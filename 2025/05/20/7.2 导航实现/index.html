<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"gen2710.netlify.app","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":true,"height":100},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="7.2 导航实现准备工作 请先安装相关的ROS功能包:  安装 gmapping 包(用于构建地图):sudo apt install ros-&lt;ROS版本&gt;-gmapping 安装地图服务包(用于保存与读取地图):sudo apt install ros-&lt;ROS版本&gt;-map-server 安装 navigation 包(用于定位以及路径规划):sudo apt ins">
<meta property="og:type" content="article">
<meta property="og:title" content="7.2 导航实现">
<meta property="og:url" content="http://gen2710.netlify.app/2025/05/20/7.2%20%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B0/index.html">
<meta property="og:site_name" content="U.N.O">
<meta property="og:description" content="7.2 导航实现准备工作 请先安装相关的ROS功能包:  安装 gmapping 包(用于构建地图):sudo apt install ros-&lt;ROS版本&gt;-gmapping 安装地图服务包(用于保存与读取地图):sudo apt install ros-&lt;ROS版本&gt;-map-server 安装 navigation 包(用于定位以及路径规划):sudo apt ins">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/slam%E6%BC%94%E7%A4%BA.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11%2014-47-29%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/amcl%E5%AE%9A%E4%BD%8D%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/amcl%E6%B5%8B%E8%AF%95.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E7%A2%B0%E6%92%9E%E7%AE%97%E6%B3%95.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/rviz%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/rviz%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%AF%BC%E8%88%AA.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E8%87%AA%E4%B8%BB%E7%A7%BB%E5%8A%A8SLAM.gif">
<meta property="article:published_time" content="2025-05-19T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-20T12:40:31.192Z">
<meta property="article:author" content="Hita">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/slam%E6%BC%94%E7%A4%BA.PNG">


<link rel="canonical" href="http://gen2710.netlify.app/2025/05/20/7.2%20%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://gen2710.netlify.app/2025/05/20/7.2%20%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B0/","path":"2025/05/20/7.2 导航实现/","title":"7.2 导航实现"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>7.2 导航实现 | U.N.O</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">U.N.O</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#7-2-%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.</span> <span class="nav-text">7.2 导航实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-1-SLAM%E5%BB%BA%E5%9B%BE"><span class="nav-number">1.1.</span> <span class="nav-text">7.2.1 SLAM建图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-gmapping-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.gmapping 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-gmapping%E8%8A%82%E7%82%B9"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.gmapping节点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1%E8%AE%A2%E9%98%85%E7%9A%84Topic"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">2.1订阅的Topic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2%E5%8F%91%E5%B8%83%E7%9A%84Topic"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">2.2发布的Topic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">2.3服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4%E5%8F%82%E6%95%B0"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">2.4参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5%E6%89%80%E9%9C%80%E7%9A%84%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">2.5所需的坐标变换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6%E5%8F%91%E5%B8%83%E7%9A%84%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="nav-number">1.1.2.6.</span> <span class="nav-text">2.6发布的坐标变换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3gmapping%E4%BD%BF%E7%94%A8"><span class="nav-number">1.1.3.</span> <span class="nav-text">3gmapping使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1%E7%BC%96%E5%86%99gmapping%E8%8A%82%E7%82%B9%E7%9B%B8%E5%85%B3launch%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">3.1编写gmapping节点相关launch文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E6%89%A7%E8%A1%8C"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">3.2 执行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-2-%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.2.</span> <span class="nav-text">7.2.2 地图服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-map-server%E7%AE%80%E4%BB%8B"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.map_server简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-map-server%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%9C%B0%E5%9B%BE%E4%BF%9D%E5%AD%98%E8%8A%82%E7%82%B9%EF%BC%88map-saver%EF%BC%89"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.map_server使用之地图保存节点（map_saver）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-map-server%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1%EF%BC%88map-server%EF%BC%89"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.map_server使用之地图服务（map_server）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-map-server%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">3.1 map_server节点说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2%E5%9C%B0%E5%9B%BE%E6%8A%93%E5%8F%96"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">3.2地图抓取</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-3-%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.3.</span> <span class="nav-text">7.2.3 定位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-amcl%E7%AE%80%E4%BB%8B"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. amcl简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.节点说明</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E8%AE%A2%E9%98%85%E7%9A%84%E8%AF%9D%E9%A2%98"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">2.1 订阅的话题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E5%8F%91%E5%B8%83%E7%9A%84%E8%AF%9D%E9%A2%98"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">2.2 发布的话题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">2.3 服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%B0%83%E7%94%A8"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">2.4 服务的调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">2.5 参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="nav-number">1.3.2.6.</span> <span class="nav-text">2.6 坐标变换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BD%BF%E7%94%A8"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E7%BC%96%E5%86%99launch%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">3.1 编写launch文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95launch%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">3.2 编写测试launch文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-%E6%89%A7%E8%A1%8C"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">3.3 执行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-4-%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92"><span class="nav-number">1.4.</span> <span class="nav-text">7.2.4 路径规划</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-move-base-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. move_base 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">2.节点说明</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E5%8A%A8%E4%BD%9C"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">2.1 动作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E8%AE%A2%E9%98%85%E7%9A%84%E8%AF%9D%E9%A2%98"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">2.2 订阅的话题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E5%8F%91%E5%B8%83%E7%9A%84%E8%AF%9D%E9%A2%98"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">2.3 发布的话题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">2.4 服务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-move-base%E4%B8%8E%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.move_base与代价地图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E6%A6%82%E5%BF%B5"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">3.1 概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E7%BB%84%E6%88%90"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">3.2 组成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-%E7%A2%B0%E6%92%9E%E7%AE%97%E6%B3%95"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">3.3 碰撞算法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-move-base%E4%BD%BF%E7%94%A8"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.move_base使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E9%85%8D%E7%BD%AElaunch%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">4.1 配置launch文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2%E9%85%8D%E7%BD%AE%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">4.2配置其他文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-%E6%B5%8B%E8%AF%95"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">4.4 测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-5-%E5%AF%BC%E8%88%AA%E4%B8%8Eslam%E5%BB%BA%E5%9B%BE"><span class="nav-number">1.5.</span> <span class="nav-text">7.2.5 导航与slam建图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%BC%96%E5%86%99launch%E6%96%87%E4%BB%B6"><span class="nav-number">1.5.1.</span> <span class="nav-text">1.编写launch文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%B5%8B%E8%AF%95"><span class="nav-number">1.5.2.</span> <span class="nav-text">2.测试</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hita"
      src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
  <p class="site-author-name" itemprop="name">Hita</p>
  <div class="site-description" itemprop="description">Gains Do not Stop!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jiangbaoaaa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiangbaoaaa" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:n13155609602@163.com" title="E-mail → mailto:n13155609602@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/05/20/7.2%20%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="7.2 导航实现 | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          7.2 导航实现
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-05-20 00:00:00 / 修改时间：20:40:31" itemprop="dateCreated datePublished" datetime="2025-05-20T00:00:00+08:00">2025-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="7-2-导航实现"><a href="#7-2-导航实现" class="headerlink" title="7.2 导航实现"></a>7.2 导航实现</h1><p><strong>准备工作</strong></p>
<p>请先安装相关的ROS功能包:</p>
<ul>
<li>安装 gmapping 包(用于构建地图):<code>sudo apt install ros-&lt;ROS版本&gt;-gmapping</code></li>
<li>安装地图服务包(用于保存与读取地图):<code>sudo apt install ros-&lt;ROS版本&gt;-map-server</code></li>
<li>安装 navigation 包(用于定位以及路径规划):<code>sudo apt install ros-&lt;ROS版本&gt;-navigation</code></li>
</ul>
<p>新建<code>nav_demo</code>功能包，并导入依赖: gmapping map_server amcl move_base</p>
<hr>
<h2 id="7-2-1-SLAM建图"><a href="#7-2-1-SLAM建图" class="headerlink" title="7.2.1 SLAM建图"></a>7.2.1 SLAM建图</h2><p>选择gmapping算法</p>
<h3 id="1-gmapping-简介"><a href="#1-gmapping-简介" class="headerlink" title="1.gmapping 简介"></a>1.gmapping 简介</h3><p>gmapping 是ROS开源社区中较为常用且比较成熟的SLAM算法之一，gmapping可以根据移动机器人里程计数据和激光雷达数据来绘制二维的栅格地图，对应的，gmapping对硬件也有一定的要求:</p>
<ul>
<li>该移动机器人可以发布里程计消息</li>
<li>机器人需要发布雷达消息(该消息可以通过水平固定安装的雷达发布，或者也可以将深度相机消息转换成雷达消息)</li>
</ul>
<h3 id="2-gmapping节点"><a href="#2-gmapping节点" class="headerlink" title="2.gmapping节点"></a>2.gmapping节点</h3><p>gmapping 功能包中的核心节点是:slam_gmapping。为了方便调用，需要先了解该节点订阅的话题、发布的话题、服务以及相关参数。</p>
<h4 id="2-1订阅的Topic"><a href="#2-1订阅的Topic" class="headerlink" title="2.1订阅的Topic"></a>2.1订阅的Topic</h4><p>tf (tf&#x2F;tfMessage)</p>
<ul>
<li>用于雷达、底盘与里程计之间的坐标变换消息。</li>
</ul>
<p>scan(sensor_msgs&#x2F;LaserScan)</p>
<ul>
<li>SLAM所需的雷达信息。</li>
</ul>
<h4 id="2-2发布的Topic"><a href="#2-2发布的Topic" class="headerlink" title="2.2发布的Topic"></a>2.2发布的Topic</h4><p>map_metadata(nav_msgs&#x2F;MapMetaData)</p>
<ul>
<li>地图元数据，包括地图的宽度、高度、分辨率等，该消息会固定更新。</li>
</ul>
<p>map(nav_msgs&#x2F;OccupancyGrid)</p>
<ul>
<li>地图栅格数据，一般会在rviz中以图形化的方式显示。</li>
</ul>
<p>~entropy(std_msgs&#x2F;Float64)</p>
<ul>
<li>机器人姿态分布熵估计(值越大，不确定性越大)。</li>
</ul>
<h4 id="2-3服务"><a href="#2-3服务" class="headerlink" title="2.3服务"></a>2.3服务</h4><p>dynamic_map(nav_msgs&#x2F;GetMap)</p>
<ul>
<li>用于获取地图数据。</li>
</ul>
<h4 id="2-4参数"><a href="#2-4参数" class="headerlink" title="2.4参数"></a>2.4参数</h4><p>~base_frame(string, default:”base_link”)</p>
<ul>
<li>机器人基坐标系。</li>
</ul>
<p>~map_frame(string, default:”map”)</p>
<ul>
<li>地图坐标系。</li>
</ul>
<p>~odom_frame(string, default:”odom”)</p>
<ul>
<li>里程计坐标系。</li>
</ul>
<p>~map_update_interval(float, default: 5.0)</p>
<ul>
<li>地图更新频率，根据指定的值设计更新间隔。</li>
</ul>
<p>~maxUrange(float, default: 80.0)</p>
<ul>
<li>激光探测的最大可用范围(超出此阈值，被截断)。</li>
</ul>
<p>~maxRange(float)</p>
<ul>
<li>激光探测的最大范围。</li>
</ul>
<p>…. 参数较多，上述是几个较为常用的参数，其他参数介绍可参考官网。</p>
<h4 id="2-5所需的坐标变换"><a href="#2-5所需的坐标变换" class="headerlink" title="2.5所需的坐标变换"></a>2.5所需的坐标变换</h4><p>雷达坐标系→基坐标系</p>
<ul>
<li>一般由 robot_state_publisher 或 static_transform_publisher 发布。</li>
</ul>
<p>基坐标系→里程计坐标系</p>
<ul>
<li>一般由里程计节点发布。</li>
</ul>
<h4 id="2-6发布的坐标变换"><a href="#2-6发布的坐标变换" class="headerlink" title="2.6发布的坐标变换"></a>2.6发布的坐标变换</h4><p>地图坐标系→里程计坐标系</p>
<ul>
<li>地图到里程计坐标系之间的变换。</li>
</ul>
<h3 id="3gmapping使用"><a href="#3gmapping使用" class="headerlink" title="3gmapping使用"></a>3gmapping使用</h3><h4 id="3-1编写gmapping节点相关launch文件"><a href="#3-1编写gmapping节点相关launch文件" class="headerlink" title="3.1编写gmapping节点相关launch文件"></a>3.1编写gmapping节点相关launch文件</h4><p>新建<code>launch</code>文件夹 新建<code>nav01_slam.launch</code>文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 仿真情况下设置为true --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;use_sim_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- gmapping 节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;gmapping&quot;</span> <span class="attr">type</span>=<span class="string">&quot;slam_gmapping&quot;</span> <span class="attr">name</span>=<span class="string">&quot;slam_gmapping&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置雷达话题 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;scan&quot;</span> <span class="attr">to</span>=<span class="string">&quot;scan&quot;</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 关键参数-坐标系 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;base_frame&quot;</span> <span class="attr">value</span>=<span class="string">&quot;base_footprint&quot;</span>/&gt;</span><span class="comment">&lt;!--底盘坐标系--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_frame&quot;</span> <span class="attr">value</span>=<span class="string">&quot;odom&quot;</span>/&gt;</span> <span class="comment">&lt;!--里程计坐标系--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;map_frame&quot;</span> <span class="attr">value</span>=<span class="string">&quot;map&quot;</span> /&gt;</span>  <span class="comment">&lt;!-- 地图坐标系 --&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;map_update_interval&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;maxUrange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;16.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;sigma&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;kernelSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lstep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;astep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;iterations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lsigma&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.075&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ogain&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lskip&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;srr&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;srt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;str&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;stt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;linearUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;angularUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;temporalUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;resampleThreshold&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;particles&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;xmin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;-50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ymin&quot;</span> <span class="attr">value</span>=<span class="string">&quot;-50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;xmax&quot;</span> <span class="attr">value</span>=<span class="string">&quot;50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ymax&quot;</span> <span class="attr">value</span>=<span class="string">&quot;50.0&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;delta&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;llsamplerange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.01&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;llsamplestep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.01&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lasamplerange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.005&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;lasamplestep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.005&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;joint_state_publisher&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;robot_state_publisher&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可以保存 rviz 配置并后期直接使用--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;node pkg=&quot;rviz&quot; type=&quot;rviz&quot; name=&quot;rviz&quot; args=&quot;-d $(find my_nav_sum)/rviz/gmapping.rviz&quot;/&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-2-执行"><a href="#3-2-执行" class="headerlink" title="3.2 执行"></a>3.2 执行</h4><ol>
<li>启动Gazebo仿真环境</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ./devel/setup.bash</span><br><span class="line">roslaunch urdf02_gazebo demo03_env.launch</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>启动地图绘制launch文件</li>
</ol>
<p><code>roslaunch nav_demo nav01_slam.launch</code></p>
<ol start="3">
<li>启动键盘控制节点</li>
</ol>
<p><code>rosrun teleop_twist_keyboard teleop_twist_keyboard.py</code></p>
<ol start="4">
<li>在rviz中添加组件，显示栅格地图</li>
</ol>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/slam%E6%BC%94%E7%A4%BA.PNG"></p>
<p>最后，就可以通过键盘控制gazebo中的机器人运动，同时，在rviz中可以显示gmapping发布的栅格地图数据了，下一步，还需要将地图单独保存。</p>
<hr>
<h2 id="7-2-2-地图服务"><a href="#7-2-2-地图服务" class="headerlink" title="7.2.2 地图服务"></a>7.2.2 地图服务</h2><p>我们需要将栅格地图序列化到的磁盘以持久化存储，后期还要通过反序列化读取磁盘的地图数据再执行后续操作。在ROS中，地图数据的序列化与反序列化可以通过 map_server 功能包实现。</p>
<hr>
<h3 id="1-map-server简介"><a href="#1-map-server简介" class="headerlink" title="1.map_server简介"></a>1.map_server简介</h3><p>map_server功能包中提供了两个节点:  map_saver 和 map_server，前者用于将栅格地图保存到磁盘，后者读取磁盘的栅格地图并以服务的方式提供出去。</p>
<h3 id="2-map-server使用之地图保存节点（map-saver）"><a href="#2-map-server使用之地图保存节点（map-saver）" class="headerlink" title="2.map_server使用之地图保存节点（map_saver）"></a>2.map_server使用之地图保存节点（map_saver）</h3><p>在工作空间下新建文件夹<code>map</code>,同时在<code>launch</code>文件夹下新建文件<code>nav02_map_save.launch</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;filename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find nav_demo)/map/nav&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;map_save&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">type</span>=<span class="string">&quot;map_saver&quot;</span> <span class="attr">args</span>=<span class="string">&quot;-f $(arg filename)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时运行此launch节点，就会在map文件夹下生成两个文件</p>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11%2014-47-29%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png"></p>
<p>xxx.pgm 本质是一张图片，直接使用图片查看程序即可打开。</p>
<p>xxx.yaml 保存的是地图的元数据信息，用于描述图片。</p>
<p>解释:</p>
<ul>
<li><strong>image</strong>:被描述的图片资源路径，可以是绝对路径也可以是相对路径。</li>
<li><strong>resolution</strong>: 图片分片率(单位: m&#x2F;像素)。</li>
<li><strong>origin</strong>: 地图中左下像素的二维姿势，为（x，y，偏航），偏航为逆时针旋转（偏航&#x3D; 0表示无旋转）。</li>
<li><strong>occupied_thresh</strong>: 占用概率大于此阈值的像素被视为完全占用。</li>
<li><strong>free_thresh</strong>: 占用率小于此阈值的像素被视为完全空闲。</li>
<li><strong>negate</strong>: 是否应该颠倒白色&#x2F;黑色自由&#x2F;占用的语义。</li>
</ul>
<p>map_server 中障碍物计算规则:</p>
<ol>
<li>地图中的每一个像素取值在 [0,255] 之间，白色为 255，黑色为 0，该值设为 x；</li>
<li>map_server 会将像素值作为判断是否是障碍物的依据，首先计算比例: p &#x3D; (255 - x) &#x2F; 255.0，白色为0，黑色为1(negate为true，则p &#x3D; x &#x2F; 255.0)；</li>
<li>根据步骤2计算的比例判断是否是障碍物，如果 p &gt; occupied_thresh 那么视为障碍物，如果 p &lt; free_thresh 那么视为无物。</li>
</ol>
<p>备注:</p>
<ul>
<li>图片也可以根据需求编辑。</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 申明地图图片资源的路径</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">/home/chenguoqing/demo05_ws/src/nav_demo/map/nav.pgm</span></span><br><span class="line"><span class="comment"># 地图刻度尺寸单位 米/像素</span></span><br><span class="line"><span class="attr">resolution:</span> <span class="number">0.050000</span></span><br><span class="line"><span class="comment"># 地图的位姿（相对于rviz中原点的位姿）</span></span><br><span class="line"><span class="attr">origin:</span> [<span class="number">-50.000000</span>, <span class="number">-50.000000</span>, <span class="number">0.000000</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 障碍物判断规则：</span></span><br><span class="line"><span class="comment"># 最终地图结果：白色是可通行区域、黑色时障碍物、灰色时未知区域 </span></span><br><span class="line"><span class="comment"># 判断规则：</span></span><br><span class="line"><span class="comment"># 1.地图中的每个像素都有取值[0,255] </span></span><br><span class="line"><span class="comment"># 2.根据像素值计算一个比例： p = (255-x)/255 白色是0,黑色是1，灰色介于两者之间</span></span><br><span class="line"><span class="comment"># 3.判断是否是障碍物 p&gt;occupied_thresh 就是障碍物   /   p&lt;free_thresh就是无物体，可以正常通行。</span></span><br><span class="line"><span class="comment"># 占用阈值</span></span><br><span class="line"><span class="attr">negate:</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># 空间阈值</span></span><br><span class="line"><span class="attr">occupied_thresh:</span> <span class="number">0.65</span></span><br><span class="line"><span class="comment"># 取反</span></span><br><span class="line"><span class="attr">free_thresh:</span> <span class="number">0.196</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h3 id="3-map-server使用之地图服务（map-server）"><a href="#3-map-server使用之地图服务（map-server）" class="headerlink" title="3.map_server使用之地图服务（map_server）"></a>3.map_server使用之地图服务（map_server）</h3><h4 id="3-1-map-server节点说明"><a href="#3-1-map-server节点说明" class="headerlink" title="3.1 map_server节点说明"></a>3.1 map_server节点说明</h4><p><strong>发布的话题</strong></p>
<p>map_metadata（nav_msgs &#x2F; MapMetaData）</p>
<ul>
<li>发布地图元数据。</li>
</ul>
<p>map（nav_msgs &#x2F; OccupancyGrid）</p>
<ul>
<li>地图数据。</li>
</ul>
<p><strong>服务</strong></p>
<p>static_map（nav_msgs &#x2F; GetMap）</p>
<ul>
<li>通过此服务获取地图。</li>
</ul>
<p><strong>参数</strong></p>
<p>〜frame_id（字符串，默认值：“map”）</p>
<ul>
<li>地图坐标系。</li>
</ul>
<h4 id="3-2地图抓取"><a href="#3-2地图抓取" class="headerlink" title="3.2地图抓取"></a>3.2地图抓取</h4><p>通过 map_server 的 map_server 节点可以读取栅格地图数据，编写 launch 文件如下:</p>
<p><code>nav03_map_server.launch</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置地图的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span> <span class="attr">default</span>=<span class="string">&quot;nav.yaml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行地图服务器，并且加载设置的地图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">type</span>=<span class="string">&quot;map_server&quot;</span> <span class="attr">args</span>=<span class="string">&quot;$(find nav_demo)/map/$(arg map)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>启动roscore,再执行此launch文件，再启动rviz。添加&#x2F;map话题。即可显示之前保存的地图。</p>
<p>![](<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11">https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11</a> 15-06-45 的屏幕截图.png)</p>
<hr>
<h2 id="7-2-3-定位"><a href="#7-2-3-定位" class="headerlink" title="7.2.3 定位"></a>7.2.3 定位</h2><p>所谓定位就是推算机器人自身在全局地图中的位置，当然，SLAM中也包含定位算法实现，不过SLAM的定位是用于构建全局地图的，是属于导航开始之前的阶段，而当前定位是用于导航中，导航中，机器人需要按照设定的路线运动，通过定位可以判断机器人的实际轨迹是否符合预期。在ROS的导航功能包集navigation中提供了 amcl 功能包，用于实现导航中的机器人定位。</p>
<h3 id="1-amcl简介"><a href="#1-amcl简介" class="headerlink" title="1. amcl简介"></a>1. amcl简介</h3><p>AMCL(adaptive Monte Carlo Localization) 是用于2D移动机器人的概率定位系统，它实现了自适应（或KLD采样）蒙特卡洛定位方法，可以根据已有地图使用粒子滤波器推算机器人位置。</p>
<h3 id="2-节点说明"><a href="#2-节点说明" class="headerlink" title="2.节点说明"></a>2.节点说明</h3><p>amcl 功能包中的核心节点是:amcl。为了方便调用，需要先了解该节点订阅的话题、发布的话题、服务以及相关参数。</p>
<h4 id="2-1-订阅的话题"><a href="#2-1-订阅的话题" class="headerlink" title="2.1 订阅的话题"></a>2.1 订阅的话题</h4><p>scan(sensor_msgs&#x2F;LaserScan)</p>
<ul>
<li>激光雷达数据。</li>
</ul>
<p>tf(tf&#x2F;tfMessage)</p>
<ul>
<li>坐标变换消息。</li>
</ul>
<p>initialpose(geometry_msgs&#x2F;PoseWithCovarianceStamped)</p>
<ul>
<li>用来初始化粒子滤波器的均值和协方差。</li>
</ul>
<p>map(nav_msgs&#x2F;OccupancyGrid)</p>
<ul>
<li>获取地图数据。</li>
</ul>
<h4 id="2-2-发布的话题"><a href="#2-2-发布的话题" class="headerlink" title="2.2 发布的话题"></a>2.2 发布的话题</h4><p>amcl_pose(geometry_msgs&#x2F;PoseWithCovarianceStamped)</p>
<ul>
<li>机器人在地图中的位姿估计。</li>
</ul>
<p>particlecloud(geometry_msgs&#x2F;PoseArray)</p>
<ul>
<li>位姿估计集合，rviz中可以被 PoseArray 订阅然后图形化显示机器人的位姿估计集合。</li>
</ul>
<p>tf(tf&#x2F;tfMessage)</p>
<ul>
<li>发布从 odom 到 map 的转换。</li>
</ul>
<h4 id="2-3-服务"><a href="#2-3-服务" class="headerlink" title="2.3 服务"></a>2.3 服务</h4><p>global_localization(std_srvs&#x2F;Empty)</p>
<ul>
<li>初始化全局定位的服务。</li>
</ul>
<p>request_nomotion_update(std_srvs&#x2F;Empty)</p>
<ul>
<li>手动执行更新和发布更新的粒子的服务。</li>
</ul>
<p>set_map(nav_msgs&#x2F;SetMap)</p>
<ul>
<li>手动设置新地图和姿态的服务。</li>
</ul>
<h4 id="2-4-服务的调用"><a href="#2-4-服务的调用" class="headerlink" title="2.4 服务的调用"></a>2.4 服务的调用</h4><p>static_map(nav_msgs&#x2F;GetMap)</p>
<ul>
<li>调用此服务获取地图数据。</li>
</ul>
<h4 id="2-5-参数"><a href="#2-5-参数" class="headerlink" title="2.5 参数"></a>2.5 参数</h4><p>~odom_model_type(string, default:”diff”)</p>
<ul>
<li>里程计模型选择: “diff”,”omni”,”diff-corrected”,”omni-corrected” (diff 差速、omni 全向轮)</li>
</ul>
<p>~odom_frame_id(string, default:”odom”)</p>
<ul>
<li>里程计坐标系。</li>
</ul>
<p>~base_frame_id(string, default:”base_link”)</p>
<ul>
<li>机器人极坐标系。</li>
</ul>
<p>~global_frame_id(string, default:”map”)</p>
<ul>
<li>地图坐标系。</li>
</ul>
<h4 id="2-6-坐标变换"><a href="#2-6-坐标变换" class="headerlink" title="2.6 坐标变换"></a>2.6 坐标变换</h4><p>里程计本身也是可以协助机器人定位的，不过里程计存在累计误差且一些特殊情况时(车轮打滑)会出现定位错误的情况，amcl 则可以通过估算机器人在地图坐标系下的姿态，再结合里程计提高定位准确度。</p>
<ul>
<li>里程计定位:只是通过里程计数据实现 &#x2F;odom_frame 与 &#x2F;base_frame 之间的坐标变换。</li>
<li>amcl定位: 可以提供 &#x2F;map_frame 、&#x2F;odom_frame 与 &#x2F;base_frame 之间的坐标变换。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/amcl%E5%AE%9A%E4%BD%8D%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2.png"></p>
<hr>
<h3 id="3-使用"><a href="#3-使用" class="headerlink" title="3.使用"></a>3.使用</h3><h4 id="3-1-编写launch文件"><a href="#3-1-编写launch文件" class="headerlink" title="3.1 编写launch文件"></a>3.1 编写launch文件</h4><p>新建<code>nav04_amcl.launch</code></p>
<p>关于launch文件的实现，在amcl功能包下的example目录已经给出了示例，可以作为参考</p>
<p>![](<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11">https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11</a> 15-58-52 的屏幕截图.png)</p>
<p>该目录下会列出两个文件: amcl_diff.launch 和 amcl_omni.launch 文件，前者适用于差分移动机器人，后者适用于全向移动机器人，可以按需选择.使用命令：<code>gedit examples/amcl_diff.launch</code>可以在笔记本中显示。</p>
<p>选择前者，进行相关修改：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;amcl&quot;</span> <span class="attr">type</span>=<span class="string">&quot;amcl&quot;</span> <span class="attr">name</span>=<span class="string">&quot;amcl&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Publish scans from best pose at a max of 10 Hz --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_model_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;diff&quot;</span>/&gt;</span><span class="comment">&lt;!-- 里程计模式为差分 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha5&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;transform_tolerance&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;gui_publish_rate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_max_beams&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;min_particles&quot;</span> <span class="attr">value</span>=<span class="string">&quot;500&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;max_particles&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;kld_err&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;kld_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.99&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- translation std dev, m --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.8&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_alpha4&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_hit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_short&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_max&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_z_rand&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_sigma_hit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_lambda_short&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_lambda_short&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_model_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;likelihood_field&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;param name=&quot;laser_model_type&quot; value=&quot;beam&quot;/&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;laser_likelihood_max_dist&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;update_min_d&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;update_min_a&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;odom_frame_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;odom&quot;</span>/&gt;</span><span class="comment">&lt;!-- 里程计坐标系 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;base_frame_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;base_footprint&quot;</span>/&gt;</span><span class="comment">&lt;!-- 添加机器人基坐标系 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;global_frame_id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;map&quot;</span>/&gt;</span><span class="comment">&lt;!-- 添加地图坐标系 --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;resample_interval&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;transform_tolerance&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;recovery_alpha_slow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;recovery_alpha_fast&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-2-编写测试launch文件"><a href="#3-2-编写测试launch文件" class="headerlink" title="3.2 编写测试launch文件"></a>3.2 编写测试launch文件</h4><p>amcl节点是不可以单独运行的，运行 amcl 节点之前，需要先加载全局地图，然后启动 rviz 显示定位结果，上述节点可以集成进launch文件，内容示例如下:</p>
<p>新建<code>test_amcl.launch</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置地图的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span> <span class="attr">default</span>=<span class="string">&quot;nav.yaml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;joint_state_publisher&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;robot_state_publisher&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载地图服务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_demo)/launch/nav03_map_server.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- amcl文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_demo)/launch/nav04_amcl.launch&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-3-执行"><a href="#3-3-执行" class="headerlink" title="3.3 执行"></a>3.3 执行</h4><p>1.先启动 Gazebo 仿真环境(此过程略)；</p>
<p>2.启动键盘控制节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun teleop_twist_keyboard teleop_twist_keyboard.py</span><br></pre></td></tr></table></figure>

<p>3.启动上一步中集成地图服务、amcl 与 rviz 的 launch 文件；</p>
<p>4.在启动的 rviz 中，添加RobotModel、Map组件，分别显示机器人模型与地图，添加 posearray  插件，设置topic为particlecloud来显示 amcl 预估的当前机器人的位姿，箭头越是密集，说明当前机器人处于此位置的概率越高；</p>
<p>5.通过键盘控制机器人运动，会发现 posearray 也随之而改变。</p>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/amcl%E6%B5%8B%E8%AF%95.gif"></p>
<hr>
<h2 id="7-2-4-路径规划"><a href="#7-2-4-路径规划" class="headerlink" title="7.2.4 路径规划"></a>7.2.4 路径规划</h2><p>毋庸置疑的，路径规划是导航中的核心功能之一，在ROS的导航功能包集navigation中提供了 move_base 功能包，用于实现此功能。</p>
<hr>
<h3 id="1-move-base-简介"><a href="#1-move-base-简介" class="headerlink" title="1. move_base 简介"></a>1. move_base 简介</h3><p>move_base 功能包提供了基于动作(action)的路径规划实现，move_base  可以根据给定的目标点，控制机器人底盘运动至目标位置，并且在运动过程中会连续反馈机器人自身的姿态与目标点的状态信息。如前所述(7.1)move_base主要由全局路径规划与本地路径规划组成。</p>
<h3 id="2-节点说明-1"><a href="#2-节点说明-1" class="headerlink" title="2.节点说明"></a>2.节点说明</h3><p>move_base功能包中的核心节点是:move_base。为了方便调用，需要先了解该节点action、订阅的话题、发布的话题、服务以及相关参数。</p>
<h4 id="2-1-动作"><a href="#2-1-动作" class="headerlink" title="2.1 动作"></a>2.1 动作</h4><p><strong>动作订阅</strong></p>
<p>move_base&#x2F;goal(move_base_msgs&#x2F;MoveBaseActionGoal)</p>
<ul>
<li>move_base 的运动规划目标。</li>
</ul>
<p>move_base&#x2F;cancel(actionlib_msgs&#x2F;GoalID)</p>
<ul>
<li>取消目标。</li>
</ul>
<p><strong>动作发布</strong></p>
<p>move_base&#x2F;feedback(move_base_msgs&#x2F;MoveBaseActionFeedback)</p>
<ul>
<li>连续反馈的信息，包含机器人底盘坐标。</li>
</ul>
<p>move_base&#x2F;status(actionlib_msgs&#x2F;GoalStatusArray)</p>
<ul>
<li>发送到move_base的目标状态信息。</li>
</ul>
<p>move_base&#x2F;result(move_base_msgs&#x2F;MoveBaseActionResult)</p>
<ul>
<li>操作结果(此处为空)。</li>
</ul>
<h4 id="2-2-订阅的话题"><a href="#2-2-订阅的话题" class="headerlink" title="2.2 订阅的话题"></a>2.2 订阅的话题</h4><p>move_base_simple&#x2F;goal(geometry_msgs&#x2F;PoseStamped)</p>
<ul>
<li>运动规划目标(与action相比，没有连续反馈，无法追踪机器人执行状态)。</li>
</ul>
<h4 id="2-3-发布的话题"><a href="#2-3-发布的话题" class="headerlink" title="2.3 发布的话题"></a>2.3 发布的话题</h4><p>cmd_vel(geometry_msgs&#x2F;Twist)</p>
<ul>
<li>输出到机器人底盘的运动控制消息。</li>
</ul>
<h4 id="2-4-服务"><a href="#2-4-服务" class="headerlink" title="2.4 服务"></a>2.4 服务</h4><p>~make_plan(nav_msgs&#x2F;GetPlan)</p>
<ul>
<li>请求该服务，可以获取给定目标的规划路径，但是并不执行该路径规划。</li>
</ul>
<p>~clear_unknown_space(std_srvs&#x2F;Empty)</p>
<ul>
<li>允许用户直接清除机器人周围的未知空间。</li>
</ul>
<p>~clear_costmaps(std_srvs&#x2F;Empty)</p>
<ul>
<li>允许清除代价地图中的障碍物，可能会导致机器人与障碍物碰撞，请慎用。</li>
</ul>
<hr>
<h3 id="3-move-base与代价地图"><a href="#3-move-base与代价地图" class="headerlink" title="3.move_base与代价地图"></a>3.move_base与代价地图</h3><h4 id="3-1-概念"><a href="#3-1-概念" class="headerlink" title="3.1 概念"></a>3.1 概念</h4><p>机器人导航(尤其是路径规划模块)是依赖于地图的，地图在SLAM时已经有所介绍了，ROS中的地图其实就是一张图片，这张图片有宽度、高度、分辨率等元数据，在图片中使用灰度值来表示障碍物存在的概率。不过SLAM构建的地图在导航中是不可以直接使用的，因为：</p>
<ol>
<li>SLAM构建的地图是静态地图，而导航过程中，障碍物信息是可变的，可能障碍物被移走了，也可能添加了新的障碍物，导航中需要时时的获取障碍物信息；</li>
<li>在靠近障碍物边缘时，虽然此处是空闲区域，但是机器人在进入该区域后可能由于其他一些因素，比如：惯性、或者不规则形体的机器人转弯时可能会与障碍物产生碰撞，安全起见，最好在地图的障碍物边缘设置警戒区，尽量禁止机器人进入…</li>
</ol>
<p>所以，静态地图无法直接应用于导航，其基础之上需要添加一些辅助信息的地图，比如时时获取的障碍物数据，基于静态地图添加的膨胀区等数据。</p>
<h4 id="3-2-组成"><a href="#3-2-组成" class="headerlink" title="3.2 组成"></a>3.2 组成</h4><p>代价地图有两张:global_costmap(全局代价地图) 和 local_costmap(本地代价地图)，前者用于全局路径规划，后者用于本地路径规划。</p>
<p>两张代价地图都可以多层叠加,一般有以下层级:</p>
<ul>
<li>Static Map Layer：静态地图层，SLAM构建的静态地图。</li>
<li>Obstacle Map Layer：障碍地图层，传感器感知的障碍物信息。</li>
<li>Inflation Layer：膨胀层，在以上两层地图上进行膨胀（向外扩张），以避免机器人的外壳会撞上障碍物。</li>
<li>Other Layers：根据业务自设置的地图数据。</li>
</ul>
<p>多个layer可以按需自由搭配。</p>
<p>![](<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11">https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/2025-04-11</a> 16-50-00 的屏幕截图.png)</p>
<h4 id="3-3-碰撞算法"><a href="#3-3-碰撞算法" class="headerlink" title="3.3 碰撞算法"></a>3.3 碰撞算法</h4><p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E7%A2%B0%E6%92%9E%E7%AE%97%E6%B3%95.jpg"></p>
<p>上图中，横轴是距离机器人中心的距离，纵轴是代价地图中栅格的灰度值。</p>
<ul>
<li>致命障碍:栅格值为254，此时障碍物与机器人中心重叠，必然发生碰撞；</li>
<li>内切障碍:栅格值为253，此时障碍物处于机器人的内切圆内，必然发生碰撞；</li>
<li>外切障碍:栅格值为[128,252]，此时障碍物处于其机器人的外切圆内，处于碰撞临界，不一定发生碰撞；</li>
<li>非自由空间:栅格值为(0,127]，此时机器人处于障碍物附近，属于危险警戒区，进入此区域，将来可能会发生碰撞；</li>
<li>自由区域:栅格值为0，此处机器人可以自由通过；</li>
<li>未知区域:栅格值为255，还没探明是否有障碍物。</li>
</ul>
<p>膨胀空间的设置可以参考非自由空间。</p>
<hr>
<h3 id="4-move-base使用"><a href="#4-move-base使用" class="headerlink" title="4.move_base使用"></a>4.move_base使用</h3><p> 路径规划算法在move_base功能包的move_base节点中已经封装完毕了，但是还不可以直接调用，因为算法虽然已经封装了，但是该功能包面向的是各种类型支持ROS的机器人，不同类型机器人可能大小尺寸不同，传感器不同，速度不同，应用场景不同….最后可能会导致不同的路径规划结果，那么在调用路径规划节点之前，我们还需要配置机器人参数。具体实现如下:</p>
<ol>
<li>先编写launch文件模板</li>
<li>编写配置文件</li>
<li>集成导航相关的launch文件</li>
<li>测试</li>
</ol>
<h4 id="4-1-配置launch文件"><a href="#4-1-配置launch文件" class="headerlink" title="4.1 配置launch文件"></a>4.1 配置launch文件</h4><p>新建<code>nav05_path.launch</code></p>
<p>按住 <code> ctr+f</code> 可以快速定位+修改 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">type</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">name</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">clear_params</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_de)/param/costmap_common_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;global_costmap&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_de)/param/costmap_common_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;local_costmap&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_de)/param/local_costmap_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_de)/param/global_costmap_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_de)/param/base_local_planner_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-2配置其他文件"><a href="#4-2配置其他文件" class="headerlink" title="4.2配置其他文件"></a>4.2配置其他文件</h4><p>在功能包下新建 param 目录，新建上面四个文件：costmap_common_params.yaml、local_costmap_params.yaml、global_costmap_params.yaml、base_local_planner_params.yaml</p>
<p>配置相关四个文件：</p>
<p><code>base_local_planner_params.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">TrajectoryPlannerROS:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Robot Configuration Parameters</span></span><br><span class="line">  <span class="attr">max_vel_x:</span> <span class="number">0.5</span> <span class="comment"># X 方向最大速度</span></span><br><span class="line">  <span class="attr">min_vel_x:</span> <span class="number">0.1</span> <span class="comment"># X 方向最小速速</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">max_vel_theta:</span>  <span class="number">1.0</span> <span class="comment"># </span></span><br><span class="line">  <span class="attr">min_vel_theta:</span> <span class="number">-1.0</span></span><br><span class="line">  <span class="attr">min_in_place_vel_theta:</span> <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">acc_lim_x:</span> <span class="number">1.0</span> <span class="comment"># X 加速限制</span></span><br><span class="line">  <span class="attr">acc_lim_y:</span> <span class="number">0.0</span> <span class="comment"># Y 加速限制</span></span><br><span class="line">  <span class="attr">acc_lim_theta:</span> <span class="number">0.6</span> <span class="comment"># 角速度加速限制</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Goal Tolerance Parameters，目标公差</span></span><br><span class="line">  <span class="attr">xy_goal_tolerance:</span> <span class="number">0.10</span></span><br><span class="line">  <span class="attr">yaw_goal_tolerance:</span> <span class="number">0.05</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Differential-drive robot configuration</span></span><br><span class="line"><span class="comment"># 是否是全向移动机器人</span></span><br><span class="line">  <span class="attr">holonomic_robot:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward Simulation Parameters，前进模拟参数</span></span><br><span class="line">  <span class="attr">sim_time:</span> <span class="number">0.8</span></span><br><span class="line">  <span class="attr">vx_samples:</span> <span class="number">18</span></span><br><span class="line">  <span class="attr">vtheta_samples:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">sim_granularity:</span> <span class="number">0.05</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>costmap_common_params.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#机器人几何参，如果机器人是圆形，设置 robot_radius,如果是其他形状设置 footprint</span></span><br><span class="line"><span class="attr">robot_radius:</span> <span class="number">0.12</span> <span class="comment">#圆形</span></span><br><span class="line"><span class="comment"># footprint: [[-0.12, -0.12], [-0.12, 0.12], [0.12, 0.12], [0.12, -0.12]] #其他形状</span></span><br><span class="line"></span><br><span class="line"><span class="attr">obstacle_range:</span> <span class="number">3.0</span> <span class="comment"># 用于障碍物探测，比如: 值为 3.0，意味着检测到距离小于 3 米的障碍物时，就会引入代价地图</span></span><br><span class="line"><span class="attr">raytrace_range:</span> <span class="number">3.5</span> <span class="comment"># 用于清除障碍物，比如：值为 3.5，意味着清除代价地图中 3.5 米以外的障碍物</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#膨胀半径，扩展在碰撞区域以外的代价区域，使得机器人规划路径避开障碍物</span></span><br><span class="line"><span class="attr">inflation_radius:</span> <span class="number">0.2</span></span><br><span class="line"><span class="comment">#代价比例系数，越大则代价值越小</span></span><br><span class="line"><span class="attr">cost_scaling_factor:</span> <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#地图类型</span></span><br><span class="line"><span class="attr">map_type:</span> <span class="string">costmap</span></span><br><span class="line"><span class="comment">#导航包所需要的传感器</span></span><br><span class="line"><span class="attr">observation_sources:</span> <span class="string">scan</span></span><br><span class="line"><span class="comment">#对传感器的坐标系和数据进行配置。这个也会用于代价地图添加和清除障碍物。例如，你可以用激光雷达传感器用于在代价地图添加障碍物，再添加kinect用于导航和清除障碍物。</span></span><br><span class="line"><span class="attr">scan:</span> &#123;<span class="attr">sensor_frame:</span> <span class="string">laser</span>, <span class="attr">data_type:</span> <span class="string">LaserScan</span>, <span class="attr">topic:</span> <span class="string">scan</span>, <span class="attr">marking:</span> <span class="literal">true</span>, <span class="attr">clearing:</span> <span class="literal">true</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>global_costmap_params.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global_costmap:</span></span><br><span class="line">  <span class="attr">global_frame:</span> <span class="string">map</span> <span class="comment">#地图坐标系</span></span><br><span class="line">  <span class="attr">robot_base_frame:</span> <span class="string">base_footprint</span> <span class="comment">#机器人坐标系</span></span><br><span class="line">  <span class="comment"># 以此实现坐标变换</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">update_frequency:</span> <span class="number">1.0</span> <span class="comment">#代价地图更新频率</span></span><br><span class="line">  <span class="attr">publish_frequency:</span> <span class="number">1.0</span> <span class="comment">#代价地图的发布频率</span></span><br><span class="line">  <span class="attr">transform_tolerance:</span> <span class="number">0.5</span> <span class="comment">#等待坐标变换发布信息的超时时间</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">static_map:</span> <span class="literal">true</span> <span class="comment"># 是否使用一个地图或者地图服务器来初始化全局代价地图，如果不使用静态地图，这个参数为false.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>base_local_planner_params.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">xinjilocal_costmap:</span></span><br><span class="line">  <span class="attr">global_frame:</span> <span class="string">odom</span> <span class="comment">#里程计坐标系</span></span><br><span class="line">  <span class="attr">robot_base_frame:</span> <span class="string">base_footprint</span> <span class="comment">#机器人坐标系</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">update_frequency:</span> <span class="number">10.0</span> <span class="comment">#代价地图更新频率</span></span><br><span class="line">  <span class="attr">publish_frequency:</span> <span class="number">10.0</span> <span class="comment">#代价地图的发布频率</span></span><br><span class="line">  <span class="attr">transform_tolerance:</span> <span class="number">0.5</span> <span class="comment">#等待坐标变换发布信息的超时时间</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">static_map:</span> <span class="literal">false</span>  <span class="comment">#不需要静态地图，可以提升导航效果</span></span><br><span class="line">  <span class="attr">rolling_window:</span> <span class="literal">true</span> <span class="comment">#是否使用动态窗口，默认为false，在静态的全局地图中，地图不会变化</span></span><br><span class="line">  <span class="attr">width:</span> <span class="number">3</span> <span class="comment"># 局部地图宽度 单位是 m</span></span><br><span class="line">  <span class="attr">height:</span> <span class="number">3</span> <span class="comment"># 局部地图高度 单位是 m</span></span><br><span class="line">  <span class="attr">resolution:</span> <span class="number">0.05</span> <span class="comment"># 局部地图分辨率 单位是 m，一般与静态地图分辨率保持一致</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>新建<code>nav06_test.launch</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行地图服务器，并且加载设置的地图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_demo)/launch/nav03_map_server.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 启动AMCL节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_demo)/launch/nav04_amcl.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 运行move_base节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_demo)/launch/nav05_path.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;joint_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;joint_state_publisher&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;robot_state_publisher&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-4-测试"><a href="#4-4-测试" class="headerlink" title="4.4 测试"></a>4.4 测试</h4><p>1.先启动 Gazebo 仿真环境(此过程略)；</p>
<p>2.启动导航相关的 launch 文件；</p>
<p>3.添加Rviz组件(参考演示结果),可以将配置数据保存，后期直接调用；</p>
<p>全局代价地图与本地代价地图组件配置如下:</p>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/rviz%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE.PNG"></p>
<p>全局路径规划与本地路径规划组件配置如下:</p>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/rviz%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92.PNG"></p>
<p>4.通过Rviz工具栏的 2D Nav Goal设置目的地实现导航。</p>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%AF%BC%E8%88%AA.gif"></p>
<p>5.也可以在导航过程中，添加新的障碍物，机器人也可以自动躲避障碍物。</p>
<p>直接在gazebo中添加即可。</p>
<hr>
<h2 id="7-2-5-导航与slam建图"><a href="#7-2-5-导航与slam建图" class="headerlink" title="7.2.5 导航与slam建图"></a>7.2.5 导航与slam建图</h2><blockquote>
<p>场景:在 7.2.1 导航实现01_SLAM建图中，我们是通过键盘控制机器人移动实现建图的，而后续又介绍了机器人的自主移动实现，那么可不可以将二者结合，实现机器人自主移动的SLAM建图呢？</p>
</blockquote>
<p>上述需求是可行的。虽然可能会有疑问，导航时需要地图信息，之前导航实现时，是通过 map_server 包的 map_server  节点来发布地图信息的，如果不先通过SLAM建图，那么如何发布地图信息呢？SLAM建图过程中本身就会时时发布地图信息，所以无需再使用map_server，SLAM已经发布了话题为 &#x2F;map 的地图消息了，且导航需要定位模块，SLAM本身也是可以实现定位的。</p>
<p>该过程实现比较简单，步骤如下:</p>
<ol>
<li>编写launch文件，集成SLAM与move_base相关节点；</li>
<li>执行launch文件并测试。</li>
</ol>
<hr>
<h3 id="1-编写launch文件"><a href="#1-编写launch文件" class="headerlink" title="1.编写launch文件"></a>1.编写launch文件</h3><p>当前launch文件实现，无需调用map_server的相关节点，只需要启动SLAM节点与move_base节点。</p>
<p>修改<code>nav01_slam.launch</code>文件，可以直接调用之前配置好的rviz文件</p>
<p>​    <code>&lt;node pkg=&quot;rviz&quot; type=&quot;rviz&quot; name=&quot;rviz&quot; args=&quot;-d $(find nav_demo)/config/nav_test.rviz&quot; /&gt;</code></p>
<p>新建文件<code>nav07_slam_auto.launch</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 集成SLAM与导航，实现自主移动与地图构建 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- slam实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_demo)/launch/nav01_slam.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行move_base节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_demo)/launch/nav05_path.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-测试"><a href="#2-测试" class="headerlink" title="2.测试"></a>2.测试</h3><p>1.首先运行gazebo仿真环境；</p>
<p>2.然后执行launch文件；</p>
<p>3.在rviz中通过2D Nav Goal设置目标点，机器人开始自主移动并建图了；</p>
<p>4.最后可以使用 map_server 保存地图。</p>
<p><img src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E8%87%AA%E4%B8%BB%E7%A7%BB%E5%8A%A8SLAM.gif"></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/05/20/7.3%20%E5%AF%BC%E8%88%AA%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF/" rel="prev" title="7.3 导航相关消息">
                  <i class="fa fa-angle-left"></i> 7.3 导航相关消息
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/05/20/7.1%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA%E6%A6%82%E8%BF%B0/" rel="next" title="7.1 机器人导航概述">
                  7.1 机器人导航概述 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hita</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
