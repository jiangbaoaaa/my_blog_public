<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"gen2710.netlify.app","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":true,"height":100},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Gains Do not Stop!">
<meta property="og:type" content="website">
<meta property="og:title" content="U.N.O">
<meta property="og:url" content="http://gen2710.netlify.app/index.html">
<meta property="og:site_name" content="U.N.O">
<meta property="og:description" content="Gains Do not Stop!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Hita">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://gen2710.netlify.app/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>U.N.O</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">U.N.O</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hita"
      src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
  <p class="site-author-name" itemprop="name">Hita</p>
  <div class="site-description" itemprop="description">Gains Do not Stop!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jiangbaoaaa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiangbaoaaa" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:n13155609602@163.com" title="E-mail → mailto:n13155609602@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/04/%E5%88%A9%E7%94%A8RealsenseD435%E5%AE%9E%E7%8E%B0%E7%81%AB%E7%84%B0%E8%AF%86%E5%88%AB%E5%8F%8A%E5%AE%9A%E4%BD%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/04/%E5%88%A9%E7%94%A8RealsenseD435%E5%AE%9E%E7%8E%B0%E7%81%AB%E7%84%B0%E8%AF%86%E5%88%AB%E5%8F%8A%E5%AE%9A%E4%BD%8D/" class="post-title-link" itemprop="url">利用RealsenseD435实现火焰识别及定位</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-04 00:00:00 / 修改时间：16:54:54" itemprop="dateCreated datePublished" datetime="2025-07-04T00:00:00+08:00">2025-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="利用RealsenseD435实现火焰识别及定位"><a href="#利用RealsenseD435实现火焰识别及定位" class="headerlink" title="利用RealsenseD435实现火焰识别及定位"></a>利用RealsenseD435实现火焰识别及定位</h1><h2 id="算法思路"><a href="#算法思路" class="headerlink" title="算法思路"></a>算法思路</h2><p>首先需要将Realsense D435相机的深度图像与RGB图像对齐，大致意思就是使得深度图像显示的画面与RGB图像显示的画面匹配，方便后面确定火焰的位置。由于此相机内直接节点实现了相机标定的功能，所以只需要订阅相关节点即可实现两个图像的对齐。这里不再赘述，上一片有些许介绍，同时可以参考官网资料查看。如果只是应用的话，大可不必了解那么深入。完成对齐之后，利用之前简单的火焰识别算法，获取火焰在RGB图像中的像素位置，然后在深度图像中，转换成具体的3D位置，就大功告成了。其实整个框架很简单，但是算法的精度仍然需要花时间打磨，这里只是做一个简单的实现。</p>
<hr>
<h2 id="火焰识别算法改进"><a href="#火焰识别算法改进" class="headerlink" title="火焰识别算法改进"></a>火焰识别算法改进</h2><p>之前的文章中已经有了一个基础的火焰识别算法，但是只是标记了火焰的位置，并没有标记出坐标，同时需要发布坐标消息给定位算法订阅。所以做了些许改进。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Point</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FireDetector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="comment"># 动态HSV阈值（初始值）</span></span><br><span class="line">        <span class="variable language_">self</span>.fire_pub = rospy.Publisher(<span class="string">&quot;/fire_center_px&quot;</span>, Point, queue_size=<span class="number">10</span>)</span><br><span class="line">        <span class="variable language_">self</span>.lower_fire = np.array([<span class="number">0</span>, <span class="number">150</span>, <span class="number">100</span>])  </span><br><span class="line">        <span class="variable language_">self</span>.upper_fire = np.array([<span class="number">30</span>, <span class="number">255</span>, <span class="number">255</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 运动检测相关</span></span><br><span class="line">        <span class="variable language_">self</span>.prev_gray = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.fgbg = cv2.createBackgroundSubtractorMOG2(history=<span class="number">500</span>, varThreshold=<span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 订阅图像</span></span><br><span class="line">        <span class="variable language_">self</span>.image_sub = rospy.Subscriber(<span class="string">&quot;/camera/color/image_raw&quot;</span>, </span><br><span class="line">                                        Image, <span class="variable language_">self</span>.image_callback)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dynamic_threshold</span>(<span class="params">self, hsv_img</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;动态调整饱和度阈值&quot;&quot;&quot;</span></span><br><span class="line">        avg_sat = np.mean(hsv_img[:,:,<span class="number">1</span>])</span><br><span class="line">        <span class="variable language_">self</span>.lower_fire[<span class="number">1</span>] = <span class="built_in">max</span>(<span class="number">100</span>, <span class="built_in">int</span>(avg_sat * <span class="number">0.65</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">motion_analysis</span>(<span class="params">self, frame</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运动特征分析&quot;&quot;&quot;</span></span><br><span class="line">        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line">        fgmask = <span class="variable language_">self</span>.fgbg.apply(gray)</span><br><span class="line">        <span class="keyword">return</span> cv2.medianBlur(fgmask, <span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cv_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(msg, <span class="string">&quot;bgr8&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 预处理</span></span><br><span class="line">            blurred = cv2.GaussianBlur(cv_image, (<span class="number">7</span>,<span class="number">7</span>), <span class="number">0</span>)</span><br><span class="line">            hsv = cv2.cvtColor(blurred, cv2.COLOR_BGR2HSV)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 动态阈值调整</span></span><br><span class="line">            <span class="variable language_">self</span>.dynamic_threshold(hsv)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 颜色检测</span></span><br><span class="line">            color_mask = cv2.inRange(hsv, <span class="variable language_">self</span>.lower_fire, <span class="variable language_">self</span>.upper_fire)</span><br><span class="line">            color_mask = cv2.morphologyEx(color_mask, cv2.MORPH_CLOSE, </span><br><span class="line">                                        np.ones((<span class="number">7</span>,<span class="number">7</span>), np.uint8))</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 运动检测</span></span><br><span class="line">            motion_mask = <span class="variable language_">self</span>.motion_analysis(cv_image)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 多特征融合</span></span><br><span class="line">            combined_mask = cv2.bitwise_and(color_mask, motion_mask)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 精确轮廓检测</span></span><br><span class="line">            contours, _ = cv2.findContours(combined_mask, cv2.RETR_EXTERNAL,</span><br><span class="line">                                         cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> cnt <span class="keyword">in</span> contours:</span><br><span class="line">                area = cv2.contourArea(cnt)</span><br><span class="line">                <span class="keyword">if</span> area &gt; <span class="number">800</span>:  <span class="comment"># 增大面积阈值减少误检</span></span><br><span class="line">                    x,y,w,h = cv2.boundingRect(cnt)</span><br><span class="line">                    <span class="comment">#计算火焰中心点</span></span><br><span class="line">                    center = Point()</span><br><span class="line">                    center.x = x + w//<span class="number">2</span></span><br><span class="line">                    center.y = y + h//<span class="number">2</span></span><br><span class="line">                    <span class="variable language_">self</span>.fire_pub.publish(center)</span><br><span class="line"></span><br><span class="line">                    aspect_ratio = <span class="built_in">float</span>(w)/h</span><br><span class="line">                    <span class="keyword">if</span> <span class="number">0.5</span> &lt; aspect_ratio &lt; <span class="number">2.0</span>:  <span class="comment"># 火焰通常不是极端长条形</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">#可视化标记点</span></span><br><span class="line">                        cv2.rectangle(cv_image, (x,y), (x+w,y+h), (<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>), <span class="number">2</span>)     <span class="comment">#红色框标记火焰</span></span><br><span class="line">                        cv2.circle(cv_image, (center.x, center.y), <span class="number">5</span>, (<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>), -<span class="number">1</span>)   <span class="comment">#蓝色小点表示火焰中心位置</span></span><br><span class="line">                        cv2.putText(cv_image, <span class="string">f&#x27;Fire <span class="subst">&#123;area:<span class="number">.0</span>f&#125;</span>&#x27;</span>, (x,y-<span class="number">10</span>),         </span><br><span class="line">                                   cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.7</span>, (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>), <span class="number">2</span>)     <span class="comment">#绿色表示像素面积</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 显示调试视图</span></span><br><span class="line">            debug_view = np.hstack([</span><br><span class="line">                cv_image,</span><br><span class="line">                cv2.cvtColor(combined_mask, cv2.COLOR_GRAY2BGR)</span><br><span class="line">            ])</span><br><span class="line">            cv2.imshow(<span class="string">&quot;Fire Detection&quot;</span>, debug_view)</span><br><span class="line">            cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;fire_detector&#x27;</span>)</span><br><span class="line">    detector = FireDetector()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>算法源码可以清楚看到，计算出火焰中心点后，会通过**&#x2F;fire_center_px<strong>话题发布为</strong>geometry_msgs&#x2F;Point**消息。</p>
<hr>
<h2 id="火焰3D定位"><a href="#火焰3D定位" class="headerlink" title="火焰3D定位"></a>火焰3D定位</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image, CameraInfo</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Point, PointStamped</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fire3DLocator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.intrinsics = <span class="literal">None</span></span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/aligned_depth_to_color/image_raw&quot;</span>, Image, <span class="variable language_">self</span>.depth_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/color/camera_info&quot;</span>, CameraInfo, <span class="variable language_">self</span>.info_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_center_px&quot;</span>, Point, <span class="variable language_">self</span>.fire_callback)</span><br><span class="line">        <span class="variable language_">self</span>.pub = rospy.Publisher(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">        cv2.namedWindow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.WINDOW_NORMAL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.intrinsics:</span><br><span class="line">            <span class="variable language_">self</span>.intrinsics = &#123;</span><br><span class="line">                <span class="string">&#x27;fx&#x27;</span>: msg.K[<span class="number">0</span>], <span class="string">&#x27;fy&#x27;</span>: msg.K[<span class="number">4</span>],</span><br><span class="line">                <span class="string">&#x27;cx&#x27;</span>: msg.K[<span class="number">2</span>], <span class="string">&#x27;cy&#x27;</span>: msg.K[<span class="number">5</span>]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">depth_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(msg, <span class="string">&quot;passthrough&quot;</span>)</span><br><span class="line">        <span class="comment"># 深度图归一化显示</span></span><br><span class="line">        norm_depth = cv2.normalize(<span class="variable language_">self</span>.depth_image, <span class="literal">None</span>, <span class="number">0</span>, <span class="number">255</span>, cv2.NORM_MINMAX, dtype=cv2.CV_8U)</span><br><span class="line">        cv2.imshow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.applyColorMap(norm_depth, cv2.COLORMAP_JET))</span><br><span class="line">        cv2.waitKey(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fire_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.depth_image <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="variable language_">self</span>.intrinsics <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        u, v = <span class="built_in">int</span>(msg.x), <span class="built_in">int</span>(msg.y)</span><br><span class="line">        depth = <span class="variable language_">self</span>.depth_image[v, u] / <span class="number">1000.0</span>  <span class="comment"># mm转m</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="number">0.1</span> &lt; depth &lt; <span class="number">10.0</span>:  <span class="comment"># 有效距离范围</span></span><br><span class="line">            point = PointStamped()</span><br><span class="line">            point.header.stamp = rospy.Time.now()</span><br><span class="line">            point.header.frame_id = <span class="string">&quot;camera_color_optical_frame&quot;</span></span><br><span class="line">            point.point.x = (u - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cx&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fx&#x27;</span>]</span><br><span class="line">            point.point.y = (v - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cy&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fy&#x27;</span>]</span><br><span class="line">            point.point.z = depth</span><br><span class="line">            <span class="variable language_">self</span>.pub.publish(point)</span><br><span class="line">            rospy.loginfo(<span class="string">f&quot;Fire 3D Position: X=<span class="subst">&#123;point.point.x:<span class="number">.2</span>f&#125;</span>m Y=<span class="subst">&#123;point.point.y:<span class="number">.2</span>f&#125;</span>m Z=<span class="subst">&#123;point.point.z:<span class="number">.2</span>f&#125;</span>m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;fire_3d_locator&#x27;</span>)</span><br><span class="line">    Fire3DLocator()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>大致步骤如下：</p>
<ol>
<li>创建fire_3d_locator节点，实现三订阅一发布的通信模式</li>
<li>深度图订阅(&#x2F;camera&#x2F;aligned_depth_to_color&#x2F;image_raw)</li>
<li>相机内参订阅(&#x2F;camera&#x2F;color&#x2F;camera_info)</li>
<li>火焰像素坐标订阅(&#x2F;fire_center_px)</li>
<li>3D坐标发布(&#x2F;fire_position_3d)</li>
</ol>
<hr>
<h3 id="数据流处理链"><a href="#数据流处理链" class="headerlink" title="数据流处理链"></a>数据流处理链</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[深度图] --&gt; B[深度回调]</span><br><span class="line">    C[相机内参] --&gt; D[内参回调]</span><br><span class="line">    E[像素坐标] --&gt; F[3D坐标计算]</span><br><span class="line">    B --&gt; F</span><br><span class="line">    D --&gt; F</span><br><span class="line">    F --&gt; G[3D坐标发布]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="核心算法实现"><a href="#核心算法实现" class="headerlink" title="核心算法实现"></a>核心算法实现</h3><ol>
<li>相机坐标系转换</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = (u - cx) * Z / fx</span><br><span class="line">Y = (v - cy) * Z / fy </span><br></pre></td></tr></table></figure>

<p>其中(u,v)为像素坐标，(cx,cy)为主点坐标，(fx,fy)为焦距</p>
<ol start="2">
<li>深度数据处理</li>
</ol>
<ul>
<li>深度值单位转换：mm → m（除以1000）</li>
<li>有效距离过滤：0.1m &lt; Z &lt; 10m</li>
<li>深度图可视化：使用JET色图显示归一化深度</li>
</ul>
<ol start="3">
<li>坐标发布规范</li>
</ol>
<ul>
<li>采用PointStamped消息类型包含：</li>
<li>时间戳(header.stamp)</li>
<li>坐标系ID(camera_color_optical_frame)</li>
<li>三维坐标值</li>
</ul>
<ol start="4">
<li>彩色映射深度图像来增强深度感知</li>
</ol>
<hr>
<p>这样，火焰识别与定位算法就大致实现了，虽然算法比较基础，但是能够对ROS话题发布、坐标系发布、消息之间的接受与发送有一个清楚的认识，为后续机器人学习打下基础。</p>
<p>现在来展示一下效果如何。</p>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><ol>
<li>打开相机节点</li>
</ol>
<p>这次打开的相机节点有所不同，参考上一篇文章：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch align_depth:=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>运行火焰识别脚本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun robot_vision fire_detector.py</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-04_16-06-22.png" style="zoom:50%;" />

<ol start="3">
<li>运行火焰定位脚本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun robot_vision fire_3D_locator.py</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-04_16-06-34.png"></p>
<p>合理首先会显示一个深度图像，会有更直观的感受。</p>
<p>然后在终端可以查看具体的3D信息</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-04_16-06-58.png"></p>
<p>值得注意的是：</p>
<p><strong>X表示距离相机左右的距离（米），向右为正，Y表示距离相机的垂直方向，向上为正，Z表示距离相机的深度，向前为正。</strong></p>
<p>也就是说，图中最后一行表示：火焰位置在相机的右方0.06m,上方0m，前方0.27m.</p>
<p>这样，基本的火焰识别与定位就实现了。后续可以将火焰的相对坐标进行转换，可以接入消防小车的自主导航系统中了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/04/%E4%BD%BF%E7%94%A8Realsense%20D435%E5%B0%86RGB%E5%9B%BE%E5%83%8F%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%83%8F%E5%AF%B9%E9%BD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/04/%E4%BD%BF%E7%94%A8Realsense%20D435%E5%B0%86RGB%E5%9B%BE%E5%83%8F%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%83%8F%E5%AF%B9%E9%BD%90/" class="post-title-link" itemprop="url">使用Realsense D435将RGB图像与深度图像对齐</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-04 00:00:00 / 修改时间：16:54:16" itemprop="dateCreated datePublished" datetime="2025-07-04T00:00:00+08:00">2025-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用Realsense-D435将RGB图像与深度图像对齐"><a href="#使用Realsense-D435将RGB图像与深度图像对齐" class="headerlink" title="使用Realsense D435将RGB图像与深度图像对齐"></a>使用Realsense D435将RGB图像与深度图像对齐</h1><h2 id="深度图像简介"><a href="#深度图像简介" class="headerlink" title="深度图像简介"></a>深度图像简介</h2><p>RealSense D435 配备了两个摄像头（左、右）和红外传感器，采用 <strong>双目立体视觉</strong> 技术。该技术模拟人眼通过两个视角获取的图像差异来计算景物的深度信息。</p>
<p>深度图像是一种特殊的图像类型，用来表示场景中每个像素到相机的距离，没有颜色信息，通过灰度值或者伪彩色来表示不同深度。</p>
<p>深度图像可以通过多种技术生成，常见的生成方法包括：</p>
<ol>
<li>立体视觉：使用两台相机从不同角度拍摄同一场景，计算图像中的视差来获取深度。</li>
<li>飞行时间（ToF）传感器：通过发射光脉冲并测量其反射回传感器的时间来计算物体距离。</li>
<li>结构光技术：通过投射已知图案到物体表面，并分析图案的变形来计算深度。</li>
<li>激光雷达（LiDAR）：通过激光扫描场景并测量光束反射的时间来获得深度信息。</li>
</ol>
<p>这款RealsenseD435采用双目立体视觉与红外结构光相结合的方式生成深度图像，可以有效捕捉高精度的深度信息。</p>
<hr>
<h2 id="深度图像显示"><a href="#深度图像显示" class="headerlink" title="深度图像显示"></a>深度图像显示</h2><ol>
<li>启动相机节点</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch align_depth:=<span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>打开rviz</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rviz</span><br></pre></td></tr></table></figure>

<p>选择Image插件，选择**&#x2F;camera&#x2F;aligned_depth_to_color&#x2F;image_raw<strong>话题，即可查看对齐的深度图像，再选择</strong>&#x2F;camera&#x2F;color&#x2F;image_raw**，即可查看RGB图像。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/1.png" alt="image-20250703160602119" style="zoom:50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250703160954999.png" alt="image-20250703160954999"></p>
<p>这样简单的一个深度图像对齐后显示就完成了。后续进行火源识别与定位会起到作用。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/01/CMake%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/01/CMake%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">CMake安装与使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-01 00:00:00 / 修改时间：11:25:56" itemprop="dateCreated datePublished" datetime="2025-07-01T00:00:00+08:00">2025-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">工具学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CMake安装与使用"><a href="#CMake安装与使用" class="headerlink" title="CMake安装与使用"></a>CMake安装与使用</h1><p>CMake 是个一个开源的跨平台自动化建构系统，用来管理软件建置的程序，并不依赖于某特定编译器，并可支持多层目录、多个应用程序与多个函数库。</p>
<p>CMake 通过使用简单的配置文件 CMakeLists.txt，自动生成不同平台的构建文件（如 Makefile、Ninja 构建文件、Visual Studio 工程文件等），简化了项目的编译和构建过程。</p>
<p>CMake 本身不是构建工具，而是生成构建系统的工具，它生成的构建系统可以使用不同的编译器和工具链。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Cmake.svg" alt="img"></p>
<ul>
<li>CMakeLists.txt 文件： CMake 的配置文件，用于定义项目的构建规则、依赖关系、编译选项等。每个 CMake 项目通常包含一个或多个 CMakeLists.txt 文件。</li>
<li>构建目录： 为了保持源代码的整洁，CMake 鼓励使用独立的构建目录（Out-of-source 构建）。这样，构建生成的文件与源代码分开存放。</li>
</ul>
<hr>
<p><strong>基本流程</strong></p>
<ol>
<li>编写 CMakeLists.txt 文件： 定义项目的构建规则和依赖关系。</li>
<li>生成构建文件： 使用 CMake 生成适合当前平台的构建系统文件（例如 Makefile、Visual Studio 工程文件）。</li>
<li>执行构建： 使用生成的构建系统文件（如 make、ninja、msbuild）来编译项目。</li>
</ol>
<h2 id="安装cmake"><a href="#安装cmake" class="headerlink" title="安装cmake"></a>安装cmake</h2><p>Linux:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update  <span class="comment">#更新APT列表</span></span><br><span class="line"><span class="built_in">sudo</span> apt install cmake  <span class="comment">#下载</span></span><br><span class="line">cmake --version  <span class="comment">#查看版本</span></span><br></pre></td></tr></table></figure>

<p>如果你通过APT或Snap安装CMake，一般不需要额外的配置。安装完成后，CMake应该能够正常工作并且系统会自动将它添加到环境变量中。不过，如果你是通过源代码编译安装CMake，可能需要一些额外的配置来确保它在系统中正确工作。这里直接使用APT安装，不需要配置环境。</p>
<hr>
<h2 id="CMake基础"><a href="#CMake基础" class="headerlink" title="CMake基础"></a>CMake基础</h2><h3 id="CMakeLists-txt-文件"><a href="#CMakeLists-txt-文件" class="headerlink" title="CMakeLists.txt 文件"></a>CMakeLists.txt 文件</h3><p>这个文件是CMake的配置文件，用于定义项目的构建规则、依赖关系、编译选项等。</p>
<p>每个项目都需要一个或者多个CMakeLists.txt文件</p>
<h4 id="文件结构及基本语法"><a href="#文件结构及基本语法" class="headerlink" title="文件结构及基本语法"></a>文件结构及基本语法</h4><p><strong>常见指令</strong></p>
<ol>
<li>指定CMake的最低版本要求</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION &lt;version&gt;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>定义项目的名称和使用的编程语言</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">project</span>(MyProject CXX)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>指定要生成的可执行文件和其源文件</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(&lt;<span class="keyword">target</span>&gt; &lt;source_files&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(scout_base_node src/scout_base_node.cpp)</span><br></pre></td></tr></table></figure>

<p>其作用是告诉CMake生成一个名为<strong>scout_base_node</strong>的可执行文件，这个文件是由src&#x2F;scout_base_node.cpp这个源文件编译而来的。</p>
<ol start="4">
<li>创建一个库（静态库或者动态库）及其元文件</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(&lt;<span class="keyword">target</span>&gt; &lt;source_files&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(scout_messenger STATIC src/scout_messenger.cpp)</span><br></pre></td></tr></table></figure>

<p>这个就是用于生成一个库文件为：scout_messenger，构建完成之后，CMake会生成一个名为 libscout_messenger.a 的静态库文件（在Linux系统中）</p>
<p>STATIC：这个关键字表示你要生成的是一个静态库。静态库是一个包含已编译代码的文件，在链接时会将整个库的内容直接复制到最终的可执行文件或其他库中。与动态库（shared 或 dll）不同，静态库在运行时不需要依赖库文件。</p>
<p>src&#x2F;scout_messenger.cpp：这是生成静态库所需的源文件。在这个例子中，scout_messenger.cpp 这个源文件会被编译并打包成 scout_messenger 静态库。</p>
<ol start="5">
<li>链接目标文件与其他库</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(&lt;<span class="keyword">target</span>&gt; &lt;libraries&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(scout_messenger <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>在 CMake 中用来将 scout_messenger 目标与 ROS 所需的库（即 catkin_LIBRARIES）进行链接的命令。通过它，scout_messenger 可以访问这些 ROS 库中的功能，确保程序能够正常运行在 ROS 环境下。</p>
<ol start="6">
<li>添加头文件搜索路径</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(&lt;dirs&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(</span><br><span class="line">    <span class="keyword">include</span></span><br><span class="line">    <span class="variable">$&#123;catkin_INCLUDE_DIRS&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>include：这是一个相对路径，指向当前项目的 include 文件夹，通常用来存放项目的头文件。通过将 include 添加到 include_directories 中，编译器会在编译过程中查找该目录中的头文件。</p>
</li>
<li><p>${catkin_INCLUDE_DIRS}：这是一个 CMake 变量，通常是在使用 ROS 构建系统时定义的。catkin_INCLUDE_DIRS 包含了与 ROS 环境相关的所有头文件路径。这个变量会自动由 catkin 设置，包含了 ROS 包和依赖项的头文件路径。例如，如果你的项目依赖于 roscpp 或其他 ROS 包，catkin_INCLUDE_DIRS 就会包含这些包的头文件路径。</p>
</li>
</ul>
<ol start="7">
<li>设置变量的值</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(&lt;variable&gt; &lt;value&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>设置目标属性</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(<span class="keyword">TARGET</span> target_name</span><br><span class="line">                          [BEFORE | AFTER]</span><br><span class="line">                          [SYSTEM] [PUBLIC | PRIVATE | INTERFACE]</span><br><span class="line">                          [items1...])</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(MyExecutable PRIVATE <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>安装规则</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS target1 [target2 ...]</span><br><span class="line">        [RUNTIME DESTINATION dir]</span><br><span class="line">        [LIBRARY DESTINATION dir]</span><br><span class="line">        [ARCHIVE DESTINATION dir]</span><br><span class="line">        [INCLUDES DESTINATION [dir ...]]</span><br><span class="line">        [PRIVATE_HEADER DESTINATION dir]</span><br><span class="line">        [PUBLIC_HEADER DESTINATION dir])</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS scout_messenger scout_base_node</span><br><span class="line">  RUNTIME DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span></span><br><span class="line">  LIBRARY DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_LIB_DESTINATION&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_LIB_DESTINATION&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>这些 install 命令的作用是将构建后的文件（如可执行文件、库文件、头文件、launch 文件等）安装到适当的目录中，以便能够在安装后正确运行和使用。</p>
<ol start="10">
<li>条件语句</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(expression)</span><br><span class="line">  <span class="comment"># Commands</span></span><br><span class="line"><span class="keyword">elseif</span>(expression)</span><br><span class="line">  <span class="comment"># Commands</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="comment"># Commands</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> <span class="string">&quot;Debug&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(<span class="string">&quot;Debug build&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>自定义命令（add_custom_command 命令）</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">   <span class="keyword">TARGET</span> <span class="keyword">target</span></span><br><span class="line">   PRE_BUILD | PRE_LINK | POST_BUILD</span><br><span class="line">   <span class="keyword">COMMAND</span> command1 [ARGS] [WORKING_DIRECTORY dir]</span><br><span class="line">   [<span class="keyword">COMMAND</span> command2 [ARGS]]</span><br><span class="line">   [DEPENDS [depend1 [depend2 ...]]]</span><br><span class="line">   [COMMENT comment]</span><br><span class="line">   [VERBATIM]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">   <span class="keyword">TARGET</span> MyExecutable POST_BUILD</span><br><span class="line">   <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E echo <span class="string">&quot;Build completed.&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这段代码的作用是，在构建 MyExecutable 完成后，执行一个自定义的命令，打印出 “Build completed.” 到控制台。</p>
<hr>
<h3 id="变量和缓存"><a href="#变量和缓存" class="headerlink" title="变量和缓存"></a>变量和缓存</h3><p>CMake 使用变量来存储和传递信息，这些变量可以在 CMakeLists.txt 文件中定义和使用。</p>
<p>变量可以分为普通变量和缓存变量。</p>
<h4 id="变量定义和缓存"><a href="#变量定义和缓存" class="headerlink" title="变量定义和缓存"></a>变量定义和缓存</h4><p><strong>定义变量</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_VAR <span class="string">&quot;Hello World&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>使用变量</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Variable MY_VAR is $&#123;MY_VAR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>运行 CMake 配置或生成过程时，CMake 会输出：</p>
<p>– Variable MY_VAR is Hello World</p>
<h4 id="缓存变量"><a href="#缓存变量" class="headerlink" title="缓存变量"></a>缓存变量</h4><p>缓存变量存储在 CMake 的缓存文件中，用户可以在 CMake 配置时修改这些值。缓存变量通常用于用户输入的设置，例如编译选项和路径。</p>
<p><strong>定义缓存变量：</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_CACHE_VAR <span class="string">&quot;DefaultValue&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;A cache variable&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>使用缓存变量：</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Cache variable MY_CACHE_VAR is $&#123;MY_CACHE_VAR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="查找库和包"><a href="#查找库和包" class="headerlink" title="查找库和包"></a>查找库和包</h3><p>CMake 可以通过 find_package() 指令自动检测和配置外部库和包。</p>
<p>常用于查找系统安装的库或第三方库。</p>
<h4 id="find-package-指令"><a href="#find-package-指令" class="headerlink" title="find_package()指令"></a>find_package()指令</h4><p>基本用法：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED)</span><br></pre></td></tr></table></figure>

<p>指定版本：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Boost <span class="number">1.70</span> REQUIRED)</span><br></pre></td></tr></table></figure>

<p>查找库并指定路径：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED PATHS /path/to/opencv)</span><br></pre></td></tr></table></figure>

<p>使用查找到的库：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(MyExecutable Boost::Boost)</span><br></pre></td></tr></table></figure>

<p>设置包含目录和链接目录：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;Boost_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;Boost_LIBRARY_DIRS&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>实例</strong>：</p>
<p>假设想在项目上使用Boost库，CMakeLists.txt文件应该如下:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProject CXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找 Boost 库</span></span><br><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(MyExecutable main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接 Boost 库</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(MyExecutable Boost::Boost)</span><br></pre></td></tr></table></figure>

<h2 id="CMake-构建流程"><a href="#CMake-构建流程" class="headerlink" title="CMake 构建流程"></a>CMake 构建流程</h2><p>主要分为以下几步：</p>
<ol>
<li>创建构建目录：保持源代码目录整洁。</li>
<li>使用 CMake 生成构建文件：配置项目并生成适合平台的构建文件。</li>
<li>编译和构建：使用生成的构建文件执行编译和构建。</li>
<li>清理构建文件：删除中间文件和目标文件。</li>
<li>重新配置和构建：处理项目设置的更改。</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/cmake-simple-flowchart.png" alt="img"></p>
<h3 id="创建构建目录"><a href="#创建构建目录" class="headerlink" title="创建构建目录"></a>创建构建目录</h3><p>CMakes使用”Out-of-source” 构建方式，即将构建文件放在源代码目录之外的独立目录中。</p>
<p>这样可以保持源代码目录的整洁，并方便管理不同的构建配置。</p>
<h4 id="创建构建目录："><a href="#创建构建目录：" class="headerlink" title="创建构建目录："></a>创建构建目录：</h4><p>在项目的根目录下，创建一个新的构建目录。例如，可以创建一个名为 <strong>build</strong> 的目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build</span><br></pre></td></tr></table></figure>

<h4 id="进入构建目录："><a href="#进入构建目录：" class="headerlink" title="进入构建目录："></a>进入构建目录：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> build</span><br></pre></td></tr></table></figure>

<h3 id="使用CMake-生成构建文件"><a href="#使用CMake-生成构建文件" class="headerlink" title="使用CMake 生成构建文件"></a>使用CMake 生成构建文件</h3><p>在构建目录中运行 CMake，以生成适合当前平台的构建系统文件（例如 Makefile、Ninja 构建文件、Visual Studio 工程文件等）。</p>
<h4 id="运行-CMake-配置："><a href="#运行-CMake-配置：" class="headerlink" title="运行 CMake 配置："></a>运行 CMake 配置：</h4><p>在构建目录中运行 CMake 命令，指定源代码目录。源代码目录是包含 CMakeLists.txt 文件的目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br></pre></td></tr></table></figure>

<p>如果需要指定生成器（如 Ninja、Visual Studio），可以使用 -G 选项。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -G <span class="string">&quot;Ninja&quot;</span> ..</span><br></pre></td></tr></table></figure>

<p>如果需要指定构建类型（如 Debug 或 Release），可以使用 -DCMAKE_BUILD_TYPE 选项。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</span><br></pre></td></tr></table></figure>

<h4 id="检查配置结果："><a href="#检查配置结果：" class="headerlink" title="检查配置结果："></a>检查配置结果：</h4><p>CMake 会输出配置过程中的详细信息，包括找到的库、定义的选项等，如果没有错误，构建系统文件将被生成到构建目录中。</p>
<h3 id="编译和构建"><a href="#编译和构建" class="headerlink" title="编译和构建"></a>编译和构建</h3><p>使用生成的构建文件进行编译和构建。</p>
<p>不同的构建系统使用不同的命令。</p>
<h4 id="使用Makefile"><a href="#使用Makefile" class="headerlink" title="使用Makefile"></a>使用Makefile</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nake</span><br></pre></td></tr></table></figure>

<p>如果要构建特定目标，指定目标名，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make MyExecutable</span><br></pre></td></tr></table></figure>

<h3 id="清理构建文件"><a href="#清理构建文件" class="headerlink" title="清理构建文件"></a>清理构建文件</h3><p>构建过程中生成的中间文件和目标文件可以通过清理操作删除。</p>
<h4 id="使用Makefile-1"><a href="#使用Makefile-1" class="headerlink" title="使用Makefile:"></a>使用Makefile:</h4><p>运行 make clean 命令（如果定义了清理规则）来删除生成的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>

<h3 id="重新配置和构建"><a href="#重新配置和构建" class="headerlink" title="重新配置和构建"></a>重新配置和构建</h3><p>如果修改了 CMakeLists.txt 文件或项目设置，可能需要重新配置和构建项目。</p>
<h4 id="重新运行CMake配置："><a href="#重新运行CMake配置：" class="headerlink" title="重新运行CMake配置："></a>重新运行CMake配置：</h4><p>在构建目录中重新运行 CMake 配置命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br></pre></td></tr></table></figure>

<h4 id="重新编译："><a href="#重新编译：" class="headerlink" title="重新编译："></a>重新编译：</h4><p>使用构建命令重新编译项目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="构建实例"><a href="#构建实例" class="headerlink" title="构建实例"></a>构建实例</h2><p>构建步骤如下：</p>
<ol>
<li>创建CMakeLists.txt文件：定义项目、目标和依赖</li>
<li>创建构建目录：保持源代码整洁</li>
<li>配置项目：使用CMake生成构建文件</li>
<li>编译项目：使用构建系统文件编译项目</li>
<li>运行可执行文件：执行生成的程序</li>
<li>清理构建文件：删除中间文件和目标文件</li>
</ol>
<p>假设我们有一个简单的 C++ 项目，包含一个主程序文件和一个库文件，我们将使用 CMake 构建这个项目。</p>
<p>参考网址：<a target="_blank" rel="noopener" href="https://www.runoob.com/cmake/cmake-build-demo.html">https://www.runoob.com/cmake/cmake-build-demo.html</a></p>
<hr>
<h2 id="CMake-高级特性"><a href="#CMake-高级特性" class="headerlink" title="CMake 高级特性"></a>CMake 高级特性</h2><p>CMake 高级特性允许我们更灵活地管理和配置 CMake 项目，以适应复杂的构建需求和环境。</p>
<ol>
<li>自定义CMake模块和脚本：创建自定义模块和脚本以简化构建过程</li>
<li>构建配置和目标：使用多配置生成器和定义多个构建目标</li>
<li>高级查找和配置：灵活地查找和配置构建选项</li>
<li>生成自定义构建步骤：添加自定义命令和目标以执行额外的构建操作</li>
<li>跨平台和交叉编译：支持不同平台的构建和交叉编译</li>
<li>目标属性和配置：设置和修改目标的属性，满足特定需求</li>
</ol>
<hr>
<h3 id="自定义CMake模块和脚本"><a href="#自定义CMake模块和脚本" class="headerlink" title="自定义CMake模块和脚本"></a>自定义CMake模块和脚本</h3><h4 id="自定义CMake模块"><a href="#自定义CMake模块" class="headerlink" title="自定义CMake模块"></a>自定义CMake模块</h4><p>CMake 允许你创建和使用自定义模块，以简化常见的构建任务。</p>
<p>自定义模块通常包含自定义的 CMake 脚本和函数。</p>
<h5 id="创建自定义模块："><a href="#创建自定义模块：" class="headerlink" title="创建自定义模块："></a>创建自定义模块：</h5><ul>
<li><p>在项目目录下创建一个cmake&#x2F; 目录，用于存放自定义cmake模块</p>
</li>
<li><p>在cmake&#x2F; 目录下创建一个MyModule.cmake文件</p>
</li>
<li><p>在CMakeLists.txt文件中包含自定义模块：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">list</span>(APPEND CMAKE_MODULE_PATH <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake&quot;</span>)</span><br><span class="line"><span class="keyword">include</span>(MyModule)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>list(APPEND CMAKE_MODULE_PATH …) 用于扩展 CMake 的模块搜索路径。</p>
</li>
<li><p>include(MyModule) 用于加载并执行指定的 CMake 模块文件。</p>
</li>
</ul>
</li>
</ul>
<h5 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h5><p>MyModule.cmake 文件：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(my_custom_function)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;This is a custom function!&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<p>function(my_custom_function)：定义了一个名为 my_custom_function 的自定义函数。函数名 my_custom_function 可以用来在其他地方调用该函数。</p>
<p>message(STATUS “This is a custom function!”)：这是一个 CMake 内置命令，用于输出消息。STATUS 是消息类型，表示这条消息是状态信息，通常会在编译时显示出来。 “This is a custom function!” 是你要输出的消息内容。</p>
<p>endfunction()：结束自定义函数的定义，标志着函数体的结束。</p>
<p>所以，这段代码的作用是定义了一个名为 my_custom_function 的函数，在该函数被调用时，它会输出消息 This is a custom function!。</p>
<p>在CMakeLists.txt中调用自定义函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_custom_function()</span><br></pre></td></tr></table></figure>

<h4 id="使用自定义CMake脚本"><a href="#使用自定义CMake脚本" class="headerlink" title="使用自定义CMake脚本"></a>使用自定义CMake脚本</h4><p>自定义 CMake 脚本允许你执行自定义配置操作，灵活处理复杂的构建要求。</p>
<h5 id="创建自定义脚本："><a href="#创建自定义脚本：" class="headerlink" title="创建自定义脚本："></a>创建自定义脚本：</h5><ul>
<li>在项目中创建一个脚本文件（例如 config.cmake）。</li>
<li>在脚本中编写 CMake 指令。</li>
</ul>
<h5 id="在-CMakeLists-txt-文件中调用脚本："><a href="#在-CMakeLists-txt-文件中调用脚本：" class="headerlink" title="在 CMakeLists.txt 文件中调用脚本："></a>在 CMakeLists.txt 文件中调用脚本：</h5><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/config.cmake)</span><br></pre></td></tr></table></figure>



<h4 id="构建配置和目标"><a href="#构建配置和目标" class="headerlink" title="构建配置和目标"></a>构建配置和目标</h4><h5 id="多配置生成器"><a href="#多配置生成器" class="headerlink" title="多配置生成器"></a>多配置生成器</h5><p>CMake 支持多种构建配置（如 Debug、Release）。</p>
<p>多配置生成器允许你在同一构建目录中同时生成不同配置的构建。</p>
<p><strong>指定配置类型</strong></p>
<p>在 CMakeLists.txt 中设置默认配置：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Release&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;Build type&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>使用 Visual Studio：</p>
<p>在 Visual Studio 中选择构建配置（Debug 或 Release）。</p>
<h5 id="构建目标"><a href="#构建目标" class="headerlink" title="构建目标"></a>构建目标</h5><p>可以定义多个构建目标，每个目标可以有不同的构建设置和选项。</p>
<p>添加多个目标：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(MyExecutable1 src/main1.cpp)</span><br><span class="line"><span class="keyword">add_executable</span>(MyExecutable2 src/main2.cpp)</span><br></pre></td></tr></table></figure>

<p>设置目标属性：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(MyExecutable1 PROPERTIES COMPILE_DEFINITIONS <span class="string">&quot;DEBUG&quot;</span>)</span><br><span class="line"><span class="keyword">set_target_properties</span>(MyExecutable2 PROPERTIES COMPILE_DEFINITIONS <span class="string">&quot;RELEASE&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="高级查找和配置"><a href="#高级查找和配置" class="headerlink" title="高级查找和配置"></a>高级查找和配置</h4><h5 id="查找包的高级用法"><a href="#查找包的高级用法" class="headerlink" title="查找包的高级用法"></a>查找包的高级用法</h5><p>find_package() 指令可以用于查找和配置复杂的第三方库和包。</p>
<p>查找包的高级选项：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED COMPONENTS filesystem system)</span><br></pre></td></tr></table></figure>

<p>设置查找路径：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(BOOST_ROOT <span class="string">&quot;/path/to/boost&quot;</span>)</span><br><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED)</span><br></pre></td></tr></table></figure>

<h5 id="配置文件和构建选项"><a href="#配置文件和构建选项" class="headerlink" title="配置文件和构建选项"></a>配置文件和构建选项</h5><p>你可以通过 CMake 配置文件来控制构建选项和配置。</p>
<p>配置选项：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">configure_file</span>(config.h.in config.h)</span><br></pre></td></tr></table></figure>

<p>配置文件 (config.h.in)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> VERSION <span class="string">&quot;@PROJECT_VERSION@&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>在源文件中包含配置文件：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config.h&quot;</span></span></span><br></pre></td></tr></table></figure>



<hr>
<p>后面还有一些高级配置，暂时用不到，先不管。</p>
<p>参考<a target="_blank" rel="noopener" href="https://www.runoob.com/cmake/cmake-exercises.html">https://www.runoob.com/cmake/cmake-exercises.html</a></p>
<hr>
<h2 id="CMake-实战练习"><a href="#CMake-实战练习" class="headerlink" title="CMake 实战练习"></a>CMake 实战练习</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/cmake/cmake-exercises.html">https://www.runoob.com/cmake/cmake-exercises.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/01/inter%20Realsense%20D435%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/01/inter%20Realsense%20D435%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">inter Realsense D435使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-01 00:00:00 / 修改时间：11:26:40" itemprop="dateCreated datePublished" datetime="2025-07-01T00:00:00+08:00">2025-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="inter-Realsense-D435使用"><a href="#inter-Realsense-D435使用" class="headerlink" title="inter Realsense D435使用"></a>inter Realsense D435使用</h1><h2 id="安装ros软件包"><a href="#安装ros软件包" class="headerlink" title="安装ros软件包"></a>安装ros软件包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install ros-<span class="variable">$ROS_DISTRO</span>-realsense2-camera</span><br></pre></td></tr></table></figure>

<p>终端运行如下指令,替换成自己的ros版本。</p>
<h2 id="启动相机节点"><a href="#启动相机节点" class="headerlink" title="启动相机节点"></a>启动相机节点</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch</span><br></pre></td></tr></table></figure>

<p>可以选择将其他流分辨率和帧速率作为参数提供给<strong>rs_camera.launch</strong>文件</p>
<p>使用 <code>rostopic list</code>查看已经发布的话题。使用 <code>rostopic info /话题名称</code>查看话题信息</p>
<h2 id="点云数据"><a href="#点云数据" class="headerlink" title="点云数据"></a>点云数据</h2><p>可以使用pointcloud 选项启动camera ，使得发布点云实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch filters:=pointcloud</span><br></pre></td></tr></table></figure>

<p>之后可以打开rviz查看点云信息。</p>
<h2 id="对齐深度坐标系"><a href="#对齐深度坐标系" class="headerlink" title="对齐深度坐标系"></a>对齐深度坐标系</h2><p>以下示例说明了如何启动 Camera 节点并将其将对齐的深度流发布到其他可用流，例如颜色或红外流。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch align_depth:=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="使用Dynamic-Reconfigure-Params-设置摄像头参数"><a href="#使用Dynamic-Reconfigure-Params-设置摄像头参数" class="headerlink" title="使用Dynamic Reconfigure Params 设置摄像头参数"></a>使用Dynamic Reconfigure Params 设置摄像头参数</h2><p>使用rqt来更改相机控制值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun rqt_reconfigure rqt_reconfigure</span><br></pre></td></tr></table></figure>

<h2 id="ros-obiect-analytics"><a href="#ros-obiect-analytics" class="headerlink" title="ros_obiect_analytics"></a>ros_obiect_analytics</h2><p>用于实时对象检测、定位和跟踪的 ROS 包装器,已经停止维护了。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/intel/ros_object_analytics">https://github.com/intel/ros_object_analytics</a></p>
<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/IntelRealSense/realsense-ros/tree/ros1-legacy?tab=readme-ov-file">https://github.com/IntelRealSense/realsense-ros/tree/ros1-legacy?tab=readme-ov-file</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.intelrealsense.com/docs/docs-get-started">https://dev.intelrealsense.com/docs/docs-get-started</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/01/%E5%9C%A8ROS%E4%B8%AD%E7%BB%93%E5%90%88opencv%E5%A4%84%E7%90%86%E6%9D%A5%E8%87%AA%E6%B7%B1%E5%BA%A6%E7%9B%B8%E6%9C%BARealsense%20D435%E7%9A%84%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/01/%E5%9C%A8ROS%E4%B8%AD%E7%BB%93%E5%90%88opencv%E5%A4%84%E7%90%86%E6%9D%A5%E8%87%AA%E6%B7%B1%E5%BA%A6%E7%9B%B8%E6%9C%BARealsense%20D435%E7%9A%84%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">在ROS中结合opencv处理来自深度相机Realsense D435的图像数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-01 00:00:00 / 修改时间：13:53:56" itemprop="dateCreated datePublished" datetime="2025-07-01T00:00:00+08:00">2025-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="在ROS中结合opencv处理来自深度相机Realsense-D435的图像数据"><a href="#在ROS中结合opencv处理来自深度相机Realsense-D435的图像数据" class="headerlink" title="在ROS中结合opencv处理来自深度相机Realsense D435的图像数据"></a>在ROS中结合opencv处理来自深度相机Realsense D435的图像数据</h1><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><ul>
<li>相机：realsense d435(具体配置参考文档<strong>inter Realsense D435使用</strong>)</li>
<li>软件：opencv</li>
</ul>
<h2 id="安装opencv"><a href="#安装opencv" class="headerlink" title="安装opencv"></a>安装opencv</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install ros-noetic-desktop-full</span><br><span class="line"><span class="built_in">sudo</span> apt install libopencv-dev <span class="comment">#安装opencv（可能本身就安装好了）</span></span><br></pre></td></tr></table></figure>

<p>如果之前看过D435使用的文档，就不需要安装Realsense驱动了。这里不再追述。</p>
<h2 id="启动Realsense驱动程序"><a href="#启动Realsense驱动程序" class="headerlink" title="启动Realsense驱动程序"></a>启动Realsense驱动程序</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch</span><br></pre></td></tr></table></figure>

<p><strong>检查：</strong></p>
<p>使用 <code>rostopic list</code> 查看发布的话题，应该可以看到：<strong>&#x2F;camera&#x2F;color&#x2F;image_raw</strong> 和 <strong>&#x2F;camera&#x2F;depth&#x2F;image_rect_raw</strong> 这两个话题，分别包含 RGB 图像和深度图像数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/realsense%E7%BB%93%E5%90%88opencv%E5%AE%9E%E4%BE%8B.png" alt="image-20250624164903403"></p>
<h2 id="在ROS中使用Opencv处理Realsense数据测试"><a href="#在ROS中使用Opencv处理Realsense数据测试" class="headerlink" title="在ROS中使用Opencv处理Realsense数据测试"></a>在ROS中使用Opencv处理Realsense数据测试</h2><p>如果想要在ROS中使用Opencv来处理图像数据，需要创建一个ROS节点，订阅Realsense发布的图像话题，（刚才已经在list中查看了），然后使用opencv进行处理，可以使用RoS中的<strong>cv_bridge</strong>包来将ROS中的消息转换为Opencv格式的图像数据，并且调用Opencv库进行各种图像处理，或者将Opencv处理过后的数据转换成ROS图像，通过话题发布，实现各个节点之间的图像传输。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/cv_bridge%E5%8A%9F%E8%83%BD%E5%8C%85%E7%9A%84%E4%BD%9C%E7%94%A8.png" alt="在这里插入图片描述"></p>
<h3 id="安装-cv-bridge包"><a href="#安装-cv-bridge包" class="headerlink" title="安装 cv_bridge包"></a>安装 <strong>cv_bridge</strong>包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install ros-noetic-cv-bridge</span><br></pre></td></tr></table></figure>

<h3 id="创建一个ros节点来处理图像数据"><a href="#创建一个ros节点来处理图像数据" class="headerlink" title="创建一个ros节点来处理图像数据"></a>创建一个ros节点来处理图像数据</h3><ul>
<li>创建ROS功能包</li>
</ul>
<p>例如我新建了一个 <strong>fire_reco_ws</strong> 工作空间，作为后面这个项目的工作空间。按照惯例，先 <code>Control + Shift + B</code>添加 <code>tasks.json</code>文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="comment">// 有关 tasks.json 格式的文档，请参见</span></span><br><span class="line">    <span class="comment">// https://go.microsoft.com/fwlink/?LinkId=733558</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;catkin_make:debug&quot;</span><span class="punctuation">,</span> <span class="comment">//代表提示的描述性信息</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span>  <span class="comment">//可以选择shell或者process,如果是shell代码是在shell里面运行一个命令，如果是process代表作为一个进程来运行</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;catkin_make&quot;</span><span class="punctuation">,</span><span class="comment">//这个是我们需要运行的命令</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//如果需要在命令后面加一些后缀，可以写在这里，比如-DCATKIN_WHITELIST_PACKAGES=“pac1;pac2”</span></span><br><span class="line">            <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span><span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;presentation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;reveal&quot;</span><span class="punctuation">:</span> <span class="string">&quot;always&quot;</span><span class="comment">//可选always或者silence，代表是否输出信息</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$msCompile&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>cd到src目录，右键，新建一个软件包，我命名为：<strong>test01</strong>,添加依赖：std_msgs roscpp rospy sensor_msgs cv_bridge</p>
<p>或者直接在终端输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/fire_reco_ws/src</span><br><span class="line">catkin_create_pkg opencv_realsense std_msgs rospy sensor_msgs cv_bridge roscpp</span><br><span class="line"><span class="built_in">cd</span> opencv_realsense</span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个<strong>scripts</strong>文件夹并且写一个简单的python脚本来订阅Realsense图像话题并且使用Opencv进行处理：</li>
</ul>
<p>在 scripts 目录下创建 realsense_opencv_test.py 文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">callback</span>(<span class="params">data</span>):</span><br><span class="line">    bridge = CvBridge()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 将 ROS 图像消息转换为 OpenCV 格式</span></span><br><span class="line">        cv_image = bridge.imgmsg_to_cv2(data, desired_encoding=<span class="string">&quot;bgr8&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在这里可以处理图像</span></span><br><span class="line">        <span class="comment"># 例如：显示图像</span></span><br><span class="line">        cv2.imshow(<span class="string">&quot;RealSense Image&quot;</span>, cv_image)</span><br><span class="line">        cv2.waitKey(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rospy.logerr(<span class="string">&quot;Failed to convert image: %s&quot;</span>, <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;realsense_opencv_node&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 订阅 RealSense 相机的 RGB 图像话题</span></span><br><span class="line">    rospy.Subscriber(<span class="string">&quot;/camera/color/image_raw&quot;</span>, Image, callback)</span><br><span class="line"></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个脚本将订阅的Realsense的RGB图像话题（&#x2F;camera&#x2F;color&#x2F;image_raw）,然后使用Opencv显示图像。</p>
<h3 id="给脚本可执行权限："><a href="#给脚本可执行权限：" class="headerlink" title="给脚本可执行权限："></a>给脚本可执行权限：</h3><p>先cd到scripts文件夹，在终端输入ll，可以发现该文件没有可执行权限，不是绿色。再在终端输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x realsense_opencv_test.py <span class="comment">#一般会自动补齐，否则是出现了问题。</span></span><br></pre></td></tr></table></figure>

<p>再输入ll,发现文件变绿了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/%E6%B7%BB%E5%8A%A0%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90.png" alt="image-20250624171915491"></p>
<h3 id="编辑CMake-List"><a href="#编辑CMake-List" class="headerlink" title="编辑CMake_List"></a>编辑CMake_List</h3><p>打开test01下面的CMake_List。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/%E7%BC%96%E8%BE%91cmake_list.png" alt="image-20250624172110850"></p>
<p>修改此处：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250624172231086.png" alt="image-20250624172231086" style="zoom: 67%;" />

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS scripts/自定义文件名.py</span><br><span class="line">  DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="编译ROS包"><a href="#编译ROS包" class="headerlink" title="编译ROS包"></a>编译ROS包</h3><p>可以直接快捷键：<code>control + B + shift</code></p>
<p>也可以在终端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/fire_reco_ws/</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br></pre></td></tr></table></figure>

<h3 id="运行ROS节点"><a href="#运行ROS节点" class="headerlink" title="运行ROS节点"></a>运行ROS节点</h3><p>确保已经运行了Realsense驱动程序：<code>roslaunch realsense2_camera rs_camera.launch</code> ,然后在另外一个终端运行节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun opencv_realsense realsense_opencv.py</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250624173321705.png" alt="image-20250624173321705"></p>
<p>此时，可以看到来自Realsense D435 的数据，并且可以使用Opencv来处理数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250624173350863.png" alt="image-20250624173350863"></p>
<p>至此，已经可以灵活地在ROS中处理来自Realsense相机的图像和深度数据，结合Opencv进行更多的图像处理。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/01/%E4%BD%BF%E7%94%A8HSV%E5%81%9A%E7%AE%80%E5%8D%95%E7%9A%84%E7%81%AB%E6%BA%90%E8%AF%86%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/01/%E4%BD%BF%E7%94%A8HSV%E5%81%9A%E7%AE%80%E5%8D%95%E7%9A%84%E7%81%AB%E6%BA%90%E8%AF%86%E5%88%AB/" class="post-title-link" itemprop="url">使用HSV做简单的火源识别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-01 00:00:00 / 修改时间：13:52:50" itemprop="dateCreated datePublished" datetime="2025-07-01T00:00:00+08:00">2025-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用HSV做简单的火源识别"><a href="#使用HSV做简单的火源识别" class="headerlink" title="使用HSV做简单的火源识别"></a>使用HSV做简单的火源识别</h1><h2 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h2><p>HSV火焰识别原理主要是基于HSV色彩模型来识别火焰颜色，图像中的颜色通常是以RGB（红绿蓝）格式存储的，然而在火焰识别中，RGB空间的颜色处理并不总是理想的。转换到HSV空间后，可以更容易地处理色调（H）、饱和度（S）和亮度（V）三个分量。火焰的颜色通常集中在高亮度和饱和度区域，因此HSV模型的V（亮度）和S（饱和度）分量对于识别火焰非常重要。</p>
<ul>
<li>火焰的色调（H）在HSV空间中一般处于某个特定的范围。例如，火焰的色调通常位于红色（约0°），黄色（约60°），橙色（约30°）等范围。</li>
<li>火焰的亮度（V）通常较高，意味着它具有较高的光强。</li>
<li>火焰的饱和度（S）也较高，因此识别时会过滤掉低饱和度的区域。</li>
</ul>
<p>通过这些阈值可以有效从图像中提取火焰区域。</p>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ul>
<li>固件：Realsense D435深度相机</li>
<li>软件：OpenCV ROS包</li>
<li>语言：Python</li>
</ul>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FireDetector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="comment"># 动态HSV阈值（初始值）</span></span><br><span class="line">        <span class="variable language_">self</span>.lower_fire = np.array([<span class="number">0</span>, <span class="number">150</span>, <span class="number">100</span>])  </span><br><span class="line">        <span class="variable language_">self</span>.upper_fire = np.array([<span class="number">30</span>, <span class="number">255</span>, <span class="number">255</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 运动检测相关</span></span><br><span class="line">        <span class="variable language_">self</span>.prev_gray = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.fgbg = cv2.createBackgroundSubtractorMOG2(history=<span class="number">500</span>, varThreshold=<span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 订阅图像</span></span><br><span class="line">        <span class="variable language_">self</span>.image_sub = rospy.Subscriber(<span class="string">&quot;/camera/color/image_raw&quot;</span>, </span><br><span class="line">                                        Image, <span class="variable language_">self</span>.image_callback)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dynamic_threshold</span>(<span class="params">self, hsv_img</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;动态调整饱和度阈值&quot;&quot;&quot;</span></span><br><span class="line">        avg_sat = np.mean(hsv_img[:,:,<span class="number">1</span>])</span><br><span class="line">        <span class="variable language_">self</span>.lower_fire[<span class="number">1</span>] = <span class="built_in">max</span>(<span class="number">100</span>, <span class="built_in">int</span>(avg_sat * <span class="number">0.65</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">motion_analysis</span>(<span class="params">self, frame</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运动特征分析&quot;&quot;&quot;</span></span><br><span class="line">        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line">        fgmask = <span class="variable language_">self</span>.fgbg.apply(gray)</span><br><span class="line">        <span class="keyword">return</span> cv2.medianBlur(fgmask, <span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cv_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(msg, <span class="string">&quot;bgr8&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 预处理</span></span><br><span class="line">            blurred = cv2.GaussianBlur(cv_image, (<span class="number">7</span>,<span class="number">7</span>), <span class="number">0</span>)</span><br><span class="line">            hsv = cv2.cvtColor(blurred, cv2.COLOR_BGR2HSV)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 动态阈值调整</span></span><br><span class="line">            <span class="variable language_">self</span>.dynamic_threshold(hsv)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 颜色检测</span></span><br><span class="line">            color_mask = cv2.inRange(hsv, <span class="variable language_">self</span>.lower_fire, <span class="variable language_">self</span>.upper_fire)</span><br><span class="line">            color_mask = cv2.morphologyEx(color_mask, cv2.MORPH_CLOSE, </span><br><span class="line">                                        np.ones((<span class="number">7</span>,<span class="number">7</span>), np.uint8))</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 运动检测</span></span><br><span class="line">            motion_mask = <span class="variable language_">self</span>.motion_analysis(cv_image)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 多特征融合</span></span><br><span class="line">            combined_mask = cv2.bitwise_and(color_mask, motion_mask)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 精确轮廓检测</span></span><br><span class="line">            contours, _ = cv2.findContours(combined_mask, cv2.RETR_EXTERNAL,</span><br><span class="line">                                         cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> cnt <span class="keyword">in</span> contours:</span><br><span class="line">                area = cv2.contourArea(cnt)</span><br><span class="line">                <span class="keyword">if</span> area &gt; <span class="number">800</span>:  <span class="comment"># 增大面积阈值减少误检</span></span><br><span class="line">                    x,y,w,h = cv2.boundingRect(cnt)</span><br><span class="line">                    aspect_ratio = <span class="built_in">float</span>(w)/h</span><br><span class="line">                    <span class="keyword">if</span> <span class="number">0.5</span> &lt; aspect_ratio &lt; <span class="number">2.0</span>:  <span class="comment"># 火焰通常不是极端长条形</span></span><br><span class="line">                        cv2.rectangle(cv_image, (x,y), (x+w,y+h), (<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">                        cv2.putText(cv_image, <span class="string">f&#x27;Fire <span class="subst">&#123;area:<span class="number">.0</span>f&#125;</span>&#x27;</span>, (x,y-<span class="number">10</span>),</span><br><span class="line">                                   cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.7</span>, (<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 显示调试视图</span></span><br><span class="line">            debug_view = np.hstack([</span><br><span class="line">                cv_image,</span><br><span class="line">                cv2.cvtColor(combined_mask, cv2.COLOR_GRAY2BGR)</span><br><span class="line">            ])</span><br><span class="line">            cv2.imshow(<span class="string">&quot;Fire Detection&quot;</span>, debug_view)</span><br><span class="line">            cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;fire_detector&#x27;</span>)</span><br><span class="line">    detector = FireDetector()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li>首先使用当前图像的平均饱和度，动态调整火焰检测的饱和度阈值，可以适应不同光照条件下的火焰检测。之后将图像转换为灰度图，应用背景减除来检测运动区域（火焰）。最后通过中值滤波减少噪声。</li>
<li>对输入图像进行高斯模糊，然后转换成HSV颜色空间，根据平均饱和度调整颜色阈值。通过背景消除检测图像中运动区域，再利用多特征融合，确保仅检测到火焰区域，最后在图像上标注出火焰区域的矩形框。并且显示处理前后的结果帮助调试。</li>
<li>初始化ROS节点，创建FireDetector对象，开始火焰检测，使用回调函数，保持节点活跃。</li>
</ol>
<hr>
<p>整个代码框架较为清晰，可以修改参数达到最终效果。</p>
<h2 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  cv_bridge</span><br><span class="line">  image_transport</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  sensor_msgs</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br><span class="line">catkin_install_python(PROGRAMS</span><br><span class="line">  scripts/fire_detector.py</span><br><span class="line">  DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以新建一个launch文件直接运行相机节点还有这个脚本。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fire_detector.py&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;fire_detector&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 可添加RealSense相机启动配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find realsense2_camera)/launch/rs_camera.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;enable_color&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看看效果：<br><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/%E7%81%AB%E7%84%B0%E8%AF%86%E5%88%AB%2Cpng" alt="image-20250630203948668">这个只是简单测试，还不够稳定，后续可以对算法进行改进。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/01/%E7%BB%93%E5%90%88ROS%E5%92%8COpenCV%E5%AE%9E%E7%8E%B0%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/01/%E7%BB%93%E5%90%88ROS%E5%92%8COpenCV%E5%AE%9E%E7%8E%B0%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" class="post-title-link" itemprop="url">结合ROS和OpenCV实现人脸识别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-01 00:00:00 / 修改时间：13:52:02" itemprop="dateCreated datePublished" datetime="2025-07-01T00:00:00+08:00">2025-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="结合ROS和OpenCV实现人脸识别"><a href="#结合ROS和OpenCV实现人脸识别" class="headerlink" title="结合ROS和OpenCV实现人脸识别"></a>结合ROS和OpenCV实现人脸识别</h1><h2 id="源码实现：face-detector-py"><a href="#源码实现：face-detector-py" class="headerlink" title="源码实现：face_detector.py"></a>源码实现：face_detector.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image, RegionOfInterest</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge, CvBridgeError</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">faceDetector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        rospy.on_shutdown(<span class="variable language_">self</span>.cleanup);</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建cv_bridge</span></span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="variable language_">self</span>.image_pub = rospy.Publisher(<span class="string">&quot;cv_bridge_image&quot;</span>, Image, queue_size=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取haar特征的级联表的XML文件，文件路径在launch文件中传入</span></span><br><span class="line">        cascade_1 = rospy.get_param(<span class="string">&quot;~cascade_1&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        cascade_2 = rospy.get_param(<span class="string">&quot;~cascade_2&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用级联表初始化haar特征检测器</span></span><br><span class="line">        <span class="variable language_">self</span>.cascade_1 = cv2.CascadeClassifier(cascade_1)</span><br><span class="line">        <span class="variable language_">self</span>.cascade_2 = cv2.CascadeClassifier(cascade_2)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置级联表的参数，优化人脸识别，可以在launch文件中重新配置</span></span><br><span class="line">        <span class="variable language_">self</span>.haar_scaleFactor  = rospy.get_param(<span class="string">&quot;~haar_scaleFactor&quot;</span>, <span class="number">1.2</span>)</span><br><span class="line">        <span class="variable language_">self</span>.haar_minNeighbors = rospy.get_param(<span class="string">&quot;~haar_minNeighbors&quot;</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="variable language_">self</span>.haar_minSize      = rospy.get_param(<span class="string">&quot;~haar_minSize&quot;</span>, <span class="number">40</span>)</span><br><span class="line">        <span class="variable language_">self</span>.haar_maxSize      = rospy.get_param(<span class="string">&quot;~haar_maxSize&quot;</span>, <span class="number">60</span>)</span><br><span class="line">        <span class="variable language_">self</span>.color = (<span class="number">50</span>, <span class="number">255</span>, <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化订阅rgb格式图像数据的订阅者，此处图像topic的话题名可以在launch文件中重映射</span></span><br><span class="line">        <span class="variable language_">self</span>.image_sub = rospy.Subscriber(<span class="string">&quot;input_rgb_image&quot;</span>, Image, <span class="variable language_">self</span>.image_callback, queue_size=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_callback</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="comment"># 使用cv_bridge将ROS的图像数据转换成OpenCV的图像格式</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cv_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(data, <span class="string">&quot;bgr8&quot;</span>)     </span><br><span class="line">            frame = np.array(cv_image, dtype=np.uint8)</span><br><span class="line">        <span class="keyword">except</span> CvBridgeError, e:</span><br><span class="line">            <span class="built_in">print</span> e</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建灰度图像</span></span><br><span class="line">        grey_image = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建平衡直方图，减少光线影响</span></span><br><span class="line">        grey_image = cv2.equalizeHist(grey_image)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 尝试检测人脸</span></span><br><span class="line">        faces_result = <span class="variable language_">self</span>.detect_face(grey_image)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在opencv的窗口中框出所有人脸区域</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(faces_result)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> face <span class="keyword">in</span> faces_result: </span><br><span class="line">                x, y, w, h = face</span><br><span class="line">                cv2.rectangle(cv_image, (x, y), (x+w, y+h), <span class="variable language_">self</span>.color, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将识别后的图像转换成ROS消息并发布</span></span><br><span class="line">        <span class="variable language_">self</span>.image_pub.publish(<span class="variable language_">self</span>.bridge.cv2_to_imgmsg(cv_image, <span class="string">&quot;bgr8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detect_face</span>(<span class="params">self, input_image</span>):</span><br><span class="line">        <span class="comment"># 首先匹配正面人脸的模型</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.cascade_1:</span><br><span class="line">            faces = <span class="variable language_">self</span>.cascade_1.detectMultiScale(input_image, </span><br><span class="line">                    <span class="variable language_">self</span>.haar_scaleFactor, </span><br><span class="line">                    <span class="variable language_">self</span>.haar_minNeighbors, </span><br><span class="line">                    cv2.CASCADE_SCALE_IMAGE, </span><br><span class="line">                    (<span class="variable language_">self</span>.haar_minSize, <span class="variable language_">self</span>.haar_maxSize))</span><br><span class="line">                                         </span><br><span class="line">        <span class="comment"># 如果正面人脸匹配失败，那么就尝试匹配侧面人脸的模型</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(faces) == <span class="number">0</span> <span class="keyword">and</span> <span class="variable language_">self</span>.cascade_2:</span><br><span class="line">            faces = <span class="variable language_">self</span>.cascade_2.detectMultiScale(input_image, </span><br><span class="line">                    <span class="variable language_">self</span>.haar_scaleFactor, </span><br><span class="line">                    <span class="variable language_">self</span>.haar_minNeighbors, </span><br><span class="line">                    cv2.CASCADE_SCALE_IMAGE, </span><br><span class="line">                    (<span class="variable language_">self</span>.haar_minSize, <span class="variable language_">self</span>.haar_maxSize))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> faces</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Shutting down vision node.&quot;</span></span><br><span class="line">        cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 初始化ros节点</span></span><br><span class="line">        rospy.init_node(<span class="string">&quot;face_detector&quot;</span>)</span><br><span class="line">        faceDetector()</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;Face detector is started..&quot;</span>)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;Please subscribe the ROS image.&quot;</span>)</span><br><span class="line">        rospy.spin()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Shutting down face detector node.&quot;</span></span><br><span class="line">        cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

<h3 id="初始化部分"><a href="#初始化部分" class="headerlink" title="初始化部分"></a>初始化部分</h3><p>完成ROS节点、图像、识别参数的设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">    rospy.on_shutdown(<span class="variable language_">self</span>.cleanup);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建cv_bridge</span></span><br><span class="line">    <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">    <span class="variable language_">self</span>.image_pub = rospy.Publisher(<span class="string">&quot;cv_bridge_image&quot;</span>, Image, queue_size=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取haar特征的级联表的XML文件，文件路径在launch文件中传入</span></span><br><span class="line">    cascade_1 = rospy.get_param(<span class="string">&quot;~cascade_1&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    cascade_2 = rospy.get_param(<span class="string">&quot;~cascade_2&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用级联表初始化haar特征检测器</span></span><br><span class="line">    <span class="variable language_">self</span>.cascade_1 = cv2.CascadeClassifier(cascade_1)</span><br><span class="line">    <span class="variable language_">self</span>.cascade_2 = cv2.CascadeClassifier(cascade_2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置级联表的参数，优化人脸识别，可以在launch文件中重新配置</span></span><br><span class="line">    <span class="variable language_">self</span>.haar_scaleFactor  = rospy.get_param(<span class="string">&quot;~haar_scaleFactor&quot;</span>, <span class="number">1.2</span>)</span><br><span class="line">    <span class="variable language_">self</span>.haar_minNeighbors = rospy.get_param(<span class="string">&quot;~haar_minNeighbors&quot;</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="variable language_">self</span>.haar_minSize      = rospy.get_param(<span class="string">&quot;~haar_minSize&quot;</span>, <span class="number">40</span>)</span><br><span class="line">    <span class="variable language_">self</span>.haar_maxSize      = rospy.get_param(<span class="string">&quot;~haar_maxSize&quot;</span>, <span class="number">60</span>)</span><br><span class="line">    <span class="variable language_">self</span>.color = (<span class="number">50</span>, <span class="number">255</span>, <span class="number">50</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 初始化订阅rgb格式图像数据的订阅者，此处图像topic的话题名可以在launch文件中重映射</span></span><br><span class="line">    <span class="variable language_">self</span>.image_sub = rospy.Subscriber(<span class="string">&quot;input_rgb_image&quot;</span>, Image, <span class="variable language_">self</span>.image_callback, queue_size=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ROS图像回调函数"><a href="#ROS图像回调函数" class="headerlink" title="ROS图像回调函数"></a>ROS图像回调函数</h3><p>例程节点收到摄像头发布的RGB图像数据之后进入回调函数，将图像转成OpenCV的数据格式，然后预处理之后开始调用人脸识别的功能函数，最后发布识别结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">image_callback</span>(<span class="params">self, data</span>):</span><br><span class="line">    <span class="comment"># 使用cv_bridge将ROS的图像数据转换成OpenCV的图像格式</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cv_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(data, <span class="string">&quot;bgr8&quot;</span>)     </span><br><span class="line">        frame = np.array(cv_image, dtype=np.uint8)</span><br><span class="line">    <span class="keyword">except</span> CvBridgeError, e:</span><br><span class="line">        <span class="built_in">print</span> e</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建灰度图像</span></span><br><span class="line">    grey_image = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建平衡直方图，减少光线影响</span></span><br><span class="line">    grey_image = cv2.equalizeHist(grey_image)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试检测人脸</span></span><br><span class="line">    faces_result = <span class="variable language_">self</span>.detect_face(grey_image)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在opencv的窗口中框出所有人脸区域</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(faces_result)&gt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> face <span class="keyword">in</span> faces_result: </span><br><span class="line">            x, y, w, h = face</span><br><span class="line">            cv2.rectangle(cv_image, (x, y), (x+w, y+h), <span class="variable language_">self</span>.color, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将识别后的图像转换成ROS消息并发布</span></span><br><span class="line">    <span class="variable language_">self</span>.image_pub.publish(<span class="variable language_">self</span>.bridge.cv2_to_imgmsg(cv_image, <span class="string">&quot;bgr8&quot;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="人脸识别"><a href="#人脸识别" class="headerlink" title="人脸识别"></a>人脸识别</h3><p>直接调用OpenCV提供的人脸识别接口，与数据库中的人脸特征进行匹配。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">detect_face</span>(<span class="params">self, input_image</span>):</span><br><span class="line">    <span class="comment"># 首先匹配正面人脸的模型</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.cascade_1:</span><br><span class="line">        faces = <span class="variable language_">self</span>.cascade_1.detectMultiScale(input_image, </span><br><span class="line">                <span class="variable language_">self</span>.haar_scaleFactor, </span><br><span class="line">                <span class="variable language_">self</span>.haar_minNeighbors, </span><br><span class="line">                cv2.CASCADE_SCALE_IMAGE, </span><br><span class="line">                (<span class="variable language_">self</span>.haar_minSize, <span class="variable language_">self</span>.haar_maxSize))</span><br><span class="line">                                     </span><br><span class="line">    <span class="comment"># 如果正面人脸匹配失败，那么就尝试匹配侧面人脸的模型</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(faces) == <span class="number">0</span> <span class="keyword">and</span> <span class="variable language_">self</span>.cascade_2:</span><br><span class="line">        faces = <span class="variable language_">self</span>.cascade_2.detectMultiScale(input_image, </span><br><span class="line">                <span class="variable language_">self</span>.haar_scaleFactor, </span><br><span class="line">                <span class="variable language_">self</span>.haar_minNeighbors, </span><br><span class="line">                cv2.CASCADE_SCALE_IMAGE, </span><br><span class="line">                (<span class="variable language_">self</span>.haar_minSize, <span class="variable language_">self</span>.haar_maxSize))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> faces</span><br></pre></td></tr></table></figure>

<p>代码中一些参数还有话题需要在launch文件中设置，所以需要编写一个launch文件：robot_vision&#x2F;face_detector.launch</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">name</span>=<span class="string">&quot;face_detector&quot;</span> <span class="attr">type</span>=<span class="string">&quot;face_detector.py&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;input_rgb_image&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/camera/color/image_raw&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span>&gt;</span></span><br><span class="line">            haar_scaleFactor: 1.2</span><br><span class="line">            haar_minNeighbors: 2</span><br><span class="line">            haar_minSize: 40</span><br><span class="line">            haar_maxSize: 60</span><br><span class="line">        <span class="tag">&lt;/<span class="name">rosparam</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;cascade_1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find robot_vision)/data/haar_detectors/haarcascade_frontalface_alt.xml&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;cascade_2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find robot_vision)/data/haar_detectors/haarcascade_profileface.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/06/23/nav%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/23/nav%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98/" class="post-title-link" itemprop="url">nav参数调优</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-06-23 00:00:00 / 修改时间：15:23:43" itemprop="dateCreated datePublished" datetime="2025-06-23T00:00:00+08:00">2025-06-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="nav参数调优"><a href="#nav参数调优" class="headerlink" title="nav参数调优"></a>nav参数调优</h1><h2 id="速度和加速度"><a href="#速度和加速度" class="headerlink" title="速度和加速度"></a>速度和加速度</h2><p>在ROS导航堆栈中，本地路径规划器（local planner）接收里程计消息（Odom）,并且输出控制机器人运动的速度命令（cmd_vel)</p>
<h2 id="Global-planner-全局路径规划器"><a href="#Global-planner-全局路径规划器" class="headerlink" title="Global_planner(全局路径规划器)"></a>Global_planner(全局路径规划器)</h2><p>在navigation stack 中使用move_base节点，需要：</p>
<ul>
<li>global_planner</li>
<li>local_planner</li>
</ul>
<p>共有三个global_planner</p>
<ul>
<li>carrot_planner</li>
<li>navfn</li>
<li>global_planner</li>
</ul>
<hr>
<ol>
<li>carrot_planner</li>
</ol>
<p>这是最简单的一个，检查给定目标是否是障碍物，如果是，会通过沿着机器人和目标点之间的向量移动，选择接近原始目标的替代目标。它的目标是不断更新目标点并控制机器人朝着该点前进。在机器人到达当前目标点后，新的目标点会被设置，直到机器人到达最终目标。</p>
<ol start="2">
<li>navfn和global_planner</li>
</ol>
<p>navfn的核心思想是通过A算法进行路径搜索，并使用Dijkstra*算法的思想来计算每个栅格的代价。具体来说：</p>
<ol>
<li><p>栅格地图：navfn依赖于一个2D栅格地图，在该地图中，障碍物被标记为不可通过的区域。</p>
</li>
<li><p>代价计算：每个栅格都有一个代价值，navfn通过对整个地图的每个栅格进行代价计算，找到从起始点到目标点的最短路径。</p>
</li>
<li><p>. A*算法：它基于A算法来找到最佳路径。A算法综合考虑了路径的代价和启发式的距离，从而确保找到最优的路径。</p>
</li>
<li><p>路径输出：通过计算，navfn为机器人生成一条完整的全局路径，供机器人执行后续的局部路径规划和运动控制。</p>
</li>
</ol>
<p>navfn使用Dijkstra算法在起点和终点之间找到成本最低的全局路径。Global_planner作为navfn更灵活的替代构建，具有更多选项：</p>
<ul>
<li>支持A*</li>
<li>切换二次近似</li>
<li>切换网格路线</li>
</ul>
<p>打开rqt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun rqt-reconfigure rqt_reconfigure</span><br></pre></td></tr></table></figure>

<p>allow unknown(true), </p>
<p>use dijkstra(true), </p>
<p>use quadratic(true),</p>
<p>use grid path(false), </p>
<p>old navfn behavior(false) to their default values. </p>
<p>Setting visualize potential(false) to true </p>
<p>​			navfn cost values are set to<br><strong>cost &#x3D; COST NEUTRAL + COST FACTOR * costmap cost value.</strong></p>
<p><strong>将cost factor 设置太低或者太高会降低路径的质量，对于lethal cost 将其设置为较低的值可能会导致无法生成任何路径！</strong> 当cost_factor &#x3D; 0.55,neutral_cost &#x3D; 66,lethal_cost &#x3D; 253,全局路径规划非常那个可取。</p>
<h2 id="LocalPlanner-局部路径规划器"><a href="#LocalPlanner-局部路径规划器" class="headerlink" title="LocalPlanner(局部路径规划器)"></a>LocalPlanner(局部路径规划器)</h2><p>局部路径规划器包括：</p>
<ul>
<li>dwa _local _planner</li>
<li>eband_local_planner</li>
<li>teb_loacl_planner</li>
</ul>
<p>通常首选<strong>dwa</strong></p>
<p>Dynamic Window Approach (DWA) （动态窗口逼近）算法，roswiki提供了一个摘要：</p>
<ol>
<li>在机器人的控制空间中离散采样</li>
<li>对于每个采样速度，从机器人的当前状态执行正向模拟，预测如果在一段时间内该采样速度会发生什么</li>
<li>使用包含以下特征的指标评估前向模拟产生的每个轨迹：靠近障碍物、接近目标、接近全局路径、速度、与障碍物碰撞的轨迹。</li>
<li>选择得分最高的轨迹，并且将相关的速度发送到底座。</li>
<li>重复</li>
</ol>
<hr>
<ul>
<li>DWA 评估机器人根据不同速度和角速度产生的多个轨迹，并为每个轨迹分配一个评分。</li>
<li>评分标准通常包括以下几个方面：<ul>
<li><strong>速度评分</strong>：希望机器人保持较高的速度，但在接近障碍物时要降低速度。</li>
<li><strong>障碍物评分</strong>：避免与障碍物碰撞，选择离障碍物较远的轨迹。</li>
<li><strong>轨迹平滑性评分</strong>：选择平滑的轨迹，以避免急转弯和过大的运动变化。</li>
</ul>
</li>
<li>通过这些评分，DWA 算法选择最优的轨迹作为控制指令。</li>
</ul>
<h3 id="正向模拟"><a href="#正向模拟" class="headerlink" title="正向模拟"></a>正向模拟</h3><p>这是dwa算法的第二步，local planner在机器人的控制空间中获取速度样本，检查并且消除不良速度，每个速度都要经过模拟，有参数<strong>sim_time</strong>控制。sim_time值越大，计算负载越重。当sim_time时间变长，local_planner生成路径的时间也会变长。</p>
<p>最好将sim_time的参数范围设置在2-4之间。</p>
<p>除此之外，还有其他参数值得注意：</p>
<p><strong>Velocity samples:</strong></p>
<p>vx sample 和vy sample 控制在 x 轴和 y 轴方向上，分别采样多少个线速度样本。vth sample控制旋转速度，表示采样多少个旋转速度样本。</p>
<p>通常设置将vx sample 设置比 vth sample更大。这里笔者设置 vx_sample &#x3D; 20, vth_sample &#x3D; 40</p>
<p><strong>Simulation granularity:</strong></p>
<p>模拟粒度是指在机器人路径规划过程中，轨迹上各个点之间的步长（或间距）。它决定了在轨迹上检查点的频率。</p>
<ul>
<li>低值的模拟粒度意味着检查的点更频繁，可以更加精准地检测轨迹与障碍物的交点，但是会消耗更多资源。</li>
<li>高值的模拟粒度表示步长较长，检查的点较少，计算负担轻，路径的精度可能会低，撞到障碍物的可能会更大。</li>
</ul>
<p>默认值为0.025对于中小型机器人来说足够。</p>
<h3 id="Trajactory-Scoring"><a href="#Trajactory-Scoring" class="headerlink" title="Trajactory Scoring"></a>Trajactory Scoring</h3><p>DWA Local Planner 通过最大化目标函数来获得最佳速度，从而帮助机器人进行路径规划。</p>
<p>使用一个目标函数来评估不同速度对的效果，目标是最小化函数的值。主要有三个主要部分：</p>
<ul>
<li>progress to goal（朝目标前进的进度）</li>
<li>clearance from obstacles（与障碍物的间隙）</li>
<li>forward velocity（前进速度)</li>
</ul>
<p>目标函数的成本：<strong>cost</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cost = path distance bias * (距离(m) 到路径的端点)</span><br><span class="line">      + goal distance bias * (距离(m) 到局部目标的端点)</span><br><span class="line">      + occdist scale * (沿轨迹的最大障碍物代价 (0-254))</span><br></pre></td></tr></table></figure>

<ol>
<li><p>path distance bias：路径距离偏差，这个参数控制了局部规划器应该多大程度上保持在全局路径附近。较高的值会使得局部规划器更倾向于选择接近全局路径的轨迹。</p>
</li>
<li><p>goal distance bias：目标距离偏差，控制了机器人在追求局部目标时的路径选择。较高的值表示机器人更重视接近局部目标，而不太依赖于全局路径，允许其走出全局路径去到达目标。</p>
</li>
<li><p>occdist scale：障碍物距离偏差，控制了机器人避障的倾向。较高的值会导致机器人更加避开障碍物，但如果设置过高，可能会导致机器人犹豫不决，甚至停在原地。</p>
</li>
</ol>
<hr>
<p>path distance bias：这个参数的高低决定了局部规划器在跟随全局路径时的依赖程度。较大的值会让机器人更倾向于保持在全局路径上。</p>
<p>goal distance bias：控制机器人在局部路径规划时，是否更倾向于向局部目标前进。增大此参数值，机器人会更自由地绕开全局路径，直接追求局部目标。</p>
<p>occdist scale：决定机器人避障的严格程度。如果这个值太高，机器人可能会过度避开障碍物，导致其路径规划不果断，甚至停滞不前。</p>
<p><strong>path distance bias &#x3D; 32.0</strong><br><strong>goal distance bias &#x3D; 20.0</strong><br><strong>occdist scale &#x3D; 0.02</strong></p>
<h3 id="其他参数设计"><a href="#其他参数设计" class="headerlink" title="其他参数设计"></a>其他参数设计</h3><p>Goal distance tolerance（目标距离容差）:</p>
<ol>
<li>yaw goal tolerance (double, default: 0.05)</li>
</ol>
<p>描述：该参数定义了在机器人达到目标时，控制器在 偏航角（yaw）（即机器人绕垂直轴的旋转）上的容差。单位是 弧度。<br>作用：当机器人接近目标时，如果它的偏航角误差小于该值（0.05弧度），则认为机器人已经到达目标。<br>默认值：0.05弧度，相当于约 2.87度，允许一定的旋转误差。</p>
<ol start="2">
<li>xy goal tolerance (double, default: 0.10)</li>
</ol>
<p>描述：该参数定义了机器人在 x 和 y 坐标（平面内的距离）上的目标容差，单位是 米。<br>作用：当机器人接近目标时，如果它与目标的距离小于该值（0.10米），则认为机器人已经到达目标。<br>默认值：0.10米，即允许机器人与目标位置有最多10厘米的偏差。</p>
<ol start="3">
<li>latch xy goal tolerance (bool, default: false)</li>
</ol>
<p>描述：该参数决定了是否启用 目标容差锁定。如果启用，当机器人到达目标的 xy 位置（即目标的平面坐标）时，机器人将停下来，开始原地旋转，而不再进一步移动，即使它在旋转过程中离目标位置稍微偏离。<br>作用：启用此选项可以使机器人在到达目标位置后原地旋转，而不再根据路径调整自己的位置。<br>默认值：false，表示默认不启用该行为。</p>
<hr>
<p>Oscillation Reset(摆动重置)</p>
<p>机器人可能会由于局部规划器生成两台&#x3D;条相反的路径在目标之间来回摆动，为了防止摆动无限进行，ROS提供恢复机制来帮助机器人重新规划路径。</p>
<ol start="4">
<li><p>oscillation reset dist (double, default: 0.05)</p>
<ul>
<li>描述：该参数定义了在机器人的路径震荡（oscillation）发生时，机器人需要行进的最小距离（单位：米），以便触发 摆动重置标志（oscillation flags）。即机器人必须走多远才能重置它的摆动状态。</li>
<li>作用：如果机器人由于路径震荡而来回摆动，并且没有走出震荡区域，那么该参数控制了机器人在遇到震荡时需要移动多远，才会清除摆动标志并尝试新的行为来恢复正常行进。<br>默认值：0.05米，表示机器人必须移动至少 5厘米，才能重新启动其路径规划和恢复机制。</li>
</ul>
<hr>
</li>
</ol>
<h2 id="Costmap-Parameters"><a href="#Costmap-Parameters" class="headerlink" title="Costmap Parameters"></a>Costmap Parameters</h2><p>   代价地图参数调整对于local_planner的成功至关重要。</p>
<p>   costmap被分为三个主要层次：</p>
<ul>
<li>static map layer(静态地图层)：</li>
</ul>
<p>   代表静态的slam地图，是一个预先构建的地图，是之前使用gmapping构建的地图。</p>
<ul>
<li>obstacle map layer(障碍地图层)：</li>
</ul>
<p>   表示机器人检测到的障碍物，包括2D障碍物（环境中的物体：墙壁）、3D障碍物是使用传感器检测的。通常表示为<strong>体素层</strong>。</p>
<ul>
<li>inflation layer（膨胀层）</li>
</ul>
<p>   在此层中，障碍物会被 膨胀，也就是将障碍物周围的区域扩展，以确保机器人不仅避免碰到障碍物本身，还能避免距离障碍物过近的区域。这有助于通过计算每个 2D 成本地图单元格 的“成本”，来确保机器人避开障碍物。膨胀区域考虑到机器人的尺寸和所需的障碍物间隙。</p>
<hr>
<p>   <strong>全局代价地图和局部代价地图：</strong></p>
<ul>
<li>全局成本地图（Global Costmap）：</li>
</ul>
<p>   该成本地图表示整个环境，并且是基于 提供给导航栈的<strong>静态地图</strong> 生成的。它通过膨胀静态地图上的障碍物来生成，并在较大范围内表示机器人导航的环境（通常用于全局规划）。</p>
<ul>
<li>局部成本地图（Local Costmap）：</li>
</ul>
<p>   该成本地图是基于机器人 实时传感器数据（如激光扫描仪、摄像头或深度传感器）动态生成的。它表示机器人周围的环境，并会持续更新。局部成本地图被本地规划器（如 DWA）用于避开障碍物并实时安全地导航。</p>
<p>   有很多重要的参数需要设置：</p>
<h3 id="footprint"><a href="#footprint" class="headerlink" title="footprint"></a>footprint</h3><p>   这是机器人移动底座的轮廓，我们希望占地面积略大于机器人的真实轮廓。</p>
<h3 id="inflation"><a href="#inflation" class="headerlink" title="inflation"></a>inflation</h3><p>   膨胀层由不同单元格组成，每个单元有三个状态：</p>
<ul>
<li>占用（Occupied）：该单元格被障碍物占据。</li>
<li>无障碍（Free）：该单元格没有障碍物。</li>
<li>未知（Unknown）：机器人无法确定该单元格的状态。</li>
</ul>
<p>   <img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/%E7%A2%B0%E6%92%9E%E7%AE%97%E6%B3%95.jpg" alt="img"></p>
<p>上图中，横轴是距离机器人中心的距离，纵轴是代价地图中栅格的灰度值。</p>
<p>致命障碍:栅格值为254，此时障碍物与机器人中心重叠，必然发生碰撞；<br>内切障碍:栅格值为253，此时障碍物处于机器人的内切圆内，必然发生碰撞；<br>外切障碍:栅格值为[128,252]，此时障碍物处于其机器人的外切圆内，处于碰撞临界，不一定发生碰撞；<br>非自由空间:栅格值为(0,127]，此时机器人处于障碍物附近，属于危险警戒区，进入此区域，将来可能会发生碰撞；<br>自由区域:栅格值为0，此处机器人可以自由通过；<br>未知区域:栅格值为255，还没探明是否有障碍物。</p>
<ul>
<li>膨胀半径（Inflation Radius）：控制 零成本点（即距离障碍物最远的地方）到障碍物的距离。简单来说，膨胀半径决定了障碍物的影响范围，膨胀区域越大，障碍物周围的影响区间也就越大。</li>
<li>成本缩放因子（Cost Scaling Factor）：决定了衰减曲线的斜率。成本缩放因子与单元格的成本成反比，也就是说，当成本缩放因子增加时，衰减曲线会变得更陡峭。这会导致障碍物周围的区域成本值迅速增大，从而让机器人更倾向于避开这些区域。</li>
</ul>
<p>可以选择<strong>更小的成本缩放因子</strong>，从而更适合机器人避开障碍物。</p>
<h3 id="costmap-resolution"><a href="#costmap-resolution" class="headerlink" title="costmap resolution"></a>costmap resolution</h3><p>成本地图分辨率是指每个单元格的大小，即地图每个格子表示实际的物理空间大小</p>
<p>分辨率设置得不同，会影响计算负载和路径规划效果。较低的分辨率意味着每个单元格覆盖更大的区域，计算量较小，但可能导致精度下降。</p>
<ul>
<li>局部成本地图：较低的分辨率可能导致障碍物在狭窄通道中重叠，使得机器人无法规划路径。</li>
<li>全局成本地图：分辨率设置为与提供给导航栈的地图一致即可，通常不需要特别高的分辨率。</li>
<li>激光雷达分辨率：如果激光雷达的分辨率较低，可能会导致地图中出现未知的小点，影响地图的准确性，因此可以根据实际计算能力调整分辨率。</li>
</ul>
<h3 id="obstacle-layer-and-voxel-layer"><a href="#obstacle-layer-and-voxel-layer" class="headerlink" title="obstacle layer and voxel layer"></a>obstacle layer and voxel layer</h3><ul>
<li>障碍层（Obstacle Layer） 和 体素层（Voxel Layer） 都是用于标记成本地图中的障碍物。这两个层可以统称为 “障碍层”。</li>
<li>障碍层：主要在 二维空间 中追踪障碍物，即它跟踪地图上的障碍物位置。</li>
<li>体素层：则是在 三维空间 中追踪障碍物，即它不仅考虑障碍物的平面位置，还会考虑障碍物的高度信息</li>
</ul>
<hr>
<p>obstacle layer的参数设置</p>
<ol>
<li>max obstacle height（最大障碍物高度）<br>  含义：这是可以插入到成本地图中的障碍物的最大高度，单位是米。<br>用途：如果障碍物的高度超过这个值，它将不会被添加到成本地图中。通常应该将这个值设置得略高于机器人的高度。对于 体素层，这基本上是 体素网格（Voxel Grid） 的高度。</li>
<li>obstacle range（障碍物范围）<br>  含义：这是从机器人起始位置到障碍物的最大距离，单位是米。<br>用途：只有在距离机器人一定范围内的障碍物才会被插入到成本地图中。这个值也可以根据传感器进行调整，即不同的传感器可以设置不同的障碍物范围。</li>
<li>raytrace range（射线追踪范围）<br>  含义：这是射线追踪用于从地图上使用传感器数据检测障碍物的最大距离，单位是米。<br>用途：射线追踪方法通过发射虚拟射线扫描周围环境，查找可能的障碍物。与 障碍物范围 不同，这个参数仅对 体素层（Voxel Layer） 有效。该值同样可以根据传感器的不同进行调整。</li>
<li>origin z（地图的 z 坐标原点）<br>  含义：这是成本地图在 Z轴 上的原点位置，单位是米。<br>用途：它确定了地图在垂直方向上的起始位置，用于处理体素地图中的障碍物和空白区域。</li>
<li>z resolution（Z轴分辨率）<br>  含义：这是地图在 Z轴 上每个单元格的分辨率，单位是米&#x2F;单元格。<br>用途：它决定了垂直方向上每个体素的高度，较小的值可以提供更高的垂直精度，适合处理复杂的三维障碍物。</li>
<li>z voxels（Z轴体素数）<br>  含义：这是每个垂直列中体素的数量，决定了体素网格的高度。体素网格的高度是 z resolution 乘以 z voxels。<br>用途：这个值决定了垂直方向上的体素数，即地图在Z轴上的分层结构。越多的体素意味着可以更精确地表示障碍物的垂直结构。</li>
<li>unknown threshold（未知阈值）<br>  含义：在每个垂直列中，允许的最大 未知 单元格数量，被认为该列是“已知”的。<br>用途：如果在垂直列中有超过一定数量的 未知单元格（unknown cells），则该列会被认为是“已知”的。这可以用于控制哪些区域应该被认为是障碍物或空白区域。</li>
<li>mark threshold（标记阈值）<br>  含义：每个垂直列中允许的最大 标记单元格（marked cells） 数量，被认为该列是“空闲”的。<br>用途：如果在垂直列中有超过一定数量的 标记单元格（标记为“空闲”区域），则该列会被认为是“空闲”的。这用于区分已经被标记为障碍物和被认为是空白区域的部分。</li>
</ol>
<hr>
<h2 id="AMCL"><a href="#AMCL" class="headerlink" title="AMCL"></a>AMCL</h2><p>AMCL（Adaptive Monte Carlo Localization）是ROS（Robot Operating System）中用于实现机器人定位的一个重要模块。它基于 蒙特卡洛定位（Monte Carlo Localization, MCL） 算法，使用粒子滤波（Particle Filter）技术来估计机器人在已知地图中的位置和姿态。</p>
<p>MCL算法通过 粒子滤波 来估计机器人在已知地图中的位置。它依赖于两种模型来估计机器人的位置：运动模型和测量模型。</p>
<ol>
<li>运动模型（Motion Model）：</li>
</ol>
<p>运动模型用于描述机器人如何根据**里程计数据（Odometry）**来预测自己的运动。通过里程计，机器人可以估算自己的位移和旋转，运动模型根据这些估算来更新机器人的位置和姿态。<br>该模型描述了在没有外部传感器输入的情况下，机器人根据其运动的先验信息如何变化。</p>
<ol start="2">
<li>测量模型（Measurement Model）：</li>
</ol>
<p>测量模型则描述了如何利用传感器（例如<strong>激光雷达（Laser Scan）</strong>）来估算机器人周围环境的状态，并与地图数据进行比较，进而帮助定位。通过传感器测得的距离信息，测量模型可以计算出不同位置的观测值，从而更新机器人位置的估计。</p>
<hr>
<p>从而可以分析三个问题：</p>
<h3 id="header-in-LaserScan-messages"><a href="#header-in-LaserScan-messages" class="headerlink" title="header in LaserScan messages"></a>header in LaserScan messages</h3><p>在sensor_msgs&#x2F;LaserScan话题中发布：</p>
<ol>
<li>angle_min (float32)<br> 含义：扫描的起始角度，单位为弧度（rad）。<br> 影响：这是激光扫描器开始扫描的角度。如果这个参数设置不正确，扫描范围的起始点会偏离实际的扫描范围，从而导致激光扫描的误差，进而影响定位结果。</li>
<li>angle_max (float32)<br> 含义：扫描的结束角度，单位为弧度（rad）。<br> 影响：这是激光扫描器停止扫描的角度。如果该参数设置不准确，扫描的结束位置会错误，导致扫描的有效范围与实际的扫描范围不一致，这会影响到机器人定位时对环境的理解，可能导致错误的障碍物位置估计。</li>
<li>angle_increment (float32)<br> 含义：每个扫描之间的角度增量，单位为弧度（rad）。<br> 影响：该参数决定了激光扫描器每次测量之间的角度间隔。如果设置不正确，激光扫描的精度会受到影响，可能导致激光点的分布不均匀，进而影响定位和地图构建的精度。</li>
<li>time_increment (float32)<br> 含义：测量之间的时间间隔，单位为秒。如果激光扫描器在移动时，该参数用于插值计算3D点的位置。<br> 影响：当激光扫描器运动时，time_increment 用于推算每个激光测量之间的时间差异。如果该参数设置不准确，可能导致定位过程中对激光点的时间顺序理解出现偏差，影响到位置的估算与更新，尤其是在动态环境中，可能导致位置偏差。</li>
<li>scan_time (float32)<br> 含义：每次扫描的时间间隔，单位为秒。<br> 影响：这是每次激光扫描完成所需的时间。如果这个参数设置不正确，可能会导致扫描更新的时效性出现问题，进而影响到机器人在定位时对周围环境的实时理解。如果扫描时间太长，AMCL可能无法及时更新位置，导致延迟；如果时间设置得过短，可能导致数据采集不完整，降低定位精度。</li>
<li>range_min (float32)<br> 含义：激光扫描器测量的最小距离，单位为米（m）。<br> 影响：激光扫描器的最小测量距离。如果该参数设置不准确，可能导致激光扫描器无法正确识别靠近的物体或障碍物，从而影响障碍物检测和定位。尤其在距离较近时，机器人可能会错误地认为没有障碍物，影响路径规划与定位。</li>
<li>range_max (float32)<br> 含义：激光扫描器测量的最大距离，单位为米（m）。<br> 影响：激光扫描器的最大测量距离。如果这个参数设置不正确，可能导致机器人无法感知到远处的障碍物，从而影响机器人在大范围环境中的定位与路径规划。设置不正确的最大范围会导致环境感知不完整，影响机器人的定位精度。</li>
</ol>
<hr>
<h3 id="测量和运动模型的参数"><a href="#测量和运动模型的参数" class="headerlink" title="测量和运动模型的参数"></a>测量和运动模型的参数</h3><p>这里列出了一些在amcl包里面的参数</p>
<p>对于雷达扫描模型，默认参数是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;laser_z_hit&quot;: 0.5,</span><br><span class="line">&quot;laser_sigma_hit&quot;: 0.2,</span><br><span class="line">&quot;laser_z_rand&quot; :0.5,</span><br><span class="line">&quot;laser_likelihood_max_dist&quot;: 2.0</span><br></pre></td></tr></table></figure>

<p>为了提高机器人的定位性，我们增加了laser.z.hit和laser.sigma.hit 来获得更高的测量噪声。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;laser_z_hit&quot;</span>: 0.9,</span><br><span class="line"><span class="string">&quot;laser_sigma_hit&quot;</span>: 0.1,</span><br><span class="line"><span class="string">&quot;laser_z_rand&quot;</span> :0.5,</span><br><span class="line"><span class="string">&quot;laser_likelihood_max_dist&quot;</span>: 4.0</span><br></pre></td></tr></table></figure>

<p>下面是结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250616101019092.png" alt="image-20250616101019092"></p>
<hr>
<p>对于里程计模型，默认参数是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;kld_err&quot;</span>: 0.01,</span><br><span class="line"><span class="string">&quot;kld_z&quot;</span>: 0.99,</span><br><span class="line"><span class="string">&quot;odom_alpha1&quot;</span>: 0.005,</span><br><span class="line"><span class="string">&quot;odom_alpha2&quot;</span>: 0.005,</span><br><span class="line"><span class="string">&quot;odom_alpha3&quot;</span>: 0.005,</span><br><span class="line"><span class="string">&quot;odom_alpha4&quot;</span>: 0.005</span><br></pre></td></tr></table></figure>

<p>当里程计的噪声较小时，颗粒会更加集中（准确），否则，颗粒会更加分散。</p>
<hr>
<h3 id="雷达的坐标变换"><a href="#雷达的坐标变换" class="headerlink" title="雷达的坐标变换"></a>雷达的坐标变换</h3><p>在 ROS 系统中，如果激光扫描仪与机器人底盘之间的坐标变换（tf transform）不正确，可能导致激光数据的偏移和定位异常。通常，这些变换通过 URDF 和 SRDF 文件来处理，但如果使用 rosbag 文件进行数据回放时，你可能需要手动发布这些变换，确保激光扫描仪的位置信息正确地与机器人底盘的坐标系对接。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/06/23/%E5%9F%BA%E4%BA%8Egmapping+move_base%E7%9A%84%E5%BB%BA%E5%9B%BE%E5%8F%8A%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/23/%E5%9F%BA%E4%BA%8Egmapping+move_base%E7%9A%84%E5%BB%BA%E5%9B%BE%E5%8F%8A%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">基于gmapping+move_base的建图及路径规划算法总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-06-23 00:00:00 / 修改时间：15:24:35" itemprop="dateCreated datePublished" datetime="2025-06-23T00:00:00+08:00">2025-06-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="基于gmapping-move-base的建图及路径规划算法总结"><a href="#基于gmapping-move-base的建图及路径规划算法总结" class="headerlink" title="基于gmapping+move_base的建图及路径规划算法总结"></a>基于gmapping+move_base的建图及路径规划算法总结</h1><h2 id="硬件说明"><a href="#硬件说明" class="headerlink" title="硬件说明"></a>硬件说明</h2><ol>
<li><p>底盘</p>
<p>型号：scout_mini（普通版本）</p>
</li>
</ol>
<ul>
<li><p>github仓库：<a target="_blank" rel="noopener" href="https://github.com/agilexrobotics/scout_ros">https://github.com/agilexrobotics/scout_ros</a></p>
<p>可以参考官网给出的教程进行操作，基本没有其他问题。</p>
<p>值得关注的是此软件包的结构：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/scout_ros%E7%BB%93%E6%9E%84.png" alt="image-20250623101812677"></p>
</li>
</ul>
<p>可以看到，scout_ros软件包下面共有4个文件夹：</p>
<ul>
<li>scout_base:围绕 ugv_sdk 的 ROS 包装器，用于监视和控制 scout 机器人</li>
<li>scout_bringup:启动 ROS 节点的启动和配置文件</li>
<li>scout_description:基于移动底盘的 URDF 模型</li>
<li>scout_msgs:与 scout 相关的消息定义</li>
</ul>
<hr>
<h3 id="scout-bringup"><a href="#scout-bringup" class="headerlink" title="scout_bringup"></a>scout_bringup</h3><p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/scout_bringup.img" alt="image-20250623102443063"></p>
<p>这个文件夹主要关注launch文件，由于购买的底盘是scout_mini，选择使用scout_mini_robot_base.launch ,miniomni是麦克纳姆轮版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scout_mini_robot_base.launch </span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;port_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;can0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;simulated_robot&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;model_xacro&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(find scout_description)/urdf/scout_v2.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;odom_topic_name&quot;</span> <span class="attr">default</span>=<span class="string">&quot;odom&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;is_scout_mini&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;pub_tf&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find scout_base)/launch/scout_base.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;port_name&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(arg port_name)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;simulated_robot&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(arg simulated_robot)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;odom_topic_name&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(arg odom_topic_name)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;is_scout_mini&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(arg is_scout_mini)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;pub_tf&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(arg pub_tf)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--include file=&quot;$(find scout_description)/launch/description.launch&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;arg name=&quot;model_xacro&quot; default=&quot;$(arg model_xacro)&quot; /&gt;</span></span><br><span class="line"><span class="comment">    &lt;/include--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>port_name：指定用于与机器人通信的端口，默认值&#x3D;“can 0”</li>
<li>simulated_robot：表示是否使用模拟启动，默认值&#x3D;“false”</li>
<li>model_xacro：指定用于发布 tf 帧的目标“.xacro”文件，默认值&#x3D;scout_v2.xacro</li>
<li>odom_topic_name：设置计算出的里程计发布到的主题的名称，默认值&#x3D;“odom”</li>
<li>is_scout_mini：适用于 scout_mini 类型的底盘，默认值&#x3D;“ture”</li>
<li>pub_tf：是否发布tf坐标变换，默认值是”false”</li>
</ul>
<hr>
<p>对于scout_mini的测试，按照官网的指令操作即可。model_xacro可以在 <code>scout_description/urdf/</code>找到，并且做相应的更改。</p>
<p>打开终端：运行如下指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jiangbao@jiangbao:~/demo_ws$ source ./devel/setup.bash</span><br><span class="line">jiangbao@jiangbao:~/demo_ws$ roslaunch scout_description display_scout_mini.launch </span><br></pre></td></tr></table></figure>

<p>即可打开urdf模型：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/scout_mini%E6%A8%A1%E5%9E%8B.img" alt="image-20250623104034852" style="zoom:50%;" />

<p>如果需要根据需求，对模型进行修改，可以参考<strong>9.1构建机器人的模型</strong></p>
<hr>
<ol start="2">
<li>雷达</li>
</ol>
<p>型号：镭神智能C16-151B-22070017</p>
<p>可以找客服要一下软件驱动包。按照提示安装即可。下好驱动之后，可以参考文档<strong>8.2 机器人平台设计-传感器-雷达</strong>进行操作。</p>
<p>至此，硬件配置结束。</p>
<h2 id="传感器集成"><a href="#传感器集成" class="headerlink" title="传感器集成"></a>传感器集成</h2><p>在配置好雷达以及小车底盘之后能，为了方便同时启动多个节点，可以写一个功能包，并且通过坐标变换来实现机器人底盘与里程计、雷达相互关联。参考文件<strong>8.3传感器集成</strong></p>
<p>值得注意的是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;include file=&quot;$(find scout_bringup)/launch/scout_teleop_keyboard.launch&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>如果在机器人启动文件中包含了这个文件，后面使用导航时，就会无法用路径规划算法控制小车底盘移动，所以可以选择在需要使用的时候，自己单独开启小车底盘控制节点。</p>
<h2 id="构建机器人模型"><a href="#构建机器人模型" class="headerlink" title="构建机器人模型"></a>构建机器人模型</h2><p>如果对于怎么添加传感器模型不熟悉，可以参考赵虚左老师的文档：</p>
<p><a target="_blank" rel="noopener" href="http://www.autolabor.com.cn/book/ROSTutorials/di-9-zhang-ji-qi-ren-dao-822a28-shi-4f5329/92-dao-hang-shi-xian/931-dao-hang-shi-xian-01-zhun-bei-gong-zuo.html">http://www.autolabor.com.cn/book/ROSTutorials/di-9-zhang-ji-qi-ren-dao-822a28-shi-4f5329/92-dao-hang-shi-xian/931-dao-hang-shi-xian-01-zhun-bei-gong-zuo.html</a></p>
<p>里面很详细介绍怎么去新建一个传感器模型，记得修改相关参数。</p>
<h2 id="建图及相关操作"><a href="#建图及相关操作" class="headerlink" title="建图及相关操作"></a>建图及相关操作</h2><p>这一节主要使用gmapping 建图，并且使用map_server及map_save来实现地图的保存与读取</p>
<p>按照<strong>9.2建图及其相关操作</strong>，应该问题不大。</p>
<h2 id="AMCL定位"><a href="#AMCL定位" class="headerlink" title="AMCL定位"></a>AMCL定位</h2><p>AMCL可以实现机器人在栅格地图自身的定位，具体实现参考文档 <strong>9.3amcl定位</strong></p>
<h2 id="路径规划"><a href="#路径规划" class="headerlink" title="路径规划"></a>路径规划</h2><p>路径规划主要采用move_base的插件来实现：<br>全局使用该插件自带的，应该是A*,这个目前还没有研究，后续会跟上。局部路径规划使用的是基础的：TrajectoryPlanner,可以修改相关参数，或者是使用其他的路径规划算法。具体相关操作以及路径规划相关参数的修改可以参考文档 **9.4路径规划 **以及文档 <strong>nav参数调优</strong>。这一部分属于是直接照搬，后续如果要深入学习，会作进一步说明。</p>
<h2 id="导航与slam自主建图"><a href="#导航与slam自主建图" class="headerlink" title="导航与slam自主建图"></a>导航与slam自主建图</h2><p>这一部分不用多说，就是单纯把前两布建图以及路径规划结合在一起，参考文档9.5导航与slam自主建图。</p>
<hr>
<p>至此，整个slam与路径规划项目大致结束，虽然使用算法简单，但是对整个系统的理解及后续算法的精进有很大帮助。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/06/11/9.1%20%E6%9E%84%E5%BB%BA%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250315215109.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Do not Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/11/9.1%20%E6%9E%84%E5%BB%BA%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">9.1构造机器人模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-06-11 00:00:00" itemprop="dateCreated datePublished" datetime="2025-06-11T00:00:00+08:00">2025-06-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-23 15:20:48" itemprop="dateModified" datetime="2025-06-23T15:20:48+08:00">2025-06-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="9-1-构建机器人模型"><a href="#9-1-构建机器人模型" class="headerlink" title="9.1 构建机器人模型"></a>9.1 构建机器人模型</h1><h2 id="分析scout-ros功能包构成"><a href="#分析scout-ros功能包构成" class="headerlink" title="分析scout_ros功能包构成"></a>分析scout_ros功能包构成</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">├── launch</span><br><span class="line">│   ├── display_scout_mini.launch</span><br><span class="line">│   ├── display_scout_v2.launch</span><br><span class="line">│   ├── gazebo.launch</span><br><span class="line">│   ├── scout_mini_stock.launch</span><br><span class="line">│   └── scout_v2_stock.launch</span><br><span class="line">├── meshes</span><br><span class="line">│   ├── 1_Link.STL</span><br><span class="line">│   ├── 2_Link.STL</span><br><span class="line">│   ├── 3_Link.STL</span><br><span class="line">│   ├── 4_Link.STL</span><br><span class="line">│   ├── base_link.dae</span><br><span class="line">│   ├── scout_mini_base_link.dae</span><br><span class="line">│   ├── scout_mini_base_link.STL</span><br><span class="line">│   ├── wheel.dae</span><br><span class="line">│   ├── wheel_type1.dae</span><br><span class="line">│   └── wheel_type2.dae</span><br><span class="line">├── package.xml</span><br><span class="line">├── rviz</span><br><span class="line">│   ├── model_display.rviz</span><br><span class="line">│   ├── navigation.rviz</span><br><span class="line">│   └── scout_mini_model_display.rviz</span><br><span class="line">└── urdf</span><br><span class="line">    ├── empty.urdf</span><br><span class="line">    ├── scout_mini.gazebo</span><br><span class="line">    ├── scout_mini_laser.urdf.xacro</span><br><span class="line">    ├── scout_mini.urdf.xacro</span><br><span class="line">    ├── scout_mini_wheel.gazebo</span><br><span class="line">    ├── scout_mini_wheel.xacro</span><br><span class="line">    ├── scout_v2.gazebo</span><br><span class="line">    ├── scout_v2.xacro</span><br><span class="line">    ├── scout_wheel.gazebo</span><br><span class="line">    ├── scout_wheel_type1.xacro</span><br><span class="line">    └── scout_wheel_type2.xacro</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到，主要需要使用的是laucn文件夹，其中display_scout_mini.launch用于启动带有机器人模型的rviz.如果需要增加传感器之类的模型，那么就需要在urdf文件中新建xacro文件。例如，我新建了一个名为scout_mini_laser.urdf.xacro文件。用于增加雷达组件。</p>
<p>所以说，想要增加一个雷达也很简单。</p>
<p>新建scout_mini_laser.urdf.xacro文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;mycar&quot;</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://wiki.ros.org/xacro&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;support_radius&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.01&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;support_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.15&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;laser_radius&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.03&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;laser_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_support_x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_support_y&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_support_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;wheel_vertical_offset + base_z_size / 2 + support_length / 2&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_laser_x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_laser_y&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_laser_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;support_length / 2 + laser_length / 2&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;support&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;support_radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;support_length&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0.8 0.5 0.0 0.5&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;support2base&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;support&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;joint_support_x&#125; $&#123;joint_support_y&#125; $&#123;joint_support_z&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;laser&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;laser_radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;laser_length&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0 0 0 0.5&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;laser2support&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;support&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;laser&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;joint_laser_x&#125; $&#123;joint_laser_y&#125; $&#123;joint_laser_z&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是赵虚左老师的文件，没有太多修改，主要改动是：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_support_x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_support_y&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_support_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;wheel_vertical_offset + base_z_size / 2 + support_length / 2&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于没有设计base_footprint 所以scout_mini底盘设了一个wheel_vertical_offset，弥补地面相对底盘的高度差，所以在写支柱对于底盘的高度差的时候，不仅要加上底盘的高度，还要加上这个补偿。</p>
<p>至此写完了雷达的xacro文件。</p>
<p>再修改一下 scout_mini_laser.urdf.xacro，找到最后面，增加一个：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Additional definitions --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(arg urdf_extras)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;scout_mini_laser.urdf.xacro&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>大功告成。</p>
<p>在终端运行一下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch scout_description display_scout_mini.launch</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/%E5%A2%9E%E5%8A%A0%E9%9B%B7%E8%BE%BE.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hita</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
