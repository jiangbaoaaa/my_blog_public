<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"gen2710.netlify.app","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":true,"height":100},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Gains Don&#39;t Stop!">
<meta property="og:type" content="website">
<meta property="og:title" content="U.N.O">
<meta property="og:url" content="http://gen2710.netlify.app/index.html">
<meta property="og:site_name" content="U.N.O">
<meta property="og:description" content="Gains Don&#39;t Stop!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Hita">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://gen2710.netlify.app/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>U.N.O</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">U.N.O</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hita"
      src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
  <p class="site-author-name" itemprop="name">Hita</p>
  <div class="site-description" itemprop="description">Gains Don't Stop!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jiangbaoaaa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiangbaoaaa" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:n13155609602@163.com" title="E-mail → mailto:n13155609602@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/08/01/EndNote%20%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/01/EndNote%20%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">EndNote使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-08-01 00:00:00 / 修改时间：09:57:49" itemprop="dateCreated datePublished" datetime="2025-08-01T00:00:00+08:00">2025-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">工具使用</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="EndNote-使用"><a href="#EndNote-使用" class="headerlink" title="EndNote 使用"></a>EndNote 使用</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>EndNote是一款广泛使用的文献管理工具，旨在帮助学者和研究人员整理、管理和引用学术文献。在学术写作中，EndNote能够自动化引用过程，减少人工输入错误，提升工作效率。无论是在准备论文、书籍还是研究报告时，EndNote都能为用户提供强大的支持，尤其在生成参考文献和引用格式方面表现突出。</p>
<h2 id="新建文件数据库"><a href="#新建文件数据库" class="headerlink" title="新建文件数据库"></a>新建文件数据库</h2><p>打开EndNote,选择file&gt;new ,选择文件位置，即可新建一个文件数据库。文件数据库相当于你管理文献的一个大仓库。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195548273.png" alt="image-20250731195548273"></p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195617688.png" alt="image-20250731195617688"  />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195637883.png" alt="image-20250731195637883" style="zoom: 67%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195659062.png" alt="image-20250731195659062"></p>
<p>会出现两个新的图标在桌面上。</p>
<hr>
<h2 id="导入文献"><a href="#导入文献" class="headerlink" title="导入文献"></a>导入文献</h2><h3 id="导入英文文献（以WOS为例）"><a href="#导入英文文献（以WOS为例）" class="headerlink" title="导入英文文献（以WOS为例）"></a>导入英文文献（以WOS为例）</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200240533.png" alt="image-20250731200240533" style="zoom: 50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200411385.png" alt="image-20250731200411385"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200510672.png" alt="image-20250731200510672"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200602788.png" alt="image-20250731200602788"></p>
<p>文献即可在EndNote中显示了。或者点击file&gt;import&gt;file，选中刚才在浏览器下载的文件，也可以导入。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200755328.png" alt="image-20250731200755328" style="zoom:80%;" />

<hr>
<h3 id="导入中文文献（知网为例）"><a href="#导入中文文献（知网为例）" class="headerlink" title="导入中文文献（知网为例）"></a>导入中文文献（知网为例）</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201116020.png" alt="image-20250731201116020" style="zoom:50%;" />

<p>会跳转到下面这个界面。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201222425.png" alt="image-20250731201222425" style="zoom:50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201302937.png" alt="image-20250731201302937"></p>
<p>与前面英文文献类似，选择打开即可。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201354847.png" alt="image-20250731201354847" style="zoom:67%;" />

<p>刚才导出的两篇文章都能在endnote中找到了。</p>
<h3 id="导入PDF"><a href="#导入PDF" class="headerlink" title="导入PDF"></a>导入PDF</h3><p>对于中文文献的PDF导入，可能无法识别，所以建议只导入英文文献的PDF.</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201701772.png" alt="image-20250731201701772"></p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201851483.png" alt="image-20250731201851483" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202136588.png" alt="image-20250731202136588" style="zoom:67%;" />

<p>英文文献的话，就会完整一点，同时可以通过文献的DOI号来更新文件信息。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202238574.png" alt="image-20250731202238574" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202545052.png" alt="image-20250731202545052" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202708767.png" alt="image-20250731202708767" style="zoom:67%;" />

<p>找到文件，选择复制DOI号，然后保存在上述界面之后，选择更新即可。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731203052379.png" alt="image-20250731203052379" style="zoom:67%;" />

<p>这样，文献条目栏就有更新的信息了。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731203140549.png" alt="image-20250731203140549" style="zoom:67%;" />

<p>文献导入暂时介绍到这。</p>
<hr>
<h2 id="基本界面"><a href="#基本界面" class="headerlink" title="基本界面"></a>基本界面</h2><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731204134909.png" alt="image-20250731204134909" style="zoom:67%;" />

<h3 id="文献去重"><a href="#文献去重" class="headerlink" title="文献去重"></a>文献去重</h3><p>如果是批量导入文献的话，如果从不同的数据库中导入文献可能存在重复的情况，这时候就需要去重。</p>
<p>首先先批量导入一些文献，分别从两个数据库导入了25篇文献，现在对其中重复的文献进行去重。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731204717472.png" alt="image-20250731204717472" style="zoom: 50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731204813359.png" alt="image-20250731204813359"></p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205003151.png" alt="image-20250731205003151" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205052835.png" alt="image-20250731205052835" style="zoom:67%;" />

<p>按住 <code>ctr + A</code>选择全部文献。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205211704.png" alt="image-20250731205211704" style="zoom:80%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205640773.png" alt="image-20250731205640773" style="zoom: 50%;" />

<p>如果选择取消，可以在侧边栏看到：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205738517.png" alt="image-20250731205738517" style="zoom:50%;" />

<p>有一个重复的文件夹</p>
<p>直接把不需要的文献拖拽到垃圾桶即可。</p>
<hr>
<h3 id="文献分类"><a href="#文献分类" class="headerlink" title="文献分类"></a>文献分类</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731210408265.png" alt="image-20250731210408265" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731210555381.png" alt="image-20250731210555381" style="zoom:50%;" />

<p>创建好文件夹之后，可以把导入的文献拖拽或者邮件放入文件夹中，同样可以进行删除文献或者文件夹操作，注意这不会删除你本来的文献。仍然存在于All Ref内，除非拖拽到 Trash中。</p>
<hr>
<h3 id="文献标签"><a href="#文献标签" class="headerlink" title="文献标签"></a>文献标签</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211110190.png" alt="image-20250731211110190" style="zoom: 50%;" />

<p>将文献拖拽到标签处即可赋予标签，或者右键文献</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211225249.png" alt="image-20250731211225249" style="zoom:50%;" />

<p>第一种方式比较优雅。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211345499.png" alt="image-20250731211345499" style="zoom:80%;" />

<hr>
<h3 id="文献排序"><a href="#文献排序" class="headerlink" title="文献排序"></a>文献排序</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211714999.png" alt="image-20250731211714999" style="zoom: 50%;" />

<p>右键信息栏即可给文献添加新的信息，这里可以添加一个评级，给它勾选上即可。</p>
<h3 id="文献阅读"><a href="#文献阅读" class="headerlink" title="文献阅读"></a>文献阅读</h3><p>由于没有在这个软件阅读文献的习惯，所以知识简单做一个标记。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731212333810.png" alt="image-20250731212333810" style="zoom:67%;" />

<h2 id="文献引用"><a href="#文献引用" class="headerlink" title="文献引用"></a>文献引用</h2><p>挖个坑，现在用不到</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/30/docker%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/30/docker%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Docker 安装及使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-30 00:00:00 / 修改时间：16:27:29" itemprop="dateCreated datePublished" datetime="2025-07-30T00:00:00+08:00">2025-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">工具学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="docker安装及使用"><a href="#docker安装及使用" class="headerlink" title="docker安装及使用"></a>docker安装及使用</h1><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><p><strong>环境介绍</strong> ：</p>
<ul>
<li>虚拟机：vmware 17pro</li>
<li>系统：ubuntu20.04</li>
</ul>
<h3 id="下载Docker"><a href="#下载Docker" class="headerlink" title="下载Docker"></a>下载Docker</h3><p>参考文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1323800">最详细的ubuntu 安装 docker教程-阿里云开发者社区</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/24228872523">(49 封私信 &#x2F; 76 条消息) docker配置镜像Docker pull时报错：https://registry-1.docker.io/v2/ - 知乎</a></li>
</ul>
<hr>
<h2 id="使用Docker"><a href="#使用Docker" class="headerlink" title="使用Docker"></a>使用Docker</h2><h3 id="Docker基本组成"><a href="#Docker基本组成" class="headerlink" title="Docker基本组成"></a>Docker基本组成</h3><p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250726105837573.png" alt="image-20250726105837573"></p>
<p><strong>镜像(image)</strong>：只是一个只读的模板，可以用来创建容器，一个镜像可以创建多个容器。</p>
<p><strong>容器(container)</strong> ：利用容器独立运行一个或者一组应用，容器时用镜像创建的运行实例。每个容器是相互隔离的，一个容器相当于一个简易版的环境。它的定义和镜像类似，唯一的区别在于容器的最上面一层是可读可写的。</p>
<p><strong>仓库(repository)</strong>：仓库是集中存放镜文件的场所，最大的公开仓库是Docker Hub。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250726110258459.png" alt="image-20250726110258459"></p>
<hr>
<h2 id="Docker-常用命令"><a href="#Docker-常用命令" class="headerlink" title="Docker 常用命令"></a>Docker 常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker -v 		# 显示Docker版本信息</span><br><span class="line">docker info 	# 显示Docker系统信息，包括镜像和容器数</span><br><span class="line">docker --help 	# 帮助</span><br></pre></td></tr></table></figure>

<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><ol>
<li>docker images</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker images		# 列出本地主机上的镜像</span><br><span class="line"># 解释</span><br><span class="line">REPOSITORY   镜像的仓库源</span><br><span class="line">TAG          镜像的标签</span><br><span class="line">IMAGE ID     镜像的ID</span><br><span class="line"> CREATED      镜像创建时间</span><br><span class="line">SIZE         镜像大小</span><br><span class="line"></span><br><span class="line">-a：        列出本地所有镜像</span><br><span class="line">-q：        只显示镜像id</span><br><span class="line">--digests： 显示镜像的摘要信息</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>docker search</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search 镜像名称		# 例如 docker search mysql</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>docker pull</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull 镜像名称		# 例如 docker pull mysql</span><br><span class="line"># 如果不添加tag，则拉取最新的，也可以添加tag：docker pull mysql:5.7  具体的tag可以去docker hub 查看</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>docker rmi(remove image)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 镜像id</span><br><span class="line">docker rmi -f $(docker images -qa)		# 删除全部</span><br></pre></td></tr></table></figure>

<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><p>必须要先下载镜像才能创建容器，使用centos镜像来测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<ol>
<li>新建容器并启动</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run [选项] image [指令]</span><br><span class="line"></span><br><span class="line"># 常用选项：</span><br><span class="line">--name=&quot;Name&quot;               # 给容器指定一个名字</span><br><span class="line">-d                          # 后台方式运行容器，并返回容器的id！</span><br><span class="line">-i                          # 以交互模式运行容器，通过和 -t 一起使用</span><br><span class="line">-t                          # 给容器重新分配一个终端，通常和 -i 一起使用</span><br><span class="line">-P                          # 随机端口映射（大写）</span><br><span class="line">-p                          # 指定端口映射（小写）</span><br><span class="line"></span><br><span class="line"># 使用centos进行交互式启动容器，在容器中执行/bin/bash命令</span><br><span class="line">docker run -it centos /bin/bash</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>列出所有运行的容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker ps </span><br><span class="line"></span><br><span class="line"># 常用选项</span><br><span class="line">-a 	# 列出当前所有正在运行的容器和历史运行的容器</span><br><span class="line">-l 	#显示最近创建的容器</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>退出容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit		# 退出容器并且停止</span><br><span class="line">ctrl+p+q	# 容器不停止退出</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动停止容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker start (容器id or 容器名)        # 启动容器</span><br><span class="line">docker restart (容器id or 容器名)      # 重启容器</span><br><span class="line">docker stop (容器id or 容器名)         # 停止容器</span><br><span class="line">docker kill (容器id or 容器名)         # 强制停止容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>删除容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id                  # 删除指定容器</span><br><span class="line">docker rm -f $(docker ps -a -q)  # 删除所有容器</span><br><span class="line">docker ps -a -q|xargs docker rm  # 删除所有容器</span><br></pre></td></tr></table></figure>

<h3 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h3><ol>
<li>后台启动容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockerrun -d 容器名</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看容器中运行的进程信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器id</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看容器&#x2F;镜像的元数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>进入正在运行的容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器名</span><br><span class="line">docker attach 容器id</span><br><span class="line"></span><br><span class="line"># 区别</span><br><span class="line"># exec   是在容器中打开新的终端，并且可以启动新的进程</span><br><span class="line"># attach 直接进入容器启动命令的终端，不会启动新的进程</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>从容器内拷贝文件到主机</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径 目的地路径</span><br></pre></td></tr></table></figure>

<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><p>Portainer安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9000:9000 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce</span><br></pre></td></tr></table></figure>

<p>Portainer是Docker的图形化管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷 的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和 服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型单位对容器管 理的全部需求。</p>
<p>访问方式：<a target="_blank" rel="noopener" href="http://ip:9000/">http://ip:9000</a></p>
<p>查看自己的ip:<code>ifconfig</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250726154933589.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250726154809192.png"></p>
<hr>
<h2 id="Docker镜像讲解"><a href="#Docker镜像讲解" class="headerlink" title="Docker镜像讲解"></a>Docker镜像讲解</h2><p> 镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含 运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<p>Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部！ 这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<h3 id="镜像Commit"><a href="#镜像Commit" class="headerlink" title="镜像Commit"></a>镜像Commit</h3><p>docker commit 从容器创建一个新的镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m=&quot;提交的信息&quot; -a=&quot;作者&quot; 容器id 要创建的目标镜像名:[标签名]</span><br><span class="line">如果要保留现在容器的状态，可以通过commit，提交镜像，方便使用，类似于vm中的快照。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><h3 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h3><p>容器之间可以共享数据，可以保存数据，让数据挂在到本地，数据就不会因为容器删除丢失。<strong>容器数据卷可以使得容器持久化，保证容器之间数据的共享以及继承。</strong></p>
<h3 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h3><blockquote>
<p>方式一：容器中直接使用命令添加</p>
</blockquote>
<p><strong>挂载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 宿主机绝对路径目录：容器内目录 镜像名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">docker run  -it -v /home/test:/home ubuntu:20.04 /bin/bash</span><br></pre></td></tr></table></figure>

<p>查看是否挂载成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查看容器id</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">hita@hita-vm:/$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">0bbaf7ac2bdc   ubuntu:20.04   &quot;/bin/bash&quot;               3 minutes ago   Exited (0) 3 minutes ago             keen_dirac</span><br><span class="line">8aa9983a7e8f   2cd1d97f893f   &quot;/docker-entrypoint.…&quot;   2 days ago      Exited (0) 2 days ago                mynginx</span><br><span class="line">63cfb2f424a8   74cc54e27dc4   &quot;/hello&quot;                  3 days ago      Exited (0) 3 days ago                sad_chaum</span><br><span class="line">c06b8b5fe3d7   74cc54e27dc4   &quot;/hello&quot;                  3 days ago      Exited (0) 3 days ago                suspicious_snyder</span><br><span class="line"></span><br><span class="line"># 查看元数据</span><br><span class="line">docker inspect 0bbaf7ac2bdc</span><br></pre></td></tr></table></figure>

<p>可以看到有这一段：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728163658066.png"></p>
<p>测试容器和宿主机之间数据共享：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 容器内</span><br><span class="line">root@0bbaf7ac2bdc:/# cd home</span><br><span class="line">root@0bbaf7ac2bdc:/home# ls</span><br><span class="line">root@0bbaf7ac2bdc:/home# touch test.java</span><br><span class="line">root@0bbaf7ac2bdc:/home# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"># 宿主机</span><br><span class="line">hita@hita-vm:/home$ cd test</span><br><span class="line">hita@hita-vm:/home/test$ ls</span><br><span class="line">test.java</span><br></pre></td></tr></table></figure>

<p>在容器中创建的会在宿主机中看到，反过来也一样，相当于在宿主机与容器内目录下新建任何文件，都会同步。并且就算是容器停止退出之后，主机修改数据，同样在容器中也会同步。只要是在预设的目录下的文件。就算是把容器删除之后，同样能够在主机中保留删除前的数据。</p>
<blockquote>
<p>方式二：通过Docker File添加容器数据卷</p>
</blockquote>
<p>DockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p>
<p><strong>测试</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 在宿主机 /home 目录下新建一个 docker-test-volume 文件夹</span><br><span class="line">hita@hita-vm:~$ mkdir docker-test-volume</span><br><span class="line">hita@hita-vm:~$ cd /home</span><br><span class="line">hita@hita-vm:/home$ sudo mkdir docker-test-volume</span><br><span class="line">[sudo] hita 的密码：       </span><br><span class="line">hita@hita-vm:/home$ ls</span><br><span class="line">docker-test-volume  hita  test</span><br><span class="line"></span><br><span class="line"># 编写 DockerFile 文件</span><br><span class="line">hita@hita-vm:/home$ pwd</span><br><span class="line">/home</span><br><span class="line">hita@hita-vm:/home$ cd docker-test-volume/</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ sudo gedit dockerfile1</span><br><span class="line"></span><br><span class="line"># 内容</span><br><span class="line">FROM ubuntu:20.04</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;/dataVolumeContainer1&quot;,&quot;/dataVolumeContainer2&quot;]</span><br><span class="line"> </span><br><span class="line">CMD /bin/bash &amp;&amp; echo &quot;-------finish------&quot;</span><br><span class="line"></span><br><span class="line"># ubild 后生成镜像，获得一个新的镜像</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker build -f /home/docker-test-volume/dockerfile1 -t test/ubuntu .</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728201212958.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728201720395.png"></p>
<p>可以看到新增了一个镜像test&#x2F;ubuntu.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 启动容器</span><br><span class="line">docker run -it 1350 /bin/bash</span><br></pre></td></tr></table></figure>

<p>可以看到新建的两个数据卷。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728202757745.png"></p>
<p>通过上述步骤，已经知道了容器内卷目录的地址，但是不知道对应主机的目录地址在哪</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 在数据卷中新建一个文件</span><br><span class="line">root@9d4fe1d5212f:/# cd dataVolumeContainer1</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# pwd</span><br><span class="line">/dataVolumeContainer1</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# touch container.txt</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 28 12:32 container.txt</span><br><span class="line"></span><br><span class="line"># 查看容器信息</span><br><span class="line">hita@hita-vm:~$ docker inspect 1350</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728203555017.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 在容器内新建一个文件</span><br><span class="line">root@9d4fe1d5212f:/# cd dataVolumeContainer1</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# touch container.txt</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# ls</span><br><span class="line">container.txt</span><br><span class="line"></span><br><span class="line"># 在宿主机查看位置</span><br><span class="line">hita@hita-vm:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">9d4fe1d5212f   1350           &quot;/bin/bash&quot;   36 minutes ago   Up 36 minutes             eager_banzai</span><br><span class="line">0bbaf7ac2bdc   ubuntu:20.04   &quot;/bin/bash&quot;   5 hours ago      Up 4 hours                keen_dirac</span><br><span class="line">hita@hita-vm:~$ docker inspect 9d4f</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728205826749.png"></p>
<p>这属于是匿名挂载，后面会讲。</p>
<p>接下来测试在容器内新建的文件是否同步了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~$ sudo -i</span><br><span class="line">root@hita-vm:~# cd /var/lib/docker/volumes/ce568fe2101804c5e79cd74df09d8cd49993ab7f4c71a5c0b80173e298837f3b/_data</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728211334028.png"></p>
<p>这个卷是在主机的默认位置。</p>
<hr>
<h3 id="匿名挂载和具名挂载"><a href="#匿名挂载和具名挂载" class="headerlink" title="匿名挂载和具名挂载"></a>匿名挂载和具名挂载</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 匿名挂载</span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -p -- name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"># 匿名挂载缺点是不好维护，通常使用docker volume 维护</span><br><span class="line">docker volume ls</span><br><span class="line"></span><br><span class="line"># 具名挂载</span><br><span class="line">-v 卷名：/容器内路径</span><br><span class="line">docker run -d -P --name nginx02 -v nginxconfig:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line"># 查看挂载的路径</span><br><span class="line"></span><br><span class="line">hita@hita-vm:~$ docker volume inspect nginxconfig </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2025-07-29T10:20:20+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/nginxconfig/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;nginxconfig&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>挂载卷跟挂载目录有什么区别呢？</strong></p>
<p>挂载卷用于在容器之间持久化和共享数据，存储在docker主机的特定目录中。如上nginxconfig就是一个挂载卷，目录挂载就是将Docker容器与主机的目录进行映射，Docker不会像管理卷一样管理这个目录。</p>
<ul>
<li><strong>挂载卷</strong>是由 Docker 管理的数据存储机制，适合用于持久化和共享数据。</li>
<li><strong>挂载目录</strong>是用户直接指定的本地文件系统路径，适合用于开发和直接操作主机文件系统的场景。</li>
</ul>
<p>需要判断挂载的是卷名而不是本机目录名？</p>
<p>挂载创建的时候：<strong>不是&#x2F;开始就是卷名，是&#x2F;开始就是目录名。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 目录挂载</span><br><span class="line">docker run  -it -v /home/test:/home ubuntu:20.04 /bin/bash</span><br><span class="line"></span><br><span class="line"># 卷挂载</span><br><span class="line">docker run -d -P --name nginx02 -v nginxconfig:/etc/nginx nginx</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><p>命名的容器挂载数据卷，其他容器通过挂载在这个父容器实现数据共享，挂载数据卷的容器，就是数据卷容器。其本身不运行任何应用程序，仅用于存储数据。</p>
<ol>
<li>先启动那个父容器docker 然后再datavolumecontainer2添加新文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~$ docker run -it --name docker test/ubuntu:latest </span><br><span class="line">-------finish------</span><br><span class="line">root@713998876d0c:/# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx   1 root root    7 Apr  4 02:03 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr 15  2020 boot</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jul 29 02:54 dataVolumeContainer1</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jul 29 02:54 dataVolumeContainer2</span><br><span class="line">drwxr-xr-x   5 root root  360 Jul 29 02:54 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 29 02:54 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr 15  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Apr  4 02:03 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Apr  4 02:03 lib32 -&gt; usr/lib32</span><br><span class="line">lrwxrwxrwx   1 root root    9 Apr  4 02:03 lib64 -&gt; usr/lib64</span><br><span class="line">lrwxrwxrwx   1 root root   10 Apr  4 02:03 libx32 -&gt; usr/libx32</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 opt</span><br><span class="line">dr-xr-xr-x 475 root root    0 Jul 29 02:54 proc</span><br><span class="line">drwx------   2 root root 4096 Apr  4 02:09 root</span><br><span class="line">drwxr-xr-x   5 root root 4096 Apr  4 02:09 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Apr  4 02:03 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Jul 29 02:54 sys</span><br><span class="line">drwxrwxrwt   2 root root 4096 Apr  4 02:09 tmp</span><br><span class="line">drwxr-xr-x  13 root root 4096 Apr  4 02:03 usr</span><br><span class="line">drwxr-xr-x  11 root root 4096 Apr  4 02:09 var</span><br><span class="line">root@713998876d0c:/# cd dataVolumeContainer2</span><br><span class="line">root@713998876d0c:/dataVolumeContainer2# touch docker.txt</span><br><span class="line">root@713998876d0c:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建docker02 ,docker03继承docker</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">创建docker02</span><br><span class="line">hita@hita-vm:~$ cd /home/docker-test-volume/</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker run -it --name docker02 --volumes-from docker test/ubuntu:latest </span><br><span class="line">-------finish------</span><br><span class="line">root@389cd5a12747:/# cd dataVolumeContainer2</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# touch docker02.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt  docker02.txt</span><br><span class="line"></span><br><span class="line"># 创建docker03</span><br><span class="line">hita@hita-vm:~$ cd /home</span><br><span class="line">hita@hita-vm:/home$ cd docker-test-volume/</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker run -it --name docker03 --volumes-from docker test/ubuntu:latest </span><br><span class="line">-------finish------</span><br><span class="line">root@8e3c5ff93b8a:/# cd dataVolumeContainer2</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt  docker02.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到，docker02继承了docker 的文件docker.txt.在docker03中新建文件docker03.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# touch docker03.txt</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt  docker02.txt  docker03.txt</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# </span><br><span class="line"></span><br><span class="line"># 在docker 中查看</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls                                    </span><br><span class="line">docker.txt  docker02.txt  docker03.txt</span><br></pre></td></tr></table></figure>

<p>可以发现docker02 docker03创建的共享文件。</p>
<ol start="3">
<li>删除docker ,修改docker02 后，docker03还能不能访问</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 删除docker</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker rm -f docker</span><br><span class="line"></span><br><span class="line"># 修改docker02</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 02:56 docker.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:01 docker02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:03 docker03.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# touch docker02-update.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 02:56 docker.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:12 docker02-update.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:01 docker02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:03 docker03.txt</span><br><span class="line"></span><br><span class="line"># 查看docker03变化</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 02:56 docker.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:12 docker02-update.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:01 docker02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:03 docker03.txt</span><br></pre></td></tr></table></figure>

<p>后续同样删除docker02容器，docker03同样可以访问原来的共享文件，如果新建docker04来继承docker03，在删除docker03，同样可以访问共享文件。所以得出结论：</p>
<p><strong>容器之间配置信息的传递，数据卷的生命周期会一直持续到没有容器使用它位置，存储在本机的文件会一直保留。</strong></p>
<hr>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><h3 id="什么是DockerFile"><a href="#什么是DockerFile" class="headerlink" title="什么是DockerFile"></a>什么是DockerFile</h3><p>dockerfile是用来构建Docker镜像的构建文件，<strong>是由一系列命令和参数构成的脚本</strong></p>
<p>构建步骤：</p>
<ol>
<li>编写DockerFile文件</li>
<li>docker build 构建镜像</li>
<li>docker run</li>
</ol>
<hr>
<h3 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h3><p><strong>基础知识</strong></p>
<ol>
<li>每条保留字指令都必须大写并且后面至少跟随一个参数</li>
<li>指令从上到下顺序执行</li>
<li>#表示注释</li>
<li>每条指令都会创建一个新的镜像层，并且对镜像进行提交</li>
</ol>
<p><strong>流程</strong></p>
<ol>
<li>docker 从基础镜像运行一个容器</li>
<li>执行一条指令并且对容器做出修改</li>
<li>执行类似 docker commit 的操作提交新的镜像层</li>
<li>Docker 再基于刚提交的镜像运行一个新的容器</li>
<li>执行dockerfile中的下一条指令直到所有的指令都执行完成</li>
</ol>
<p><strong>说明</strong></p>
<p>从应用软件角度，DockerFile 、docker镜像与docker容器分别代表软件的三个不同阶段</p>
<ul>
<li>DockerFile是软件的原材料（代码）</li>
<li>Docker镜像是软件的交付品（.apk）</li>
<li>Docker容器则是软件的运行状态（客户下载安装执行）</li>
</ul>
<p><img src="https://static001.geekbang.org/infoq/22/22c8413e4b9d8570d178aab1c54da58e.png" alt="img"></p>
<p><strong>DockerFile</strong>：需要定义一个DockerFile，DockerFile定义了进程需要的一切东西。DockerFile涉及的内容 包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进 程和内核进程（当引用进行需要和系统服务和内核进程打交道，这时需要考虑如何设计 namespace的权 限控制）等等。 </p>
<p><strong>Docker镜像</strong>：在DockerFile 定义了一个文件之后，Docker build 时会产生一个Docker镜像，当运行  Docker 镜像时，会真正开始提供服务；</p>
<p> <strong>Docker容器</strong>：容器是直接提供服务的。</p>
<hr>
<p>DockerFile指令</p>
<p><img src="https://th.bing.com/th/id/R.60fb3eed56951276ca0ce0431552ab1e?rik=GhYbCOyx/cwvxg&riu=http://www.178linux.com/wp-content/uploads/2018/08/dockerfile%E6%8C%87%E4%BB%A4.png&ehk=bd5ZcaxiwZrFiGvUmg6ZlLEkpWF1uZOa9T80sPwfK2U=&risl=&pid=ImgRaw&r=0" alt="Docker容器技术之Dockerfile | Linux运维部落"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250729200359835.png"></p>
<h3 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h3><blockquote>
<p>自定义一个 ubuntu20.04</p>
</blockquote>
<ol>
<li>编写DockerFile</li>
</ol>
<p>查看下官方默认的ubuntu:20.04的情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~$ docker run -it ubuntu:20.04 </span><br><span class="line">root@59ceb0729bd7:/# pwd</span><br><span class="line">/</span><br><span class="line">root@59ceb0729bd7:/# vim a.txt</span><br><span class="line">bash: vim: command not found</span><br><span class="line">root@59ceb0729bd7:/# ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line">root@59ceb0729bd7:/# </span><br></pre></td></tr></table></figure>

<p><strong>修改目的</strong>：使得自己的镜像具备如下功能：登陆后的默认路径、vim编译器、查看网络配置ifconfig支持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:20.04</span><br><span class="line">MAINTAINER kuangshen&lt;24736743@qq.com&gt;</span><br><span class="line"></span><br><span class="line"># 设置环境变量</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line"></span><br><span class="line"># 设置工作目录</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line"># 更新apt-get并安装vim和net-tools</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y vim net-tools </span><br><span class="line"></span><br><span class="line"># 暴露80端口</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"># 输出环境变量MYPATH</span><br><span class="line">CMD echo $MYPATH</span><br><span class="line"></span><br><span class="line"># 输出结束信息</span><br><span class="line">CMD echo &quot;----------end--------&quot;</span><br><span class="line"></span><br><span class="line"># 启动bash</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>构建</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f mydockerfile-test -t myubuntu:0.1</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250730151940676.png"></p>
<ol start="3">
<li>运行</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it myubuntu:0.1</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250730152426781.png"></p>
<p>可以看到，镜像已经支持vim&#x2F;ifconfig的命令了</p>
<ol start="4">
<li>列出镜像的变更历史</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history myubuntu:0.1</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250730153312945.png"></p>
<hr>
<blockquote>
<p>CMD和ENTRYPOINT的区别</p>
</blockquote>
<p>CMD: DockerFile 中可以有很多cmd指令,但只有最后一个生效,cmd会被 docker run 之后的参数替换</p>
<p>ENTRYPOINT: docker run 之后的参数会被当作参数传递给ENTROPOINT 之后形成新的命令组合</p>
<hr>
<h3 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h3><p>留个坑，后面再填</p>
<hr>
<p>参考视频：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1og4y1q7M4/?p=34&spm_id_from=333.1007.top_right_bar_window_history.content.click">https://www.bilibili.com/video/BV1og4y1q7M4/?p=34&amp;spm_id_from=333.1007.top_right_bar_window_history.content.click</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/23/%E5%B0%8F%E8%BD%A6%E8%87%AA%E4%B8%BB%E7%81%AB%E7%84%B0%E5%AE%9A%E4%BD%8D%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/23/%E5%B0%8F%E8%BD%A6%E8%87%AA%E4%B8%BB%E7%81%AB%E7%84%B0%E5%AE%9A%E4%BD%8D%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">小车自主火焰定位系统搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-23 00:00:00 / 修改时间：19:41:37" itemprop="dateCreated datePublished" datetime="2025-07-23T00:00:00+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="小车自主火焰定位系统搭建"><a href="#小车自主火焰定位系统搭建" class="headerlink" title="小车自主火焰定位系统搭建"></a>小车自主火焰定位系统搭建</h1><h2 id="整体思路框架"><a href="#整体思路框架" class="headerlink" title="整体思路框架"></a>整体思路框架</h2><ol>
<li>小车订阅火焰位置数据</li>
</ol>
<p>之前在代码中已经发布了小车相对于相机的3D位置话题：&#x2F;fire_position_3d,小车只要订阅即可</p>
<ol start="2">
<li>转换火焰的相对位置到小车坐标系</li>
</ol>
<p>使用TF2来实现坐标变换：camera_link到base_link</p>
<ol start="3">
<li>规划小车路径到火焰的位置</li>
</ol>
<p>目标点设置:火焰的3D位置转换为小车的坐标系中的2D目标位置，然后将火焰相对于地图的位置发布给move_base.</p>
<p>路经规划：利用move_base进行路径规划。可以通过其将转换国的目标点作为目标进行路径规划，从而实现小车朝着火焰位置前进。</p>
<hr>
<p>优化：</p>
<ol>
<li>导航控制与精确定位</li>
</ol>
<p>需要调节小车速度，使其能够平稳靠近火焰，避免过快靠近导致导航不稳定。</p>
<p>在接近火焰时候，需要确保小车精确停靠在火焰附近。</p>
<ol start="2">
<li>火焰识别可靠性和鲁棒性优化</li>
</ol>
<p>鲁棒性：确保火焰识别算法在各种环境下都可以稳定工作，提升火焰检测准确性。</p>
<hr>
<h2 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h2><ol>
<li>构建TF坐标变换树，有两种方法：</li>
</ol>
<ul>
<li>使用 URDF + Robot State Publisher（后面再用）</li>
<li>使用 robot_state_publisher 发布 TF（实验）</li>
</ul>
<ol start="2">
<li><p>获取火焰相对于小车底盘的位置</p>
</li>
<li><p>发布火焰相对于小车底盘的位置，方便其他节点订阅</p>
</li>
<li><p>将火焰相对于小车坐标转换成地图坐标，这样可以在全局地图上做路径规划和导航了</p>
</li>
<li><p>将火焰相对与地图的2D位置发布给move_base，从而使用全局以及局部路径规划算法，来计算路径，通过cml_vel话题发布命令控制小车朝目标移动</p>
</li>
</ol>
<hr>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="构建TF坐标变换"><a href="#构建TF坐标变换" class="headerlink" title="构建TF坐标变换"></a>构建TF坐标变换</h3><ol>
<li>使用robot_state_publisher</li>
</ol>
<p>在路径：<code>test_ws/src/mycar_start/launch/start_tf.launch</code>文件中做如下修改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 机器人启动文件：</span></span><br><span class="line"><span class="comment">        当不包含机器人模型时，需要发布坐标变换</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动雷达节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find lslidar_driver)/launch/start.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find pointcloud_to_laserscan)/launch/pointcloud_scan.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动小车节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find scout_base)/launch/scout_mini_base.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;include file=&quot;$(find scout_bringup)/launch/scout_teleop_keyboard.launch&quot; /&gt;  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动相机节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;camera2basefootprint&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;tf2_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">args</span>=<span class="string">&quot;0.1 0 0.1 0 0 0 /base_link /camera_link&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;rplidar2basefootprint&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;tf2_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">args</span>=<span class="string">&quot;0 0 0.1 0 0 0 /base_link /laser&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于火焰识别功能包是在另外一个文件里面，所以没有添加相机启动节点，需要自己启动。</p>
<p>值得注意的是这个<strong>camera_link</strong>后期可能需要设置为其他坐标系，方便使用。</p>
<ol start="2">
<li>使用URDF + Robot State Publisher</li>
</ol>
<p>这个跟添加雷达操作类似，不再赘述，直接附上代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;mycar&quot;</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://wiki.ros.org/xacro&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_support_radius&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.01&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_support_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.10&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.02&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_width&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_height&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_support_x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.12&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_support_y&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_support_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;wheel_vertical_offset + base_z_size / 2 + camera_support_length / 2&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_y&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;camera_support_length / 2 + camera_height / 2&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;camera_support&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;camera_support_radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;camera_support_length&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0.8 0.5 0.0 0.5&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;camera_support2base&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;camera_support&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;joint_camera_support_x&#125; $&#123;joint_camera_support_y&#125; $&#123;joint_camera_support_z&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;camera&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;$&#123;camera_length&#125; $&#123;camera_width&#125; $&#123;camera_height&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0 0 0 0.8&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;camera2camera_support&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;camera_support&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;camera&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;joint_camera_x&#125; $&#123;joint_camera_y&#125; $&#123;joint_camera_z&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在文件<code>scout_mini.urdf.xacro</code>中添加相机部件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Additional definitions --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(arg urdf_extras)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;scout_mini_laser.urdf.xacro&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;scout_mini_camera.urdf.xacro&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样就完成了相机的组成。看一下效果：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-15_10-23-24.png" style="zoom:50%;" />


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/23/%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%AF%BC%E8%88%AA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/23/%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%AF%BC%E8%88%AA/" class="post-title-link" itemprop="url">利用move_base使得小车导航至火焰位置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-23 00:00:00 / 修改时间：19:41:37" itemprop="dateCreated datePublished" datetime="2025-07-23T00:00:00+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="利用move-base使得小车导航至火焰位置"><a href="#利用move-base使得小车导航至火焰位置" class="headerlink" title="利用move_base使得小车导航至火焰位置"></a>利用move_base使得小车导航至火焰位置</h1><h2 id="整体思路"><a href="#整体思路" class="headerlink" title="整体思路"></a>整体思路</h2><p>之前已经实现了使用小车，利用2D nav goal工具来设置目标点，只需要将这个目标点替换为火焰位置，这样就能实现火焰的导航。上一次已经实现了火焰相对于相机坐标系到火焰相对于小车坐标系的变换，现在只需要实现火焰坐标系到地图坐标系的转换即可。这便是整体思路</p>
<h2 id="2D-Nav-Goal基本原理"><a href="#2D-Nav-Goal基本原理" class="headerlink" title="2D Nav Goal基本原理"></a>2D Nav Goal基本原理</h2><ul>
<li><p>在rviz中通过”2D Nav Goal”工具设置目标点时，会发布geometry_msgs&#x2F;PoseStamped类型的消息到&#x2F;move_base_simple&#x2F;goal话题</p>
</li>
<li><p>move_base节点订阅该话题，将目标点转换为导航任务，并启动全局&#x2F;局部路径规划</p>
</li>
<li><p>目标点坐标基于用户指定的参考系（通常为map或odom坐标系）</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/2d%20nav%20goal%E5%8E%9F%E7%90%86.png"></p>
</li>
</ul>
<p>有了上述理解之后，可以尝试设置一个目标点，通过脚本来实现小车的移动</p>
<p>新建脚本文件：scripts&#x2F;goal.publisher.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PoseStamped</span><br><span class="line"><span class="keyword">from</span> tf.transformations <span class="keyword">import</span> quaternion_from_euler</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_goal</span>(<span class="params">x, y, yaw</span>):  <span class="comment"># yaw 为朝向偏航角（弧度）</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&#x27;/move_base_simple/goal&#x27;</span>, PoseStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">    rospy.sleep(<span class="number">1</span>)  <span class="comment"># 确保发布器已完全初始化</span></span><br><span class="line"></span><br><span class="line">    goal = PoseStamped()</span><br><span class="line">    goal.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">    goal.header.stamp = rospy.get_rostime()  <span class="comment"># 使用 ROS 时间戳</span></span><br><span class="line">    goal.pose.position.x = x</span><br><span class="line">    goal.pose.position.y = y</span><br><span class="line">    goal.pose.position.z = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将偏航角转换为四元数</span></span><br><span class="line">    q = quaternion_from_euler(<span class="number">0</span>, <span class="number">0</span>, yaw)</span><br><span class="line">    goal.pose.orientation.x = q[<span class="number">0</span>]</span><br><span class="line">    goal.pose.orientation.y = q[<span class="number">1</span>]</span><br><span class="line">    goal.pose.orientation.z = q[<span class="number">2</span>]</span><br><span class="line">    goal.pose.orientation.w = q[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发布目标消息</span></span><br><span class="line">    pub.publish(goal)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Goal published: x=%.2f, y=%.2f, yaw=%.2f&quot;</span>, x, y, yaw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;goal_publisher&#x27;</span>)  <span class="comment"># 初始化 ROS 节点</span></span><br><span class="line">        rospy.sleep(<span class="number">1</span>)  <span class="comment"># 等待一秒，确保节点已启动</span></span><br><span class="line">        send_goal(<span class="number">0.2</span>, <span class="number">0.15</span>, <span class="number">0.785</span>)  <span class="comment"># 示例：目标 (0.1, 0.15)，朝向 45° (0.785 弧度)</span></span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打开导航以及小车底盘控制节点，即可在终端查看消息数据.</p>
<p>具体命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic echo /move_base_simple/goal</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-22_16-52-25.png" alt="Snipaste_2025-07-22_16-52-25"></p>
<hr>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><p>新建一个脚本：scripts&#x2F;fire_navigator.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PointStamped, PoseStamped</span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> do_transform_point</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FireGoalConverter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;fire_goal_converter&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.tf_buffer = tf2_ros.Buffer()</span><br><span class="line">        <span class="variable language_">self</span>.tf_listener = tf2_ros.TransformListener(<span class="variable language_">self</span>.tf_buffer)</span><br><span class="line">        <span class="variable language_">self</span>.pub = rospy.Publisher(<span class="string">&#x27;/move_base_simple/goal&#x27;</span>, PoseStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, <span class="variable language_">self</span>.callback)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            transform = <span class="variable language_">self</span>.tf_buffer.lookup_transform(<span class="string">&quot;map&quot;</span>, msg.header.frame_id, rospy.Time(<span class="number">0</span>))</span><br><span class="line">            map_point = do_transform_point(msg, transform)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            rospy.loginfo(<span class="string">f&quot;坐标转换成功: <span class="subst">&#123;msg.header.frame_id&#125;</span> -&gt; map&quot;</span>)</span><br><span class="line">            rospy.loginfo(<span class="string">f&quot;转换后的坐标: x=<span class="subst">&#123;map_point.point.x&#125;</span>, y=<span class="subst">&#123;map_point.point.y&#125;</span>, z=<span class="subst">&#123;map_point.point.z&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            goal = PoseStamped()</span><br><span class="line">            goal.header = map_point.header</span><br><span class="line">            goal.pose.position.x = map_point.point.x</span><br><span class="line">            goal.pose.position.y = map_point.point.y</span><br><span class="line">            goal.pose.position.z = <span class="number">0.0</span></span><br><span class="line">            goal.pose.orientation.w = <span class="number">1.0</span></span><br><span class="line">            <span class="variable language_">self</span>.pub.publish(goal)</span><br><span class="line">        <span class="keyword">except</span> (tf2_ros.LookupException, tf2_ros.ConnectivityException) <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="string">f&quot;坐标转换失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    FireGoalConverter()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时编辑一下cmakelists以及赋予可执行权限</p>
<p>在打开机器人底盘控制节点，导航节点，火焰识别节点之后，再打开这个节点，即可实现火焰的导航。</p>
<p>为了方便打开多个节点，编写一个火焰识别launch文件：</p>
<p>新建文件：launch&#x2F;fire_detector.launch</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加RealSense相机启动配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find realsense2_camera)/launch/rs_camera.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;align_depth&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 启动火焰识别节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fire_detector.py&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;fire_detector&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动火焰定位节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fire_3D_locator.py&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;fire_3D_locator&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动marker节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fire_marker_publisher.py&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;fire_marker_publisher&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/test_ws</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ./devel/setup.bash</span><br><span class="line">rosrun scout_bringup bringup_can2usb.bash</span><br><span class="line">roslaunch mycar_start start_mycar.launch</span><br><span class="line">roslaunch nav nav.launch</span><br><span class="line"></span><br><span class="line">/fire_reco_ws</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ./devel/setup.bash</span><br><span class="line">roslaunch robot_vision fire_detector.launch</span><br><span class="line">rosrun robot_vision fire_navigator.py</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行完成这些之后，可以在窗口看到一些信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-23_11-16-35.png" alt="Snipaste_2025-07-23_11-16-35"><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-23_11-16-02.png" alt="Snipaste_2025-07-23_11-16-02"></p>
<p>至此，整个系统就完成了简单的实现。虽然存在很多问题，但是整体功能以及框架较为完整。后续可以对SLAM 、路径规划、火焰识别等方面进行优化，会达到更好的效果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/15/Marker%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/Marker%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Marker基本使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Marker基本使用"><a href="#Marker基本使用" class="headerlink" title="Marker基本使用"></a>Marker基本使用</h1><h2 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h2><p>marker display允许在rviz中可视化数据，不需要了解任何有关解释数据的信息，相反，原始对象通过visualization_msgs&#x2F;Marker消息发布到显示器，这些消息允许显示箭头、框、球体和线条等对象。可以作为火焰识别后的显示来使用。</p>
<h2 id="算法介绍"><a href="#算法介绍" class="headerlink" title="算法介绍"></a>算法介绍</h2><ol>
<li><p>新建软件包：<code>catkin_create_pkg using_markers roscpp visualization_msgs</code></p>
</li>
<li><p>新建	src&#x2F;marker_shapes.cpp</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;visualization_msgs/Marker.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">( <span class="type">int</span> argc, <span class="type">char</span>** argv )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;basic_shapes&quot;</span>);</span><br><span class="line">  ros::NodeHandle n;</span><br><span class="line">  <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  ros::Publisher marker_pub = n.<span class="built_in">advertise</span>&lt;visualization_msgs::Marker&gt;(<span class="string">&quot;visualization_marker&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set our initial shape type to be a cube</span></span><br><span class="line">  <span class="type">uint32_t</span> shape = visualization_msgs::Marker::CUBE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    visualization_msgs::Marker marker;</span><br><span class="line">    <span class="comment">// Set the frame ID and timestamp.  See the TF tutorials for information on these.</span></span><br><span class="line">    marker.header.frame_id = <span class="string">&quot;my_frame&quot;</span>;</span><br><span class="line">    marker.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the namespace and id for this marker.  This serves to create a unique ID</span></span><br><span class="line">    <span class="comment">// Any marker sent with the same namespace and id will overwrite the old one</span></span><br><span class="line">    marker.ns = <span class="string">&quot;basic_shapes&quot;</span>;</span><br><span class="line">    marker.id = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the marker type.  Initially this is CUBE, and cycles between that and SPHERE, ARROW, and CYLINDER</span></span><br><span class="line">    marker.type = shape;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the marker action.  Options are ADD, DELETE, and new in ROS Indigo: 3 (DELETEALL)</span></span><br><span class="line">    marker.action = visualization_msgs::Marker::ADD;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the pose of the marker.  This is a full 6DOF pose relative to the frame/time specified in the header</span></span><br><span class="line">    marker.pose.position.x = <span class="number">0</span>;</span><br><span class="line">    marker.pose.position.y = <span class="number">0</span>;</span><br><span class="line">    marker.pose.position.z = <span class="number">0</span>;</span><br><span class="line">    marker.pose.orientation.x = <span class="number">0.0</span>;</span><br><span class="line">    marker.pose.orientation.y = <span class="number">0.0</span>;</span><br><span class="line">    marker.pose.orientation.z = <span class="number">0.0</span>;</span><br><span class="line">    marker.pose.orientation.w = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the scale of the marker -- 1x1x1 here means 1m on a side</span></span><br><span class="line">    marker.scale.x = <span class="number">1.0</span>;</span><br><span class="line">    marker.scale.y = <span class="number">1.0</span>;</span><br><span class="line">    marker.scale.z = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the color -- be sure to set alpha to something non-zero!</span></span><br><span class="line">    marker.color.r = <span class="number">0.0f</span>;</span><br><span class="line">    marker.color.g = <span class="number">1.0f</span>;</span><br><span class="line">    marker.color.b = <span class="number">0.0f</span>;</span><br><span class="line">    marker.color.a = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    marker.lifetime = ros::<span class="built_in">Duration</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Publish the marker</span></span><br><span class="line">    <span class="keyword">while</span> (marker_pub.<span class="built_in">getNumSubscribers</span>() &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (!ros::<span class="built_in">ok</span>())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">ROS_WARN_ONCE</span>(<span class="string">&quot;Please create a subscriber to the marker&quot;</span>);</span><br><span class="line">      <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    marker_pub.<span class="built_in">publish</span>(marker);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cycle between different shapes</span></span><br><span class="line">    <span class="keyword">switch</span> (shape)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::CUBE:</span><br><span class="line">      shape = visualization_msgs::Marker::SPHERE;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::SPHERE:</span><br><span class="line">      shape = visualization_msgs::Marker::ARROW;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::ARROW:</span><br><span class="line">      shape = visualization_msgs::Marker::CYLINDER;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::CYLINDER:</span><br><span class="line">      shape = visualization_msgs::Marker::CUBE;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.<span class="built_in">sleep</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>代码解释</li>
</ol>
<ul>
<li><pre><code class="language-cpp">#include &lt;ros/ros.h&gt;
#include &lt;visualization_msgs/Marker.h&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  包含依赖项，同时包含 visualization_msgs/Marker 消息定义。</span><br><span class="line"></span><br><span class="line">- ```  cpp</span><br><span class="line">  int main( int argc, char** argv )</span><br><span class="line">  &#123;</span><br><span class="line">    ros::init(argc, argv, &quot;basic_shapes&quot;);</span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    ros::Rate r(1);</span><br><span class="line">    ros::Publisher marker_pub = n.advertise&lt;visualization_msgs::Marker&gt;(&quot;visualization_marker&quot;, 1);</span><br></pre></td></tr></table></figure>

初始化ROS,并且在visualization_marker话题上创建一个ros::Publisher.
</code></pre>
</li>
<li><pre><code class="language-cpp">uint32_t shape = visualization_msgs::Marker::CUBE;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  创建一个整数来跟踪发布的形状，将使用四种类型都以相同的方式使用visiualization_msgs/Marker消息，因此可以简单切换形状类型来演示不同的形状。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">    while (ros::ok())</span><br><span class="line">    &#123;</span><br><span class="line">      visualization_msgs::Marker marker;</span><br><span class="line">      // Set the frame ID and timestamp.  See the TF tutorials for information on these.</span><br><span class="line">      marker.header.frame_id = &quot;/my_frame&quot;;</span><br><span class="line">      marker.header.stamp = ros::Time::now();</span><br></pre></td></tr></table></figure>

这是代码核心，首先**创建一个visualization_msgs/Marker消息类型，命名为marker, 设置Marker的header.frame_id**，通过TF来定义，命名为：my_frame,这个标记是相对于my_frame来定位的。最后一行设置了标记消息的时间戳，获取当前ROS时间，将其赋给header.stamp。
</code></pre>
</li>
<li><pre><code class="language-cpp">    marker.ns = &quot;basic_shapes&quot;;
    marker.id = 0;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  命名空间和id用于为此标记创建唯一的名称，如果收到相同的命名空间和id的标记消息，则新的标记会替代旧的标记。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      marker.type = shape;</span><br></pre></td></tr></table></figure>

此 type 字段指定我们要发送的标记类型。visualization_msgs /Marker 消息中列举了可用的类型。这里我们将类型设置为 shape 变量，该变量在每次循环中都会发生变化。
</code></pre>
</li>
<li><pre><code class="language-cpp">marker.action = visualization_msgs::Marker::ADD;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  action 字段指定如何处理标记。选项包括 visualization_msgs::Marker::ADD 和 visualization_msgs::Marker::DELETE 。 ADD 有点用词不当，它的真正含义是“创建或修改”。visualization_msgs::Marker::DELETEALL ,用于删除rviz中所有的标记。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      marker.pose.position.x = 0;</span><br><span class="line">      marker.pose.position.y = 0;</span><br><span class="line">      marker.pose.position.z = 0;</span><br><span class="line">      marker.pose.orientation.x = 0.0;</span><br><span class="line">      marker.pose.orientation.y = 0.0;</span><br><span class="line">      marker.pose.orientation.z = 0.0;</span><br><span class="line">      marker.pose.orientation.w = 1.0;</span><br><span class="line">  </span><br><span class="line">      // Set the scale of the marker -- 1x1x1 here means 1m on a side</span><br><span class="line">      marker.scale.x = 1.0;</span><br><span class="line">      marker.scale.y = 1.0;</span><br><span class="line">      marker.scale.z = 1.0;</span><br><span class="line">  </span><br><span class="line">      // Set the color -- be sure to set alpha to something non-zero!</span><br><span class="line">      marker.color.r = 0.0f;</span><br><span class="line">      marker.color.g = 1.0f;</span><br><span class="line">      marker.color.b = 0.0f;</span><br><span class="line">      marker.color.a = 1.0;</span><br></pre></td></tr></table></figure>

第一个是位置设置，设置为了坐标原点，第二个通过四元数标记方向，表示没有任何偏移，第三个是尺寸设置 ，标记的尺寸将根据这些比例进行缩放，后面一个是颜色设置，通过RGB表示。最后一个是透明度设置，1表示完全不透明。
</code></pre>
</li>
<li><pre><code class="language-cpp">    marker.lifetime = ros::Duration();
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  lifetime字段指定此标记在自动删除之前应保留多长时间，ros::Duration()表示永不删除。在达到lifetime之前收到新的标记消息，那么lifetime会被重置为新的标记的值.</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      while (marker_pub.getNumSubscribers() &lt; 1)</span><br><span class="line">      &#123;</span><br><span class="line">        if (!ros::ok())</span><br><span class="line">        &#123;</span><br><span class="line">          return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        ROS_WARN_ONCE(&quot;Please create a subscriber to the marker&quot;);</span><br><span class="line">        sleep(1);</span><br><span class="line">      &#125;</span><br><span class="line">      marker_pub.publish(marker);</span><br></pre></td></tr></table></figure>

等待标记有一个订阅者，然后发布标记，也可以使用锁存发布者来替代这个代码。通常在rviz中订阅my_frame.
</code></pre>
</li>
<li><pre><code class="language-cpp">    switch (shape)
    &#123;
    case visualization_msgs::Marker::CUBE:
      shape = visualization_msgs::Marker::SPHERE;
      break;
    case visualization_msgs::Marker::SPHERE:
      shape = visualization_msgs::Marker::ARROW;
      break;
    case visualization_msgs::Marker::ARROW:
      shape = visualization_msgs::Marker::CYLINDER;
      break;
    case visualization_msgs::Marker::CYLINDER:
      shape = visualization_msgs::Marker::CUBE;
      break;
    &#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  这段代码让我们在发布一条标记消息的同时显示所有的四个形状，根据当前的形状，设置下一个发布的形状。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      r.sleep();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

睡眠并且循环到顶部。
</code></pre>
</li>
</ul>
<ol start="3">
<li>构建代码</li>
</ol>
<p><code>catkin_make</code></p>
<ol start="5">
<li>运行代码</li>
</ol>
<p><code>rosrun using_markers basic_shapes</code></p>
<ol start="6">
<li>查看标记</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rviz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将Fixed Frames改成：my_frame,然后新增加一个Marker，指定的默认话题是visualization_marker,然后就能在原点处看到一个形状，每秒都会变换。</p>
<p>展示一下结果：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250709162557150.png" alt="image-20250709162557150" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250709162730038.png" alt="image-20250709162730038" style="zoom:67%;" />

<p>marker基础的使用就这么多，后续继续学习。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/15/%E4%BD%BF%E7%94%A8Marker%E5%B0%86%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%9C%A8Rviz%E4%B8%AD%E6%98%BE%E7%A4%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E4%BD%BF%E7%94%A8Marker%E5%B0%86%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%9C%A8Rviz%E4%B8%AD%E6%98%BE%E7%A4%BA/" class="post-title-link" itemprop="url">使用Marker将火焰位置在Rviz中显示</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用Marker将火焰位置在Rviz中显示"><a href="#使用Marker将火焰位置在Rviz中显示" class="headerlink" title="使用Marker将火焰位置在Rviz中显示"></a>使用Marker将火焰位置在Rviz中显示</h1><h2 id="思路介绍"><a href="#思路介绍" class="headerlink" title="思路介绍"></a>思路介绍</h2><p>要使用marker来显示火焰的位置，首先需要在3Dlocator代码中将火焰相对于相机坐标系的坐标发布出去，然后由marker来订阅。</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><ol>
<li>fire_3D_locator</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image, CameraInfo</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Point, PointStamped</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fire3DLocator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.intrinsics = <span class="literal">None</span></span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/aligned_depth_to_color/image_raw&quot;</span>, Image, <span class="variable language_">self</span>.depth_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/color/camera_info&quot;</span>, CameraInfo, <span class="variable language_">self</span>.info_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_center_px&quot;</span>, Point, <span class="variable language_">self</span>.fire_callback)</span><br><span class="line">        <span class="variable language_">self</span>.pub = rospy.Publisher(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">        cv2.namedWindow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.WINDOW_NORMAL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.intrinsics:</span><br><span class="line">            <span class="variable language_">self</span>.intrinsics = &#123;</span><br><span class="line">                <span class="string">&#x27;fx&#x27;</span>: msg.K[<span class="number">0</span>], <span class="string">&#x27;fy&#x27;</span>: msg.K[<span class="number">4</span>],</span><br><span class="line">                <span class="string">&#x27;cx&#x27;</span>: msg.K[<span class="number">2</span>], <span class="string">&#x27;cy&#x27;</span>: msg.K[<span class="number">5</span>]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">depth_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(msg, <span class="string">&quot;passthrough&quot;</span>)</span><br><span class="line">        <span class="comment"># 深度图归一化显示</span></span><br><span class="line">        norm_depth = cv2.normalize(<span class="variable language_">self</span>.depth_image, <span class="literal">None</span>, <span class="number">0</span>, <span class="number">255</span>, cv2.NORM_MINMAX, dtype=cv2.CV_8U)</span><br><span class="line">        cv2.imshow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.applyColorMap(norm_depth, cv2.COLORMAP_JET))</span><br><span class="line">        cv2.waitKey(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fire_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.depth_image <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="variable language_">self</span>.intrinsics <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        u, v = <span class="built_in">int</span>(msg.x), <span class="built_in">int</span>(msg.y)</span><br><span class="line">        depth = <span class="variable language_">self</span>.depth_image[v, u] / <span class="number">1000.0</span>  <span class="comment"># mm转m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="comment"># 计算相机坐标系下的3D坐标</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0.1</span> &lt; depth &lt;<span class="number">10.0</span>:</span><br><span class="line">            point_3d = PointStamped()</span><br><span class="line">            point_3d.header.frame_id = <span class="string">&quot;camera_depth_optical_frame&quot;</span>  <span class="comment"># 使用相机光学坐标系:ml-citation&#123;ref=&quot;3&quot; data=&quot;citationList&quot;&#125;</span></span><br><span class="line">            point_3d.header.stamp = rospy.Time.now()</span><br><span class="line">        </span><br><span class="line">            <span class="comment"># 像素坐标转3D坐标（针孔相机模型）:ml-citation&#123;ref=&quot;1&quot; data=&quot;citationList&quot;&#125;</span></span><br><span class="line">            point_3d.point.x = (u - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cx&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fx&#x27;</span>]</span><br><span class="line">            point_3d.point.y = (v - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cy&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fy&#x27;</span>]</span><br><span class="line">            point_3d.point.z = depth</span><br><span class="line">        </span><br><span class="line">            <span class="variable language_">self</span>.pub.publish(point_3d)  <span class="comment"># 发布3D坐标</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#终端显示火焰位置</span></span><br><span class="line">            rospy.loginfo(<span class="string">&quot;\n火焰位置(相机坐标系):\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;X: <span class="subst">&#123;point_3d.point.x:<span class="number">.3</span>f&#125;</span> m\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;Y: <span class="subst">&#123;point_3d.point.y:<span class="number">.3</span>f&#125;</span> m\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;Z: <span class="subst">&#123;point_3d.point.z:<span class="number">.3</span>f&#125;</span> m\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;像素坐标: (<span class="subst">&#123;u&#125;</span>, <span class="subst">&#123;v&#125;</span>)&quot;</span>)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;fire_3d_locator&#x27;</span>)</span><br><span class="line">    Fire3DLocator()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>fire_marker_publisher</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> visualization_msgs.msg <span class="keyword">import</span> Marker</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PointStamped</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FireMarkerPublisher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;fire_marker_publisher&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.marker_pub = rospy.Publisher(<span class="string">&#x27;/fire_marker&#x27;</span>, Marker, queue_size=<span class="number">10</span>)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, <span class="variable language_">self</span>.callback)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 动态更新参数</span></span><br><span class="line">        <span class="variable language_">self</span>.last_position = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker = Marker()</span><br><span class="line">        <span class="variable language_">self</span>.update_threshold = <span class="number">0.3</span>  <span class="comment"># 位置变化阈值(米)</span></span><br><span class="line">        <span class="variable language_">self</span>.stable_timeout = rospy.Duration(<span class="number">2.0</span>)  <span class="comment"># 稳定持续时间</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化默认Marker</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.ns = <span class="string">&quot;fire_detection&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.<span class="built_in">id</span> = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.<span class="built_in">type</span> = Marker.SPHERE</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.action = Marker.ADD</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.scale.x = <span class="variable language_">self</span>.current_marker.scale.y = <span class="variable language_">self</span>.current_marker.scale.z = <span class="number">0.1</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.color.r = <span class="number">1.0</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.color.a = <span class="number">0.8</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.lifetime = rospy.Duration(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        current_pos = np.array([msg.point.x, msg.point.y, msg.point.z])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 首次检测或超过稳定时间</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.last_position <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> \</span><br><span class="line">           (rospy.Time.now() - <span class="variable language_">self</span>.current_marker.header.stamp) &gt; <span class="variable language_">self</span>.stable_timeout:</span><br><span class="line">            <span class="variable language_">self</span>._update_marker(msg, current_pos)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 计算位置变化量</span></span><br><span class="line">        displacement = np.linalg.norm(current_pos - <span class="variable language_">self</span>.last_position)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 超过阈值则更新</span></span><br><span class="line">        <span class="keyword">if</span> displacement &gt; <span class="variable language_">self</span>.update_threshold:</span><br><span class="line">            <span class="variable language_">self</span>._update_marker(msg, current_pos)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_update_marker</span>(<span class="params">self, msg, new_pos</span>):</span><br><span class="line">        <span class="variable language_">self</span>.last_position = new_pos</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.header = msg.header</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.pose.position = msg.point</span><br><span class="line">        <span class="comment">#self.current_marker.header.stamp = rospy.Time.now()  # 重置时间戳</span></span><br><span class="line">        <span class="variable language_">self</span>.marker_pub.publish(<span class="variable language_">self</span>.current_marker)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    FireMarkerPublisher()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为了保证marker数据显示的稳定性，添加了一个稳定时间以及位置变化阈值，这样可以稳定输出火焰位置。</p>
<h2 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h2><ol>
<li><pre><code class="language-bash"># 依次打开以下节点
roslaunch realsense2_camera rs_camera.launch align_depth:=true
rosrun robot_vision fire_detector.py 
rosrun robot_vision fire_3D_locator.py 
rosrun robot_vision fire_marker_publisher.py 
</code></pre>
<p>执行完以下程序之后，可以看到结果：</p>
</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/11212.png" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-14_15-10-29.png" style="zoom:50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-14_15-11-11.png"></p>
<p>这样既可以在rviz中显示火焰的位置，也可以在终端显示火焰相对于相机的具体位置。后续作用于小车上也很方便进行。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/04/%E5%88%A9%E7%94%A8RealsenseD435%E5%AE%9E%E7%8E%B0%E7%81%AB%E7%84%B0%E8%AF%86%E5%88%AB%E5%8F%8A%E5%AE%9A%E4%BD%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/04/%E5%88%A9%E7%94%A8RealsenseD435%E5%AE%9E%E7%8E%B0%E7%81%AB%E7%84%B0%E8%AF%86%E5%88%AB%E5%8F%8A%E5%AE%9A%E4%BD%8D/" class="post-title-link" itemprop="url">利用RealsenseD435实现火焰识别及定位</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-04 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-04T00:00:00+08:00">2025-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="利用RealsenseD435实现火焰识别及定位"><a href="#利用RealsenseD435实现火焰识别及定位" class="headerlink" title="利用RealsenseD435实现火焰识别及定位"></a>利用RealsenseD435实现火焰识别及定位</h1><h2 id="算法思路"><a href="#算法思路" class="headerlink" title="算法思路"></a>算法思路</h2><p>首先需要将Realsense D435相机的深度图像与RGB图像对齐，大致意思就是使得深度图像显示的画面与RGB图像显示的画面匹配，方便后面确定火焰的位置。由于此相机内直接节点实现了相机标定的功能，所以只需要订阅相关节点即可实现两个图像的对齐。这里不再赘述，上一片有些许介绍，同时可以参考官网资料查看。如果只是应用的话，大可不必了解那么深入。完成对齐之后，利用之前简单的火焰识别算法，获取火焰在RGB图像中的像素位置，然后在深度图像中，转换成具体的3D位置，就大功告成了。其实整个框架很简单，但是算法的精度仍然需要花时间打磨，这里只是做一个简单的实现。</p>
<hr>
<h2 id="火焰识别算法改进"><a href="#火焰识别算法改进" class="headerlink" title="火焰识别算法改进"></a>火焰识别算法改进</h2><p>之前的文章中已经有了一个基础的火焰识别算法，但是只是标记了火焰的位置，并没有标记出坐标，同时需要发布坐标消息给定位算法订阅。所以做了些许改进。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Point</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FireDetector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="comment"># 动态HSV阈值（初始值）</span></span><br><span class="line">        <span class="variable language_">self</span>.fire_pub = rospy.Publisher(<span class="string">&quot;/fire_center_px&quot;</span>, Point, queue_size=<span class="number">10</span>)</span><br><span class="line">        <span class="variable language_">self</span>.lower_fire = np.array([<span class="number">0</span>, <span class="number">150</span>, <span class="number">100</span>])  </span><br><span class="line">        <span class="variable language_">self</span>.upper_fire = np.array([<span class="number">30</span>, <span class="number">255</span>, <span class="number">255</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 运动检测相关</span></span><br><span class="line">        <span class="variable language_">self</span>.prev_gray = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.fgbg = cv2.createBackgroundSubtractorMOG2(history=<span class="number">500</span>, varThreshold=<span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 订阅图像</span></span><br><span class="line">        <span class="variable language_">self</span>.image_sub = rospy.Subscriber(<span class="string">&quot;/camera/color/image_raw&quot;</span>, </span><br><span class="line">                                        Image, <span class="variable language_">self</span>.image_callback)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dynamic_threshold</span>(<span class="params">self, hsv_img</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;动态调整饱和度阈值&quot;&quot;&quot;</span></span><br><span class="line">        avg_sat = np.mean(hsv_img[:,:,<span class="number">1</span>])</span><br><span class="line">        <span class="variable language_">self</span>.lower_fire[<span class="number">1</span>] = <span class="built_in">max</span>(<span class="number">100</span>, <span class="built_in">int</span>(avg_sat * <span class="number">0.65</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">motion_analysis</span>(<span class="params">self, frame</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运动特征分析&quot;&quot;&quot;</span></span><br><span class="line">        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line">        fgmask = <span class="variable language_">self</span>.fgbg.apply(gray)</span><br><span class="line">        <span class="keyword">return</span> cv2.medianBlur(fgmask, <span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cv_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(msg, <span class="string">&quot;bgr8&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 预处理</span></span><br><span class="line">            blurred = cv2.GaussianBlur(cv_image, (<span class="number">7</span>,<span class="number">7</span>), <span class="number">0</span>)</span><br><span class="line">            hsv = cv2.cvtColor(blurred, cv2.COLOR_BGR2HSV)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 动态阈值调整</span></span><br><span class="line">            <span class="variable language_">self</span>.dynamic_threshold(hsv)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 颜色检测</span></span><br><span class="line">            color_mask = cv2.inRange(hsv, <span class="variable language_">self</span>.lower_fire, <span class="variable language_">self</span>.upper_fire)</span><br><span class="line">            color_mask = cv2.morphologyEx(color_mask, cv2.MORPH_CLOSE, </span><br><span class="line">                                        np.ones((<span class="number">7</span>,<span class="number">7</span>), np.uint8))</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 运动检测</span></span><br><span class="line">            motion_mask = <span class="variable language_">self</span>.motion_analysis(cv_image)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 多特征融合</span></span><br><span class="line">            combined_mask = cv2.bitwise_and(color_mask, motion_mask)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 精确轮廓检测</span></span><br><span class="line">            contours, _ = cv2.findContours(combined_mask, cv2.RETR_EXTERNAL,</span><br><span class="line">                                         cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> cnt <span class="keyword">in</span> contours:</span><br><span class="line">                area = cv2.contourArea(cnt)</span><br><span class="line">                <span class="keyword">if</span> area &gt; <span class="number">800</span>:  <span class="comment"># 增大面积阈值减少误检</span></span><br><span class="line">                    x,y,w,h = cv2.boundingRect(cnt)</span><br><span class="line">                    <span class="comment">#计算火焰中心点</span></span><br><span class="line">                    center = Point()</span><br><span class="line">                    center.x = x + w//<span class="number">2</span></span><br><span class="line">                    center.y = y + h//<span class="number">2</span></span><br><span class="line">                    <span class="variable language_">self</span>.fire_pub.publish(center)</span><br><span class="line"></span><br><span class="line">                    aspect_ratio = <span class="built_in">float</span>(w)/h</span><br><span class="line">                    <span class="keyword">if</span> <span class="number">0.5</span> &lt; aspect_ratio &lt; <span class="number">2.0</span>:  <span class="comment"># 火焰通常不是极端长条形</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">#可视化标记点</span></span><br><span class="line">                        cv2.rectangle(cv_image, (x,y), (x+w,y+h), (<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>), <span class="number">2</span>)     <span class="comment">#红色框标记火焰</span></span><br><span class="line">                        cv2.circle(cv_image, (center.x, center.y), <span class="number">5</span>, (<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>), -<span class="number">1</span>)   <span class="comment">#蓝色小点表示火焰中心位置</span></span><br><span class="line">                        cv2.putText(cv_image, <span class="string">f&#x27;Fire <span class="subst">&#123;area:<span class="number">.0</span>f&#125;</span>&#x27;</span>, (x,y-<span class="number">10</span>),         </span><br><span class="line">                                   cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.7</span>, (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>), <span class="number">2</span>)     <span class="comment">#绿色表示像素面积</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 显示调试视图</span></span><br><span class="line">            debug_view = np.hstack([</span><br><span class="line">                cv_image,</span><br><span class="line">                cv2.cvtColor(combined_mask, cv2.COLOR_GRAY2BGR)</span><br><span class="line">            ])</span><br><span class="line">            cv2.imshow(<span class="string">&quot;Fire Detection&quot;</span>, debug_view)</span><br><span class="line">            cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;fire_detector&#x27;</span>)</span><br><span class="line">    detector = FireDetector()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>算法源码可以清楚看到，计算出火焰中心点后，会通过**&#x2F;fire_center_px<strong>话题发布为</strong>geometry_msgs&#x2F;Point**消息。</p>
<hr>
<h2 id="火焰3D定位"><a href="#火焰3D定位" class="headerlink" title="火焰3D定位"></a>火焰3D定位</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image, CameraInfo</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Point, PointStamped</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fire3DLocator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.intrinsics = <span class="literal">None</span></span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/aligned_depth_to_color/image_raw&quot;</span>, Image, <span class="variable language_">self</span>.depth_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/color/camera_info&quot;</span>, CameraInfo, <span class="variable language_">self</span>.info_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_center_px&quot;</span>, Point, <span class="variable language_">self</span>.fire_callback)</span><br><span class="line">        <span class="variable language_">self</span>.pub = rospy.Publisher(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">        cv2.namedWindow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.WINDOW_NORMAL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.intrinsics:</span><br><span class="line">            <span class="variable language_">self</span>.intrinsics = &#123;</span><br><span class="line">                <span class="string">&#x27;fx&#x27;</span>: msg.K[<span class="number">0</span>], <span class="string">&#x27;fy&#x27;</span>: msg.K[<span class="number">4</span>],</span><br><span class="line">                <span class="string">&#x27;cx&#x27;</span>: msg.K[<span class="number">2</span>], <span class="string">&#x27;cy&#x27;</span>: msg.K[<span class="number">5</span>]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">depth_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(msg, <span class="string">&quot;passthrough&quot;</span>)</span><br><span class="line">        <span class="comment"># 深度图归一化显示</span></span><br><span class="line">        norm_depth = cv2.normalize(<span class="variable language_">self</span>.depth_image, <span class="literal">None</span>, <span class="number">0</span>, <span class="number">255</span>, cv2.NORM_MINMAX, dtype=cv2.CV_8U)</span><br><span class="line">        cv2.imshow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.applyColorMap(norm_depth, cv2.COLORMAP_JET))</span><br><span class="line">        cv2.waitKey(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fire_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.depth_image <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="variable language_">self</span>.intrinsics <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        u, v = <span class="built_in">int</span>(msg.x), <span class="built_in">int</span>(msg.y)</span><br><span class="line">        depth = <span class="variable language_">self</span>.depth_image[v, u] / <span class="number">1000.0</span>  <span class="comment"># mm转m</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="number">0.1</span> &lt; depth &lt; <span class="number">10.0</span>:  <span class="comment"># 有效距离范围</span></span><br><span class="line">            point = PointStamped()</span><br><span class="line">            point.header.stamp = rospy.Time.now()</span><br><span class="line">            point.header.frame_id = <span class="string">&quot;camera_color_optical_frame&quot;</span></span><br><span class="line">            point.point.x = (u - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cx&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fx&#x27;</span>]</span><br><span class="line">            point.point.y = (v - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cy&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fy&#x27;</span>]</span><br><span class="line">            point.point.z = depth</span><br><span class="line">            <span class="variable language_">self</span>.pub.publish(point)</span><br><span class="line">            rospy.loginfo(<span class="string">f&quot;Fire 3D Position: X=<span class="subst">&#123;point.point.x:<span class="number">.2</span>f&#125;</span>m Y=<span class="subst">&#123;point.point.y:<span class="number">.2</span>f&#125;</span>m Z=<span class="subst">&#123;point.point.z:<span class="number">.2</span>f&#125;</span>m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;fire_3d_locator&#x27;</span>)</span><br><span class="line">    Fire3DLocator()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>大致步骤如下：</p>
<ol>
<li>创建fire_3d_locator节点，实现三订阅一发布的通信模式</li>
<li>深度图订阅(&#x2F;camera&#x2F;aligned_depth_to_color&#x2F;image_raw)</li>
<li>相机内参订阅(&#x2F;camera&#x2F;color&#x2F;camera_info)</li>
<li>火焰像素坐标订阅(&#x2F;fire_center_px)</li>
<li>3D坐标发布(&#x2F;fire_position_3d)</li>
</ol>
<hr>
<h3 id="数据流处理链"><a href="#数据流处理链" class="headerlink" title="数据流处理链"></a>数据流处理链</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[深度图] --&gt; B[深度回调]</span><br><span class="line">    C[相机内参] --&gt; D[内参回调]</span><br><span class="line">    E[像素坐标] --&gt; F[3D坐标计算]</span><br><span class="line">    B --&gt; F</span><br><span class="line">    D --&gt; F</span><br><span class="line">    F --&gt; G[3D坐标发布]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="核心算法实现"><a href="#核心算法实现" class="headerlink" title="核心算法实现"></a>核心算法实现</h3><ol>
<li>相机坐标系转换</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = (u - cx) * Z / fx</span><br><span class="line">Y = (v - cy) * Z / fy </span><br></pre></td></tr></table></figure>

<p>其中(u,v)为像素坐标，(cx,cy)为主点坐标，(fx,fy)为焦距</p>
<ol start="2">
<li>深度数据处理</li>
</ol>
<ul>
<li>深度值单位转换：mm → m（除以1000）</li>
<li>有效距离过滤：0.1m &lt; Z &lt; 10m</li>
<li>深度图可视化：使用JET色图显示归一化深度</li>
</ul>
<ol start="3">
<li>坐标发布规范</li>
</ol>
<ul>
<li>采用PointStamped消息类型包含：</li>
<li>时间戳(header.stamp)</li>
<li>坐标系ID(camera_color_optical_frame)</li>
<li>三维坐标值</li>
</ul>
<ol start="4">
<li>彩色映射深度图像来增强深度感知</li>
</ol>
<hr>
<p>这样，火焰识别与定位算法就大致实现了，虽然算法比较基础，但是能够对ROS话题发布、坐标系发布、消息之间的接受与发送有一个清楚的认识，为后续机器人学习打下基础。</p>
<p>现在来展示一下效果如何。</p>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><ol>
<li>打开相机节点</li>
</ol>
<p>这次打开的相机节点有所不同，参考上一篇文章：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch align_depth:=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>运行火焰识别脚本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun robot_vision fire_detector.py</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-04_16-06-22.png" style="zoom:50%;" />

<ol start="3">
<li>运行火焰定位脚本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun robot_vision fire_3D_locator.py</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-04_16-06-34.png"></p>
<p>合理首先会显示一个深度图像，会有更直观的感受。</p>
<p>然后在终端可以查看具体的3D信息</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-04_16-06-58.png"></p>
<p>值得注意的是：</p>
<p><strong>X表示距离相机左右的距离（米），向右为正，Y表示距离相机的垂直方向，向上为正，Z表示距离相机的深度，向前为正。</strong></p>
<p>也就是说，图中最后一行表示：火焰位置在相机的右方0.06m,上方0m，前方0.27m.</p>
<p>这样，基本的火焰识别与定位就实现了。后续可以将火焰的相对坐标进行转换，可以接入消防小车的自主导航系统中了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/04/%E4%BD%BF%E7%94%A8Realsense%20D435%E5%B0%86RGB%E5%9B%BE%E5%83%8F%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%83%8F%E5%AF%B9%E9%BD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/04/%E4%BD%BF%E7%94%A8Realsense%20D435%E5%B0%86RGB%E5%9B%BE%E5%83%8F%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%83%8F%E5%AF%B9%E9%BD%90/" class="post-title-link" itemprop="url">使用Realsense D435将RGB图像与深度图像对齐</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-04 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-04T00:00:00+08:00">2025-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用Realsense-D435将RGB图像与深度图像对齐"><a href="#使用Realsense-D435将RGB图像与深度图像对齐" class="headerlink" title="使用Realsense D435将RGB图像与深度图像对齐"></a>使用Realsense D435将RGB图像与深度图像对齐</h1><h2 id="深度图像简介"><a href="#深度图像简介" class="headerlink" title="深度图像简介"></a>深度图像简介</h2><p>RealSense D435 配备了两个摄像头（左、右）和红外传感器，采用 <strong>双目立体视觉</strong> 技术。该技术模拟人眼通过两个视角获取的图像差异来计算景物的深度信息。</p>
<p>深度图像是一种特殊的图像类型，用来表示场景中每个像素到相机的距离，没有颜色信息，通过灰度值或者伪彩色来表示不同深度。</p>
<p>深度图像可以通过多种技术生成，常见的生成方法包括：</p>
<ol>
<li>立体视觉：使用两台相机从不同角度拍摄同一场景，计算图像中的视差来获取深度。</li>
<li>飞行时间（ToF）传感器：通过发射光脉冲并测量其反射回传感器的时间来计算物体距离。</li>
<li>结构光技术：通过投射已知图案到物体表面，并分析图案的变形来计算深度。</li>
<li>激光雷达（LiDAR）：通过激光扫描场景并测量光束反射的时间来获得深度信息。</li>
</ol>
<p>这款RealsenseD435采用双目立体视觉与红外结构光相结合的方式生成深度图像，可以有效捕捉高精度的深度信息。</p>
<hr>
<h2 id="深度图像显示"><a href="#深度图像显示" class="headerlink" title="深度图像显示"></a>深度图像显示</h2><ol>
<li>启动相机节点</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch align_depth:=<span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>打开rviz</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rviz</span><br></pre></td></tr></table></figure>

<p>选择Image插件，选择**&#x2F;camera&#x2F;aligned_depth_to_color&#x2F;image_raw<strong>话题，即可查看对齐的深度图像，再选择</strong>&#x2F;camera&#x2F;color&#x2F;image_raw**，即可查看RGB图像。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/1.png" alt="image-20250703160602119" style="zoom:50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250703160954999.png" alt="image-20250703160954999"></p>
<p>这样简单的一个深度图像对齐后显示就完成了。后续进行火源识别与定位会起到作用。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/01/CMake%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/01/CMake%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">CMake安装与使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-01T00:00:00+08:00">2025-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">工具学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CMake安装与使用"><a href="#CMake安装与使用" class="headerlink" title="CMake安装与使用"></a>CMake安装与使用</h1><p>CMake 是个一个开源的跨平台自动化建构系统，用来管理软件建置的程序，并不依赖于某特定编译器，并可支持多层目录、多个应用程序与多个函数库。</p>
<p>CMake 通过使用简单的配置文件 CMakeLists.txt，自动生成不同平台的构建文件（如 Makefile、Ninja 构建文件、Visual Studio 工程文件等），简化了项目的编译和构建过程。</p>
<p>CMake 本身不是构建工具，而是生成构建系统的工具，它生成的构建系统可以使用不同的编译器和工具链。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Cmake.svg" alt="img"></p>
<ul>
<li>CMakeLists.txt 文件： CMake 的配置文件，用于定义项目的构建规则、依赖关系、编译选项等。每个 CMake 项目通常包含一个或多个 CMakeLists.txt 文件。</li>
<li>构建目录： 为了保持源代码的整洁，CMake 鼓励使用独立的构建目录（Out-of-source 构建）。这样，构建生成的文件与源代码分开存放。</li>
</ul>
<hr>
<p><strong>基本流程</strong></p>
<ol>
<li>编写 CMakeLists.txt 文件： 定义项目的构建规则和依赖关系。</li>
<li>生成构建文件： 使用 CMake 生成适合当前平台的构建系统文件（例如 Makefile、Visual Studio 工程文件）。</li>
<li>执行构建： 使用生成的构建系统文件（如 make、ninja、msbuild）来编译项目。</li>
</ol>
<h2 id="安装cmake"><a href="#安装cmake" class="headerlink" title="安装cmake"></a>安装cmake</h2><p>Linux:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update  <span class="comment">#更新APT列表</span></span><br><span class="line"><span class="built_in">sudo</span> apt install cmake  <span class="comment">#下载</span></span><br><span class="line">cmake --version  <span class="comment">#查看版本</span></span><br></pre></td></tr></table></figure>

<p>如果你通过APT或Snap安装CMake，一般不需要额外的配置。安装完成后，CMake应该能够正常工作并且系统会自动将它添加到环境变量中。不过，如果你是通过源代码编译安装CMake，可能需要一些额外的配置来确保它在系统中正确工作。这里直接使用APT安装，不需要配置环境。</p>
<hr>
<h2 id="CMake基础"><a href="#CMake基础" class="headerlink" title="CMake基础"></a>CMake基础</h2><h3 id="CMakeLists-txt-文件"><a href="#CMakeLists-txt-文件" class="headerlink" title="CMakeLists.txt 文件"></a>CMakeLists.txt 文件</h3><p>这个文件是CMake的配置文件，用于定义项目的构建规则、依赖关系、编译选项等。</p>
<p>每个项目都需要一个或者多个CMakeLists.txt文件</p>
<h4 id="文件结构及基本语法"><a href="#文件结构及基本语法" class="headerlink" title="文件结构及基本语法"></a>文件结构及基本语法</h4><p><strong>常见指令</strong></p>
<ol>
<li>指定CMake的最低版本要求</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION &lt;version&gt;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>定义项目的名称和使用的编程语言</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">project</span>(MyProject CXX)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>指定要生成的可执行文件和其源文件</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(&lt;<span class="keyword">target</span>&gt; &lt;source_files&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(scout_base_node src/scout_base_node.cpp)</span><br></pre></td></tr></table></figure>

<p>其作用是告诉CMake生成一个名为<strong>scout_base_node</strong>的可执行文件，这个文件是由src&#x2F;scout_base_node.cpp这个源文件编译而来的。</p>
<ol start="4">
<li>创建一个库（静态库或者动态库）及其元文件</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(&lt;<span class="keyword">target</span>&gt; &lt;source_files&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(scout_messenger STATIC src/scout_messenger.cpp)</span><br></pre></td></tr></table></figure>

<p>这个就是用于生成一个库文件为：scout_messenger，构建完成之后，CMake会生成一个名为 libscout_messenger.a 的静态库文件（在Linux系统中）</p>
<p>STATIC：这个关键字表示你要生成的是一个静态库。静态库是一个包含已编译代码的文件，在链接时会将整个库的内容直接复制到最终的可执行文件或其他库中。与动态库（shared 或 dll）不同，静态库在运行时不需要依赖库文件。</p>
<p>src&#x2F;scout_messenger.cpp：这是生成静态库所需的源文件。在这个例子中，scout_messenger.cpp 这个源文件会被编译并打包成 scout_messenger 静态库。</p>
<ol start="5">
<li>链接目标文件与其他库</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(&lt;<span class="keyword">target</span>&gt; &lt;libraries&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(scout_messenger <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>在 CMake 中用来将 scout_messenger 目标与 ROS 所需的库（即 catkin_LIBRARIES）进行链接的命令。通过它，scout_messenger 可以访问这些 ROS 库中的功能，确保程序能够正常运行在 ROS 环境下。</p>
<ol start="6">
<li>添加头文件搜索路径</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(&lt;dirs&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(</span><br><span class="line">    <span class="keyword">include</span></span><br><span class="line">    <span class="variable">$&#123;catkin_INCLUDE_DIRS&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>include：这是一个相对路径，指向当前项目的 include 文件夹，通常用来存放项目的头文件。通过将 include 添加到 include_directories 中，编译器会在编译过程中查找该目录中的头文件。</p>
</li>
<li><p>${catkin_INCLUDE_DIRS}：这是一个 CMake 变量，通常是在使用 ROS 构建系统时定义的。catkin_INCLUDE_DIRS 包含了与 ROS 环境相关的所有头文件路径。这个变量会自动由 catkin 设置，包含了 ROS 包和依赖项的头文件路径。例如，如果你的项目依赖于 roscpp 或其他 ROS 包，catkin_INCLUDE_DIRS 就会包含这些包的头文件路径。</p>
</li>
</ul>
<ol start="7">
<li>设置变量的值</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(&lt;variable&gt; &lt;value&gt;...)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>设置目标属性</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(<span class="keyword">TARGET</span> target_name</span><br><span class="line">                          [BEFORE | AFTER]</span><br><span class="line">                          [SYSTEM] [PUBLIC | PRIVATE | INTERFACE]</span><br><span class="line">                          [items1...])</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(MyExecutable PRIVATE <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>安装规则</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS target1 [target2 ...]</span><br><span class="line">        [RUNTIME DESTINATION dir]</span><br><span class="line">        [LIBRARY DESTINATION dir]</span><br><span class="line">        [ARCHIVE DESTINATION dir]</span><br><span class="line">        [INCLUDES DESTINATION [dir ...]]</span><br><span class="line">        [PRIVATE_HEADER DESTINATION dir]</span><br><span class="line">        [PUBLIC_HEADER DESTINATION dir])</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS scout_messenger scout_base_node</span><br><span class="line">  RUNTIME DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span></span><br><span class="line">  LIBRARY DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_LIB_DESTINATION&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_LIB_DESTINATION&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>这些 install 命令的作用是将构建后的文件（如可执行文件、库文件、头文件、launch 文件等）安装到适当的目录中，以便能够在安装后正确运行和使用。</p>
<ol start="10">
<li>条件语句</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(expression)</span><br><span class="line">  <span class="comment"># Commands</span></span><br><span class="line"><span class="keyword">elseif</span>(expression)</span><br><span class="line">  <span class="comment"># Commands</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="comment"># Commands</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> <span class="string">&quot;Debug&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(<span class="string">&quot;Debug build&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>自定义命令（add_custom_command 命令）</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">   <span class="keyword">TARGET</span> <span class="keyword">target</span></span><br><span class="line">   PRE_BUILD | PRE_LINK | POST_BUILD</span><br><span class="line">   <span class="keyword">COMMAND</span> command1 [ARGS] [WORKING_DIRECTORY dir]</span><br><span class="line">   [<span class="keyword">COMMAND</span> command2 [ARGS]]</span><br><span class="line">   [DEPENDS [depend1 [depend2 ...]]]</span><br><span class="line">   [COMMENT comment]</span><br><span class="line">   [VERBATIM]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">   <span class="keyword">TARGET</span> MyExecutable POST_BUILD</span><br><span class="line">   <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E echo <span class="string">&quot;Build completed.&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这段代码的作用是，在构建 MyExecutable 完成后，执行一个自定义的命令，打印出 “Build completed.” 到控制台。</p>
<hr>
<h3 id="变量和缓存"><a href="#变量和缓存" class="headerlink" title="变量和缓存"></a>变量和缓存</h3><p>CMake 使用变量来存储和传递信息，这些变量可以在 CMakeLists.txt 文件中定义和使用。</p>
<p>变量可以分为普通变量和缓存变量。</p>
<h4 id="变量定义和缓存"><a href="#变量定义和缓存" class="headerlink" title="变量定义和缓存"></a>变量定义和缓存</h4><p><strong>定义变量</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_VAR <span class="string">&quot;Hello World&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>使用变量</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Variable MY_VAR is $&#123;MY_VAR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>运行 CMake 配置或生成过程时，CMake 会输出：</p>
<p>– Variable MY_VAR is Hello World</p>
<h4 id="缓存变量"><a href="#缓存变量" class="headerlink" title="缓存变量"></a>缓存变量</h4><p>缓存变量存储在 CMake 的缓存文件中，用户可以在 CMake 配置时修改这些值。缓存变量通常用于用户输入的设置，例如编译选项和路径。</p>
<p><strong>定义缓存变量：</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_CACHE_VAR <span class="string">&quot;DefaultValue&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;A cache variable&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>使用缓存变量：</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Cache variable MY_CACHE_VAR is $&#123;MY_CACHE_VAR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="查找库和包"><a href="#查找库和包" class="headerlink" title="查找库和包"></a>查找库和包</h3><p>CMake 可以通过 find_package() 指令自动检测和配置外部库和包。</p>
<p>常用于查找系统安装的库或第三方库。</p>
<h4 id="find-package-指令"><a href="#find-package-指令" class="headerlink" title="find_package()指令"></a>find_package()指令</h4><p>基本用法：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED)</span><br></pre></td></tr></table></figure>

<p>指定版本：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Boost <span class="number">1.70</span> REQUIRED)</span><br></pre></td></tr></table></figure>

<p>查找库并指定路径：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED PATHS /path/to/opencv)</span><br></pre></td></tr></table></figure>

<p>使用查找到的库：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(MyExecutable Boost::Boost)</span><br></pre></td></tr></table></figure>

<p>设置包含目录和链接目录：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;Boost_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;Boost_LIBRARY_DIRS&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>实例</strong>：</p>
<p>假设想在项目上使用Boost库，CMakeLists.txt文件应该如下:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProject CXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找 Boost 库</span></span><br><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(MyExecutable main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接 Boost 库</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(MyExecutable Boost::Boost)</span><br></pre></td></tr></table></figure>

<h2 id="CMake-构建流程"><a href="#CMake-构建流程" class="headerlink" title="CMake 构建流程"></a>CMake 构建流程</h2><p>主要分为以下几步：</p>
<ol>
<li>创建构建目录：保持源代码目录整洁。</li>
<li>使用 CMake 生成构建文件：配置项目并生成适合平台的构建文件。</li>
<li>编译和构建：使用生成的构建文件执行编译和构建。</li>
<li>清理构建文件：删除中间文件和目标文件。</li>
<li>重新配置和构建：处理项目设置的更改。</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/cmake-simple-flowchart.png" alt="img"></p>
<h3 id="创建构建目录"><a href="#创建构建目录" class="headerlink" title="创建构建目录"></a>创建构建目录</h3><p>CMakes使用”Out-of-source” 构建方式，即将构建文件放在源代码目录之外的独立目录中。</p>
<p>这样可以保持源代码目录的整洁，并方便管理不同的构建配置。</p>
<h4 id="创建构建目录："><a href="#创建构建目录：" class="headerlink" title="创建构建目录："></a>创建构建目录：</h4><p>在项目的根目录下，创建一个新的构建目录。例如，可以创建一个名为 <strong>build</strong> 的目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build</span><br></pre></td></tr></table></figure>

<h4 id="进入构建目录："><a href="#进入构建目录：" class="headerlink" title="进入构建目录："></a>进入构建目录：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> build</span><br></pre></td></tr></table></figure>

<h3 id="使用CMake-生成构建文件"><a href="#使用CMake-生成构建文件" class="headerlink" title="使用CMake 生成构建文件"></a>使用CMake 生成构建文件</h3><p>在构建目录中运行 CMake，以生成适合当前平台的构建系统文件（例如 Makefile、Ninja 构建文件、Visual Studio 工程文件等）。</p>
<h4 id="运行-CMake-配置："><a href="#运行-CMake-配置：" class="headerlink" title="运行 CMake 配置："></a>运行 CMake 配置：</h4><p>在构建目录中运行 CMake 命令，指定源代码目录。源代码目录是包含 CMakeLists.txt 文件的目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br></pre></td></tr></table></figure>

<p>如果需要指定生成器（如 Ninja、Visual Studio），可以使用 -G 选项。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -G <span class="string">&quot;Ninja&quot;</span> ..</span><br></pre></td></tr></table></figure>

<p>如果需要指定构建类型（如 Debug 或 Release），可以使用 -DCMAKE_BUILD_TYPE 选项。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</span><br></pre></td></tr></table></figure>

<h4 id="检查配置结果："><a href="#检查配置结果：" class="headerlink" title="检查配置结果："></a>检查配置结果：</h4><p>CMake 会输出配置过程中的详细信息，包括找到的库、定义的选项等，如果没有错误，构建系统文件将被生成到构建目录中。</p>
<h3 id="编译和构建"><a href="#编译和构建" class="headerlink" title="编译和构建"></a>编译和构建</h3><p>使用生成的构建文件进行编译和构建。</p>
<p>不同的构建系统使用不同的命令。</p>
<h4 id="使用Makefile"><a href="#使用Makefile" class="headerlink" title="使用Makefile"></a>使用Makefile</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nake</span><br></pre></td></tr></table></figure>

<p>如果要构建特定目标，指定目标名，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make MyExecutable</span><br></pre></td></tr></table></figure>

<h3 id="清理构建文件"><a href="#清理构建文件" class="headerlink" title="清理构建文件"></a>清理构建文件</h3><p>构建过程中生成的中间文件和目标文件可以通过清理操作删除。</p>
<h4 id="使用Makefile-1"><a href="#使用Makefile-1" class="headerlink" title="使用Makefile:"></a>使用Makefile:</h4><p>运行 make clean 命令（如果定义了清理规则）来删除生成的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>

<h3 id="重新配置和构建"><a href="#重新配置和构建" class="headerlink" title="重新配置和构建"></a>重新配置和构建</h3><p>如果修改了 CMakeLists.txt 文件或项目设置，可能需要重新配置和构建项目。</p>
<h4 id="重新运行CMake配置："><a href="#重新运行CMake配置：" class="headerlink" title="重新运行CMake配置："></a>重新运行CMake配置：</h4><p>在构建目录中重新运行 CMake 配置命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br></pre></td></tr></table></figure>

<h4 id="重新编译："><a href="#重新编译：" class="headerlink" title="重新编译："></a>重新编译：</h4><p>使用构建命令重新编译项目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="构建实例"><a href="#构建实例" class="headerlink" title="构建实例"></a>构建实例</h2><p>构建步骤如下：</p>
<ol>
<li>创建CMakeLists.txt文件：定义项目、目标和依赖</li>
<li>创建构建目录：保持源代码整洁</li>
<li>配置项目：使用CMake生成构建文件</li>
<li>编译项目：使用构建系统文件编译项目</li>
<li>运行可执行文件：执行生成的程序</li>
<li>清理构建文件：删除中间文件和目标文件</li>
</ol>
<p>假设我们有一个简单的 C++ 项目，包含一个主程序文件和一个库文件，我们将使用 CMake 构建这个项目。</p>
<p>参考网址：<a target="_blank" rel="noopener" href="https://www.runoob.com/cmake/cmake-build-demo.html">https://www.runoob.com/cmake/cmake-build-demo.html</a></p>
<hr>
<h2 id="CMake-高级特性"><a href="#CMake-高级特性" class="headerlink" title="CMake 高级特性"></a>CMake 高级特性</h2><p>CMake 高级特性允许我们更灵活地管理和配置 CMake 项目，以适应复杂的构建需求和环境。</p>
<ol>
<li>自定义CMake模块和脚本：创建自定义模块和脚本以简化构建过程</li>
<li>构建配置和目标：使用多配置生成器和定义多个构建目标</li>
<li>高级查找和配置：灵活地查找和配置构建选项</li>
<li>生成自定义构建步骤：添加自定义命令和目标以执行额外的构建操作</li>
<li>跨平台和交叉编译：支持不同平台的构建和交叉编译</li>
<li>目标属性和配置：设置和修改目标的属性，满足特定需求</li>
</ol>
<hr>
<h3 id="自定义CMake模块和脚本"><a href="#自定义CMake模块和脚本" class="headerlink" title="自定义CMake模块和脚本"></a>自定义CMake模块和脚本</h3><h4 id="自定义CMake模块"><a href="#自定义CMake模块" class="headerlink" title="自定义CMake模块"></a>自定义CMake模块</h4><p>CMake 允许你创建和使用自定义模块，以简化常见的构建任务。</p>
<p>自定义模块通常包含自定义的 CMake 脚本和函数。</p>
<h5 id="创建自定义模块："><a href="#创建自定义模块：" class="headerlink" title="创建自定义模块："></a>创建自定义模块：</h5><ul>
<li><p>在项目目录下创建一个cmake&#x2F; 目录，用于存放自定义cmake模块</p>
</li>
<li><p>在cmake&#x2F; 目录下创建一个MyModule.cmake文件</p>
</li>
<li><p>在CMakeLists.txt文件中包含自定义模块：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">list</span>(APPEND CMAKE_MODULE_PATH <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake&quot;</span>)</span><br><span class="line"><span class="keyword">include</span>(MyModule)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>list(APPEND CMAKE_MODULE_PATH …) 用于扩展 CMake 的模块搜索路径。</p>
</li>
<li><p>include(MyModule) 用于加载并执行指定的 CMake 模块文件。</p>
</li>
</ul>
</li>
</ul>
<h5 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h5><p>MyModule.cmake 文件：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(my_custom_function)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;This is a custom function!&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<p>function(my_custom_function)：定义了一个名为 my_custom_function 的自定义函数。函数名 my_custom_function 可以用来在其他地方调用该函数。</p>
<p>message(STATUS “This is a custom function!”)：这是一个 CMake 内置命令，用于输出消息。STATUS 是消息类型，表示这条消息是状态信息，通常会在编译时显示出来。 “This is a custom function!” 是你要输出的消息内容。</p>
<p>endfunction()：结束自定义函数的定义，标志着函数体的结束。</p>
<p>所以，这段代码的作用是定义了一个名为 my_custom_function 的函数，在该函数被调用时，它会输出消息 This is a custom function!。</p>
<p>在CMakeLists.txt中调用自定义函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_custom_function()</span><br></pre></td></tr></table></figure>

<h4 id="使用自定义CMake脚本"><a href="#使用自定义CMake脚本" class="headerlink" title="使用自定义CMake脚本"></a>使用自定义CMake脚本</h4><p>自定义 CMake 脚本允许你执行自定义配置操作，灵活处理复杂的构建要求。</p>
<h5 id="创建自定义脚本："><a href="#创建自定义脚本：" class="headerlink" title="创建自定义脚本："></a>创建自定义脚本：</h5><ul>
<li>在项目中创建一个脚本文件（例如 config.cmake）。</li>
<li>在脚本中编写 CMake 指令。</li>
</ul>
<h5 id="在-CMakeLists-txt-文件中调用脚本："><a href="#在-CMakeLists-txt-文件中调用脚本：" class="headerlink" title="在 CMakeLists.txt 文件中调用脚本："></a>在 CMakeLists.txt 文件中调用脚本：</h5><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/config.cmake)</span><br></pre></td></tr></table></figure>



<h4 id="构建配置和目标"><a href="#构建配置和目标" class="headerlink" title="构建配置和目标"></a>构建配置和目标</h4><h5 id="多配置生成器"><a href="#多配置生成器" class="headerlink" title="多配置生成器"></a>多配置生成器</h5><p>CMake 支持多种构建配置（如 Debug、Release）。</p>
<p>多配置生成器允许你在同一构建目录中同时生成不同配置的构建。</p>
<p><strong>指定配置类型</strong></p>
<p>在 CMakeLists.txt 中设置默认配置：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Release&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;Build type&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>使用 Visual Studio：</p>
<p>在 Visual Studio 中选择构建配置（Debug 或 Release）。</p>
<h5 id="构建目标"><a href="#构建目标" class="headerlink" title="构建目标"></a>构建目标</h5><p>可以定义多个构建目标，每个目标可以有不同的构建设置和选项。</p>
<p>添加多个目标：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(MyExecutable1 src/main1.cpp)</span><br><span class="line"><span class="keyword">add_executable</span>(MyExecutable2 src/main2.cpp)</span><br></pre></td></tr></table></figure>

<p>设置目标属性：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(MyExecutable1 PROPERTIES COMPILE_DEFINITIONS <span class="string">&quot;DEBUG&quot;</span>)</span><br><span class="line"><span class="keyword">set_target_properties</span>(MyExecutable2 PROPERTIES COMPILE_DEFINITIONS <span class="string">&quot;RELEASE&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="高级查找和配置"><a href="#高级查找和配置" class="headerlink" title="高级查找和配置"></a>高级查找和配置</h4><h5 id="查找包的高级用法"><a href="#查找包的高级用法" class="headerlink" title="查找包的高级用法"></a>查找包的高级用法</h5><p>find_package() 指令可以用于查找和配置复杂的第三方库和包。</p>
<p>查找包的高级选项：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED COMPONENTS filesystem system)</span><br></pre></td></tr></table></figure>

<p>设置查找路径：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(BOOST_ROOT <span class="string">&quot;/path/to/boost&quot;</span>)</span><br><span class="line"><span class="keyword">find_package</span>(Boost REQUIRED)</span><br></pre></td></tr></table></figure>

<h5 id="配置文件和构建选项"><a href="#配置文件和构建选项" class="headerlink" title="配置文件和构建选项"></a>配置文件和构建选项</h5><p>你可以通过 CMake 配置文件来控制构建选项和配置。</p>
<p>配置选项：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">configure_file</span>(config.h.in config.h)</span><br></pre></td></tr></table></figure>

<p>配置文件 (config.h.in)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> VERSION <span class="string">&quot;@PROJECT_VERSION@&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>在源文件中包含配置文件：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config.h&quot;</span></span></span><br></pre></td></tr></table></figure>



<hr>
<p>后面还有一些高级配置，暂时用不到，先不管。</p>
<p>参考<a target="_blank" rel="noopener" href="https://www.runoob.com/cmake/cmake-exercises.html">https://www.runoob.com/cmake/cmake-exercises.html</a></p>
<hr>
<h2 id="CMake-实战练习"><a href="#CMake-实战练习" class="headerlink" title="CMake 实战练习"></a>CMake 实战练习</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/cmake/cmake-exercises.html">https://www.runoob.com/cmake/cmake-exercises.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/01/inter%20Realsense%20D435%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/01/inter%20Realsense%20D435%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">inter Realsense D435使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-01T00:00:00+08:00">2025-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="inter-Realsense-D435使用"><a href="#inter-Realsense-D435使用" class="headerlink" title="inter Realsense D435使用"></a>inter Realsense D435使用</h1><h2 id="安装ros软件包"><a href="#安装ros软件包" class="headerlink" title="安装ros软件包"></a>安装ros软件包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install ros-<span class="variable">$ROS_DISTRO</span>-realsense2-camera</span><br></pre></td></tr></table></figure>

<p>终端运行如下指令,替换成自己的ros版本。</p>
<h2 id="启动相机节点"><a href="#启动相机节点" class="headerlink" title="启动相机节点"></a>启动相机节点</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch</span><br></pre></td></tr></table></figure>

<p>可以选择将其他流分辨率和帧速率作为参数提供给<strong>rs_camera.launch</strong>文件</p>
<p>使用 <code>rostopic list</code>查看已经发布的话题。使用 <code>rostopic info /话题名称</code>查看话题信息</p>
<h2 id="点云数据"><a href="#点云数据" class="headerlink" title="点云数据"></a>点云数据</h2><p>可以使用pointcloud 选项启动camera ，使得发布点云实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch filters:=pointcloud</span><br></pre></td></tr></table></figure>

<p>之后可以打开rviz查看点云信息。</p>
<h2 id="对齐深度坐标系"><a href="#对齐深度坐标系" class="headerlink" title="对齐深度坐标系"></a>对齐深度坐标系</h2><p>以下示例说明了如何启动 Camera 节点并将其将对齐的深度流发布到其他可用流，例如颜色或红外流。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch realsense2_camera rs_camera.launch align_depth:=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="使用Dynamic-Reconfigure-Params-设置摄像头参数"><a href="#使用Dynamic-Reconfigure-Params-设置摄像头参数" class="headerlink" title="使用Dynamic Reconfigure Params 设置摄像头参数"></a>使用Dynamic Reconfigure Params 设置摄像头参数</h2><p>使用rqt来更改相机控制值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun rqt_reconfigure rqt_reconfigure</span><br></pre></td></tr></table></figure>

<h2 id="ros-obiect-analytics"><a href="#ros-obiect-analytics" class="headerlink" title="ros_obiect_analytics"></a>ros_obiect_analytics</h2><p>用于实时对象检测、定位和跟踪的 ROS 包装器,已经停止维护了。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/intel/ros_object_analytics">https://github.com/intel/ros_object_analytics</a></p>
<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/IntelRealSense/realsense-ros/tree/ros1-legacy?tab=readme-ov-file">https://github.com/IntelRealSense/realsense-ros/tree/ros1-legacy?tab=readme-ov-file</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.intelrealsense.com/docs/docs-get-started">https://dev.intelrealsense.com/docs/docs-get-started</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hita</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
