<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"gen2710.netlify.app","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":true,"height":100},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Gains Don&#39;t Stop!">
<meta property="og:type" content="website">
<meta property="og:title" content="U.N.O">
<meta property="og:url" content="http://gen2710.netlify.app/index.html">
<meta property="og:site_name" content="U.N.O">
<meta property="og:description" content="Gains Don&#39;t Stop!">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Hita">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://gen2710.netlify.app/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>U.N.O</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">U.N.O</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hita"
      src="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
  <p class="site-author-name" itemprop="name">Hita</p>
  <div class="site-description" itemprop="description">Gains Don't Stop!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jiangbaoaaa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiangbaoaaa" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:n13155609602@163.com" title="E-mail → mailto:n13155609602@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/08/25/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%BA%94%E8%AE%B2%EF%BC%89--%E7%9B%B8%E6%9C%BA%E4%B8%8E%E5%9B%BE%E5%83%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/25/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%BA%94%E8%AE%B2%EF%BC%89--%E7%9B%B8%E6%9C%BA%E4%B8%8E%E5%9B%BE%E5%83%8F/" class="post-title-link" itemprop="url">第五讲-相机与图像</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-08-25 00:00:00 / 修改时间：11:31:01" itemprop="dateCreated datePublished" datetime="2025-08-25T00:00:00+08:00">2025-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2/" itemprop="url" rel="index"><span itemprop="name">视觉SLAM十四讲</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="视觉SLAM十四讲（第五讲）–相机与图像"><a href="#视觉SLAM十四讲（第五讲）–相机与图像" class="headerlink" title="视觉SLAM十四讲（第五讲）–相机与图像"></a>视觉SLAM十四讲（第五讲）–相机与图像</h1><p>计算机中，一张照片由很多像素组成，每个像素记录色彩或亮度的信息。</p>
<h2 id="相机模型"><a href="#相机模型" class="headerlink" title="相机模型"></a>相机模型</h2><p>相机将三维坐标点映射到二位图像平面可以由一个几何模型描述。例如针孔模型。同时，由于相机镜头有透镜，使得光线投影到成像平面的过程中会产生畸变，因此需要针孔和畸变模型描述投影过程。两个模型可以将外部的三维点投影到相机内部成像平面，构成<code>内参数</code>。</p>
<h3 id="针孔相机模型"><a href="#针孔相机模型" class="headerlink" title="针孔相机模型"></a>针孔相机模型</h3><p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20190102115709713.png" alt="Overview of each camera model (pinhole + fisheye) - Programmer Sought"></p>
<p>$$<br>\frac{Z}{f} &#x3D; -\frac{X}{X’} &#x3D; -\frac{Y}{Y’}<br>$$<br>由图可以知道如上式关系，其中负号表示成像是倒立的。为了更符合实际，等价将成像平面对称地放到相机前方，和三维空间点放到摄像机坐标系同一侧，如下图所示，所得等式也稍作调整：<br>$$<br>\frac{Z}{f} &#x3D; \frac{X}{X’} &#x3D; \frac{Y}{Y’}<br>$$<br><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20181113171148585.png" alt="几何光学 | 1-1 几何光学基本定律与成像基本概念 - 知乎"></p>
<p>整理一下上述公式：<br>$$<br>X’ &#x3D; f\frac{X}{Z}<br>\<br>Y’ &#x3D; f\frac{Y}{Z}<br>$$<br>进行处理后的正像被称为针孔模型。在相机中，我们最终获得的是一个个像素，需要在成像平面上对像进行采样和量化，为了描述将光线转换成图像像素的过程，在物理平面上固定一个**像素平面$o-u-v$。**在像素平面得到$P^{‘}$的像素坐标：$[u, v]^T$​​。</p>
<p>下图是不同坐标系的表示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/f15758757d381093fa8e45670bfc09d4.png"></p>
<blockquote>
<p>像素坐标系</p>
</blockquote>
<p>表示三维空间物体在图像平面的投影，像素是离散化的。坐标原点在CCD图像平面的左上角，u轴平行于CCD平面水平向右，v轴垂直与u轴向下，坐标使用(u, v)表示。像素坐标系与成像平面之间相差一个<code>缩放</code>和一个<code>远点的平移</code>。设像素坐标在u轴上缩放了α倍，在v轴上缩放了β倍。同时原点平移了$[c_x,c_y]^T$。那么，$P^{‘}$的坐标与像素坐标$[u, v]^ T$的关系是：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250822194654199.png" alt="image-20250822194654199"></p>
<p>其中，中间的两组成的矩阵$K$称为相机的内参数矩阵，通常不会发生改变。如果需要自己确定相机内参的话，就需要所谓的标定技术例如张正友标定法。至于外参，我们使用的是$P$在相机坐标系（就是实际的相机的坐标系）下的坐标，但是实际上由于相机在运动，所以$P$的相机坐标应该是他的世界坐标系，即根据相机当前的位姿变换到相机坐标系的结果$P_w$。相机的位姿由它的旋转矩阵R和平移向量t描述：<br>$$<br>ZP_{uv} &#x3D; Z \begin{bmatrix} u \ v \ 1 \end{bmatrix} &#x3D; \mathbf{K}(\mathbf{R}P_{w} + \mathbf{t}) &#x3D; \mathbf{K}\mathbf{T}P_{w}<br>$$<br>其中，相机的位姿R，t又称为<code>相机的外参数</code>。</p>
<p>投影相当于在由世界坐标系到相机坐标系的转化过程中，再除掉最后一维的数值（深度）。相当于进行一个归一化处理，得到点$P$在相机<strong>归一化平面</strong>上的投影：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250822201917962.png" alt="image-20250822201917962"></p>
<p><strong>归一化坐标</strong>可以理解为相机前方z &#x3D; 1处的平面上的点，这个平面也称为归一化平面，归一化坐标左乘内参就是像素坐标，如果对于相机坐标系同时乘以任意非零常数，得到的归一化坐标都是一样的，这就是<strong>点的深度在投影过程中丢失了</strong>，所以单目视觉得不到像素点的深度值。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/MengYa_Dream/article/details/120233806">图像处理——4个坐标系及相关转换图像像素坐标系 图像物理坐标系 相机坐标系 世界坐标系_图像坐标系-CSDN博客</a></p>
<hr>
<h3 id="畸变模型"><a href="#畸变模型" class="headerlink" title="畸变模型"></a>畸变模型</h3><p>为了获得好的成像效果，会在相机前方加上透镜，会影响光线传播，由透镜形状引起的畸变称为径向畸变，主要分为：桶形畸变和枕形畸变。除了透镜的形状会引入畸变，由于相机的组装过程中不能使透镜与成像面严格平行，所以会引入切向畸变。所以要进行畸变校正，具体参考书本101页。</p>
<p>主要是理解四个坐标系之间的变换关系。</p>
<hr>
<h3 id="双目相机模型"><a href="#双目相机模型" class="headerlink" title="双目相机模型"></a>双目相机模型</h3><p>由于根据单个相机无法确定空间点的具体位置，只有当P的深度确定时，才能确切知道空间位置。可以通过同步采集左右相机的图像，计算图像间的视差，估计每一个像素的深度。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/stereo.PNG" alt="stereo"></p>
<p>双目相机一般由左眼和右眼两个<strong>水平放置</strong>的相机组成。上图中左右两个相机都是使用针孔相机模型，两个相机的成像平面在同一个水平面上，同时两个相机光心是水平放置的，因此对于一个P点，其在两个图像上的投影点的行坐标是相同的，我们通过对其纵坐标的处理便可以得到视差了。</p>
<p>图中两个相机光心之间的距离b被成为双目相机的<strong>基线</strong>，是与焦距f一样重要的参数。</p>
<p>根据上图，假设一个空间点P，在左右目各成一像$P_L$与$P_R$，分别以两个光心垂直的位置为二维坐标原点，则$P_L$的横坐标为$u_L$，$P_R$的横坐标为$u_R$，可以发现$u_R$是一个负数。根据上图中右侧三角形相似的原理，可以得到下面公式<br>$$<br>\frac{z-f}{z}&#x3D;\frac{b-u_{L}+u_{R}}{b}<br>$$<br>得到：<br>$$<br>z &#x3D; \frac{fb}{d}, d&#x3D; u_L -u_R<br>$$<br>d称为视差。</p>
<hr>
<h3 id="RGB-D相机模型"><a href="#RGB-D相机模型" class="headerlink" title="RGB-D相机模型"></a>RGB-D相机模型</h3><p>相较于双目相机通过视差计算深度，RGB-D相机能够主动测量每个像素的深度，主要分为两类RGB-D相机：</p>
<ol>
<li>通过红外结构光原理测量像素距离</li>
<li>通过飞行实践原理测量像素距离</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/cae3ffa05c1d4dd7a52cd9cc25b860c9.png" alt="img"></p>
<p>无论哪种，都要向探测目标发射一束光线（通常为红外光）。在红外结构光原理中，相机根据返回的结构光图案，计算物体与自身的距离。在TOF原理中，先发射脉冲光，根据发送到返回之间的光束飞行时间计算物体与自身的距离。这里只做简单介绍</p>
<hr>
<h2 id="图像"><a href="#图像" class="headerlink" title="图像"></a>图像</h2><p>数学中，图像可以用一个矩阵描述，计算机中，可以用二维数组表示。我们使用OpenCV来进行图像处理，在一张灰度图中，每个像素位置$(x, y)$对应一个灰度值$I$，所以一张宽度为$w$、高度为$h$的图像，在数学上记为一个函数：<br>$$<br>I(x, y) : \mathbb{R}^{2} \mapsto \mathbb{R}<br>$$<br>$(x, y)$是像素坐标。用0~255的整数表达图像的灰度读数。那么一张宽度为640像素、高度为480像素分辨率的灰度图可以表示为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> image[<span class="number">480</span>][<span class="number">640</span>]</span><br></pre></td></tr></table></figure>

<p>因为在图像中，数组的行数对应图像的高度，列数对应图像的宽度。图像以二维数组形式存储，当访问某一个像素时，需要指明所处的坐标。</p>
<p>我们讨论一个位于x,y处的像素，访问方式是：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> pixel = image[y][x]</span><br></pre></td></tr></table></figure>

<p>至于像素数据的记录，只做一个简单介绍，如下图展示的，例如一般灰度值用8位整数记录0~255d的值，彩色图则使用三通道，24位记录。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250822214528123.png" alt="image-20250822214528123"></p>
<hr>
<h2 id="实践：计算机中的图像"><a href="#实践：计算机中的图像" class="headerlink" title="实践：计算机中的图像"></a>实践：计算机中的图像</h2><h3 id="OpenCV基本使用方法"><a href="#OpenCV基本使用方法" class="headerlink" title="OpenCV基本使用方法"></a>OpenCV基本使用方法</h3><blockquote>
<p>安装opencv</p>
</blockquote>
<p>环境：ubuntu20.04 vm17</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt upgrate -y</span><br><span class="line"><span class="built_in">sudo</span> apt install libopencv-dev python3-opencv -y</span><br></pre></td></tr></table></figure>



<p>新建文件夹及文件：<code>slambook/ch5/imageBasics/imageBasics.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 读取argv[1]指定的图像</span></span><br><span class="line">  cv::Mat image;</span><br><span class="line">  image = cv::<span class="built_in">imread</span>(argv[<span class="number">1</span>]); <span class="comment">//cv::imread函数读取指定路径下的图像</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断图像文件是否正确读取</span></span><br><span class="line">  <span class="keyword">if</span> (image.data == <span class="literal">nullptr</span>) &#123; <span class="comment">//数据不存在,可能是文件不存在</span></span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;文件&quot;</span> &lt;&lt; argv[<span class="number">1</span>] &lt;&lt; <span class="string">&quot;不存在.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 文件顺利读取, 首先输出一些基本信息</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;图像宽为&quot;</span> &lt;&lt; image.cols &lt;&lt; <span class="string">&quot;,高为&quot;</span> &lt;&lt; image.rows &lt;&lt; <span class="string">&quot;,通道数为&quot;</span> &lt;&lt; image.<span class="built_in">channels</span>() &lt;&lt; endl;</span><br><span class="line">  cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);      <span class="comment">// 用cv::imshow显示图像</span></span><br><span class="line">  cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);                  <span class="comment">// 暂停程序,等待一个按键输入</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断image的类型</span></span><br><span class="line">  <span class="keyword">if</span> (image.<span class="built_in">type</span>() != CV_8UC1 &amp;&amp; image.<span class="built_in">type</span>() != CV_8UC3) &#123;</span><br><span class="line">    <span class="comment">// 图像类型不符合要求</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;请输入一张彩色图或灰度图.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历图像, 请注意以下遍历方式亦可使用于随机像素访问</span></span><br><span class="line">  <span class="comment">// 使用 std::chrono 来给算法计时</span></span><br><span class="line">  chrono::steady_clock::time_point t1 = chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> y = <span class="number">0</span>; y &lt; image.rows; y++) &#123;</span><br><span class="line">    <span class="comment">// 用cv::Mat::ptr获得图像的行指针</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *row_ptr = image.<span class="built_in">ptr</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;(y);  <span class="comment">// row_ptr是第y行的头指针</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> x = <span class="number">0</span>; x &lt; image.cols; x++) &#123;</span><br><span class="line">      <span class="comment">// 访问位于 x,y 处的像素</span></span><br><span class="line">      <span class="type">unsigned</span> <span class="type">char</span> *data_ptr = &amp;row_ptr[x * image.<span class="built_in">channels</span>()]; <span class="comment">// data_ptr 指向待访问的像素数据</span></span><br><span class="line">      <span class="comment">// 输出该像素的每个通道,如果是灰度图就只有一个通道</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c != image.<span class="built_in">channels</span>(); c++) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> data = data_ptr[c]; <span class="comment">// data为I(x,y)第c个通道的值</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  chrono::steady_clock::time_point t2 = chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">  chrono::duration&lt;<span class="type">double</span>&gt; time_used = chrono::duration_cast &lt; chrono::duration &lt; <span class="type">double</span> &gt;&gt; (t2 - t1);</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;遍历图像用时：&quot;</span> &lt;&lt; time_used.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; 秒。&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关于 cv::Mat 的拷贝</span></span><br><span class="line">  <span class="comment">// 直接赋值并不会拷贝数据</span></span><br><span class="line">  cv::Mat image_another = image;</span><br><span class="line">  <span class="comment">// 修改 image_another 会导致 image 发生变化</span></span><br><span class="line">  <span class="built_in">image_another</span>(cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)).<span class="built_in">setTo</span>(<span class="number">0</span>); <span class="comment">// 将左上角100*100的块置零</span></span><br><span class="line">  cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">  cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用clone函数来拷贝数据</span></span><br><span class="line">  cv::Mat image_clone = image.<span class="built_in">clone</span>();</span><br><span class="line">  <span class="built_in">image_clone</span>(cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)).<span class="built_in">setTo</span>(<span class="number">255</span>);</span><br><span class="line">  cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">  cv::<span class="built_in">imshow</span>(<span class="string">&quot;image_clone&quot;</span>, image_clone);</span><br><span class="line">  cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对于图像还有很多基本的操作,如剪切,旋转,缩放等,限于篇幅就不一一介绍了,请参看OpenCV官方文档查询每个函数的调用方法.</span></span><br><span class="line">  cv::<span class="built_in">destroyAllWindows</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>新建CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line"></span><br><span class="line">project(imageBasics)</span><br><span class="line"></span><br><span class="line">set( CMAKE_CXX_FLAGS <span class="string">&quot;-std=c++14&quot;</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找OpenCV</span></span><br><span class="line">find_package(OpenCV REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果找到OpenCV，则执行以下操作</span></span><br><span class="line">if(OpenCV_FOUND)</span><br><span class="line">  <span class="comment"># 包含OpenCV的头文件目录</span></span><br><span class="line">  include_directories($&#123;OpenCV_INCLUDE_DIRS&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 添加可执行文件</span></span><br><span class="line">  add_executable(imageBasics imageBasics.cpp)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 链接OpenCV库</span></span><br><span class="line">  target_link_libraries(imageBasics $&#123;OpenCV_LIBRARIES&#125;)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>把源代码中的图片复制到同一文件夹下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250825101854724.png"></p>
<p>在终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch5/imageBasics/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch5/imageBasics/build</span><br><span class="line">hita@hita-vm:~/slambook/ch5/imageBasics/build$ make</span><br><span class="line">[100%] Built target imageBasics</span><br><span class="line">hita@hita-vm:~/slambook/ch5/imageBasics/build$ ./imageBasics ../ubuntu.png </span><br><span class="line">图像宽为1200,高为674,通道数为3</span><br><span class="line">遍历图像用时：0.00393242 秒。</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250825102058073.png" alt="image-20250825102058073"></p>
<hr>
<h3 id="图像去畸变"><a href="#图像去畸变" class="headerlink" title="图像去畸变"></a>图像去畸变</h3><p>新建文件 <code>slambook/ch5/imageBasics/undistrotImage.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">string image_file = <span class="string">&quot;../distorted.png&quot;</span>;   <span class="comment">// 请确保路径正确</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 本程序实现去畸变部分的代码。尽管我们可以调用OpenCV的去畸变，但自己实现一遍有助于理解。</span></span><br><span class="line">  <span class="comment">// 畸变参数</span></span><br><span class="line">  <span class="type">double</span> k1 = <span class="number">-0.28340811</span>, k2 = <span class="number">0.07395907</span>, p1 = <span class="number">0.00019359</span>, p2 = <span class="number">1.76187114e-05</span>;</span><br><span class="line">  <span class="comment">// 内参</span></span><br><span class="line">  <span class="type">double</span> fx = <span class="number">458.654</span>, fy = <span class="number">457.296</span>, cx = <span class="number">367.215</span>, cy = <span class="number">248.375</span>;</span><br><span class="line"></span><br><span class="line">  cv::Mat image = cv::<span class="built_in">imread</span>(image_file, <span class="number">0</span>);   <span class="comment">// 图像是灰度图，CV_8UC1</span></span><br><span class="line">  <span class="type">int</span> rows = image.rows, cols = image.cols;</span><br><span class="line">  cv::Mat image_undistort = cv::<span class="built_in">Mat</span>(rows, cols, CV_8UC1);   <span class="comment">// 去畸变以后的图</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 计算去畸变后图像的内容</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt; rows; v++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">0</span>; u &lt; cols; u++) &#123;</span><br><span class="line">      <span class="comment">// 按照公式，计算点(u,v)对应到畸变图像中的坐标(u_distorted, v_distorted)</span></span><br><span class="line">      <span class="type">double</span> x = (u - cx) / fx, y = (v - cy) / fy;</span><br><span class="line">      <span class="type">double</span> r = <span class="built_in">sqrt</span>(x * x + y * y);</span><br><span class="line">      <span class="type">double</span> x_distorted = x * (<span class="number">1</span> + k1 * r * r + k2 * r * r * r * r) + <span class="number">2</span> * p1 * x * y + p2 * (r * r + <span class="number">2</span> * x * x);</span><br><span class="line">      <span class="type">double</span> y_distorted = y * (<span class="number">1</span> + k1 * r * r + k2 * r * r * r * r) + p1 * (r * r + <span class="number">2</span> * y * y) + <span class="number">2</span> * p2 * x * y;</span><br><span class="line">      <span class="type">double</span> u_distorted = fx * x_distorted + cx;</span><br><span class="line">      <span class="type">double</span> v_distorted = fy * y_distorted + cy;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 赋值 (最近邻插值)</span></span><br><span class="line">      <span class="keyword">if</span> (u_distorted &gt;= <span class="number">0</span> &amp;&amp; v_distorted &gt;= <span class="number">0</span> &amp;&amp; u_distorted &lt; cols &amp;&amp; v_distorted &lt; rows) &#123;</span><br><span class="line">        image_undistort.<span class="built_in">at</span>&lt;uchar&gt;(v, u) = image.<span class="built_in">at</span>&lt;uchar&gt;((<span class="type">int</span>) v_distorted, (<span class="type">int</span>) u_distorted);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        image_undistort.<span class="built_in">at</span>&lt;uchar&gt;(v, u) = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 画图去畸变后图像</span></span><br><span class="line">  cv::<span class="built_in">imshow</span>(<span class="string">&quot;distorted&quot;</span>, image);</span><br><span class="line">  cv::<span class="built_in">imshow</span>(<span class="string">&quot;undistorted&quot;</span>, image_undistort);</span><br><span class="line">  cv::<span class="built_in">waitKey</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line"></span><br><span class="line">project(imageBasics)</span><br><span class="line"></span><br><span class="line">set( CMAKE_CXX_FLAGS <span class="string">&quot;-std=c++14&quot;</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找OpenCV</span></span><br><span class="line">find_package(OpenCV REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果找到OpenCV，则执行以下操作</span></span><br><span class="line">if(OpenCV_FOUND)</span><br><span class="line">  <span class="comment"># 包含OpenCV的头文件目录</span></span><br><span class="line">  include_directories($&#123;OpenCV_INCLUDE_DIRS&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 添加可执行文件</span></span><br><span class="line">  add_executable(imageBasics imageBasics.cpp)</span><br><span class="line">  add_executable(undistortImage undistortImage.cpp)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 链接OpenCV库</span></span><br><span class="line">  target_link_libraries(imageBasics $&#123;OpenCV_LIBRARIES&#125;)</span><br><span class="line">  target_link_libraries(undistortImage $&#123;OpenCV_LIBRARIES&#125;)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>终端输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch5/imageBasics/build$ cmake ..</span><br><span class="line">-- Configuring <span class="keyword">done</span></span><br><span class="line">-- Generating <span class="keyword">done</span></span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch5/imageBasics/build</span><br><span class="line">hita@hita-vm:~/slambook/ch5/imageBasics/build$ make</span><br><span class="line">Scanning dependencies of target undistortImage</span><br><span class="line">[ 25%] Building CXX object CMakeFiles/undistortImage.<span class="built_in">dir</span>/undistortImage.cpp.o</span><br><span class="line">[ 50%] Linking CXX executable undistortImage</span><br><span class="line">[ 50%] Built target undistortImage</span><br><span class="line">[100%] Built target imageBasics</span><br><span class="line">hita@hita-vm:~/slambook/ch5/imageBasics/build$ ./undistortImage </span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250825104800880.png" alt="image-20250825104800880"></p>
<h2 id="实践：3D视觉"><a href="#实践：3D视觉" class="headerlink" title="实践：3D视觉"></a>实践：3D视觉</h2><h3 id="双目视觉"><a href="#双目视觉" class="headerlink" title="双目视觉"></a>双目视觉</h3><p>可以从双目视觉的左右图像出发，计算图像对应的视差图，计算各像素在相机坐标系下的坐标，生成点云。</p>
<p>新建文件夹及文件：<code>slambook/ch5/stereoVision/stereoVision.cpp</code></p>
<p>首先讲源代码中两个图像放置在该文件夹下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件路径</span></span><br><span class="line">string left_file = <span class="string">&quot;../left.png&quot;</span>;</span><br><span class="line">string right_file = <span class="string">&quot;../right.png&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在pangolin中画图，已写好，无需调整</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">showPointCloud</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> vector&lt;Vector4d, Eigen::aligned_allocator&lt;Vector4d&gt;&gt; &amp;pointcloud)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内参</span></span><br><span class="line">    <span class="type">double</span> fx = <span class="number">718.856</span>, fy = <span class="number">718.856</span>, cx = <span class="number">607.1928</span>, cy = <span class="number">185.2157</span>;</span><br><span class="line">    <span class="comment">// 基线</span></span><br><span class="line">    <span class="type">double</span> b = <span class="number">0.573</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取图像</span></span><br><span class="line">    cv::Mat left = cv::<span class="built_in">imread</span>(left_file, <span class="number">0</span>);</span><br><span class="line">    cv::Mat right = cv::<span class="built_in">imread</span>(right_file, <span class="number">0</span>);</span><br><span class="line">    cv::Ptr&lt;cv::StereoSGBM&gt; sgbm = cv::StereoSGBM::<span class="built_in">create</span>(</span><br><span class="line">        <span class="number">0</span>, <span class="number">96</span>, <span class="number">9</span>, <span class="number">8</span> * <span class="number">9</span> * <span class="number">9</span>, <span class="number">32</span> * <span class="number">9</span> * <span class="number">9</span>, <span class="number">1</span>, <span class="number">63</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">32</span>);    <span class="comment">// 神奇的参数</span></span><br><span class="line">    cv::Mat disparity_sgbm, disparity;</span><br><span class="line">    sgbm-&gt;<span class="built_in">compute</span>(left, right, disparity_sgbm);</span><br><span class="line">    disparity_sgbm.<span class="built_in">convertTo</span>(disparity, CV_32F, <span class="number">1.0</span> / <span class="number">16.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成点云</span></span><br><span class="line">    vector&lt;Vector4d, Eigen::aligned_allocator&lt;Vector4d&gt;&gt; pointcloud;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果你的机器慢，请把后面的v++和u++改成v+=2, u+=2</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt; left.rows; v++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">0</span>; u &lt; left.cols; u++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (disparity.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(v, u) &lt;= <span class="number">0.0</span> || disparity.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(v, u) &gt;= <span class="number">96.0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function">Vector4d <span class="title">point</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, left.at&lt;uchar&gt;(v, u) / <span class="number">255.0</span>)</span></span>; <span class="comment">// 前三维为xyz,第四维为颜色</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 根据双目模型计算 point 的位置</span></span><br><span class="line">            <span class="type">double</span> x = (u - cx) / fx;</span><br><span class="line">            <span class="type">double</span> y = (v - cy) / fy;</span><br><span class="line">            <span class="type">double</span> depth = fx * b / (disparity.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(v, u));</span><br><span class="line">            point[<span class="number">0</span>] = x * depth;</span><br><span class="line">            point[<span class="number">1</span>] = y * depth;</span><br><span class="line">            point[<span class="number">2</span>] = depth;</span><br><span class="line"></span><br><span class="line">            pointcloud.<span class="built_in">push_back</span>(point);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;disparity&quot;</span>, disparity / <span class="number">96.0</span>);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 画出点云</span></span><br><span class="line">    <span class="built_in">showPointCloud</span>(pointcloud);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">showPointCloud</span><span class="params">(<span class="type">const</span> vector&lt;Vector4d, Eigen::aligned_allocator&lt;Vector4d&gt;&gt; &amp;pointcloud)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pointcloud.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Point cloud is empty!&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pangolin::<span class="built_in">CreateWindowAndBind</span>(<span class="string">&quot;Point Cloud Viewer&quot;</span>, <span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_BLEND);</span><br><span class="line">    <span class="built_in">glBlendFunc</span>(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">    <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        pangolin::ProjectionMatrix(<span class="number">1024</span>, <span class="number">768</span>, <span class="number">500</span>, <span class="number">500</span>, <span class="number">512</span>, <span class="number">389</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="params"><span class="function">        pangolin::ModelViewLookAt(<span class="number">0</span>, <span class="number">-0.1</span>, <span class="number">-1.8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br><span class="line"></span><br><span class="line">    pangolin::View &amp;d_cam = pangolin::<span class="built_in">CreateDisplay</span>()</span><br><span class="line">        .<span class="built_in">SetBounds</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, pangolin::Attach::<span class="built_in">Pix</span>(<span class="number">175</span>), <span class="number">1.0</span>, <span class="number">-1024.0f</span> / <span class="number">768.0f</span>)</span><br><span class="line">        .<span class="built_in">SetHandler</span>(<span class="keyword">new</span> pangolin::<span class="built_in">Handler3D</span>(s_cam));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pangolin::<span class="built_in">ShouldQuit</span>() == <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        d_cam.<span class="built_in">Activate</span>(s_cam);</span><br><span class="line">        <span class="built_in">glClearColor</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glPointSize</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">glBegin</span>(GL_POINTS);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;p: pointcloud) &#123;</span><br><span class="line">            <span class="built_in">glColor3f</span>(p[<span class="number">3</span>], p[<span class="number">3</span>], p[<span class="number">3</span>]);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">glEnd</span>();</span><br><span class="line">        pangolin::<span class="built_in">FinishFrame</span>();</span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">5000</span>);   <span class="comment">// sleep 5 ms</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line">project(stereoVision)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 C++ 标准</span></span><br><span class="line">set(CMAKE_CXX_STANDARD 14)</span><br><span class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找所有依赖库</span></span><br><span class="line"><span class="comment"># 这会设置相应的变量，如 *_INCLUDE_DIRS 和 *_LIBRARIES</span></span><br><span class="line">find_package(OpenCV REQUIRED)</span><br><span class="line">find_package(Eigen3 REQUIRED)</span><br><span class="line">find_package(Pangolin REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加头文件搜索目录</span></span><br><span class="line"><span class="comment"># 编译器需要知道去哪里找 .hpp 文件</span></span><br><span class="line">include_directories(</span><br><span class="line">    $&#123;OpenCV_INCLUDE_DIRS&#125;</span><br><span class="line">    $&#123;EIGEN3_INCLUDE_DIR&#125;</span><br><span class="line">    $&#123;Pangolin_INCLUDE_DIRS&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加可执行文件</span></span><br><span class="line">add_executable(stereoVision stereoVision.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接库文件</span></span><br><span class="line"><span class="comment"># 链接器需要知道去哪里找库的实现文件</span></span><br><span class="line">target_link_libraries(stereoVision</span><br><span class="line">    $&#123;OpenCV_LIBRARIES&#125;</span><br><span class="line">    $&#123;Pangolin_LIBRARIES&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>在终端输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch5/steroVision/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch5/steroVision/build</span><br><span class="line">hita@hita-vm:~/slambook/ch5/steroVision/build$ make </span><br><span class="line">[100%] Built target stereoVision</span><br><span class="line">hita@hita-vm:~/slambook/ch5/steroVision/build$ ./stereoVision </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250825110158793.png" alt="image-20250825110158793"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250825110214053.png" alt="image-20250825110214053"></p>
<h3 id="RGB-D视觉"><a href="#RGB-D视觉" class="headerlink" title="RGB-D视觉"></a>RGB-D视觉</h3><p>RGB-D相机可以通过物理的方法获取像素深度信息，如果已知相机内外参，就可以计算任何一个像素在世界坐标系下的位置，从而建立一个点云地图。将相关文件放置到<code>slambook/ch5/rgbd/</code>文件夹下，有类似结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── color</span><br><span class="line">│   ├── 1.png</span><br><span class="line">│   ├── 2.png</span><br><span class="line">│   ├── 3.png</span><br><span class="line">│   ├── 4.png</span><br><span class="line">│   └── 5.png</span><br><span class="line">├── depth</span><br><span class="line">│   ├── 1.pgm</span><br><span class="line">│   ├── 2.pgm</span><br><span class="line">│   ├── 3.pgm</span><br><span class="line">│   ├── 4.pgm</span><br><span class="line">│   └── 5.pgm</span><br><span class="line">├── joinMap.cpp</span><br><span class="line">└── pose.txt</span><br></pre></td></tr></table></figure>

<p>分别对应RGB图，深度图和五张图像的相机外参位姿（以$T_{wc}$形式）。为平移向量+旋转四元数。</p>
<p>新建文件<code>slambook/ch5/rgbd/jointMap.cpp</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &lt;opencv2/opencv.hpp&gt;</span><br><span class="line">#include &lt;boost/format.hpp&gt;  // for formating strings</span><br><span class="line">#include &lt;pangolin/pangolin.h&gt;</span><br><span class="line">#include &lt;sophus/se3.hpp&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">typedef vector&lt;Sophus::SE3d, Eigen::aligned_allocator&lt;Sophus::SE3d&gt;&gt; TrajectoryType;</span><br><span class="line">typedef Eigen::Matrix&lt;double, 6, 1&gt; Vector6d;</span><br><span class="line"></span><br><span class="line">// 在pangolin中画图，已写好，无需调整</span><br><span class="line">void showPointCloud(</span><br><span class="line">    const vector&lt;Vector6d, Eigen::aligned_allocator&lt;Vector6d&gt;&gt; &amp;pointcloud);</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">    vector&lt;cv::Mat&gt; colorImgs, depthImgs;    // 彩色图和深度图</span><br><span class="line">    TrajectoryType poses;         // 相机位姿</span><br><span class="line"></span><br><span class="line">    ifstream fin(&quot;../pose.txt&quot;);</span><br><span class="line">    if (!fin) &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;请在有pose.txt的目录下运行此程序&quot; &lt;&lt; endl;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">        boost::format fmt(&quot;../%s/%d.%s&quot;); //图像文件格式</span><br><span class="line">        colorImgs.push_back(cv::imread((fmt % &quot;color&quot; % (i + 1) % &quot;png&quot;).str()));</span><br><span class="line">        depthImgs.push_back(cv::imread((fmt % &quot;depth&quot; % (i + 1) % &quot;pgm&quot;).str(), -1)); // 使用-1读取原始图像</span><br><span class="line"></span><br><span class="line">        double data[7] = &#123;0&#125;;</span><br><span class="line">        for (auto &amp;d:data)</span><br><span class="line">            fin &gt;&gt; d;</span><br><span class="line">        Sophus::SE3d pose(Eigen::Quaterniond(data[6], data[3], data[4], data[5]),</span><br><span class="line">                          Eigen::Vector3d(data[0], data[1], data[2]));</span><br><span class="line">        poses.push_back(pose);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 计算点云并拼接</span><br><span class="line">    // 相机内参 </span><br><span class="line">    double cx = 325.5;</span><br><span class="line">    double cy = 253.5;</span><br><span class="line">    double fx = 518.0;</span><br><span class="line">    double fy = 519.0;</span><br><span class="line">    double depthScale = 1000.0;</span><br><span class="line">    vector&lt;Vector6d, Eigen::aligned_allocator&lt;Vector6d&gt;&gt; pointcloud;</span><br><span class="line">    pointcloud.reserve(1000000);</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">        cout &lt;&lt; &quot;转换图像中: &quot; &lt;&lt; i + 1 &lt;&lt; endl;</span><br><span class="line">        cv::Mat color = colorImgs[i];</span><br><span class="line">        cv::Mat depth = depthImgs[i];</span><br><span class="line">        Sophus::SE3d T = poses[i];</span><br><span class="line">        for (int v = 0; v &lt; color.rows; v++)</span><br><span class="line">            for (int u = 0; u &lt; color.cols; u++) &#123;</span><br><span class="line">                unsigned int d = depth.ptr&lt;unsigned short&gt;(v)[u]; // 深度值</span><br><span class="line">                if (d == 0) continue; // 为0表示没有测量到</span><br><span class="line">                Eigen::Vector3d point;</span><br><span class="line">                point[2] = double(d) / depthScale;</span><br><span class="line">                point[0] = (u - cx) * point[2] / fx;</span><br><span class="line">                point[1] = (v - cy) * point[2] / fy;</span><br><span class="line">                Eigen::Vector3d pointWorld = T * point;</span><br><span class="line"></span><br><span class="line">                Vector6d p;</span><br><span class="line">                p.head&lt;3&gt;() = pointWorld;</span><br><span class="line">                p[5] = color.data[v * color.step + u * color.channels()];   // blue</span><br><span class="line">                p[4] = color.data[v * color.step + u * color.channels() + 1]; // green</span><br><span class="line">                p[3] = color.data[v * color.step + u * color.channels() + 2]; // red</span><br><span class="line">                pointcloud.push_back(p);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;点云共有&quot; &lt;&lt; pointcloud.size() &lt;&lt; &quot;个点.&quot; &lt;&lt; endl;</span><br><span class="line">    showPointCloud(pointcloud);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void showPointCloud(const vector&lt;Vector6d, Eigen::aligned_allocator&lt;Vector6d&gt;&gt; &amp;pointcloud) &#123;</span><br><span class="line"></span><br><span class="line">    if (pointcloud.empty()) &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;Point cloud is empty!&quot; &lt;&lt; endl;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pangolin::CreateWindowAndBind(&quot;Point Cloud Viewer&quot;, 1024, 768);</span><br><span class="line">    glEnable(GL_DEPTH_TEST);</span><br><span class="line">    glEnable(GL_BLEND);</span><br><span class="line">    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">    pangolin::OpenGlRenderState s_cam(</span><br><span class="line">        pangolin::ProjectionMatrix(1024, 768, 500, 500, 512, 389, 0.1, 1000),</span><br><span class="line">        pangolin::ModelViewLookAt(0, -0.1, -1.8, 0, 0, 0, 0.0, -1.0, 0.0)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    pangolin::View &amp;d_cam = pangolin::CreateDisplay()</span><br><span class="line">        .SetBounds(0.0, 1.0, pangolin::Attach::Pix(175), 1.0, -1024.0f / 768.0f)</span><br><span class="line">        .SetHandler(new pangolin::Handler3D(s_cam));</span><br><span class="line"></span><br><span class="line">    while (pangolin::ShouldQuit() == false) &#123;</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        d_cam.Activate(s_cam);</span><br><span class="line">        glClearColor(1.0f, 1.0f, 1.0f, 1.0f);</span><br><span class="line"></span><br><span class="line">        glPointSize(2);</span><br><span class="line">        glBegin(GL_POINTS);</span><br><span class="line">        for (auto &amp;p: pointcloud) &#123;</span><br><span class="line">            glColor3d(p[3] / 255.0, p[4] / 255.0, p[5] / 255.0);</span><br><span class="line">            glVertex3d(p[0], p[1], p[2]);</span><br><span class="line">        &#125;</span><br><span class="line">        glEnd();</span><br><span class="line">        pangolin::FinishFrame();</span><br><span class="line">        usleep(5000);   // sleep 5 ms</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line">project(joinMap)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 C++ 标准</span></span><br><span class="line">set(CMAKE_CXX_STANDARD 14)</span><br><span class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找所有依赖库</span></span><br><span class="line">find_package(OpenCV REQUIRED)</span><br><span class="line">find_package(Eigen3 REQUIRED)</span><br><span class="line">find_package(Pangolin REQUIRED)</span><br><span class="line">find_package(Sophus REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加头文件搜索目录</span></span><br><span class="line">include_directories(</span><br><span class="line">    $&#123;OpenCV_INCLUDE_DIRS&#125;</span><br><span class="line">    $&#123;EIGEN3_INCLUDE_DIR&#125;</span><br><span class="line">    $&#123;Pangolin_INCLUDE_DIRS&#125;</span><br><span class="line">    $&#123;Sophus_INCLUDE_DIRS&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加可执行文件</span></span><br><span class="line">add_executable(joinMap joinMap.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接库文件</span></span><br><span class="line">target_link_libraries(joinMap</span><br><span class="line">    $&#123;OpenCV_LIBRARIES&#125;</span><br><span class="line">    $&#123;Pangolin_LIBRARIES&#125;</span><br><span class="line">    $&#123;Sophus_LIBRARIES&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>终端输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch5/rgbd/build$ cmake ..</span><br><span class="line">-- Configuring <span class="keyword">done</span></span><br><span class="line">-- Generating <span class="keyword">done</span></span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch5/rgbd/build</span><br><span class="line">hita@hita-vm:~/slambook/ch5/rgbd/build$ make</span><br><span class="line">[100%] Built target joinMap</span><br><span class="line">hita@hita-vm:~/slambook/ch5/rgbd/build$ ./joinMap </span><br><span class="line">转换图像中: 1</span><br><span class="line">转换图像中: 2</span><br><span class="line">转换图像中: 3</span><br><span class="line">转换图像中: 4</span><br><span class="line">转换图像中: 5</span><br><span class="line">点云共有1081843个点.</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250825112657741.png" alt="image-20250825112657741"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/08/20/2025-08-20-%E7%AC%AC%E5%9B%9B%E8%AE%B2-%E6%9D%8E%E7%BE%A4%E6%9D%8E%E4%BB%A3%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/20/2025-08-20-%E7%AC%AC%E5%9B%9B%E8%AE%B2-%E6%9D%8E%E7%BE%A4%E6%9D%8E%E4%BB%A3%E6%95%B0/" class="post-title-link" itemprop="url">第四讲-李群李代数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-08-20 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-20T00:00:00+08:00">2025-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-08-22 16:01:51" itemprop="dateModified" datetime="2025-08-22T16:01:51+08:00">2025-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2/" itemprop="url" rel="index"><span itemprop="name">视觉SLAM十四讲</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="视觉SLAM十四讲（第四讲）——李群李代数"><a href="#视觉SLAM十四讲（第四讲）——李群李代数" class="headerlink" title="视觉SLAM十四讲（第四讲）——李群李代数"></a>视觉SLAM十四讲（第四讲）——李群李代数</h1><h2 id="李群与李代数基础"><a href="#李群与李代数基础" class="headerlink" title="李群与李代数基础"></a>李群与李代数基础</h2><p>三维旋转矩阵构成了特殊的正交群 $SO(3)$,而变换矩阵构成了特殊欧式群$SE(3)$.有如下格式：<br>$$<br>\begin{align*}<br>\mathrm{SO}(3) &amp;&#x3D; { R \in \mathbb{R}^{3 \times 3} \mid RR^T &#x3D; I, \det(R) &#x3D; 1 }, \<br>\mathrm{SE}(3) &amp;&#x3D; \left{ T &#x3D;<br>\begin{bmatrix}<br>R &amp; t \<br>0^T &amp; 1<br>\end{bmatrix} \in \mathbb{R}^{4 \times 4} \mid R \in \mathrm{SO}(3), t \in \mathbb{R}^3 \right}.<br>\end{align*}<br>$$<br>这些旋转矩阵或者变换矩阵对于加法是不封闭的，即任意两个旋转矩阵按照矩阵加法的定义，和不再是一个旋转矩阵。但是他们的乘法是封闭的。对于这种只有一个（良好的）运算的集合，称之为群。</p>
<h3 id="群"><a href="#群" class="headerlink" title="群"></a>群</h3><p>群（Group）是一种集合加上一种运算的的代数结构。把集合记作A，运算记为. 群可以记作$G &#x3D; (A,.)$.群要求满足条件：</p>
<blockquote>
<p>封结幺逆（丰俭由你）</p>
</blockquote>
<ol>
<li>封：两个元素都属于群，乘积也属于群</li>
<li>结：结合律</li>
<li>幺元：群中至少有一个元素，别的元素与其相乘都是自身</li>
<li>逆：对于群中所有的元素，群中至少有一个元素，与其他元素相乘都得到一个固定元素</li>
</ol>
<hr>
<h3 id="李代数的引出"><a href="#李代数的引出" class="headerlink" title="李代数的引出"></a>李代数的引出</h3><blockquote>
<p>反对成矩阵</p>
</blockquote>
<p>$$<br>A^T &#x3D; -A<br>\<br>a_ji &#x3D; -aij<br>\<br>$$</p>
<p>对角线元素为零，对称位置元素互为相反数。</p>
<p>在三维欧几里得空间中，两个向量的叉积运算可以完全等价为一个反对称矩阵和一个向量的乘法来表示。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250820204806939.png" alt="image-20250820204806939" style="zoom:67%;" />

<p>在书中用^表示将一个向量构造成一个反对称矩阵。叉积等价于矩阵乘法。</p>
<p>若$R$是任意旋转矩阵，代表某个相机的旋转，它会随时间连续变化，是时间的函数：$R(t)$</p>
<p>由：$$R(t)R(t)^{T} &#x3D; I$$，对等式两边求导：</p>
<p>$$<br>\dot{R}(t)R(t)^{T} + R(t)\dot{R}(t)^{T} &#x3D; 0<br>\<br>\dot{R}(t)R(t)^{T} &#x3D; -(\dot{R}(t)R(t)^{T})^{T}<br>$$<br>所以，矩阵：$\dot{R}(t)R(t)^{T}$是一个反对称矩阵。根据上面叉积的知识，我们可以找到一个三维向量$\phi(t) \in \mathbb{R}^{3}$​与之对应:<br>$$<br>\dot{\mathbf{R}}(t)\mathbf{R}(t)^{T} &#x3D; \phi(t)^{\wedge}<br>$$<br>等式两边右乘$\mathbf{R}(t)$,由于是正交阵，所以有：<br>$$<br>\dot{\mathbf{R}}(t) &#x3D; \phi(t)^{\wedge}\mathbf{R}(t) &#x3D; \begin{bmatrix} 0 &amp; -\phi_{3} &amp; \phi_{2} \ \phi_{3} &amp; 0 &amp; -\phi_{1} \ -\phi_{2} &amp; \phi_{1} &amp; 0 \end{bmatrix} \mathbf{R}(t)<br>$$<br>可以看到，每次对旋转矩阵求一次导数，只需要左乘一个$\phi(t)^{\wedge}$​即可。</p>
<p>可以把上式子看成一个微分方程，解得：<br>$$<br>\mathbf{R}(t) &#x3D; \exp(\hat{\phi}_{0}t)<br>$$<br>说明：</p>
<ol>
<li>给定某时刻的R，我们就能求出一个$\phi$,它描述了R在局部的导数关系。与R对应的$\phi$ 有什么含义.其实  $\phi$ 正是对应到  $SO(3)$ 上的李代数 $\mathfrak{so}(3)$.</li>
<li>其次，给定某个向量$\phi$时，矩阵指数$\exp(\phi^{\wedge})$如何计算？反之，给定R，能否有相反的运算来计算$\phi$，事实上，这正是李群与李代数之间的指数对数映射。</li>
</ol>
<hr>
<h3 id="李代数定义"><a href="#李代数定义" class="headerlink" title="李代数定义"></a>李代数定义</h3><blockquote>
<p>李代数定义</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250821111930875.png" alt="image-20250821111930875"></p>
<ol>
<li>每个李群都有与之对应的李代数。如上式中**$\phi(t)$就是李代数，$R(t)$就是李群**，李代数描述了李群的局部性质。例如$\mathfrak{so}(3)$就反映了$SO(3)$​的局部导数性质。</li>
<li>两个向量还有李括号运算，表达了两个元素的差异。例如叉积就是一种李括号。</li>
</ol>
<hr>
<h3 id="李代数-mathfrak-so-3"><a href="#李代数-mathfrak-so-3" class="headerlink" title="李代数$\mathfrak{so}(3)$"></a>李代数$\mathfrak{so}(3)$</h3><p>之前提到的$\phi$就是一种李代数。每个$\phi$都可以生成一个反对称矩阵：<br>$$<br>\mathbf{\Phi} &#x3D; \phi^{\wedge} &#x3D; \begin{bmatrix} 0 &amp; -\phi_{3} &amp; \phi_{2} \ \phi_{3} &amp; 0 &amp; -\phi_{1} \ -\phi_{2} &amp; \phi_{1} &amp; 0 \end{bmatrix} \in \mathbb{R}^{3\times3}<br>$$<br>在此定义下，两个向量$\phi_1,\phi_2$的李括号是：<br>$$<br>[\phi_{1}, \phi_{2}] &#x3D; (\mathbf{\Phi}<em>{1}\mathbf{\Phi}</em>{2} - \mathbf{\Phi}<em>{2}\mathbf{\Phi}</em>{1})^{\vee}<br>$$<br>该向量与反对成矩阵是一一对应的，不存在歧义的情况。即$\mathfrak{so}(3)$的元素是三维向量或者三维反对成矩阵，不加区别：<br>$$<br>\mathbf{so}(3) &#x3D; { \phi \in \mathbb{R}^{3}, \mathbf{\Phi} &#x3D; \phi^{\wedge} \in \mathbb{R}^{3\times3} }<br>$$<br>可以看到$\mathfrak{so}(3)$的内容：它们是一个由三维向量组成的集合，每个向量对应一个反对称矩阵，可以用于表达旋转矩阵的倒数，它与R的关系由指数映射给定：<br>$$<br>\mathbf{R}(t) &#x3D; \exp(\phi^{\wedge})<br>$$</p>
<hr>
<h3 id="李代数-mathfrak-se-3"><a href="#李代数-mathfrak-se-3" class="headerlink" title="李代数$\mathfrak{se}(3)$"></a>李代数$\mathfrak{se}(3)$</h3><p>对于$SE(3)$,也有对应李代数$\mathfrak{se}(3)$。位于$\mathbb{R}^6$空间中：<br>$$<br>\mathbf{se}(3) &#x3D; \left{ \boldsymbol{\xi} &#x3D; \begin{bmatrix} \rho \ \phi \end{bmatrix} \in \mathbb{R}^{6}, \rho \in \mathbb{R}^{3}, \phi \in \mathbf{so}(3), \boldsymbol{\xi}^{\wedge} &#x3D; \begin{bmatrix} \phi^{\wedge} &amp; \rho \ \mathbf{0}^{T} &amp; 0 \end{bmatrix} \in \mathbb{R}^{4\times4} \right}<br>$$<br>将每个$\mathfrak{se}(3)$元素记为$ \xi $,这是一个六维向量。前三维表示平移，后三维旋转。同时拓展了^的含义。<strong>使用$\wedge,\vee$​，指代“从向量到矩阵”和”从矩阵到向量“的关系</strong>。</p>
<p>李括号：<br>$$<br>[\boldsymbol{\xi}<em>{1}, \boldsymbol{\xi}</em>{2}] &#x3D; (\hat{\boldsymbol{\xi}}<em>{1}\hat{\boldsymbol{\xi}}</em>{2} - \hat{\boldsymbol{\xi}}<em>{2}\hat{\boldsymbol{\xi}}</em>{1})^{\vee}<br>$$</p>
<hr>
<h2 id="指数与对数映射"><a href="#指数与对数映射" class="headerlink" title="指数与对数映射"></a>指数与对数映射</h2><h3 id="SO-3-上的指数映射"><a href="#SO-3-上的指数映射" class="headerlink" title="$SO(3)$上的指数映射"></a>$SO(3)$上的指数映射</h3><p>指数映射，即$ \exp(\phi^{\wedge})$​的泰勒展开:<br>$$<br>\exp(\phi^{\wedge}) &#x3D; \sum_{n&#x3D;0}^{\infty} \frac{1}{n!} (\phi^{\wedge})^{n}<br>$$<br>简化计算方法，$\phi$是三维向量，可以定义它的模长和方向，分别记为：$\theta,a$于是就有$\phi &#x3D; \theta a$，这里$a$是一个长度为1的方向向量，对于$a^\wedge$,有以下两条性质：<br>$$<br>\mathbf{a}^{\wedge}\mathbf{a}^{\wedge} &#x3D; \begin{bmatrix} -a_{2}^{2} - a_{3}^{2} &amp; a_{1}a_{2} &amp; a_{1}a_{3} \ a_{1}a_{2} &amp; -a_{1}^{2} - a_{3}^{2} &amp; a_{2}a_{3} \ a_{1}a_{3} &amp; a_{2}a_{3} &amp; -a_{1}^{2} - a_{2}^{2} \end{bmatrix} &#x3D; \mathbf{a}\mathbf{a}^{T} - I<br>\<br>\<br>\mathbf{a}^{\wedge}\mathbf{a}^{\wedge}\mathbf{a}^{\wedge} &#x3D; \mathbf{a}^{\wedge}(\mathbf{a}\mathbf{a}^{T} - I) &#x3D; -\mathbf{a}^{\wedge}<br>$$<br>由此提供了$a^ \wedge$的高阶项方法。可以写成：<br>$$<br>\exp(\theta\mathbf{a}^{\wedge}) &#x3D; \cos\theta I + (1 - \cos\theta)\mathbf{a}\mathbf{a}^{T} + \sin\theta\mathbf{a}^{\wedge}<br>$$<br>（具体参考14讲公式4-22）这个和罗德里格斯公式是一样的，说明：$\mathfrak{se}(3)$实际上是由所谓的旋转向量组成的空间。指数映射就是罗德里格斯公式。通过这个就可以把$\mathfrak{se}(3)$中任意一个向量对应到一个位于$SO(3)$中的旋转矩阵。反之定义对数映射，也可以把$SO(3)$中的元素对应到$\mathfrak{se}(3)$中：<br>$$<br>\phi &#x3D; \ln(\mathbf{R})^{\vee} &#x3D; \left( \sum_{n&#x3D;0}^{\infty} \frac{(-1)^{n}}{n+1} (\mathbf{R}-I)^{n+1} \right)^{\vee}<br>$$<br>至于怎么根据对应的旋转矩阵求解李代数，可以利用迹的性质以及特征向量来求旋转角度与旋转轴。具体如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250821161823738.png" alt="image-20250821161823738"></p>
<p>这样就求得了旋转角度，关于转轴，由于$Rn &#x3D; n$说明转轴$n$是矩阵$R$特征值为1对应的特征向量。求解方程，归一化之后即可得到旋转轴。</p>
<p>值得注意的是，指数映射是一个满射并不是单射，意味着在一个李群可以找到一个李代数，但是可能存在多个李代数映射同一个李群。旋转角具有周期性，如果把旋转角固定到±$\pi$​之间那么李群与李代数之间的就是一一对应了。</p>
<h3 id="SE-3-上的指数映射"><a href="#SE-3-上的指数映射" class="headerlink" title="$SE(3)$上的指数映射"></a>$SE(3)$上的指数映射</h3><p>$\mathfrak{se}(3)$上的指数映射形式是：<br>$$<br>\exp(\boldsymbol{\xi}^{\wedge}) &#x3D; \begin{bmatrix} \displaystyle\sum_{n&#x3D;0}^{\infty} \frac{1}{n!} (\phi^{\wedge})^{n} &amp; \displaystyle\sum_{n&#x3D;0}^{\infty} \frac{1}{(n+1)!} (\phi^{\wedge})^{n} \rho \ \mathbf{0}^{T} &amp; 1 \end{bmatrix}<br>\<br>\<br>\triangleq \begin{bmatrix} \mathbf{R} &amp; J\rho \ \mathbf{0}^{T} &amp; 1 \end{bmatrix} &#x3D; \mathbf{T}<br>$$<br>指数映射中：右上角$J$可得出：<br>$$<br>\mathbf{J} &#x3D; \frac{\sin\theta}{\theta} I + \left(1 - \frac{\sin\theta}{\theta}\right) \mathbf{a}\mathbf{a}^{T} + \frac{1 - \cos\theta}{\theta} \mathbf{a}^{\wedge}<br>$$<br>与罗德里格斯公式类似，左上为旋转矩阵，右上为平移部分，是以$J$为稀矩阵的线性变换。具体的转换关系可以由下图展示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20201128193021844.png" alt="李群和李代数以及线性变换相关笔记_李代数的几何意义-CSDN博客"></p>
<h2 id="李代数求导与扰动模型"><a href="#李代数求导与扰动模型" class="headerlink" title="李代数求导与扰动模型"></a>李代数求导与扰动模型</h2><h3 id="BHC公式与近似形式"><a href="#BHC公式与近似形式" class="headerlink" title="BHC公式与近似形式"></a>BHC公式与近似形式</h3><p>使用李代数可以进行优化，在优化中导数是非常有必要的信息，会在非线性优化中使用。</p>
<p>矩阵做乘法时，李代数发生什么变化？并不是简单的加法。即<br>$$<br>\exp(\hat{\phi}<em>{1}^{\wedge}) \exp(\hat{\phi}</em>{2}^{\wedge}) &#x3D; \exp\left( (\phi_{1} + \phi_{2})^{\wedge} \right)<br>$$<br>或者等价于：<br>$$<br>\ln(\exp(\mathbf{A})\exp(\mathbf{B})) &#x3D; \mathbf{A} + \mathbf{B}<br>$$<br>该式在矩阵时<strong>不成立</strong>。两个李代数指数映射乘积的完整形式，由BCH公式给出：<br>$$<br>\ln(\exp(A)\exp(B)) &#x3D; A + B + \frac{1}{2}[A, B] + \frac{1}{12}[A, [A, B]] - \frac{1}{12}[B, [A, B]] + \dots<br>$$<br>其中$[]$​是李括号。这表明，当处理两个矩阵之积时，会产生一些由李括号组成的余项。当$\phi_1 \phi_2$为小量时，小量二次以上的项都可以忽略不计。此时近似为：<br>$$<br>\ln(\exp(\phi_{1}^{\wedge})\exp(\phi_{2}^{\wedge}))^{\vee} \approx \begin{cases} J_{l}(\phi_{2})^{-1}\phi_{1} + \phi_{2} &amp; \text{当}\phi_1\text{为小量,} \ J_{r}(\phi_{1})^{-1}\phi_{2} + \phi_{1} &amp; \text{当}\phi_2\text{为小量.} \end{cases}<br>$$<br>下标$l$就是左乘，下标$r$就是右乘，其中$J$就是之前转换的那个$J$。</p>
<p>如第一个近似：当对一个旋转矩阵$R_2$（李代数为$\phi_2$）左乘一个微小旋转矩阵$R_1$（李代数为$\phi_1$）时，可以近似看作在原有的李代数上加一项$J_1(\phi_2)^-1\phi_1$​.</p>
<p><strong>记忆方法</strong>：</p>
<ol>
<li>小量在哪边，雅可比的下标方向就在哪边</li>
<li>大量进雅可比自变量</li>
<li>最后结果时雅可比乘小量，再加上大量</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250821210325423.png" alt="image-20250821210325423"></p>
<p>这样就可以谈论李群乘法与李代数加法的关系了。其实就是研究两者之间是怎么变换的近似关系的。</p>
<hr>
<h3 id="SO-3-上的李代数求导"><a href="#SO-3-上的李代数求导" class="headerlink" title="$SO(3)$上的李代数求导"></a>$SO(3)$上的李代数求导</h3><p>在SLAM中，要估计一个相机的位置和姿态，该位姿是由$SO(3)$山的旋转矩阵或者$SE(3)$上的变换矩阵描述的。设某个时刻机器人的位姿$T$。观察到世界坐标位于$p$的点,产生了一个观测数据$z$。那么，由坐标变换关系可知：<br>$$<br>\mathbf{z} &#x3D; \mathbf{T}\mathbf{p} + \mathbf{\omega}<br>$$<br>其中$\omega$是随机噪声。所以通常会计算理想的观测与实际数据的误差：<br>$$<br>e &#x3D; \mathbf{z} - \mathbf{T}\mathbf{p}<br>$$<br>假设一共有N个这样的路标点和观测点，于是有N个上式。对于机器人进行位姿估计，相当于寻找一个最优的T，使得整体误差最小化：<br>$$<br>\min_{T} J(T) &#x3D; \sum_{i&#x3D;1}^{N} |\mathbf{z}<em>{i} - T\mathbf{p}</em>{i}|_{2}^{2}<br>$$<br>求解此问题，就需要计算目标函数$J$关于变换矩阵$T$的导数。重要的是，<strong>我们经常构建与位姿有关的函数，然后讨论该函数关于位子的导数，来调整当前的估计值</strong>。我们把$T$当作普通矩阵<strong>处理优化</strong>，就必须要加以约束，李代数有向量组成，具有良好的加法运算，所以使用李代数解决求导问题可以放分为两个思路：</p>
<ol>
<li>用李代数表示姿态，根据李代数加法对李代数求导</li>
<li>对李群左乘或者右乘微小扰动，然后对扰动求导，称为左扰动和右扰动模型。</li>
</ol>
<p>第一种是李代数求导模型，第二种是扰动模型。</p>
<hr>
<h3 id="李代数求导"><a href="#李代数求导" class="headerlink" title="李代数求导"></a>李代数求导</h3><p>考虑$SO(3)$上的情况，假设对于一个空间点$p$进行旋转，得到$Rp$。仙子啊，要计算旋转之后点的坐标相对于旋转的导数，可以暂且记为：<br>$$<br>\frac{\partial(R\mathbf{p})}{\partial R}<br>$$<br>由于$SO(3)$没有加法，所以导数无法正常计算，使用对应的李代数$\phi$计算：<br>$$<br>\frac{\partial(exp(\phi^{\wedge}p))}{\partial \phi}<br>$$<br>推导出旋转以后的点相对于李代数的导数：<br>$$<br>\frac{\partial(\mathbf{R}\mathbf{p})}{\partial\phi} &#x3D; (-\mathbf{R}\mathbf{p})^{\wedge}\mathbf{J}_{l}<br>$$</p>
<h3 id="扰动模型（左乘）"><a href="#扰动模型（左乘）" class="headerlink" title="扰动模型（左乘）"></a>扰动模型（左乘）</h3><p>上述提到的另外一个求导方式是对于R进行一次扰动$\Delta R$，看结果相对于扰动的变化率。可以是左乘也可以是右乘，有些许差异。设左扰动$\Delta R$​对应的李代数是$\varphi$,对其求导：<br>$$<br>\frac{\partial(\mathbf{R}\mathbf{p})}{\partial\boldsymbol{\varphi}} &#x3D; \lim_{\varphi \to 0} \frac{\exp(\varphi^{\wedge})\exp(\mathbf{\phi}^{\wedge})\mathbf{p} - \exp(\mathbf{\phi}^{\wedge})\mathbf{p}}{\varphi}<br>&#x3D; -(Rp)^{\wedge}<br>$$<br>可见，相较于李代数求导，省去一个雅可比的计算，使得扰动模型更为实用。</p>
<hr>
<h3 id="SE-3-上的李代数求导"><a href="#SE-3-上的李代数求导" class="headerlink" title="$SE(3)$上的李代数求导"></a>$SE(3)$上的李代数求导</h3><p>假设，某空间点$p$经过一次变换$T$(对应李代数是$\xi$),得到$Tp$，现在给$T$左乘一个扰动$\Delta T &#x3D; \mathbf{exp}(\delta \xi^\wedge)$,扰动项的李代数是：$\delta \xi &#x3D; [\delta \rho,\delta \phi]^T$。</p>
<p>直接给出扰动模型：<br>$$<br>\frac{\partial(\mathbf{T}\mathbf{p})}{\partial\delta\boldsymbol{\xi}} &#x3D; \lim_{\delta\boldsymbol{\xi} \to 0} \frac{\exp((\delta\boldsymbol{\xi})^{\wedge})\exp(\boldsymbol{\xi}^{\wedge})\mathbf{p} - \exp(\boldsymbol{\xi}^{\wedge})\mathbf{p}}{\delta\boldsymbol{\xi}}<br>\ &#x3D; \begin{bmatrix} \mathbf{I} &amp; -(\mathbf{R}\mathbf{p} + \mathbf{t})^{\wedge} \ \mathbf{0}^{T} &amp; \mathbf{0}^{T} \end{bmatrix} \stackrel{\mathrm{def}}{&#x3D;} (\mathbf{T}\mathbf{p})^{\odot}<br>$$<br>最后一个是运算符，它把一个齐次坐标的空间点变换成一个4x6的矩阵。假设$a,b,x,y$都是列向量，那么在运算符写法下，有：<br>$$<br>\frac{d \begin{bmatrix} a \ b \end{bmatrix}}{d \begin{bmatrix} x \ y \end{bmatrix}} &#x3D; \left( \frac{d[a, b]^{T}}{d \begin{bmatrix} x \ y \end{bmatrix}} \right)^{T} &#x3D; \begin{bmatrix} \frac{da}{dx} &amp; \frac{db}{dx} \ \frac{da}{dy} &amp; \frac{db}{dy} \end{bmatrix}^{T} &#x3D; \begin{bmatrix} \frac{da}{dx} &amp; \frac{da}{dy} \ \frac{db}{dx} &amp; \frac{db}{dy} \end{bmatrix}<br>$$</p>
<h2 id="实践：Sophus"><a href="#实践：Sophus" class="headerlink" title="实践：Sophus"></a>实践：Sophus</h2><h3 id="Sophus的基本使用"><a href="#Sophus的基本使用" class="headerlink" title="Sophus的基本使用"></a>Sophus的基本使用</h3><p>Sophus库支持$SO(3)$和$SE(3)$，是直接在Eigen上开发的，这个库只需要编译，不需要安装。</p>
<blockquote>
<p>使用Sophus</p>
</blockquote>
<ol>
<li>安装fmt</li>
</ol>
<p>首先安装fmt,由于使用的代码使用的是模板库，所以需要安装。</p>
<p>打开终端，可以在文件夹 <code>3rdparty</code>打开终端，这次忘了，懒得改了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/fmtlib/fmt.git</span><br><span class="line">cd fmt</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装Sophus库</li>
</ol>
<p>同样在终端打开：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/strasdat/Sophus.git</span><br><span class="line">cd Sophus</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<p>如果出现报错，可能需要修改一下CMakeLists.txt文件。</p>
<p>安装成功之后，可以测试一下。</p>
<p>新建文件：<code>slambook/ch4/useSophus.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&quot;sophus/se3.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  Matrix3d R = <span class="built_in">AngleAxisd</span>(M_PI / <span class="number">2</span>, <span class="built_in">Vector3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)).<span class="built_in">toRotationMatrix</span>();</span><br><span class="line">  <span class="function">Quaterniond <span class="title">q</span><span class="params">(R)</span></span>;</span><br><span class="line">  <span class="function">Sophus::SO3d <span class="title">SO3_R</span><span class="params">(R)</span></span>;</span><br><span class="line">  <span class="function">Sophus::SO3d <span class="title">SO3_q</span><span class="params">(q)</span></span>;</span><br><span class="line"></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;SO(3) from matrix:\n&quot;</span> &lt;&lt; SO3_R.<span class="built_in">matrix</span>() &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;SO(3) from quaternion:\n&quot;</span> &lt;&lt; SO3_q.<span class="built_in">matrix</span>() &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;they are equal&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  Vector3d so3 = SO3_R.<span class="built_in">log</span>();</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;so3 = &quot;</span> &lt;&lt; so<span class="number">3.</span><span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;so3 hat=\n&quot;</span> &lt;&lt; Sophus::SO3d::<span class="built_in">hat</span>(so3) &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;so3 hat vee= &quot;</span> &lt;&lt; Sophus::SO3d::<span class="built_in">vee</span>(Sophus::SO3d::<span class="built_in">hat</span>(so3)).<span class="built_in">transpose</span>() &lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">  <span class="function">Vector3d <span class="title">update_so3</span><span class="params">(<span class="number">1e-4</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">  Sophus::SO3d SO3_updated = Sophus::SO3d::<span class="built_in">exp</span>(update_so3) * SO3_R;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;SO3 updated = \n&quot;</span> &lt;&lt; SO3_updated.<span class="built_in">matrix</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写CmakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line">project(useSophus)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为使用 sophus，需要使用find_package命令找到它</span></span><br><span class="line">find_package(Sophus REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Eigen</span></span><br><span class="line">include_directories(<span class="string">&quot;/usr/include/eigen3&quot;</span>)</span><br><span class="line">add_executable(useSophus useSophus.cpp)</span><br><span class="line">target_link_libraries(useSophus Sophus::Sophus)</span><br></pre></td></tr></table></figure>

<p>在终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch4/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch4/build</span><br><span class="line">hita@hita-vm:~/slambook/ch4/build$ make </span><br><span class="line">[100%] Built target useSophus</span><br><span class="line">hita@hita-vm:~/slambook/ch4/build$ ./useSophus </span><br><span class="line">SO(3) from matrix:</span><br><span class="line">2.22045e-16          -1           0</span><br><span class="line">          1 2.22045e-16           0</span><br><span class="line">          0           0           1</span><br><span class="line">SO(3) from quaternion:</span><br><span class="line">2.22045e-16          -1           0</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="例子：评估轨迹的误差"><a href="#例子：评估轨迹的误差" class="headerlink" title="例子：评估轨迹的误差"></a>例子：评估轨迹的误差</h3><p>在实际工程中，需要评估一个算法的估计轨迹与真实轨迹的差异来评价算法的精度。现在来计算两条轨迹的误差。有很多种误差评估指标，<strong>如绝对轨迹误差</strong>，每个位姿李代数的<strong>均方根误差</strong>，还有<strong>绝对平移误差</strong>等。利用Sophus库，可以实现计算。分别有<code>groundtruth.txt</code>和<code>estimated.txt</code>两条轨迹,计算误差，显示到3D窗口。</p>
<p>新建文件：<code>slambook/ch4/examples/trajectoryError.cpp</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;pangolin/pangolin.h&gt;</span><br><span class="line">#include &lt;sophus/se3.hpp&gt;</span><br><span class="line"></span><br><span class="line">using namespace Sophus;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">string groundtruth_file = &quot;../../examples/groundtruth.txt&quot;;</span><br><span class="line">string estimated_file = &quot;../../examples/estimated.txt&quot;;</span><br><span class="line"></span><br><span class="line">typedef vector&lt;Sophus::SE3d, Eigen::aligned_allocator&lt;Sophus::SE3d&gt;&gt; TrajectoryType;</span><br><span class="line"></span><br><span class="line">void DrawTrajectory(const TrajectoryType &amp;gt, const TrajectoryType &amp;esti);</span><br><span class="line"></span><br><span class="line">TrajectoryType ReadTrajectory(const string &amp;path);</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">  TrajectoryType groundtruth = ReadTrajectory(groundtruth_file);</span><br><span class="line">  TrajectoryType estimated = ReadTrajectory(estimated_file);</span><br><span class="line">  assert(!groundtruth.empty() &amp;&amp; !estimated.empty());</span><br><span class="line">  assert(groundtruth.size() == estimated.size());</span><br><span class="line"></span><br><span class="line">  // compute rmse</span><br><span class="line">  double rmse = 0;</span><br><span class="line">  for (size_t i = 0; i &lt; estimated.size(); i++) &#123;</span><br><span class="line">    Sophus::SE3d p1 = estimated[i], p2 = groundtruth[i];</span><br><span class="line">    double error = (p2.inverse() * p1).log().norm();</span><br><span class="line">    rmse += error * error;</span><br><span class="line">  &#125;</span><br><span class="line">  rmse = rmse / double(estimated.size());</span><br><span class="line">  rmse = sqrt(rmse);</span><br><span class="line">  cout &lt;&lt; &quot;RMSE = &quot; &lt;&lt; rmse &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  DrawTrajectory(groundtruth, estimated);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TrajectoryType ReadTrajectory(const string &amp;path) &#123;</span><br><span class="line">  ifstream fin(path);</span><br><span class="line">  TrajectoryType trajectory;</span><br><span class="line">  if (!fin) &#123;</span><br><span class="line">    cerr &lt;&lt; &quot;trajectory &quot; &lt;&lt; path &lt;&lt; &quot; not found.&quot; &lt;&lt; endl;</span><br><span class="line">    return trajectory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  while (!fin.eof()) &#123;</span><br><span class="line">    double time, tx, ty, tz, qx, qy, qz, qw;</span><br><span class="line">    fin &gt;&gt; time &gt;&gt; tx &gt;&gt; ty &gt;&gt; tz &gt;&gt; qx &gt;&gt; qy &gt;&gt; qz &gt;&gt; qw;</span><br><span class="line">    Sophus::SE3d p1(Eigen::Quaterniond(qw, qx, qy, qz), Eigen::Vector3d(tx, ty, tz));</span><br><span class="line">    trajectory.push_back(p1);</span><br><span class="line">  &#125;</span><br><span class="line">  return trajectory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void DrawTrajectory(const TrajectoryType &amp;gt, const TrajectoryType &amp;esti) &#123;</span><br><span class="line">  // create pangolin window and plot the trajectory</span><br><span class="line">  pangolin::CreateWindowAndBind(&quot;Trajectory Viewer&quot;, 1024, 768);</span><br><span class="line">  glEnable(GL_DEPTH_TEST);</span><br><span class="line">  glEnable(GL_BLEND);</span><br><span class="line">  glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">  pangolin::OpenGlRenderState s_cam(</span><br><span class="line">      pangolin::ProjectionMatrix(1024, 768, 500, 500, 512, 389, 0.1, 1000),</span><br><span class="line">      pangolin::ModelViewLookAt(0, -0.1, -1.8, 0, 0, 0, 0.0, -1.0, 0.0)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  pangolin::View &amp;d_cam = pangolin::CreateDisplay()</span><br><span class="line">      .SetBounds(0.0, 1.0, pangolin::Attach::Pix(175), 1.0, -1024.0f / 768.0f)</span><br><span class="line">      .SetHandler(new pangolin::Handler3D(s_cam));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  while (pangolin::ShouldQuit() == false) &#123;</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    d_cam.Activate(s_cam);</span><br><span class="line">    glClearColor(1.0f, 1.0f, 1.0f, 1.0f);</span><br><span class="line"></span><br><span class="line">    glLineWidth(2);</span><br><span class="line">    for (size_t i = 0; i &lt; gt.size() - 1; i++) &#123;</span><br><span class="line">      glColor3f(0.0f, 0.0f, 1.0f);  // blue for ground truth</span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      auto p1 = gt[i], p2 = gt[i + 1];</span><br><span class="line">      glVertex3d(p1.translation()[0], p1.translation()[1], p1.translation()[2]);</span><br><span class="line">      glVertex3d(p2.translation()[0], p2.translation()[1], p2.translation()[2]);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (size_t i = 0; i &lt; esti.size() - 1; i++) &#123;</span><br><span class="line">      glColor3f(1.0f, 0.0f, 0.0f);  // red for estimated</span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      auto p1 = esti[i], p2 = esti[i + 1];</span><br><span class="line">      glVertex3d(p1.translation()[0], p1.translation()[1], p1.translation()[2]);</span><br><span class="line">      glVertex3d(p2.translation()[0], p2.translation()[1], p2.translation()[2]);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    pangolin::FinishFrame();</span><br><span class="line">    usleep(5000);   // sleep 5 ms</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建CMakeLists.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line">project(trajectoryError)</span><br><span class="line"></span><br><span class="line">option(USE_UBUNTU_20 &quot;Set to ON if you are using Ubuntu 20.04&quot; OFF)</span><br><span class="line">find_package(Pangolin REQUIRED)</span><br><span class="line">if(USE_UBUNTU_20)</span><br><span class="line">    message(&quot;You are using Ubuntu 20.04, fmt::fmt will be linked&quot;)</span><br><span class="line">    find_package(fmt REQUIRED)</span><br><span class="line">    set(FMT_LIBRARIES fmt::fmt)</span><br><span class="line">endif()</span><br><span class="line">include_directories($&#123;Pangolin_INCLUDE_DIRS&#125;)</span><br><span class="line">add_executable(trajectoryError trajectoryError.cpp)</span><br><span class="line">target_link_libraries(trajectoryError $&#123;Pangolin_LIBRARIES&#125; $&#123;FMT_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure>

<p>记得把源代码中的两个轨迹保存到<code>slambook/ch4/examples/</code></p>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch4/examples/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch4/examples/build</span><br><span class="line">hita@hita-vm:~/slambook/ch4/examples/build$ make</span><br><span class="line">[100%] Built target trajectoryError</span><br><span class="line">hita@hita-vm:~/slambook/ch4/examples/build$ ./trajectoryError </span><br><span class="line">RMSE = 2.20728</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250822155141451.png" alt="image-20250822155141451"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/08/20/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%B8%89%E8%AE%B2%EF%BC%89%E2%80%94%E2%80%94%E4%B8%89%E7%BB%B4%E5%88%9A%E4%BD%93%E8%BF%90%E5%8A%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/20/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%B8%89%E8%AE%B2%EF%BC%89%E2%80%94%E2%80%94%E4%B8%89%E7%BB%B4%E5%88%9A%E4%BD%93%E8%BF%90%E5%8A%A8/" class="post-title-link" itemprop="url">第三讲-三位刚体运动</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-08-20 00:00:00 / 修改时间：19:57:49" itemprop="dateCreated datePublished" datetime="2025-08-20T00:00:00+08:00">2025-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2/" itemprop="url" rel="index"><span itemprop="name">视觉SLAM十四讲</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="视觉SLAM十四讲（第三讲）——三维刚体运动"><a href="#视觉SLAM十四讲（第三讲）——三维刚体运动" class="headerlink" title="视觉SLAM十四讲（第三讲）——三维刚体运动"></a>视觉SLAM十四讲（第三讲）——三维刚体运动</h1><h2 id="旋转矩阵"><a href="#旋转矩阵" class="headerlink" title="旋转矩阵"></a>旋转矩阵</h2><h3 id="点、向量和坐标系"><a href="#点、向量和坐标系" class="headerlink" title="点、向量和坐标系"></a>点、向量和坐标系</h3><p>前面基础知识跳过</p>
<p><strong>向量内积</strong></p>
<p>公式如下<br>$$<br>a⋅b&#x3D;a<br>T<br> b&#x3D;<br>i&#x3D;1<br>∑<br>3<br>​<br> a<br>i<br>​<br> b<br>i<br>​<br> &#x3D;∣a∣∣b∣cos⟨a,b⟩<br>$$<br>内积可以描述向量间的投影关系，其中$$ &lt;a,b&gt;$$ 表示向量夹角。</p>
<p><strong>向量外积</strong><br>$$<br>\boldsymbol{a} \times \boldsymbol{b} &#x3D; \begin{vmatrix}<br>\boldsymbol{e}_1 &amp; \boldsymbol{e}_2 &amp; \boldsymbol{e}_3 <br>a_1 &amp; a_2 &amp; a_3 <br>b_1 &amp; b_2 &amp; b_3<br>\end{vmatrix} &#x3D; \begin{bmatrix}<br>a_2b_3 - a_3b_2 <br>a_3b_1 - a_1b_3 <br>a_1b_2 - a_2b_1<br>\end{bmatrix} &#x3D; \begin{bmatrix}<br>0 &amp; -a_3 &amp; a_2 <br>a_3 &amp; 0 &amp; -a_1 <br>-a_2 &amp; a_1 &amp; 0<br>\end{bmatrix} \boldsymbol{b} \triangleq \boldsymbol{a}^\land \boldsymbol{b}<br>$$<br>外积的结果是一个向量，方向垂直两个向量，大小是$|a||b|sin&lt;a,b&gt;$ 是两个向量张成的四边形的有向面积.对于外积运算引入$∧$,是一个反对成符号。<br>$$<br>a ∧ &#x3D;<br>\begin{bmatrix}<br>0 &amp; -a_3 &amp; a_2 \<br>a_3 &amp; 0 &amp; -a_1 \<br>-a_2 &amp; a_1 &amp; 0<br>\end{bmatrix}<br>$$</p>
<h3 id="坐标系间的欧氏变换"><a href="#坐标系间的欧氏变换" class="headerlink" title="坐标系间的欧氏变换"></a>坐标系间的欧氏变换</h3><p>旋转矩阵有一些特别的性质。它是一个行列式为1的正交矩阵。所以将$n$维旋转矩阵的集合定义为：<br>$$<br>\text{SO}(n)&#x3D;{ \boldsymbol{R} \in \mathbb{R}^{n \times n} \mid \boldsymbol{R}\boldsymbol{R}^{\text{T}} &#x3D; \boldsymbol{I}, \det(\boldsymbol{R}) &#x3D; 1 }<br>$$<br>so{n}是特殊正交群的意思（Special Orthogonal Group）。这个集合由n维空间的旋转矩阵组成，n&#x3D;3即三维空间的旋转矩阵。</p>
<p>$R_{12}$是指把坐标系2的向量变换到坐标系1，而平移$t_{12}$是指在坐标系1下取的坐标，即从1指向2的向量在坐标系1下的坐标。</p>
<h3 id="变换矩阵与齐次变换"><a href="#变换矩阵与齐次变换" class="headerlink" title="变换矩阵与齐次变换"></a>变换矩阵与齐次变换</h3><p>对于变换矩阵$T$,它具有比较特别的结构，左上角为旋转矩阵，右侧为平移向量，左下角为0向量，右下角为1.这种矩阵又称为特殊欧式群（Special Euclidean Group）<br>$$<br>\mathrm{SE}(3)&#x3D;\left{ \boldsymbol{T}&#x3D;\begin{bmatrix} \boldsymbol{R} &amp; \boldsymbol{t} \ \boldsymbol{0}^{\mathrm{T}} &amp; 1 \end{bmatrix} \in \mathbb{R}^{4\times4} \mid \boldsymbol{R} \in \mathrm{SO}(3), \boldsymbol{t} \in \mathbb{R}^3 \right}<br>$$<br>用$T_{12}$表示从2到1的变换。总的来说，坐标系之间的运动由欧式变换描述，由平移和旋转组成，旋转可以由旋转矩阵$SO(3)$描述，平移直接由一个$ \mathbb{R}^3$向量描述，最后，如果将平移与旋转放在一个矩阵中，就形成了变换矩阵$SE(3)$.</p>
<hr>
<h2 id="实践：Eigen"><a href="#实践：Eigen" class="headerlink" title="实践：Eigen"></a>实践：Eigen</h2><p>Eigen是一个开源的线性代数库，提供快速的有关矩阵的线性代数运算，下面是eigen3的官方文档链接：</p>
<p><a target="_blank" rel="noopener" href="https://libeigen.gitlab.io/eigen/docs-nightly/"> Eigen: Main Page</a></p>
<p>输入以下命令安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libeigen3-dev</span><br></pre></td></tr></table></figure>

<p>一个库由头文件以及库文件组成，其中Eigen头文件所在位置可以通过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo updatedb</span><br><span class="line">locate eigen3 | grep include</span><br></pre></td></tr></table></figure>

<p>存放在：<code>/usr/include/eigen3/</code>中</p>
<p>与其他库相比，Eigen是一个纯用头文件搭建的库，意味着只能找到它的头文件没有类似.so或者.a的二进制文件，只需要引入Eigen头文件即可使用。不需要链接库文件。可以写一段代码来实际练习EIgen:</p>
<p>新建文件：<code>slambook/ch3/useEigen/eigenMatrix.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Dense&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_SIZE 50</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    Matrix&lt;<span class="type">float</span>, <span class="number">2</span>, <span class="number">3</span>&gt; matrix_23;</span><br><span class="line">    Vector3d v_3d;</span><br><span class="line">    Matrix&lt;<span class="type">float</span>, <span class="number">3</span>, <span class="number">1</span>&gt; vd_3d;</span><br><span class="line">    Matrix3d matrix_33 = Matrix3d::<span class="built_in">Zero</span>();</span><br><span class="line">    Matrix&lt;<span class="type">double</span>, Dynamic, Dynamic&gt; matrix_dynamic;</span><br><span class="line">    MatrixXd matrix_x;</span><br><span class="line"></span><br><span class="line">    matrix_23 &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;matrix 2x3 from 1 to 6: \n&quot;</span> &lt;&lt; matrix_23 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;print matrix 2x3: &quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) cout &lt;&lt; <span class="built_in">matrix_23</span>(i, j) &lt;&lt; <span class="string">&quot;\t&quot;</span>;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v_3d &lt;&lt; <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>;</span><br><span class="line">    vd_3d &lt;&lt; <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    Matrix&lt;<span class="type">double</span>, <span class="number">2</span>, <span class="number">1</span>&gt; result = matrix_<span class="number">23.</span><span class="built_in">cast</span>&lt;<span class="type">double</span>&gt;() * v_3d;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;[1,2,3;4,5,6]*[3,2,1]=&quot;</span> &lt;&lt; result.<span class="built_in">transpose</span>() &lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    Matrix&lt;<span class="type">float</span>, <span class="number">2</span>,<span class="number">1</span>&gt; result2 = matrix_23 * vd_3d;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;[1,2,3;4,5,6]*[4,5,6]=&quot;</span> &lt;&lt; result<span class="number">2.</span><span class="built_in">transpose</span>() &lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    matrix_33 = Matrix3d::<span class="built_in">Random</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;random matrix: \n&quot;</span> &lt;&lt; matrix_33 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;transpose: \n&quot;</span> &lt;&lt; matrix_<span class="number">33.</span><span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;sum: &quot;</span> &lt;&lt; matrix_<span class="number">33.</span><span class="built_in">sum</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;tracd: &quot;</span> &lt;&lt; matrix_<span class="number">33.</span><span class="built_in">trace</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;times 10: \n&quot;</span> &lt;&lt; <span class="number">10</span> * matrix_33 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;inverse: \n&quot;</span> &lt;&lt; matrix_<span class="number">33.</span><span class="built_in">inverse</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;det: &quot;</span> &lt;&lt; matrix_<span class="number">33.</span><span class="built_in">determinant</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">SelfAdjointEigenSolver&lt;Matrix3d&gt; <span class="title">eigen_solver</span><span class="params">(matrix_<span class="number">33.</span>transpose() * matrix_33)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Eigen values = \n&quot;</span> &lt;&lt; eigen_solver.<span class="built_in">eigenvalues</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Eigen vactors = \n&quot;</span> &lt;&lt; eigen_solver.<span class="built_in">eigenvectors</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Matrix&lt;<span class="type">double</span>, MATRIX_SIZE, MATRIX_SIZE&gt; matrix_NN</span><br><span class="line">        = MatrixXd::<span class="built_in">Random</span>(MATRIX_SIZE, MATRIX_SIZE);</span><br><span class="line">    matrix_NN = matrix_NN * matrix_NN.<span class="built_in">transpose</span>();</span><br><span class="line">    Matrix&lt;<span class="type">double</span>, MATRIX_SIZE, <span class="number">1</span>&gt; v_Nd = MatrixXd:: <span class="built_in">Random</span>(MATRIX_SIZE, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">clock_t</span> time_stt = <span class="built_in">clock</span>();</span><br><span class="line">    Matrix&lt;<span class="type">double</span>, MATRIX_SIZE, <span class="number">1</span>&gt; x = matrix_NN.<span class="built_in">inverse</span>() * v_Nd;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;time of normal inverse is &quot;</span> </span><br><span class="line">         &lt;&lt; <span class="number">1000</span> * (<span class="built_in">clock</span>() - time_stt) /(<span class="type">double</span>) CLOCKS_PER_SEC &lt;&lt; <span class="string">&quot;ms&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x.<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    time_stt = <span class="built_in">clock</span>();</span><br><span class="line">    x = matrix_NN.<span class="built_in">colPivHouseholderQr</span>().<span class="built_in">solve</span>(v_Nd);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;time of QR decomposition is &quot;</span> </span><br><span class="line">         &lt;&lt; <span class="number">1000</span> * (<span class="built_in">clock</span>() - time_stt) /(<span class="type">double</span>) CLOCKS_PER_SEC &lt;&lt; <span class="string">&quot;ms&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x.<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    time_stt = <span class="built_in">clock</span>();</span><br><span class="line">    x = matrix_NN.<span class="built_in">ldlt</span>().<span class="built_in">solve</span>(v_Nd);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;time of ldlt decomposition is &quot;</span> </span><br><span class="line">         &lt;&lt; <span class="number">1000</span> * (<span class="built_in">clock</span>() - time_stt) /(<span class="type">double</span>) CLOCKS_PER_SEC &lt;&lt; <span class="string">&quot;ms&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x.<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编辑CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 2.8)</span><br><span class="line">project(useEigen)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">include_directories( <span class="string">&quot;/usr/include/eigen3&quot;</span> )</span><br><span class="line">add_executable(eigenMatrix eigenMatrix.cpp)</span><br></pre></td></tr></table></figure>

<p>在终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch3/useEigen/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch3/useEigen/build</span><br><span class="line">hita@hita-vm:~/slambook/ch3/useEigen/build$ make</span><br><span class="line">[100%] Built target eigenMatrix</span><br><span class="line">hita@hita-vm:~/slambook/ch3/useEigen/build$ ./eigenMatrix </span><br><span class="line">matrix 2x3 from 1 to 6: </span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">print matrix 2x3: </span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>编译之后即可输出结果。</p>
<hr>
<h2 id="旋转向量与欧拉角"><a href="#旋转向量与欧拉角" class="headerlink" title="旋转向量与欧拉角"></a>旋转向量与欧拉角</h2><h3 id="旋转向量"><a href="#旋转向量" class="headerlink" title="旋转向量"></a>旋转向量</h3><blockquote>
<p>旋转向量</p>
</blockquote>
<p>方向与旋转轴一致，向量长度来表示旋转角度。对于变换矩阵，使用一个旋转向量和一个平移向量来表示一次变换。这样就不再冗余。</p>
<blockquote>
<p>罗德里格斯旋转公式</p>
</blockquote>
<h1 id="vrot"><a href="#vrot" class="headerlink" title="$$vrot"></a>$$<br>v<br>r<br>o<br>t</h1><p>cos<br>θ<br>v<br>+<br>(<br>1<br>−<br>cos<br>θ<br>)<br>(<br>k<br>⋅<br>v<br>)<br>k<br>+<br>sin<br>θ<br>k<br>×<br>v<br>$$</p>
<p>附上一张图片：</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Orthogonal_decomposition_unit_vector_rodrigues_rotation_formula.svg/350px-Orthogonal_decomposition_unit_vector_rodrigues_rotation_formula.svg.png" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/1903168-20200217220414404-1389795950.png" alt="向量的分解图示"></p>
<p>其中v是三维向量，k是与旋转轴同向的单位向量，θ是v绕着k的右手方向旋转角度。vrot表示旋转之后的向量。</p>
<h1 id="矩阵形式-vrot"><a href="#矩阵形式-vrot" class="headerlink" title="矩阵形式$$vrot"></a><strong>矩阵形式</strong><br>$$<br>v<br>r<br>o<br>t</h1><h1 id="Rv-其中R是旋转矩阵，表示如下：-R"><a href="#Rv-其中R是旋转矩阵，表示如下：-R" class="headerlink" title="Rv$$其中R是旋转矩阵，表示如下：$$R"></a>R<br>v<br>$$<br>其中R是旋转矩阵，表示如下：<br>$$<br>R</h1><h1 id="cosθI-1−cosθ-kkT-sinθk∧-其中I表示单位矩阵，K表示旋转向量，k-表示由k得到的反对成矩阵，-R"><a href="#cosθI-1−cosθ-kkT-sinθk∧-其中I表示单位矩阵，K表示旋转向量，k-表示由k得到的反对成矩阵，-R" class="headerlink" title="cosθI+(1−cosθ)kkT+sinθk∧$$其中I表示单位矩阵，K表示旋转向量，k^表示由k得到的反对成矩阵，$$R"></a>cos<br>θ<br>I<br>+<br>(<br>1<br>−<br>cos<br>θ<br>)<br>k<br>k<br>T<br>+<br>sin<br>θ<br>k<br>∧<br>$$<br>其中I表示单位矩阵，K表示旋转向量，k^表示由k得到的反对成矩阵，<br>$$<br>R</h1><p>I<br>+<br>(<br>sin<br>θ<br>)<br>K<br>+<br>(<br>1<br>−<br>cos<br>θ<br>)<br>K<br>2<br>$$<br>其中K，表示旋转向量生成的反对成矩阵。</p>
<p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1DF411s7sn/?spm_id_from=333.337.search-card.all.click&vd_source=f241df170c33a3be666ec10b59feb689">罗德里格斯公式推导_哔哩哔哩_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wtyuan/p/12324495.html">罗德里格斯旋转公式（Rodrigues’ rotation formula）推导 - wtyuan - 博客园</a></p>
<p>符号∧是向量到反对称矩阵的转换符。反之，我们也可以计算从一个旋转矩阵到旋转向量的转换。对于转角 θ，取两边的迹，有<br>$$<br>\begin{aligned}\operatorname{tr}(R)&amp;&#x3D;\cos\theta\operatorname{tr}(\boldsymbol{I})+(1-\cos\theta)\operatorname{tr}(\boldsymbol{k}\boldsymbol{k}^\mathrm{T})+\sin\theta\operatorname{tr}(\boldsymbol{k}^\wedge)\&amp;\mathrm{.}\&amp;&#x3D;1+2\cos\theta\end{aligned}<br>$$<br>得到：<br>$$<br>\theta&#x3D;\arccos\left(\frac{\operatorname{tr}(\boldsymbol{R})-1}{2}\right)<br>$$<br>旋转轴上的向量在旋转后不发生改变，说明：<br>$$<br>Rn &#x3D; n<br>$$</p>
<hr>
<h3 id="欧拉角"><a href="#欧拉角" class="headerlink" title="欧拉角"></a>欧拉角</h3><p>三个转角：</p>
<ol>
<li>绕物体的Z轴旋转，得到偏航角(yaw)</li>
<li>绕旋转之后的Y轴旋转，得到俯仰角(pitch)</li>
<li>绕旋转之后的X轴旋转，得到滚转角(roll)</li>
</ol>
<p>此时可以通过[r,p,y]T这样一个三维向量描述任意旋转，rpy角的旋转顺序是ZYX.</p>
<blockquote>
<p>万向锁</p>
</blockquote>
<p>欧拉角的一个重大问题就是会碰到万向锁问题，只有使用动态的欧拉角才会出现万向锁问题（绕物体坐标系的三个轴旋转），当第二次转动的角度为±90°的时候，第一次转动与第二次转动其实为绕同一个轴转动，所以在SLAM中很少用欧拉角来表示姿态。</p>
<hr>
<h2 id="四元数"><a href="#四元数" class="headerlink" title="四元数"></a>四元数</h2><h3 id="四元数定义"><a href="#四元数定义" class="headerlink" title="四元数定义"></a>四元数定义</h3><p>四元数是由实数加上三个元素i, j, k 组成，具有如下关系：</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/104e96d68f7752e8741c1558bc33e99c5db2e0a5" alt="{\displaystyle i^{2}&#x3D;j^{2}&#x3D;k^{2}&#x3D;ijk&#x3D;-1\,}"></p>
<p>每个四元数都是1， i， j,  k 的线性组合，可以用单位四元数表示三维空间的任意一个旋转。</p>
<p>三个虚部满足如下关系：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250819201107925.png" alt="image-20250819201107925"></p>
<p><strong>四元数中乘i是绕i轴旋转180°，与复数中有所不同。</strong></p>
<hr>
<h3 id="四元数的运算"><a href="#四元数的运算" class="headerlink" title="四元数的运算"></a>四元数的运算</h3><p>四元数同样由四则运算，这里不多介绍，值得注意的是，四元数的乘法通常是不可交换的。共轭是把虚部取负号。四元数和自己的逆的乘积为实四元数1。其他的详细可参考：</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/%E5%9B%9B%E5%85%83%E6%95%B8">四元数 - 维基百科，自由的百科全书</a></p>
<h3 id="用四元数表示旋转"><a href="#用四元数表示旋转" class="headerlink" title="用四元数表示旋转"></a>用四元数表示旋转</h3><p>首先把三维空间点用一个虚四元数来表述：<br>$$<br>p &#x3D; [0, x, y, z]T &#x3D; [0, v]T<br>$$<br>相当于把四元数的三个虚部与空间中的三个轴相对应。那么旋转后的点 p’ 可以表示为这样的乘积：<br>$$<br>P^{\prime}&#x3D;qpq^{-1}<br>$$<br>结果也是四元数，把虚部取出来，即为旋转之后点的坐标。</p>
<h3 id="四元数到其他旋转表示的转换"><a href="#四元数到其他旋转表示的转换" class="headerlink" title="四元数到其他旋转表示的转换"></a>四元数到其他旋转表示的转换</h3><p>任意四元数描述了一个旋转，旋转可以用旋转矩阵或者旋转向量表示。四元数乘法可以有一种矩阵的乘法表示：<br>$$<br>q &#x3D; [s, v]^T<br>$$<br>定义如下符号：<br>$$<br>\left.q^+&#x3D;\left[\begin{array}{cc}s&amp;-v^\mathrm{T}\\v&amp;s\boldsymbol{I}+\boldsymbol{v}^\wedge\end{array}\right.\right]<br>$$</p>
<p>$$<br>q^\oplus&#x3D;\begin{bmatrix}s&amp;-v^\mathrm{T}\\v&amp;s\boldsymbol{I}-\boldsymbol{v}^\mathrm{T}\end{bmatrix}<br>$$</p>
<p>这两个符号将四元数映射为一个4x4的矩阵，于是四元数乘法可以写成矩阵形式：<br>$$<br>\left.q_1^+q_2&#x3D;\left[\begin{array}{cc}s_1&amp;-\boldsymbol{v}_1^T\\\boldsymbol{v}_1&amp;s_1\boldsymbol{I}+\boldsymbol{v}_1^\wedge\end{array}\right.\right]\begin{bmatrix}s_2\\\boldsymbol{v}_2\end{bmatrix}&#x3D;\begin{bmatrix}-\boldsymbol{v}_1^T\boldsymbol{v}_2+s_1s_2\\s_1\boldsymbol{v}_2+s_2\boldsymbol{v}_1+\boldsymbol{v}_1^\wedge\boldsymbol{v}_2\end{bmatrix}&#x3D;\boldsymbol{q}_1\boldsymbol{q}_2<br>$$<br>同理可得:<br>$$<br>q_1q_2&#x3D;q_1^+q_2&#x3D;q_2^\oplus q_1<br>$$<br>则有：<br>$$<br>\begin{aligned}p^{\prime}&amp;&#x3D;qpq^{-1}&#x3D;q^+p^+q^{-1}\&amp;&#x3D;q^+q^{-1}\oplus p\end{aligned}<br>$$<br>四元数到旋转向量的转换公式：<br>$$<br>\begin{cases}<br>\theta &#x3D; 2 \arccos q_0 \<br>[n_x, n_y, n_z]^\mathrm{T} &#x3D; \frac{[q_1, q_2, q_3]^\mathrm{T}}{\sin\frac{\theta}{2}}<br>\end{cases}<br>$$</p>
<hr>
<h2 id="相似、仿射、射影变换"><a href="#相似、仿射、射影变换" class="headerlink" title="相似、仿射、射影变换"></a>相似、仿射、射影变换</h2><h3 id="相似变换"><a href="#相似变换" class="headerlink" title="相似变换"></a>相似变换</h3><p>允许物体进行均匀放缩。三维相似变换的集合也被叫做相似变换群，记为$Sim(3)$</p>
<h3 id="仿射变换"><a href="#仿射变换" class="headerlink" title="仿射变换"></a>仿射变换</h3><p>该变换只要求A是一个可逆矩阵，不必是正交矩阵，经过仿射变换后，立方体不再是方的，但是各个面仍然是平行四边形。</p>
<h3 id="射影变换"><a href="#射影变换" class="headerlink" title="射影变换"></a>射影变换</h3><p>从真实世界到相机照片的变换是一个射影变换。</p>
<hr>
<h2 id="实践：Eigen几何模块"><a href="#实践：Eigen几何模块" class="headerlink" title="实践：Eigen几何模块"></a>实践：Eigen几何模块</h2><h3 id="Eigen几何模块的数据演示"><a href="#Eigen几何模块的数据演示" class="headerlink" title="Eigen几何模块的数据演示"></a>Eigen几何模块的数据演示</h3><p>新建文件：<code>slambook/ch3/useGeometry/useGeometry.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    Matrix3d rotation_matrix = Matrix3d::<span class="built_in">Identity</span>();</span><br><span class="line">    <span class="function">AngleAxisd <span class="title">rotation_vector</span><span class="params">(M_PI / <span class="number">4</span>, Vector3d(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>))</span></span>;</span><br><span class="line">    cout.<span class="built_in">precision</span>(<span class="number">3</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;rotation matrix = \n &quot;</span> &lt;&lt; rotation_vector.<span class="built_in">matrix</span>() &lt;&lt; endl;</span><br><span class="line">    rotation_matrix = rotation_vector.<span class="built_in">toRotationMatrix</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">Vector3d <span class="title">v</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    Vector3d v_rotated  = rotation_matrix * v;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(1, 0, 0) after rotation (by angle axis) = &quot;</span> &lt;&lt; v_rotated.<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Vector3d euler_angles = rotation_matrix.<span class="built_in">eulerAngles</span>(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;yaw pitch roll = &quot;</span> &lt;&lt; euler_angles.<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line">    Isometry3d T = Isometry3d::<span class="built_in">Identity</span>();</span><br><span class="line">    T.<span class="built_in">rotate</span>(rotation_vector);</span><br><span class="line">    T.<span class="built_in">pretranslate</span>(<span class="built_in">Vector3d</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Transform matrix = \n&quot;</span> &lt;&lt; T.<span class="built_in">matrix</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Vector3d v_transformed = T * v;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;v transformed = &quot;</span> &lt;&lt; v_transformed.<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    Quaterniond q = <span class="built_in">Quaterniond</span>(rotation_vector);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;quaternion from rotation vector = &quot;</span> &lt;&lt; q.<span class="built_in">coeffs</span>().<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line">    q = <span class="built_in">Quaterniond</span>(rotation_matrix);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;quaternion from rotation matrix = &quot;</span> &lt;&lt; q.<span class="built_in">coeffs</span>().<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    v_rotated = q * v;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(1, 0, 0) after rotation = &quot;</span> &lt;&lt; v_rotated.<span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required( VERSION 2.8 )</span><br><span class="line">project( geometry )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加Eigen头文件</span></span><br><span class="line">include_directories( <span class="string">&quot;/usr/include/eigen3&quot;</span> )</span><br><span class="line"></span><br><span class="line">add_executable(eigenGeometry useGeometry.cpp)</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch3/useGeometry$ mkdir build</span><br><span class="line">hita@hita-vm:~/slambook/ch3/useGeometry$ cd build</span><br><span class="line">hita@hita-vm:~/slambook/ch3/useGeometry/build$ cmake ..</span><br><span class="line">-- The C compiler identification is GNU 9.4.0</span><br><span class="line">-- The CXX compiler identification is GNU 9.4.0</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch3/useGeometry/build</span><br><span class="line">hita@hita-vm:~/slambook/ch3/useGeometry/build$ make</span><br><span class="line">Scanning dependencies of target eigenGeometry</span><br><span class="line">[ 50%] Building CXX object CMakeFiles/eigenGeometry.dir/useGeometry.cpp.o</span><br><span class="line">[100%] Linking CXX executable eigenGeometry</span><br><span class="line">[100%] Built target eigenGeometry</span><br><span class="line">hita@hita-vm:~/slambook/ch3/useGeometry/build$ ./eigenGeometry </span><br><span class="line">rotation matrix = </span><br><span class="line">  0.707 -0.707      0</span><br><span class="line"> 0.707  0.707      0</span><br><span class="line">     0      0      1</span><br><span class="line">(1, 0, 0) after rotation (by angle axis) = 0.707 0.707     0</span><br><span class="line">yaw pitch roll = 0.785    -0     0</span><br><span class="line">Transform matrix = </span><br><span class="line"> 0.707 -0.707      0      1</span><br><span class="line"> 0.707  0.707      0      3</span><br><span class="line">     0      0      1      4</span><br><span class="line">     0      0      0      1</span><br><span class="line">v transformed = 1.71 3.71    4</span><br><span class="line">quaternion from rotation vector =     0     0 0.383 0.924</span><br><span class="line">quaternion from rotation matrix =     0     0 0.383 0.924</span><br><span class="line">(1, 0, 0) after rotation = 0.707 0.707     0</span><br></pre></td></tr></table></figure>

<h3 id="实际的坐标变换例子"><a href="#实际的坐标变换例子" class="headerlink" title="实际的坐标变换例子"></a>实际的坐标变换例子</h3><p><strong>例子</strong></p>
<p>设有机器人一号和机器人二号位于世界坐标系中。记世界坐标系为W，机器人的坐标系为 R1和R2。机器人一号的位姿为q1 &#x3D; [0.35, 0.2, 0.3, 0.1]T, t1 &#x3D; [0.3, 0.1, 0.1]T。机器人二号的位姿为q2 &#x3D; [−0.5, 0.4, −0.1, 0.2]T, t2 &#x3D; [−0.1, 0.5, 0.3]T。这里的q和t表达的是世界坐标系到相机坐标系的变换关系。机器人一号看到某个点在自身的坐标系下坐标为pR1 &#x3D; [0.5, 0, 0.2]T，求该向量在机器人二号坐标系下的坐标。</p>
<p>新建文件 <code>slambook/ch3/examples/coordinateTransform.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    <span class="function">Quaterniond <span class="title">q1</span><span class="params">(<span class="number">0.35</span>, <span class="number">0.2</span>, <span class="number">0.3</span>, <span class="number">0.1</span>)</span>, <span class="title">q2</span><span class="params">(<span class="number">-0.5</span>, <span class="number">0.4</span>, <span class="number">-0.1</span>, <span class="number">0.2</span>)</span></span>;</span><br><span class="line">    q<span class="number">1.</span><span class="built_in">normalize</span>();</span><br><span class="line">    q<span class="number">2.</span><span class="built_in">normalize</span>();</span><br><span class="line">    <span class="function">Vector3d <span class="title">t1</span><span class="params">(<span class="number">0.3</span>, <span class="number">0.1</span>, <span class="number">0.1</span>)</span>, <span class="title">t2</span><span class="params">(<span class="number">-0.1</span>, <span class="number">0.5</span>, <span class="number">0.3</span>)</span></span>;</span><br><span class="line">    <span class="function">Vector3d <span class="title">p1</span><span class="params">(<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0.2</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Isometry3d <span class="title">T1w</span><span class="params">(q1)</span>, <span class="title">T2w</span><span class="params">(q2)</span></span>;</span><br><span class="line">    T1w.<span class="built_in">pretranslate</span>(t1);</span><br><span class="line">    T2w.<span class="built_in">pretranslate</span>(t2);</span><br><span class="line"></span><br><span class="line">    Vector3d p2 = T2w * T1w.<span class="built_in">inverse</span>() * p1;</span><br><span class="line">    cout &lt;&lt; endl &lt;&lt; p<span class="number">2.</span><span class="built_in">transpose</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 2.8)</span><br><span class="line">project(examples)</span><br><span class="line"></span><br><span class="line">include_directories(<span class="string">&quot;/usr/include/eigen3&quot;</span>)</span><br><span class="line">add_executable(coordinateTransform coordinateTransform.cpp)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch3/examples/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch3/examples/build</span><br><span class="line">hita@hita-vm:~/slambook/ch3/examples/build$ make</span><br><span class="line">[100%] Built target coordinateTransform</span><br><span class="line">hita@hita-vm:~/slambook/ch3/examples/build$ ./coordinateTransform </span><br><span class="line"></span><br><span class="line">-0.0309731    0.73499   0.296108</span><br></pre></td></tr></table></figure>

<p>程序只需要计算：<br>$$<br>p_{R_2} &#x3D; T_{R_2,W} T_{W,R_1} p_{R_1}<br>$$<br>即可，四元数使用之前需要归一化处理确保计算结果正确、稳定高效。</p>
<hr>
<h2 id="可视化演示"><a href="#可视化演示" class="headerlink" title="可视化演示"></a>可视化演示</h2><blockquote>
<p>安装Pangolin</p>
</blockquote>
<p>新建文件夹：<code>slambook/3rdparty/</code></p>
<p>在终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/stevenlovegrove/Pangolin.git</span><br><span class="line">cd Pangolin</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">cmake --build .</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure>

<p>编译成功之后测试一下，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd Pangolin/build/examples/HelloPangolin</span><br><span class="line">./HelloPangolin</span><br></pre></td></tr></table></figure>

<p>会看到一个结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250820153311084.png" alt="image-20250820153311084"></p>
<p>这代表安装成功了</p>
<p>新建文件 <code>slambook/ch3/examples/plotTrajectory.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// path to trajectory file</span></span><br><span class="line">string trajectory_file = <span class="string">&quot;../../examples/trajectory.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DrawTrajectory</span><span class="params">(vector&lt;Isometry3d, Eigen::aligned_allocator&lt;Isometry3d&gt;&gt;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    vector&lt;Isometry3d, Eigen::aligned_allocator&lt;Isometry3d&gt;&gt; poses;</span><br><span class="line">    <span class="function">ifstream <span class="title">fin</span><span class="params">(trajectory_file)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!fin) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;cannot find trajectory file at &quot;</span> &lt;&lt; trajectory_file &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!fin.<span class="built_in">eof</span>()) &#123;</span><br><span class="line">        <span class="type">double</span> time, tx, ty, tz, qx, qy, qz, qw;</span><br><span class="line">        fin &gt;&gt; time &gt;&gt; tx &gt;&gt; ty &gt;&gt; tz &gt;&gt; qx &gt;&gt; qy &gt;&gt; qz &gt;&gt; qw;</span><br><span class="line">        <span class="function">Isometry3d <span class="title">Twr</span><span class="params">(Quaterniond(qw, qx, qy, qz))</span></span>;</span><br><span class="line">        Twr.<span class="built_in">pretranslate</span>(<span class="built_in">Vector3d</span>(tx, ty, tz));</span><br><span class="line">        poses.<span class="built_in">push_back</span>(Twr);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;read total&quot;</span> &lt;&lt; poses.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;pose entries&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// draw trajectory in pangolin</span></span><br><span class="line">    <span class="built_in">DrawTrajectory</span>(poses);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DrawTrajectory</span><span class="params">(vector&lt;Isometry3d, Eigen::aligned_allocator&lt;Isometry3d&gt;&gt; poses)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// create pangolin window and plot the trajectory</span></span><br><span class="line">    pangolin::<span class="built_in">CreateWindowAndBind</span>(<span class="string">&quot;Trajectory Viewer&quot;</span>, <span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_BLEND);</span><br><span class="line">    <span class="built_in">glBlendFunc</span>(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line">    <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    pangolin::ProjectionMatrix(<span class="number">1024</span>, <span class="number">768</span>, <span class="number">500</span>, <span class="number">500</span>, <span class="number">512</span>, <span class="number">389</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="params"><span class="function">    pangolin::ModelViewLookAt(<span class="number">0</span>, <span class="number">-0.1</span>, <span class="number">-1.8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br><span class="line"></span><br><span class="line">    pangolin::View &amp;d_cam = pangolin::<span class="built_in">CreateDisplay</span>()</span><br><span class="line">        .<span class="built_in">SetBounds</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">-1024.0f</span> / <span class="number">768.0f</span>)</span><br><span class="line">        .<span class="built_in">SetHandler</span>(<span class="keyword">new</span> pangolin::<span class="built_in">Handler3D</span>(s_cam));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pangolin::<span class="built_in">ShouldQuit</span>() == <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line">        d_cam.<span class="built_in">Activate</span>(s_cam);</span><br><span class="line">        <span class="built_in">glClearColor</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">        <span class="built_in">glLineWidth</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; poses.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="comment">// 画每个位姿的三个坐标轴</span></span><br><span class="line">            Vector3d Ow = poses[i].<span class="built_in">translation</span>();</span><br><span class="line">            Vector3d Xw = poses[i] * (<span class="number">0.1</span> * <span class="built_in">Vector3d</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">            Vector3d Yw = poses[i] * (<span class="number">0.1</span> * <span class="built_in">Vector3d</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">            Vector3d Zw = poses[i] * (<span class="number">0.1</span> * <span class="built_in">Vector3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">            <span class="built_in">glBegin</span>(GL_LINES);</span><br><span class="line">            <span class="built_in">glColor3f</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(Ow[<span class="number">0</span>], Ow[<span class="number">1</span>], Ow[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(Xw[<span class="number">0</span>], Xw[<span class="number">1</span>], Xw[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glColor3f</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(Ow[<span class="number">0</span>], Ow[<span class="number">1</span>], Ow[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(Yw[<span class="number">0</span>], Yw[<span class="number">1</span>], Yw[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glColor3f</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(Ow[<span class="number">0</span>], Ow[<span class="number">1</span>], Ow[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(Zw[<span class="number">0</span>], Zw[<span class="number">1</span>], Zw[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glEnd</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 画出连线</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; poses.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="built_in">glColor3f</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">            <span class="built_in">glBegin</span>(GL_LINES);</span><br><span class="line">            <span class="keyword">auto</span> p1 = poses[i], p2 = poses[i<span class="number">+1</span>];</span><br><span class="line">            <span class="built_in">glVertex3d</span>(p<span class="number">1.</span><span class="built_in">translation</span>()[<span class="number">0</span>], p<span class="number">1.</span><span class="built_in">translation</span>()[<span class="number">1</span>], p<span class="number">1.</span><span class="built_in">translation</span>()[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glVertex3d</span>(p<span class="number">2.</span><span class="built_in">translation</span>()[<span class="number">0</span>], p<span class="number">2.</span><span class="built_in">translation</span>()[<span class="number">1</span>], p<span class="number">2.</span><span class="built_in">translation</span>()[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">glEnd</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        pangolin::<span class="built_in">FinishFrame</span>();</span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">5000</span>); <span class="comment">// sleep 5 ms</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>更新CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 2.8)</span><br><span class="line">project(examples)</span><br><span class="line"></span><br><span class="line">include_directories(<span class="string">&quot;/usr/include/eigen3&quot;</span>)</span><br><span class="line">add_executable(coordinateTransform coordinateTransform.cpp)</span><br><span class="line"></span><br><span class="line">find_package(Pangolin REQUIRED)</span><br><span class="line">include_directories($&#123;Pangolin_INCLUDE_DIRS&#125;)</span><br><span class="line">add_executable(plotTrajectory plotTrajectory.cpp)</span><br><span class="line">target_link_libraries(plotTrajectory $&#123;Pangolin_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure>

<p>在终端输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch3/examples/build$ cmake ..</span><br><span class="line">-- Configuring <span class="keyword">done</span></span><br><span class="line">-- Generating <span class="keyword">done</span></span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch3/examples/build</span><br><span class="line">hita@hita-vm:~/slambook/ch3/examples/build$ make </span><br><span class="line">Scanning dependencies of target plotTrajectory</span><br><span class="line">[ 25%] Building CXX object CMakeFiles/plotTrajectory.<span class="built_in">dir</span>/plotTrajectory.cpp.o</span><br><span class="line">[ 50%] Linking CXX executable plotTrajectory</span><br><span class="line">[ 50%] Built target plotTrajectory</span><br><span class="line">[100%] Built target coordinateTransform</span><br><span class="line">hita@hita-vm:~/slambook/ch3/examples/build$ ./plotTrajectory </span><br><span class="line"><span class="built_in">read</span> total620pose entries</span><br></pre></td></tr></table></figure>

<p>显示结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250820154628932.png" alt="image-20250820154628932"></p>
<hr>
<h3 id="显示相机位姿"><a href="#显示相机位姿" class="headerlink" title="显示相机位姿"></a>显示相机位姿</h3><p>新建文件 <code>slambook/ch3/visualizeGeometry.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Eigen/Geometry&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pangolin/pangolin.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RotationMatrix</span> &#123;</span><br><span class="line">  Matrix3d matrix = Matrix3d::<span class="built_in">Identity</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="type">const</span> RotationMatrix &amp;r) &#123;</span><br><span class="line">  out.<span class="built_in">setf</span>(ios::fixed);</span><br><span class="line">  Matrix3d matrix = r.matrix;</span><br><span class="line">  out &lt;&lt; <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">  out &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">2</span>) &lt;&lt; <span class="built_in">matrix</span>(<span class="number">0</span>, <span class="number">0</span>) &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">0</span>, <span class="number">1</span>) &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">0</span>, <span class="number">2</span>) &lt;&lt; <span class="string">&quot;],&quot;</span></span><br><span class="line">      &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">1</span>, <span class="number">0</span>) &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">1</span>, <span class="number">1</span>) &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; <span class="string">&quot;],&quot;</span></span><br><span class="line">      &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">2</span>, <span class="number">0</span>) &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">2</span>, <span class="number">1</span>) &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; <span class="built_in">matrix</span>(<span class="number">2</span>, <span class="number">2</span>) &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream &amp;<span class="keyword">operator</span>&gt;&gt;(istream &amp;in, RotationMatrix &amp;r) &#123;</span><br><span class="line">  <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TranslationVector</span> &#123;</span><br><span class="line">  Vector3d trans = <span class="built_in">Vector3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="type">const</span> TranslationVector &amp;t) &#123;</span><br><span class="line">  out &lt;&lt; <span class="string">&quot;=[&quot;</span> &lt;&lt; t.<span class="built_in">trans</span>(<span class="number">0</span>) &lt;&lt; <span class="string">&#x27;,&#x27;</span> &lt;&lt; t.<span class="built_in">trans</span>(<span class="number">1</span>) &lt;&lt; <span class="string">&#x27;,&#x27;</span> &lt;&lt; t.<span class="built_in">trans</span>(<span class="number">2</span>) &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream &amp;<span class="keyword">operator</span>&gt;&gt;(istream &amp;in, TranslationVector &amp;t) &#123;</span><br><span class="line">  <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">QuaternionDraw</span> &#123;</span><br><span class="line">  Quaterniond q;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="type">const</span> QuaternionDraw quat) &#123;</span><br><span class="line">  <span class="keyword">auto</span> c = quat.q.<span class="built_in">coeffs</span>();</span><br><span class="line">  out &lt;&lt; <span class="string">&quot;=[&quot;</span> &lt;&lt; c[<span class="number">0</span>] &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; c[<span class="number">1</span>] &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; c[<span class="number">2</span>] &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; c[<span class="number">3</span>] &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream &amp;<span class="keyword">operator</span>&gt;&gt;(istream &amp;in, <span class="type">const</span> QuaternionDraw quat) &#123;</span><br><span class="line">  <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  pangolin::<span class="built_in">CreateWindowAndBind</span>(<span class="string">&quot;visualize geometry&quot;</span>, <span class="number">1000</span>, <span class="number">600</span>);</span><br><span class="line">  <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">  <span class="function">pangolin::OpenGlRenderState <span class="title">s_cam</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    pangolin::ProjectionMatrix(<span class="number">1000</span>, <span class="number">600</span>, <span class="number">420</span>, <span class="number">420</span>, <span class="number">500</span>, <span class="number">300</span>, <span class="number">0.1</span>, <span class="number">1000</span>),</span></span></span><br><span class="line"><span class="params"><span class="function">    pangolin::ModelViewLookAt(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, pangolin::AxisY)</span></span></span><br><span class="line"><span class="params"><span class="function">  )</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">int</span> UI_WIDTH = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">  pangolin::View &amp;d_cam = pangolin::<span class="built_in">CreateDisplay</span>().</span><br><span class="line">    <span class="built_in">SetBounds</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, pangolin::Attach::<span class="built_in">Pix</span>(UI_WIDTH), <span class="number">1.0</span>, <span class="number">-1000.0f</span> / <span class="number">600.0f</span>).</span><br><span class="line">    <span class="built_in">SetHandler</span>(<span class="keyword">new</span> pangolin::<span class="built_in">Handler3D</span>(s_cam));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ui</span></span><br><span class="line">  <span class="function">pangolin::Var&lt;RotationMatrix&gt; <span class="title">rotation_matrix</span><span class="params">(<span class="string">&quot;ui.R&quot;</span>, RotationMatrix())</span></span>;</span><br><span class="line">  <span class="function">pangolin::Var&lt;TranslationVector&gt; <span class="title">translation_vector</span><span class="params">(<span class="string">&quot;ui.t&quot;</span>, TranslationVector())</span></span>;</span><br><span class="line">  <span class="function">pangolin::Var&lt;TranslationVector&gt; <span class="title">euler_angles</span><span class="params">(<span class="string">&quot;ui.rpy&quot;</span>, TranslationVector())</span></span>;</span><br><span class="line">  <span class="function">pangolin::Var&lt;QuaternionDraw&gt; <span class="title">quaternion</span><span class="params">(<span class="string">&quot;ui.q&quot;</span>, QuaternionDraw())</span></span>;</span><br><span class="line">  pangolin::<span class="built_in">CreatePanel</span>(<span class="string">&quot;ui&quot;</span>).<span class="built_in">SetBounds</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, pangolin::Attach::<span class="built_in">Pix</span>(UI_WIDTH));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!pangolin::<span class="built_in">ShouldQuit</span>()) &#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    d_cam.<span class="built_in">Activate</span>(s_cam);</span><br><span class="line"></span><br><span class="line">    pangolin::OpenGlMatrix matrix = s_cam.<span class="built_in">GetModelViewMatrix</span>();</span><br><span class="line">    Matrix&lt;<span class="type">double</span>, <span class="number">4</span>, <span class="number">4</span>&gt; m = matrix;</span><br><span class="line"></span><br><span class="line">    RotationMatrix R;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        R.<span class="built_in">matrix</span>(i, j) = <span class="built_in">m</span>(j, i);</span><br><span class="line">    rotation_matrix = R;</span><br><span class="line"></span><br><span class="line">    TranslationVector t;</span><br><span class="line">    t.trans = <span class="built_in">Vector3d</span>(<span class="built_in">m</span>(<span class="number">0</span>, <span class="number">3</span>), <span class="built_in">m</span>(<span class="number">1</span>, <span class="number">3</span>), <span class="built_in">m</span>(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    t.trans = -R.matrix * t.trans;</span><br><span class="line">    translation_vector = t;</span><br><span class="line"></span><br><span class="line">    TranslationVector euler;</span><br><span class="line">    euler.trans = R.matrix.<span class="built_in">eulerAngles</span>(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    euler_angles = euler;</span><br><span class="line"></span><br><span class="line">    QuaternionDraw quat;</span><br><span class="line">    quat.q = <span class="built_in">Quaterniond</span>(R.matrix);</span><br><span class="line">    quaternion = quat;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glColor3f</span>(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">    pangolin::<span class="built_in">glDrawColouredCube</span>();</span><br><span class="line">    <span class="comment">// draw the original axis</span></span><br><span class="line">    <span class="built_in">glLineWidth</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">glColor3f</span>(<span class="number">0.8f</span>, <span class="number">0.f</span>, <span class="number">0.f</span>);</span><br><span class="line">    <span class="built_in">glBegin</span>(GL_LINES);</span><br><span class="line">    <span class="built_in">glVertex3f</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glVertex3f</span>(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glColor3f</span>(<span class="number">0.f</span>, <span class="number">0.8f</span>, <span class="number">0.f</span>);</span><br><span class="line">    <span class="built_in">glVertex3f</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glVertex3f</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glColor3f</span>(<span class="number">0.2f</span>, <span class="number">0.2f</span>, <span class="number">1.f</span>);</span><br><span class="line">    <span class="built_in">glVertex3f</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glVertex3f</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">    pangolin::<span class="built_in">FinishFrame</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建CMakeLists.txt</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cmake_minimum_required( VERSION 2.8 )</span><br><span class="line">project( visualizeGeometry )</span><br><span class="line"></span><br><span class="line">set(CMAKE_CXX_FLAGS <span class="string">&quot;-std=c++14&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加Eigen头文件</span></span><br><span class="line">include_directories( <span class="string">&quot;/usr/include/eigen3&quot;</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加Pangolin依赖</span></span><br><span class="line">find_package( Pangolin )</span><br><span class="line">include_directories( $&#123;Pangolin_INCLUDE_DIRS&#125; )</span><br><span class="line"></span><br><span class="line">add_executable( visualizeGeometry visualizeGeometry.cpp )</span><br><span class="line">target_link_libraries( visualizeGeometry $&#123;Pangolin_LIBRARIES&#125; )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在终端输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch3/visualizeGeometry/build$ cmake ..</span><br><span class="line">-- Configuring <span class="keyword">done</span></span><br><span class="line">-- Generating <span class="keyword">done</span></span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch3/visualizeGeometry/build</span><br><span class="line">hita@hita-vm:~/slambook/ch3/visualizeGeometry/build$ make</span><br><span class="line">[100%] Built target visualizeGeometry</span><br><span class="line">hita@hita-vm:~/slambook/ch3/visualizeGeometry/build$ ./visualizeGeometry </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250820160139624.png" alt="image-20250820160139624"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/08/20/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%BA%8C%E8%AE%B2%EF%BC%89%E2%80%94%E2%80%94%E5%88%9D%E8%AF%86SLAM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/20/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2%EF%BC%88%E7%AC%AC%E4%BA%8C%E8%AE%B2%EF%BC%89%E2%80%94%E2%80%94%E5%88%9D%E8%AF%86SLAM/" class="post-title-link" itemprop="url">第二讲-初始SLAM</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-08-20 00:00:00 / 修改时间：16:22:27" itemprop="dateCreated datePublished" datetime="2025-08-20T00:00:00+08:00">2025-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%A7%86%E8%A7%89SLAM%E5%8D%81%E5%9B%9B%E8%AE%B2/" itemprop="url" rel="index"><span itemprop="name">视觉SLAM十四讲</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="视觉SLAM十四讲（第二讲）——初识SLAM"><a href="#视觉SLAM十四讲（第二讲）——初识SLAM" class="headerlink" title="视觉SLAM十四讲（第二讲）——初识SLAM"></a>视觉SLAM十四讲（第二讲）——初识SLAM</h1><h2 id="经典视觉SLAM框架"><a href="#经典视觉SLAM框架" class="headerlink" title="经典视觉SLAM框架"></a>经典视觉SLAM框架</h2><p><img src="https://th.bing.com/th/id/R.2ecd915fe6af828b0dd93990ed5b5e3c?rik=/8Yy8oF28qLB9w&riu=http://download.broadview.com.cn/Original/17055494d435efcc231f&ehk=2ay/8ZjBGFFLUpgaacPUFPzbNJMHb8ldsjQ6NNwVEz8=&risl=&pid=ImgRaw&r=0" alt="经典视觉SLAM框架 - 博文视点"></p>
<p><strong>流程</strong></p>
<ol>
<li>传感器信息读取：主要为相机图像信息的读取和预处理。如果在机器人中，可能还有码盘、惯性传感器等信息的读取和同步。</li>
<li>前端视觉里程计(visual odometry ,vo)：视觉里程计的任务是估算相邻图像间相机的运动，以及局部地图的样子，vo又称为前端。</li>
<li>后端（非线性）优化(Optimization)：后端接受不同时刻里程计测量的相机位姿，以及回环检测的信息，进行优化，得到全局一致的轨迹和地图。称为后端。</li>
<li>回环检测（loop closure detection）：回环检测判断机器人是否到达过先前的位置，如果检测到回环，会把信息提供给后端处理</li>
<li>建图（mapping）：根据估计的轨迹，建立与任务要求对应的地图。</li>
</ol>
<hr>
<h3 id="视觉里程计"><a href="#视觉里程计" class="headerlink" title="视觉里程计"></a>视觉里程计</h3><p>视觉里程计能够通过相邻帧间的图像估计相机运动，并且恢复场景的空间结构。它之所以被称为里程计，是因为它实际上只计算相邻时刻的运动，和过去的信息没有关联。但是仅仅通过视觉里程计来估计轨迹，会出现累积漂移，需要后端优化和回环检测。回环检测负责把“机器人回到原始位置”的事情检测出来，后端优化则根据该信息，校正整个轨迹。</p>
<h3 id="后端优化"><a href="#后端优化" class="headerlink" title="后端优化"></a>后端优化</h3><p>后端优化主要指处理SLAM过程中的噪声问题，前端给后端提供待优化的数据，后端负责整体的优化过程。只是面对数据，不关心数据的来源。前端和计算机视觉研究领域相关，如图像的特征提取和匹配，后端则主要是滤波和非线性优化算法。</p>
<p>SLAM<strong>本质</strong>：对运动主体自身和周围环境空间不确定性的估计。</p>
<h3 id="回环检测"><a href="#回环检测" class="headerlink" title="回环检测"></a>回环检测</h3><p>主要解决位置估计随时间漂移的问题，目的：让机器人知道自己是否已经回到了原点。</p>
<p>回环检测与“定位”和“建图”二者有密切关系。需要让机器人具有识别去过的地方的能力。<strong>例如可以判断图像间的相似性</strong>来完成回环检测。<strong>视觉回环检测实质上就是一种计算图像数据相似性</strong>的算法。如果检测到，前后两点是同一个点这个信息，会发送给后端优化算法，从而把轨迹地图调整到符合回环检测的样子。</p>
<h3 id="建图"><a href="#建图" class="headerlink" title="建图"></a>建图</h3><p>建图是指构建地图的过程，地图是对环境的描述。大体上可以分为：<strong>度量地图</strong> 和 <strong>拓扑地图</strong>两种</p>
<h4 id="度量地图"><a href="#度量地图" class="headerlink" title="度量地图"></a>度量地图</h4><p>度量地图（Metic Map）或者几何地图（Geometric Map）强调精确表示地图中的位置关系，通过稀疏、稠密分类。常见的点云、八叉树、栅格地图等都属于度量地图。</p>
<p>根据地图是否是连续的还可以分为连续地图和离散地图。例如栅格地图、体素地图就是典型的离散地图。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250801154105876.png" alt="image-20250801154105876"></p>
<h4 id="语义地图"><a href="#语义地图" class="headerlink" title="语义地图"></a>语义地图</h4><p>语义地图包含语义信息，语义信息可以是物体的种类、姿态、形状等描述。只要是包含语义信息的就可以算是语义地图。下图为包含语义的点云地图。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/4f3bee86382c87ff3cfdedf7f6ffc7ad.png" alt="img"></p>
<h4 id="拓扑地图"><a href="#拓扑地图" class="headerlink" title="拓扑地图"></a>拓扑地图</h4><p>拓扑地图(topological map)使用节点和边来表示环境，只考虑节点间的连续性，例如只关注A、B点是否联通，并不考虑是如何从A到B的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/dbb2dd50ecdd508e0c520ad269309f58.png" alt="bbd00a222180cbc06ddf8031ffc95f99.png"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/CV_Autobot/article/details/140709472">原来如此！简单总结SLAM中的各种地图-CSDN博客</a></p>
<hr>
<h2 id="SLAM问题的数学表述"><a href="#SLAM问题的数学表述" class="headerlink" title="SLAM问题的数学表述"></a>SLAM问题的数学表述</h2><p>有点看不明白，先放着</p>
<h2 id="实践编程"><a href="#实践编程" class="headerlink" title="实践编程"></a>实践编程</h2><p>我使用的是ubuntu 20.04虚拟机</p>
<h3 id="Hello-SLAM"><a href="#Hello-SLAM" class="headerlink" title="Hello SLAM"></a>Hello SLAM</h3><p>下载源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/gaoxiang12/slambook2.git</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250818152557183.png" alt="image-20250818152557183"></p>
<p>使用编译器，把文本文件编译成可执行文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ helloSLAM.cpp</span><br></pre></td></tr></table></figure>

<p>顺利执行之后会在目录里新增一个 a.out文件，这是一个可执行文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250818152703369.png" alt="image-20250818152703369"></p>
<p>在终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./a.out</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250818153220320.png" alt="image-20250818153220320"></p>
<hr>
<h3 id="使用CMake"><a href="#使用CMake" class="headerlink" title="使用CMake"></a>使用CMake</h3><p>在一个cmake工程中，我们使用cmake命令生成一个makefile文件，然后使用make命令根据makefile内容编译整个工程。在<code>slamebook2/ch2/CMakeLists.txt</code>文件中：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 2.8)</span><br><span class="line">project(helloSLAM)</span><br><span class="line">add_executable(helloSLAM helloSLAM.cpp)</span><br></pre></td></tr></table></figure>

<p>在<code>slambook2/ch2/</code>目录下，调用cmake对该工程进行cmake编译：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch2$ cmake .</span><br><span class="line">-- The C compiler identification is GNU 9.4.0</span><br><span class="line">-- The CXX compiler identification is GNU 9.4.0</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch2$ make</span><br><span class="line">Scanning dependencies of target helloSLAM</span><br><span class="line">[ 50%] Building CXX object CMakeFiles/helloSLAM.dir/helloSLAM.cpp.o</span><br><span class="line">[100%] Linking CXX executable helloSLAM</span><br><span class="line">[100%] Built target helloSLAM</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch2$ ./helloSLAM </span><br><span class="line">hello SLAM!</span><br></pre></td></tr></table></figure>

<p>同时也可以新建一个build文件夹，存放中间文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch2/build$ cmake ..</span><br><span class="line">-- The C compiler identification is GNU 9.4.0</span><br><span class="line">-- The CXX compiler identification is GNU 9.4.0</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch2/build</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ make</span><br><span class="line">Scanning dependencies of target helloSLAM</span><br><span class="line">[ 50%] Building CXX object CMakeFiles/helloSLAM.dir/helloSLAM.cpp.o</span><br><span class="line">[100%] Linking CXX executable helloSLAM</span><br><span class="line">[100%] Built target helloSLAM</span><br></pre></td></tr></table></figure>

<p>这样就可以实现源代码与中间文件的分离</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250818162920119.png" alt="image-20250818162920119"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250818162935116.png" alt="image-20250818162935116"></p>
<h3 id="使用库"><a href="#使用库" class="headerlink" title="使用库"></a>使用库</h3><p>在<code>slambook/ch2/</code>目录下新建文件：<code>libHelloSLAM.cpp</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 这是一个库文件</span><br><span class="line"># include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">void printHello() &#123;</span><br><span class="line">    cout &lt;&lt; &quot;Hello SLAM!&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个库文件提供一个printHello函数，调用此函数将输出一条信息。但是它没有主函数，意味着这个库中没有可执行文件，在CMakeLists.txt中加上如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_library（hello libHelloSLAM.cpp）</span><br></pre></td></tr></table></figure>

<p>这样就是告诉cmake，想要把这个文件编译成一个叫做hello的库，然后编译整个工程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch2$ cd build</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch2/build</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ make</span><br><span class="line">Scanning dependencies of target hello</span><br><span class="line">[ 25%] Building CXX object CMakeFiles/hello.dir/libHelloSLAM.cpp.o</span><br><span class="line">[ 50%] Linking CXX static library libhello.a</span><br><span class="line">[ 50%] Built target hello</span><br><span class="line">[100%] Built target helloSLAM</span><br></pre></td></tr></table></figure>

<p>这时，在build 文件夹会生成一个libhello.a文件。这是我们得到的库</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250818170143539.png" alt="image-20250818170143539"></p>
<blockquote>
<p>库文件</p>
</blockquote>
<p>在linux中库文件分为静态库和共享库，静态库以 .a为后缀，共享库以 .so 为后缀，所有的库都是一些函数打包后的集合，差别在于静态库每次调用都会生成一个副本，共享库则只有一个副本。库文件是一个压缩包。为了让别人使用这个库，需要提供一份头文件，说明库里面有什么。<strong>所以对于使用者，只需要拿到头文件和库文件就可以调用这个库</strong>。下面编写libhello的头文件</p>
<p>新建文件 <code>slambook/ch2/libHelloSLAM.h</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ifndef LIBHELLOSLAM_H_</span><br><span class="line">#define LIBHELLOSLAM_H_</span><br><span class="line"></span><br><span class="line">void printHello();</span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>

<p>这样就可以使用printHello函数了，最后，写一个可执行程序来调用函数</p>
<p>新建文件 <code>slambook/ch2/useHello.cpp</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;libHelloSLAM.h&quot;</span><br><span class="line"></span><br><span class="line">// 使用libHelloSLAM.h中的printHello()函数</span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">    printHello();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，在CMakeLists.txt中添加一个可执行程序的生成命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(useHello useHello.cpp)</span><br><span class="line">target_link_libraries(useHello hello)</span><br></pre></td></tr></table></figure>

<p>最后测试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch2/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch2/build</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ make</span><br><span class="line">Scanning dependencies of target hello</span><br><span class="line">[ 25%] Building CXX object CMakeFiles/hello.dir/libHelloSLAM.cpp.o</span><br><span class="line">[ 50%] Linking CXX static library libhello.a</span><br><span class="line">[ 50%] Built target hello</span><br><span class="line">[100%] Built target helloSLAM</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ cmake ..</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/hita/slambook/ch2/build</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ make</span><br><span class="line">[ 33%] Built target hello</span><br><span class="line">Scanning dependencies of target useHello</span><br><span class="line">[ 50%] Building CXX object CMakeFiles/useHello.dir/useHello.cpp.o</span><br><span class="line">[ 66%] Linking CXX executable useHello</span><br><span class="line">[ 66%] Built target useHello</span><br><span class="line">[100%] Built target helloSLAM</span><br></pre></td></tr></table></figure>

<p>运行可执行文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~/slambook/ch2$ cd build/</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ ./useHello </span><br><span class="line">Hello SLAM!</span><br><span class="line">hita@hita-vm:~/slambook/ch2/build$ </span><br></pre></td></tr></table></figure>

<p>输出结果与之前一致。通过这个例子，演示了如何生成并且调用一个库。</p>
<hr>
<h3 id="使用IDE"><a href="#使用IDE" class="headerlink" title="使用IDE"></a>使用IDE</h3><p>我使用的是vscode。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/08/01/EndNote%20%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/01/EndNote%20%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">EndNote使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-08-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-01T00:00:00+08:00">2025-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-08-20 16:19:20" itemprop="dateModified" datetime="2025-08-20T16:19:20+08:00">2025-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">工具学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="EndNote-使用"><a href="#EndNote-使用" class="headerlink" title="EndNote 使用"></a>EndNote 使用</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>EndNote是一款广泛使用的文献管理工具，旨在帮助学者和研究人员整理、管理和引用学术文献。在学术写作中，EndNote能够自动化引用过程，减少人工输入错误，提升工作效率。无论是在准备论文、书籍还是研究报告时，EndNote都能为用户提供强大的支持，尤其在生成参考文献和引用格式方面表现突出。</p>
<h2 id="新建文件数据库"><a href="#新建文件数据库" class="headerlink" title="新建文件数据库"></a>新建文件数据库</h2><p>打开EndNote,选择file&gt;new ,选择文件位置，即可新建一个文件数据库。文件数据库相当于你管理文献的一个大仓库。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195548273.png" alt="image-20250731195548273"></p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195617688.png" alt="image-20250731195617688"  />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195637883.png" alt="image-20250731195637883" style="zoom: 67%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731195659062.png" alt="image-20250731195659062"></p>
<p>会出现两个新的图标在桌面上。</p>
<hr>
<h2 id="导入文献"><a href="#导入文献" class="headerlink" title="导入文献"></a>导入文献</h2><h3 id="导入英文文献（以WOS为例）"><a href="#导入英文文献（以WOS为例）" class="headerlink" title="导入英文文献（以WOS为例）"></a>导入英文文献（以WOS为例）</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200240533.png" alt="image-20250731200240533" style="zoom: 50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200411385.png" alt="image-20250731200411385"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200510672.png" alt="image-20250731200510672"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200602788.png" alt="image-20250731200602788"></p>
<p>文献即可在EndNote中显示了。或者点击file&gt;import&gt;file，选中刚才在浏览器下载的文件，也可以导入。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731200755328.png" alt="image-20250731200755328" style="zoom:80%;" />

<hr>
<h3 id="导入中文文献（知网为例）"><a href="#导入中文文献（知网为例）" class="headerlink" title="导入中文文献（知网为例）"></a>导入中文文献（知网为例）</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201116020.png" alt="image-20250731201116020" style="zoom:50%;" />

<p>会跳转到下面这个界面。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201222425.png" alt="image-20250731201222425" style="zoom:50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201302937.png" alt="image-20250731201302937"></p>
<p>与前面英文文献类似，选择打开即可。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201354847.png" alt="image-20250731201354847" style="zoom:67%;" />

<p>刚才导出的两篇文章都能在endnote中找到了。</p>
<h3 id="导入PDF"><a href="#导入PDF" class="headerlink" title="导入PDF"></a>导入PDF</h3><p>对于中文文献的PDF导入，可能无法识别，所以建议只导入英文文献的PDF.</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201701772.png" alt="image-20250731201701772"></p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731201851483.png" alt="image-20250731201851483" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202136588.png" alt="image-20250731202136588" style="zoom:67%;" />

<p>英文文献的话，就会完整一点，同时可以通过文献的DOI号来更新文件信息。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202238574.png" alt="image-20250731202238574" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202545052.png" alt="image-20250731202545052" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731202708767.png" alt="image-20250731202708767" style="zoom:67%;" />

<p>找到文件，选择复制DOI号，然后保存在上述界面之后，选择更新即可。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731203052379.png" alt="image-20250731203052379" style="zoom:67%;" />

<p>这样，文献条目栏就有更新的信息了。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731203140549.png" alt="image-20250731203140549" style="zoom:67%;" />

<p>文献导入暂时介绍到这。</p>
<hr>
<h2 id="基本界面"><a href="#基本界面" class="headerlink" title="基本界面"></a>基本界面</h2><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731204134909.png" alt="image-20250731204134909" style="zoom:67%;" />

<h3 id="文献去重"><a href="#文献去重" class="headerlink" title="文献去重"></a>文献去重</h3><p>如果是批量导入文献的话，如果从不同的数据库中导入文献可能存在重复的情况，这时候就需要去重。</p>
<p>首先先批量导入一些文献，分别从两个数据库导入了25篇文献，现在对其中重复的文献进行去重。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731204717472.png" alt="image-20250731204717472" style="zoom: 50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731204813359.png" alt="image-20250731204813359"></p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205003151.png" alt="image-20250731205003151" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205052835.png" alt="image-20250731205052835" style="zoom:67%;" />

<p>按住 <code>ctr + A</code>选择全部文献。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205211704.png" alt="image-20250731205211704" style="zoom:80%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205640773.png" alt="image-20250731205640773" style="zoom: 50%;" />

<p>如果选择取消，可以在侧边栏看到：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731205738517.png" alt="image-20250731205738517" style="zoom:50%;" />

<p>有一个重复的文件夹</p>
<p>直接把不需要的文献拖拽到垃圾桶即可。</p>
<hr>
<h3 id="文献分类"><a href="#文献分类" class="headerlink" title="文献分类"></a>文献分类</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731210408265.png" alt="image-20250731210408265" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731210555381.png" alt="image-20250731210555381" style="zoom:50%;" />

<p>创建好文件夹之后，可以把导入的文献拖拽或者邮件放入文件夹中，同样可以进行删除文献或者文件夹操作，注意这不会删除你本来的文献。仍然存在于All Ref内，除非拖拽到 Trash中。</p>
<hr>
<h3 id="文献标签"><a href="#文献标签" class="headerlink" title="文献标签"></a>文献标签</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211110190.png" alt="image-20250731211110190" style="zoom: 50%;" />

<p>将文献拖拽到标签处即可赋予标签，或者右键文献</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211225249.png" alt="image-20250731211225249" style="zoom:50%;" />

<p>第一种方式比较优雅。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211345499.png" alt="image-20250731211345499" style="zoom:80%;" />

<hr>
<h3 id="文献排序"><a href="#文献排序" class="headerlink" title="文献排序"></a>文献排序</h3><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731211714999.png" alt="image-20250731211714999" style="zoom: 50%;" />

<p>右键信息栏即可给文献添加新的信息，这里可以添加一个评级，给它勾选上即可。</p>
<h3 id="文献阅读"><a href="#文献阅读" class="headerlink" title="文献阅读"></a>文献阅读</h3><p>由于没有在这个软件阅读文献的习惯，所以知识简单做一个标记。</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250731212333810.png" alt="image-20250731212333810" style="zoom:67%;" />

<h2 id="文献引用"><a href="#文献引用" class="headerlink" title="文献引用"></a>文献引用</h2><p>挖个坑，现在用不到</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/30/docker%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/30/docker%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Docker 安装及使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-30 00:00:00 / 修改时间：16:27:29" itemprop="dateCreated datePublished" datetime="2025-07-30T00:00:00+08:00">2025-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">工具学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="docker安装及使用"><a href="#docker安装及使用" class="headerlink" title="docker安装及使用"></a>docker安装及使用</h1><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><p><strong>环境介绍</strong> ：</p>
<ul>
<li>虚拟机：vmware 17pro</li>
<li>系统：ubuntu20.04</li>
</ul>
<h3 id="下载Docker"><a href="#下载Docker" class="headerlink" title="下载Docker"></a>下载Docker</h3><p>参考文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1323800">最详细的ubuntu 安装 docker教程-阿里云开发者社区</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/24228872523">(49 封私信 &#x2F; 76 条消息) docker配置镜像Docker pull时报错：https://registry-1.docker.io/v2/ - 知乎</a></li>
</ul>
<hr>
<h2 id="使用Docker"><a href="#使用Docker" class="headerlink" title="使用Docker"></a>使用Docker</h2><h3 id="Docker基本组成"><a href="#Docker基本组成" class="headerlink" title="Docker基本组成"></a>Docker基本组成</h3><p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250726105837573.png" alt="image-20250726105837573"></p>
<p><strong>镜像(image)</strong>：只是一个只读的模板，可以用来创建容器，一个镜像可以创建多个容器。</p>
<p><strong>容器(container)</strong> ：利用容器独立运行一个或者一组应用，容器时用镜像创建的运行实例。每个容器是相互隔离的，一个容器相当于一个简易版的环境。它的定义和镜像类似，唯一的区别在于容器的最上面一层是可读可写的。</p>
<p><strong>仓库(repository)</strong>：仓库是集中存放镜文件的场所，最大的公开仓库是Docker Hub。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250726110258459.png" alt="image-20250726110258459"></p>
<hr>
<h2 id="Docker-常用命令"><a href="#Docker-常用命令" class="headerlink" title="Docker 常用命令"></a>Docker 常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker -v 		# 显示Docker版本信息</span><br><span class="line">docker info 	# 显示Docker系统信息，包括镜像和容器数</span><br><span class="line">docker --help 	# 帮助</span><br></pre></td></tr></table></figure>

<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><ol>
<li>docker images</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker images		# 列出本地主机上的镜像</span><br><span class="line"># 解释</span><br><span class="line">REPOSITORY   镜像的仓库源</span><br><span class="line">TAG          镜像的标签</span><br><span class="line">IMAGE ID     镜像的ID</span><br><span class="line"> CREATED      镜像创建时间</span><br><span class="line">SIZE         镜像大小</span><br><span class="line"></span><br><span class="line">-a：        列出本地所有镜像</span><br><span class="line">-q：        只显示镜像id</span><br><span class="line">--digests： 显示镜像的摘要信息</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>docker search</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search 镜像名称		# 例如 docker search mysql</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>docker pull</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull 镜像名称		# 例如 docker pull mysql</span><br><span class="line"># 如果不添加tag，则拉取最新的，也可以添加tag：docker pull mysql:5.7  具体的tag可以去docker hub 查看</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>docker rmi(remove image)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 镜像id</span><br><span class="line">docker rmi -f $(docker images -qa)		# 删除全部</span><br></pre></td></tr></table></figure>

<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><p>必须要先下载镜像才能创建容器，使用centos镜像来测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<ol>
<li>新建容器并启动</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run [选项] image [指令]</span><br><span class="line"></span><br><span class="line"># 常用选项：</span><br><span class="line">--name=&quot;Name&quot;               # 给容器指定一个名字</span><br><span class="line">-d                          # 后台方式运行容器，并返回容器的id！</span><br><span class="line">-i                          # 以交互模式运行容器，通过和 -t 一起使用</span><br><span class="line">-t                          # 给容器重新分配一个终端，通常和 -i 一起使用</span><br><span class="line">-P                          # 随机端口映射（大写）</span><br><span class="line">-p                          # 指定端口映射（小写）</span><br><span class="line"></span><br><span class="line"># 使用centos进行交互式启动容器，在容器中执行/bin/bash命令</span><br><span class="line">docker run -it centos /bin/bash</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>列出所有运行的容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker ps </span><br><span class="line"></span><br><span class="line"># 常用选项</span><br><span class="line">-a 	# 列出当前所有正在运行的容器和历史运行的容器</span><br><span class="line">-l 	#显示最近创建的容器</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>退出容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit		# 退出容器并且停止</span><br><span class="line">ctrl+p+q	# 容器不停止退出</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动停止容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker start (容器id or 容器名)        # 启动容器</span><br><span class="line">docker restart (容器id or 容器名)      # 重启容器</span><br><span class="line">docker stop (容器id or 容器名)         # 停止容器</span><br><span class="line">docker kill (容器id or 容器名)         # 强制停止容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>删除容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id                  # 删除指定容器</span><br><span class="line">docker rm -f $(docker ps -a -q)  # 删除所有容器</span><br><span class="line">docker ps -a -q|xargs docker rm  # 删除所有容器</span><br></pre></td></tr></table></figure>

<h3 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h3><ol>
<li>后台启动容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockerrun -d 容器名</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看容器中运行的进程信息</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器id</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看容器&#x2F;镜像的元数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>进入正在运行的容器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器名</span><br><span class="line">docker attach 容器id</span><br><span class="line"></span><br><span class="line"># 区别</span><br><span class="line"># exec   是在容器中打开新的终端，并且可以启动新的进程</span><br><span class="line"># attach 直接进入容器启动命令的终端，不会启动新的进程</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>从容器内拷贝文件到主机</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径 目的地路径</span><br></pre></td></tr></table></figure>

<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><p>Portainer安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9000:9000 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce</span><br></pre></td></tr></table></figure>

<p>Portainer是Docker的图形化管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷 的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和 服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型单位对容器管 理的全部需求。</p>
<p>访问方式：<a target="_blank" rel="noopener" href="http://ip:9000/">http://ip:9000</a></p>
<p>查看自己的ip:<code>ifconfig</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250726154933589.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250726154809192.png"></p>
<hr>
<h2 id="Docker镜像讲解"><a href="#Docker镜像讲解" class="headerlink" title="Docker镜像讲解"></a>Docker镜像讲解</h2><p> 镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含 运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<p>Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部！ 这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<h3 id="镜像Commit"><a href="#镜像Commit" class="headerlink" title="镜像Commit"></a>镜像Commit</h3><p>docker commit 从容器创建一个新的镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m=&quot;提交的信息&quot; -a=&quot;作者&quot; 容器id 要创建的目标镜像名:[标签名]</span><br><span class="line">如果要保留现在容器的状态，可以通过commit，提交镜像，方便使用，类似于vm中的快照。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><h3 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h3><p>容器之间可以共享数据，可以保存数据，让数据挂在到本地，数据就不会因为容器删除丢失。<strong>容器数据卷可以使得容器持久化，保证容器之间数据的共享以及继承。</strong></p>
<h3 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h3><blockquote>
<p>方式一：容器中直接使用命令添加</p>
</blockquote>
<p><strong>挂载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 宿主机绝对路径目录：容器内目录 镜像名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">docker run  -it -v /home/test:/home ubuntu:20.04 /bin/bash</span><br></pre></td></tr></table></figure>

<p>查看是否挂载成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查看容器id</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">hita@hita-vm:/$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">0bbaf7ac2bdc   ubuntu:20.04   &quot;/bin/bash&quot;               3 minutes ago   Exited (0) 3 minutes ago             keen_dirac</span><br><span class="line">8aa9983a7e8f   2cd1d97f893f   &quot;/docker-entrypoint.…&quot;   2 days ago      Exited (0) 2 days ago                mynginx</span><br><span class="line">63cfb2f424a8   74cc54e27dc4   &quot;/hello&quot;                  3 days ago      Exited (0) 3 days ago                sad_chaum</span><br><span class="line">c06b8b5fe3d7   74cc54e27dc4   &quot;/hello&quot;                  3 days ago      Exited (0) 3 days ago                suspicious_snyder</span><br><span class="line"></span><br><span class="line"># 查看元数据</span><br><span class="line">docker inspect 0bbaf7ac2bdc</span><br></pre></td></tr></table></figure>

<p>可以看到有这一段：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728163658066.png"></p>
<p>测试容器和宿主机之间数据共享：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 容器内</span><br><span class="line">root@0bbaf7ac2bdc:/# cd home</span><br><span class="line">root@0bbaf7ac2bdc:/home# ls</span><br><span class="line">root@0bbaf7ac2bdc:/home# touch test.java</span><br><span class="line">root@0bbaf7ac2bdc:/home# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"># 宿主机</span><br><span class="line">hita@hita-vm:/home$ cd test</span><br><span class="line">hita@hita-vm:/home/test$ ls</span><br><span class="line">test.java</span><br></pre></td></tr></table></figure>

<p>在容器中创建的会在宿主机中看到，反过来也一样，相当于在宿主机与容器内目录下新建任何文件，都会同步。并且就算是容器停止退出之后，主机修改数据，同样在容器中也会同步。只要是在预设的目录下的文件。就算是把容器删除之后，同样能够在主机中保留删除前的数据。</p>
<blockquote>
<p>方式二：通过Docker File添加容器数据卷</p>
</blockquote>
<p>DockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p>
<p><strong>测试</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 在宿主机 /home 目录下新建一个 docker-test-volume 文件夹</span><br><span class="line">hita@hita-vm:~$ mkdir docker-test-volume</span><br><span class="line">hita@hita-vm:~$ cd /home</span><br><span class="line">hita@hita-vm:/home$ sudo mkdir docker-test-volume</span><br><span class="line">[sudo] hita 的密码：       </span><br><span class="line">hita@hita-vm:/home$ ls</span><br><span class="line">docker-test-volume  hita  test</span><br><span class="line"></span><br><span class="line"># 编写 DockerFile 文件</span><br><span class="line">hita@hita-vm:/home$ pwd</span><br><span class="line">/home</span><br><span class="line">hita@hita-vm:/home$ cd docker-test-volume/</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ sudo gedit dockerfile1</span><br><span class="line"></span><br><span class="line"># 内容</span><br><span class="line">FROM ubuntu:20.04</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;/dataVolumeContainer1&quot;,&quot;/dataVolumeContainer2&quot;]</span><br><span class="line"> </span><br><span class="line">CMD /bin/bash &amp;&amp; echo &quot;-------finish------&quot;</span><br><span class="line"></span><br><span class="line"># ubild 后生成镜像，获得一个新的镜像</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker build -f /home/docker-test-volume/dockerfile1 -t test/ubuntu .</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728201212958.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728201720395.png"></p>
<p>可以看到新增了一个镜像test&#x2F;ubuntu.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 启动容器</span><br><span class="line">docker run -it 1350 /bin/bash</span><br></pre></td></tr></table></figure>

<p>可以看到新建的两个数据卷。</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728202757745.png"></p>
<p>通过上述步骤，已经知道了容器内卷目录的地址，但是不知道对应主机的目录地址在哪</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 在数据卷中新建一个文件</span><br><span class="line">root@9d4fe1d5212f:/# cd dataVolumeContainer1</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# pwd</span><br><span class="line">/dataVolumeContainer1</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# touch container.txt</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 28 12:32 container.txt</span><br><span class="line"></span><br><span class="line"># 查看容器信息</span><br><span class="line">hita@hita-vm:~$ docker inspect 1350</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728203555017.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 在容器内新建一个文件</span><br><span class="line">root@9d4fe1d5212f:/# cd dataVolumeContainer1</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# touch container.txt</span><br><span class="line">root@9d4fe1d5212f:/dataVolumeContainer1# ls</span><br><span class="line">container.txt</span><br><span class="line"></span><br><span class="line"># 在宿主机查看位置</span><br><span class="line">hita@hita-vm:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">9d4fe1d5212f   1350           &quot;/bin/bash&quot;   36 minutes ago   Up 36 minutes             eager_banzai</span><br><span class="line">0bbaf7ac2bdc   ubuntu:20.04   &quot;/bin/bash&quot;   5 hours ago      Up 4 hours                keen_dirac</span><br><span class="line">hita@hita-vm:~$ docker inspect 9d4f</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728205826749.png"></p>
<p>这属于是匿名挂载，后面会讲。</p>
<p>接下来测试在容器内新建的文件是否同步了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~$ sudo -i</span><br><span class="line">root@hita-vm:~# cd /var/lib/docker/volumes/ce568fe2101804c5e79cd74df09d8cd49993ab7f4c71a5c0b80173e298837f3b/_data</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250728211334028.png"></p>
<p>这个卷是在主机的默认位置。</p>
<hr>
<h3 id="匿名挂载和具名挂载"><a href="#匿名挂载和具名挂载" class="headerlink" title="匿名挂载和具名挂载"></a>匿名挂载和具名挂载</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 匿名挂载</span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -p -- name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"># 匿名挂载缺点是不好维护，通常使用docker volume 维护</span><br><span class="line">docker volume ls</span><br><span class="line"></span><br><span class="line"># 具名挂载</span><br><span class="line">-v 卷名：/容器内路径</span><br><span class="line">docker run -d -P --name nginx02 -v nginxconfig:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line"># 查看挂载的路径</span><br><span class="line"></span><br><span class="line">hita@hita-vm:~$ docker volume inspect nginxconfig </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2025-07-29T10:20:20+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/nginxconfig/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;nginxconfig&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>挂载卷跟挂载目录有什么区别呢？</strong></p>
<p>挂载卷用于在容器之间持久化和共享数据，存储在docker主机的特定目录中。如上nginxconfig就是一个挂载卷，目录挂载就是将Docker容器与主机的目录进行映射，Docker不会像管理卷一样管理这个目录。</p>
<ul>
<li><strong>挂载卷</strong>是由 Docker 管理的数据存储机制，适合用于持久化和共享数据。</li>
<li><strong>挂载目录</strong>是用户直接指定的本地文件系统路径，适合用于开发和直接操作主机文件系统的场景。</li>
</ul>
<p>需要判断挂载的是卷名而不是本机目录名？</p>
<p>挂载创建的时候：<strong>不是&#x2F;开始就是卷名，是&#x2F;开始就是目录名。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 目录挂载</span><br><span class="line">docker run  -it -v /home/test:/home ubuntu:20.04 /bin/bash</span><br><span class="line"></span><br><span class="line"># 卷挂载</span><br><span class="line">docker run -d -P --name nginx02 -v nginxconfig:/etc/nginx nginx</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><p>命名的容器挂载数据卷，其他容器通过挂载在这个父容器实现数据共享，挂载数据卷的容器，就是数据卷容器。其本身不运行任何应用程序，仅用于存储数据。</p>
<ol>
<li>先启动那个父容器docker 然后再datavolumecontainer2添加新文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~$ docker run -it --name docker test/ubuntu:latest </span><br><span class="line">-------finish------</span><br><span class="line">root@713998876d0c:/# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx   1 root root    7 Apr  4 02:03 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr 15  2020 boot</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jul 29 02:54 dataVolumeContainer1</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jul 29 02:54 dataVolumeContainer2</span><br><span class="line">drwxr-xr-x   5 root root  360 Jul 29 02:54 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 29 02:54 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr 15  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Apr  4 02:03 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Apr  4 02:03 lib32 -&gt; usr/lib32</span><br><span class="line">lrwxrwxrwx   1 root root    9 Apr  4 02:03 lib64 -&gt; usr/lib64</span><br><span class="line">lrwxrwxrwx   1 root root   10 Apr  4 02:03 libx32 -&gt; usr/libx32</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 opt</span><br><span class="line">dr-xr-xr-x 475 root root    0 Jul 29 02:54 proc</span><br><span class="line">drwx------   2 root root 4096 Apr  4 02:09 root</span><br><span class="line">drwxr-xr-x   5 root root 4096 Apr  4 02:09 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Apr  4 02:03 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr  4 02:03 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Jul 29 02:54 sys</span><br><span class="line">drwxrwxrwt   2 root root 4096 Apr  4 02:09 tmp</span><br><span class="line">drwxr-xr-x  13 root root 4096 Apr  4 02:03 usr</span><br><span class="line">drwxr-xr-x  11 root root 4096 Apr  4 02:09 var</span><br><span class="line">root@713998876d0c:/# cd dataVolumeContainer2</span><br><span class="line">root@713998876d0c:/dataVolumeContainer2# touch docker.txt</span><br><span class="line">root@713998876d0c:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建docker02 ,docker03继承docker</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">创建docker02</span><br><span class="line">hita@hita-vm:~$ cd /home/docker-test-volume/</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker run -it --name docker02 --volumes-from docker test/ubuntu:latest </span><br><span class="line">-------finish------</span><br><span class="line">root@389cd5a12747:/# cd dataVolumeContainer2</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# touch docker02.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt  docker02.txt</span><br><span class="line"></span><br><span class="line"># 创建docker03</span><br><span class="line">hita@hita-vm:~$ cd /home</span><br><span class="line">hita@hita-vm:/home$ cd docker-test-volume/</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker run -it --name docker03 --volumes-from docker test/ubuntu:latest </span><br><span class="line">-------finish------</span><br><span class="line">root@8e3c5ff93b8a:/# cd dataVolumeContainer2</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt  docker02.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到，docker02继承了docker 的文件docker.txt.在docker03中新建文件docker03.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# touch docker03.txt</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# ls</span><br><span class="line">docker.txt  docker02.txt  docker03.txt</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# </span><br><span class="line"></span><br><span class="line"># 在docker 中查看</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls                                    </span><br><span class="line">docker.txt  docker02.txt  docker03.txt</span><br></pre></td></tr></table></figure>

<p>可以发现docker02 docker03创建的共享文件。</p>
<ol start="3">
<li>删除docker ,修改docker02 后，docker03还能不能访问</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 删除docker</span><br><span class="line">hita@hita-vm:/home/docker-test-volume$ docker rm -f docker</span><br><span class="line"></span><br><span class="line"># 修改docker02</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 02:56 docker.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:01 docker02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:03 docker03.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# touch docker02-update.txt</span><br><span class="line">root@389cd5a12747:/dataVolumeContainer2# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 02:56 docker.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:12 docker02-update.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:01 docker02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:03 docker03.txt</span><br><span class="line"></span><br><span class="line"># 查看docker03变化</span><br><span class="line">root@8e3c5ff93b8a:/dataVolumeContainer2# ls -l</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 02:56 docker.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:12 docker02-update.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:01 docker02.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 29 03:03 docker03.txt</span><br></pre></td></tr></table></figure>

<p>后续同样删除docker02容器，docker03同样可以访问原来的共享文件，如果新建docker04来继承docker03，在删除docker03，同样可以访问共享文件。所以得出结论：</p>
<p><strong>容器之间配置信息的传递，数据卷的生命周期会一直持续到没有容器使用它位置，存储在本机的文件会一直保留。</strong></p>
<hr>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><h3 id="什么是DockerFile"><a href="#什么是DockerFile" class="headerlink" title="什么是DockerFile"></a>什么是DockerFile</h3><p>dockerfile是用来构建Docker镜像的构建文件，<strong>是由一系列命令和参数构成的脚本</strong></p>
<p>构建步骤：</p>
<ol>
<li>编写DockerFile文件</li>
<li>docker build 构建镜像</li>
<li>docker run</li>
</ol>
<hr>
<h3 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h3><p><strong>基础知识</strong></p>
<ol>
<li>每条保留字指令都必须大写并且后面至少跟随一个参数</li>
<li>指令从上到下顺序执行</li>
<li>#表示注释</li>
<li>每条指令都会创建一个新的镜像层，并且对镜像进行提交</li>
</ol>
<p><strong>流程</strong></p>
<ol>
<li>docker 从基础镜像运行一个容器</li>
<li>执行一条指令并且对容器做出修改</li>
<li>执行类似 docker commit 的操作提交新的镜像层</li>
<li>Docker 再基于刚提交的镜像运行一个新的容器</li>
<li>执行dockerfile中的下一条指令直到所有的指令都执行完成</li>
</ol>
<p><strong>说明</strong></p>
<p>从应用软件角度，DockerFile 、docker镜像与docker容器分别代表软件的三个不同阶段</p>
<ul>
<li>DockerFile是软件的原材料（代码）</li>
<li>Docker镜像是软件的交付品（.apk）</li>
<li>Docker容器则是软件的运行状态（客户下载安装执行）</li>
</ul>
<p><img src="https://static001.geekbang.org/infoq/22/22c8413e4b9d8570d178aab1c54da58e.png" alt="img"></p>
<p><strong>DockerFile</strong>：需要定义一个DockerFile，DockerFile定义了进程需要的一切东西。DockerFile涉及的内容 包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进 程和内核进程（当引用进行需要和系统服务和内核进程打交道，这时需要考虑如何设计 namespace的权 限控制）等等。 </p>
<p><strong>Docker镜像</strong>：在DockerFile 定义了一个文件之后，Docker build 时会产生一个Docker镜像，当运行  Docker 镜像时，会真正开始提供服务；</p>
<p> <strong>Docker容器</strong>：容器是直接提供服务的。</p>
<hr>
<p>DockerFile指令</p>
<p><img src="https://th.bing.com/th/id/R.60fb3eed56951276ca0ce0431552ab1e?rik=GhYbCOyx/cwvxg&riu=http://www.178linux.com/wp-content/uploads/2018/08/dockerfile%E6%8C%87%E4%BB%A4.png&ehk=bd5ZcaxiwZrFiGvUmg6ZlLEkpWF1uZOa9T80sPwfK2U=&risl=&pid=ImgRaw&r=0" alt="Docker容器技术之Dockerfile | Linux运维部落"></p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250729200359835.png"></p>
<h3 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h3><blockquote>
<p>自定义一个 ubuntu20.04</p>
</blockquote>
<ol>
<li>编写DockerFile</li>
</ol>
<p>查看下官方默认的ubuntu:20.04的情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hita@hita-vm:~$ docker run -it ubuntu:20.04 </span><br><span class="line">root@59ceb0729bd7:/# pwd</span><br><span class="line">/</span><br><span class="line">root@59ceb0729bd7:/# vim a.txt</span><br><span class="line">bash: vim: command not found</span><br><span class="line">root@59ceb0729bd7:/# ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line">root@59ceb0729bd7:/# </span><br></pre></td></tr></table></figure>

<p><strong>修改目的</strong>：使得自己的镜像具备如下功能：登陆后的默认路径、vim编译器、查看网络配置ifconfig支持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:20.04</span><br><span class="line">MAINTAINER kuangshen&lt;24736743@qq.com&gt;</span><br><span class="line"></span><br><span class="line"># 设置环境变量</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line"></span><br><span class="line"># 设置工作目录</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line"># 更新apt-get并安装vim和net-tools</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y vim net-tools </span><br><span class="line"></span><br><span class="line"># 暴露80端口</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"># 输出环境变量MYPATH</span><br><span class="line">CMD echo $MYPATH</span><br><span class="line"></span><br><span class="line"># 输出结束信息</span><br><span class="line">CMD echo &quot;----------end--------&quot;</span><br><span class="line"></span><br><span class="line"># 启动bash</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>构建</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f mydockerfile-test -t myubuntu:0.1</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250730151940676.png"></p>
<ol start="3">
<li>运行</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it myubuntu:0.1</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250730152426781.png"></p>
<p>可以看到，镜像已经支持vim&#x2F;ifconfig的命令了</p>
<ol start="4">
<li>列出镜像的变更历史</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history myubuntu:0.1</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/20250730153312945.png"></p>
<hr>
<blockquote>
<p>CMD和ENTRYPOINT的区别</p>
</blockquote>
<p>CMD: DockerFile 中可以有很多cmd指令,但只有最后一个生效,cmd会被 docker run 之后的参数替换</p>
<p>ENTRYPOINT: docker run 之后的参数会被当作参数传递给ENTROPOINT 之后形成新的命令组合</p>
<hr>
<h3 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h3><p>留个坑，后面再填</p>
<hr>
<p>参考视频：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1og4y1q7M4/?p=34&spm_id_from=333.1007.top_right_bar_window_history.content.click">https://www.bilibili.com/video/BV1og4y1q7M4/?p=34&amp;spm_id_from=333.1007.top_right_bar_window_history.content.click</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/23/%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%AF%BC%E8%88%AA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/23/%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%AF%BC%E8%88%AA/" class="post-title-link" itemprop="url">利用move_base使得小车导航至火焰位置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-23 00:00:00 / 修改时间：19:41:37" itemprop="dateCreated datePublished" datetime="2025-07-23T00:00:00+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="利用move-base使得小车导航至火焰位置"><a href="#利用move-base使得小车导航至火焰位置" class="headerlink" title="利用move_base使得小车导航至火焰位置"></a>利用move_base使得小车导航至火焰位置</h1><h2 id="整体思路"><a href="#整体思路" class="headerlink" title="整体思路"></a>整体思路</h2><p>之前已经实现了使用小车，利用2D nav goal工具来设置目标点，只需要将这个目标点替换为火焰位置，这样就能实现火焰的导航。上一次已经实现了火焰相对于相机坐标系到火焰相对于小车坐标系的变换，现在只需要实现火焰坐标系到地图坐标系的转换即可。这便是整体思路</p>
<h2 id="2D-Nav-Goal基本原理"><a href="#2D-Nav-Goal基本原理" class="headerlink" title="2D Nav Goal基本原理"></a>2D Nav Goal基本原理</h2><ul>
<li><p>在rviz中通过”2D Nav Goal”工具设置目标点时，会发布geometry_msgs&#x2F;PoseStamped类型的消息到&#x2F;move_base_simple&#x2F;goal话题</p>
</li>
<li><p>move_base节点订阅该话题，将目标点转换为导航任务，并启动全局&#x2F;局部路径规划</p>
</li>
<li><p>目标点坐标基于用户指定的参考系（通常为map或odom坐标系）</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/2d%20nav%20goal%E5%8E%9F%E7%90%86.png"></p>
</li>
</ul>
<p>有了上述理解之后，可以尝试设置一个目标点，通过脚本来实现小车的移动</p>
<p>新建脚本文件：scripts&#x2F;goal.publisher.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PoseStamped</span><br><span class="line"><span class="keyword">from</span> tf.transformations <span class="keyword">import</span> quaternion_from_euler</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_goal</span>(<span class="params">x, y, yaw</span>):  <span class="comment"># yaw 为朝向偏航角（弧度）</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&#x27;/move_base_simple/goal&#x27;</span>, PoseStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">    rospy.sleep(<span class="number">1</span>)  <span class="comment"># 确保发布器已完全初始化</span></span><br><span class="line"></span><br><span class="line">    goal = PoseStamped()</span><br><span class="line">    goal.header.frame_id = <span class="string">&quot;map&quot;</span></span><br><span class="line">    goal.header.stamp = rospy.get_rostime()  <span class="comment"># 使用 ROS 时间戳</span></span><br><span class="line">    goal.pose.position.x = x</span><br><span class="line">    goal.pose.position.y = y</span><br><span class="line">    goal.pose.position.z = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将偏航角转换为四元数</span></span><br><span class="line">    q = quaternion_from_euler(<span class="number">0</span>, <span class="number">0</span>, yaw)</span><br><span class="line">    goal.pose.orientation.x = q[<span class="number">0</span>]</span><br><span class="line">    goal.pose.orientation.y = q[<span class="number">1</span>]</span><br><span class="line">    goal.pose.orientation.z = q[<span class="number">2</span>]</span><br><span class="line">    goal.pose.orientation.w = q[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发布目标消息</span></span><br><span class="line">    pub.publish(goal)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Goal published: x=%.2f, y=%.2f, yaw=%.2f&quot;</span>, x, y, yaw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;goal_publisher&#x27;</span>)  <span class="comment"># 初始化 ROS 节点</span></span><br><span class="line">        rospy.sleep(<span class="number">1</span>)  <span class="comment"># 等待一秒，确保节点已启动</span></span><br><span class="line">        send_goal(<span class="number">0.2</span>, <span class="number">0.15</span>, <span class="number">0.785</span>)  <span class="comment"># 示例：目标 (0.1, 0.15)，朝向 45° (0.785 弧度)</span></span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打开导航以及小车底盘控制节点，即可在终端查看消息数据.</p>
<p>具体命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic echo /move_base_simple/goal</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-22_16-52-25.png" alt="Snipaste_2025-07-22_16-52-25"></p>
<hr>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><p>新建一个脚本：scripts&#x2F;fire_navigator.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PointStamped, PoseStamped</span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> do_transform_point</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FireGoalConverter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;fire_goal_converter&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.tf_buffer = tf2_ros.Buffer()</span><br><span class="line">        <span class="variable language_">self</span>.tf_listener = tf2_ros.TransformListener(<span class="variable language_">self</span>.tf_buffer)</span><br><span class="line">        <span class="variable language_">self</span>.pub = rospy.Publisher(<span class="string">&#x27;/move_base_simple/goal&#x27;</span>, PoseStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, <span class="variable language_">self</span>.callback)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            transform = <span class="variable language_">self</span>.tf_buffer.lookup_transform(<span class="string">&quot;map&quot;</span>, msg.header.frame_id, rospy.Time(<span class="number">0</span>))</span><br><span class="line">            map_point = do_transform_point(msg, transform)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            rospy.loginfo(<span class="string">f&quot;坐标转换成功: <span class="subst">&#123;msg.header.frame_id&#125;</span> -&gt; map&quot;</span>)</span><br><span class="line">            rospy.loginfo(<span class="string">f&quot;转换后的坐标: x=<span class="subst">&#123;map_point.point.x&#125;</span>, y=<span class="subst">&#123;map_point.point.y&#125;</span>, z=<span class="subst">&#123;map_point.point.z&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            goal = PoseStamped()</span><br><span class="line">            goal.header = map_point.header</span><br><span class="line">            goal.pose.position.x = map_point.point.x</span><br><span class="line">            goal.pose.position.y = map_point.point.y</span><br><span class="line">            goal.pose.position.z = <span class="number">0.0</span></span><br><span class="line">            goal.pose.orientation.w = <span class="number">1.0</span></span><br><span class="line">            <span class="variable language_">self</span>.pub.publish(goal)</span><br><span class="line">        <span class="keyword">except</span> (tf2_ros.LookupException, tf2_ros.ConnectivityException) <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="string">f&quot;坐标转换失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    FireGoalConverter()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时编辑一下cmakelists以及赋予可执行权限</p>
<p>在打开机器人底盘控制节点，导航节点，火焰识别节点之后，再打开这个节点，即可实现火焰的导航。</p>
<p>为了方便打开多个节点，编写一个火焰识别launch文件：</p>
<p>新建文件：launch&#x2F;fire_detector.launch</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加RealSense相机启动配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find realsense2_camera)/launch/rs_camera.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;align_depth&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 启动火焰识别节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fire_detector.py&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;fire_detector&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动火焰定位节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fire_3D_locator.py&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;fire_3D_locator&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动marker节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_vision&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fire_marker_publisher.py&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;fire_marker_publisher&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/test_ws</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ./devel/setup.bash</span><br><span class="line">rosrun scout_bringup bringup_can2usb.bash</span><br><span class="line">roslaunch mycar_start start_mycar.launch</span><br><span class="line">roslaunch nav nav.launch</span><br><span class="line"></span><br><span class="line">/fire_reco_ws</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ./devel/setup.bash</span><br><span class="line">roslaunch robot_vision fire_detector.launch</span><br><span class="line">rosrun robot_vision fire_navigator.py</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行完成这些之后，可以在窗口看到一些信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-23_11-16-35.png" alt="Snipaste_2025-07-23_11-16-35"><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-23_11-16-02.png" alt="Snipaste_2025-07-23_11-16-02"></p>
<p>至此，整个系统就完成了简单的实现。虽然存在很多问题，但是整体功能以及框架较为完整。后续可以对SLAM 、路径规划、火焰识别等方面进行优化，会达到更好的效果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/23/%E5%B0%8F%E8%BD%A6%E8%87%AA%E4%B8%BB%E7%81%AB%E7%84%B0%E5%AE%9A%E4%BD%8D%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/23/%E5%B0%8F%E8%BD%A6%E8%87%AA%E4%B8%BB%E7%81%AB%E7%84%B0%E5%AE%9A%E4%BD%8D%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">小车自主火焰定位系统搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-07-23 00:00:00 / 修改时间：19:41:37" itemprop="dateCreated datePublished" datetime="2025-07-23T00:00:00+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="小车自主火焰定位系统搭建"><a href="#小车自主火焰定位系统搭建" class="headerlink" title="小车自主火焰定位系统搭建"></a>小车自主火焰定位系统搭建</h1><h2 id="整体思路框架"><a href="#整体思路框架" class="headerlink" title="整体思路框架"></a>整体思路框架</h2><ol>
<li>小车订阅火焰位置数据</li>
</ol>
<p>之前在代码中已经发布了小车相对于相机的3D位置话题：&#x2F;fire_position_3d,小车只要订阅即可</p>
<ol start="2">
<li>转换火焰的相对位置到小车坐标系</li>
</ol>
<p>使用TF2来实现坐标变换：camera_link到base_link</p>
<ol start="3">
<li>规划小车路径到火焰的位置</li>
</ol>
<p>目标点设置:火焰的3D位置转换为小车的坐标系中的2D目标位置，然后将火焰相对于地图的位置发布给move_base.</p>
<p>路经规划：利用move_base进行路径规划。可以通过其将转换国的目标点作为目标进行路径规划，从而实现小车朝着火焰位置前进。</p>
<hr>
<p>优化：</p>
<ol>
<li>导航控制与精确定位</li>
</ol>
<p>需要调节小车速度，使其能够平稳靠近火焰，避免过快靠近导致导航不稳定。</p>
<p>在接近火焰时候，需要确保小车精确停靠在火焰附近。</p>
<ol start="2">
<li>火焰识别可靠性和鲁棒性优化</li>
</ol>
<p>鲁棒性：确保火焰识别算法在各种环境下都可以稳定工作，提升火焰检测准确性。</p>
<hr>
<h2 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h2><ol>
<li>构建TF坐标变换树，有两种方法：</li>
</ol>
<ul>
<li>使用 URDF + Robot State Publisher（后面再用）</li>
<li>使用 robot_state_publisher 发布 TF（实验）</li>
</ul>
<ol start="2">
<li><p>获取火焰相对于小车底盘的位置</p>
</li>
<li><p>发布火焰相对于小车底盘的位置，方便其他节点订阅</p>
</li>
<li><p>将火焰相对于小车坐标转换成地图坐标，这样可以在全局地图上做路径规划和导航了</p>
</li>
<li><p>将火焰相对与地图的2D位置发布给move_base，从而使用全局以及局部路径规划算法，来计算路径，通过cml_vel话题发布命令控制小车朝目标移动</p>
</li>
</ol>
<hr>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="构建TF坐标变换"><a href="#构建TF坐标变换" class="headerlink" title="构建TF坐标变换"></a>构建TF坐标变换</h3><ol>
<li>使用robot_state_publisher</li>
</ol>
<p>在路径：<code>test_ws/src/mycar_start/launch/start_tf.launch</code>文件中做如下修改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 机器人启动文件：</span></span><br><span class="line"><span class="comment">        当不包含机器人模型时，需要发布坐标变换</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动雷达节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find lslidar_driver)/launch/start.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find pointcloud_to_laserscan)/launch/pointcloud_scan.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动小车节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find scout_base)/launch/scout_mini_base.launch&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;include file=&quot;$(find scout_bringup)/launch/scout_teleop_keyboard.launch&quot; /&gt;  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动相机节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;camera2basefootprint&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;tf2_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">args</span>=<span class="string">&quot;0.1 0 0.1 0 0 0 /base_link /camera_link&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;rplidar2basefootprint&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;tf2_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">args</span>=<span class="string">&quot;0 0 0.1 0 0 0 /base_link /laser&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于火焰识别功能包是在另外一个文件里面，所以没有添加相机启动节点，需要自己启动。</p>
<p>值得注意的是这个<strong>camera_link</strong>后期可能需要设置为其他坐标系，方便使用。</p>
<ol start="2">
<li>使用URDF + Robot State Publisher</li>
</ol>
<p>这个跟添加雷达操作类似，不再赘述，直接附上代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;mycar&quot;</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://wiki.ros.org/xacro&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_support_radius&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.01&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_support_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.10&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.02&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_width&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;camera_height&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_support_x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.12&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_support_y&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_support_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;wheel_vertical_offset + base_z_size / 2 + camera_support_length / 2&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_x&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_y&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;joint_camera_z&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;camera_support_length / 2 + camera_height / 2&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;camera_support&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;camera_support_radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;camera_support_length&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0.8 0.5 0.0 0.5&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;camera_support2base&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;camera_support&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;joint_camera_support_x&#125; $&#123;joint_camera_support_y&#125; $&#123;joint_camera_support_z&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;camera&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;$&#123;camera_length&#125; $&#123;camera_width&#125; $&#123;camera_height&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;0 0 0 0.8&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;camera2camera_support&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;camera_support&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;camera&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;joint_camera_x&#125; $&#123;joint_camera_y&#125; $&#123;joint_camera_z&#125;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在文件<code>scout_mini.urdf.xacro</code>中添加相机部件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Additional definitions --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(arg urdf_extras)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;scout_mini_laser.urdf.xacro&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;scout_mini_camera.urdf.xacro&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样就完成了相机的组成。看一下效果：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-15_10-23-24.png" style="zoom:50%;" />


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/15/Marker%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/Marker%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Marker基本使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Marker基本使用"><a href="#Marker基本使用" class="headerlink" title="Marker基本使用"></a>Marker基本使用</h1><h2 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h2><p>marker display允许在rviz中可视化数据，不需要了解任何有关解释数据的信息，相反，原始对象通过visualization_msgs&#x2F;Marker消息发布到显示器，这些消息允许显示箭头、框、球体和线条等对象。可以作为火焰识别后的显示来使用。</p>
<h2 id="算法介绍"><a href="#算法介绍" class="headerlink" title="算法介绍"></a>算法介绍</h2><ol>
<li><p>新建软件包：<code>catkin_create_pkg using_markers roscpp visualization_msgs</code></p>
</li>
<li><p>新建	src&#x2F;marker_shapes.cpp</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;visualization_msgs/Marker.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">( <span class="type">int</span> argc, <span class="type">char</span>** argv )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;basic_shapes&quot;</span>);</span><br><span class="line">  ros::NodeHandle n;</span><br><span class="line">  <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  ros::Publisher marker_pub = n.<span class="built_in">advertise</span>&lt;visualization_msgs::Marker&gt;(<span class="string">&quot;visualization_marker&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set our initial shape type to be a cube</span></span><br><span class="line">  <span class="type">uint32_t</span> shape = visualization_msgs::Marker::CUBE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    visualization_msgs::Marker marker;</span><br><span class="line">    <span class="comment">// Set the frame ID and timestamp.  See the TF tutorials for information on these.</span></span><br><span class="line">    marker.header.frame_id = <span class="string">&quot;my_frame&quot;</span>;</span><br><span class="line">    marker.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the namespace and id for this marker.  This serves to create a unique ID</span></span><br><span class="line">    <span class="comment">// Any marker sent with the same namespace and id will overwrite the old one</span></span><br><span class="line">    marker.ns = <span class="string">&quot;basic_shapes&quot;</span>;</span><br><span class="line">    marker.id = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the marker type.  Initially this is CUBE, and cycles between that and SPHERE, ARROW, and CYLINDER</span></span><br><span class="line">    marker.type = shape;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the marker action.  Options are ADD, DELETE, and new in ROS Indigo: 3 (DELETEALL)</span></span><br><span class="line">    marker.action = visualization_msgs::Marker::ADD;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the pose of the marker.  This is a full 6DOF pose relative to the frame/time specified in the header</span></span><br><span class="line">    marker.pose.position.x = <span class="number">0</span>;</span><br><span class="line">    marker.pose.position.y = <span class="number">0</span>;</span><br><span class="line">    marker.pose.position.z = <span class="number">0</span>;</span><br><span class="line">    marker.pose.orientation.x = <span class="number">0.0</span>;</span><br><span class="line">    marker.pose.orientation.y = <span class="number">0.0</span>;</span><br><span class="line">    marker.pose.orientation.z = <span class="number">0.0</span>;</span><br><span class="line">    marker.pose.orientation.w = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the scale of the marker -- 1x1x1 here means 1m on a side</span></span><br><span class="line">    marker.scale.x = <span class="number">1.0</span>;</span><br><span class="line">    marker.scale.y = <span class="number">1.0</span>;</span><br><span class="line">    marker.scale.z = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the color -- be sure to set alpha to something non-zero!</span></span><br><span class="line">    marker.color.r = <span class="number">0.0f</span>;</span><br><span class="line">    marker.color.g = <span class="number">1.0f</span>;</span><br><span class="line">    marker.color.b = <span class="number">0.0f</span>;</span><br><span class="line">    marker.color.a = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    marker.lifetime = ros::<span class="built_in">Duration</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Publish the marker</span></span><br><span class="line">    <span class="keyword">while</span> (marker_pub.<span class="built_in">getNumSubscribers</span>() &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (!ros::<span class="built_in">ok</span>())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">ROS_WARN_ONCE</span>(<span class="string">&quot;Please create a subscriber to the marker&quot;</span>);</span><br><span class="line">      <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    marker_pub.<span class="built_in">publish</span>(marker);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cycle between different shapes</span></span><br><span class="line">    <span class="keyword">switch</span> (shape)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::CUBE:</span><br><span class="line">      shape = visualization_msgs::Marker::SPHERE;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::SPHERE:</span><br><span class="line">      shape = visualization_msgs::Marker::ARROW;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::ARROW:</span><br><span class="line">      shape = visualization_msgs::Marker::CYLINDER;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> visualization_msgs::Marker::CYLINDER:</span><br><span class="line">      shape = visualization_msgs::Marker::CUBE;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.<span class="built_in">sleep</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>代码解释</li>
</ol>
<ul>
<li><pre><code class="language-cpp">#include &lt;ros/ros.h&gt;
#include &lt;visualization_msgs/Marker.h&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  包含依赖项，同时包含 visualization_msgs/Marker 消息定义。</span><br><span class="line"></span><br><span class="line">- ```  cpp</span><br><span class="line">  int main( int argc, char** argv )</span><br><span class="line">  &#123;</span><br><span class="line">    ros::init(argc, argv, &quot;basic_shapes&quot;);</span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    ros::Rate r(1);</span><br><span class="line">    ros::Publisher marker_pub = n.advertise&lt;visualization_msgs::Marker&gt;(&quot;visualization_marker&quot;, 1);</span><br></pre></td></tr></table></figure>

初始化ROS,并且在visualization_marker话题上创建一个ros::Publisher.
</code></pre>
</li>
<li><pre><code class="language-cpp">uint32_t shape = visualization_msgs::Marker::CUBE;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  创建一个整数来跟踪发布的形状，将使用四种类型都以相同的方式使用visiualization_msgs/Marker消息，因此可以简单切换形状类型来演示不同的形状。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">    while (ros::ok())</span><br><span class="line">    &#123;</span><br><span class="line">      visualization_msgs::Marker marker;</span><br><span class="line">      // Set the frame ID and timestamp.  See the TF tutorials for information on these.</span><br><span class="line">      marker.header.frame_id = &quot;/my_frame&quot;;</span><br><span class="line">      marker.header.stamp = ros::Time::now();</span><br></pre></td></tr></table></figure>

这是代码核心，首先**创建一个visualization_msgs/Marker消息类型，命名为marker, 设置Marker的header.frame_id**，通过TF来定义，命名为：my_frame,这个标记是相对于my_frame来定位的。最后一行设置了标记消息的时间戳，获取当前ROS时间，将其赋给header.stamp。
</code></pre>
</li>
<li><pre><code class="language-cpp">    marker.ns = &quot;basic_shapes&quot;;
    marker.id = 0;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  命名空间和id用于为此标记创建唯一的名称，如果收到相同的命名空间和id的标记消息，则新的标记会替代旧的标记。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      marker.type = shape;</span><br></pre></td></tr></table></figure>

此 type 字段指定我们要发送的标记类型。visualization_msgs /Marker 消息中列举了可用的类型。这里我们将类型设置为 shape 变量，该变量在每次循环中都会发生变化。
</code></pre>
</li>
<li><pre><code class="language-cpp">marker.action = visualization_msgs::Marker::ADD;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  action 字段指定如何处理标记。选项包括 visualization_msgs::Marker::ADD 和 visualization_msgs::Marker::DELETE 。 ADD 有点用词不当，它的真正含义是“创建或修改”。visualization_msgs::Marker::DELETEALL ,用于删除rviz中所有的标记。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      marker.pose.position.x = 0;</span><br><span class="line">      marker.pose.position.y = 0;</span><br><span class="line">      marker.pose.position.z = 0;</span><br><span class="line">      marker.pose.orientation.x = 0.0;</span><br><span class="line">      marker.pose.orientation.y = 0.0;</span><br><span class="line">      marker.pose.orientation.z = 0.0;</span><br><span class="line">      marker.pose.orientation.w = 1.0;</span><br><span class="line">  </span><br><span class="line">      // Set the scale of the marker -- 1x1x1 here means 1m on a side</span><br><span class="line">      marker.scale.x = 1.0;</span><br><span class="line">      marker.scale.y = 1.0;</span><br><span class="line">      marker.scale.z = 1.0;</span><br><span class="line">  </span><br><span class="line">      // Set the color -- be sure to set alpha to something non-zero!</span><br><span class="line">      marker.color.r = 0.0f;</span><br><span class="line">      marker.color.g = 1.0f;</span><br><span class="line">      marker.color.b = 0.0f;</span><br><span class="line">      marker.color.a = 1.0;</span><br></pre></td></tr></table></figure>

第一个是位置设置，设置为了坐标原点，第二个通过四元数标记方向，表示没有任何偏移，第三个是尺寸设置 ，标记的尺寸将根据这些比例进行缩放，后面一个是颜色设置，通过RGB表示。最后一个是透明度设置，1表示完全不透明。
</code></pre>
</li>
<li><pre><code class="language-cpp">    marker.lifetime = ros::Duration();
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  lifetime字段指定此标记在自动删除之前应保留多长时间，ros::Duration()表示永不删除。在达到lifetime之前收到新的标记消息，那么lifetime会被重置为新的标记的值.</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      while (marker_pub.getNumSubscribers() &lt; 1)</span><br><span class="line">      &#123;</span><br><span class="line">        if (!ros::ok())</span><br><span class="line">        &#123;</span><br><span class="line">          return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        ROS_WARN_ONCE(&quot;Please create a subscriber to the marker&quot;);</span><br><span class="line">        sleep(1);</span><br><span class="line">      &#125;</span><br><span class="line">      marker_pub.publish(marker);</span><br></pre></td></tr></table></figure>

等待标记有一个订阅者，然后发布标记，也可以使用锁存发布者来替代这个代码。通常在rviz中订阅my_frame.
</code></pre>
</li>
<li><pre><code class="language-cpp">    switch (shape)
    &#123;
    case visualization_msgs::Marker::CUBE:
      shape = visualization_msgs::Marker::SPHERE;
      break;
    case visualization_msgs::Marker::SPHERE:
      shape = visualization_msgs::Marker::ARROW;
      break;
    case visualization_msgs::Marker::ARROW:
      shape = visualization_msgs::Marker::CYLINDER;
      break;
    case visualization_msgs::Marker::CYLINDER:
      shape = visualization_msgs::Marker::CUBE;
      break;
    &#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  这段代码让我们在发布一条标记消息的同时显示所有的四个形状，根据当前的形状，设置下一个发布的形状。</span><br><span class="line"></span><br><span class="line">- ``` cpp</span><br><span class="line">      r.sleep();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

睡眠并且循环到顶部。
</code></pre>
</li>
</ul>
<ol start="3">
<li>构建代码</li>
</ol>
<p><code>catkin_make</code></p>
<ol start="5">
<li>运行代码</li>
</ol>
<p><code>rosrun using_markers basic_shapes</code></p>
<ol start="6">
<li>查看标记</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rviz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将Fixed Frames改成：my_frame,然后新增加一个Marker，指定的默认话题是visualization_marker,然后就能在原点处看到一个形状，每秒都会变换。</p>
<p>展示一下结果：</p>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250709162557150.png" alt="image-20250709162557150" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/image-20250709162730038.png" alt="image-20250709162730038" style="zoom:67%;" />

<p>marker基础的使用就这么多，后续继续学习。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://gen2710.netlify.app/2025/07/15/%E4%BD%BF%E7%94%A8Marker%E5%B0%86%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%9C%A8Rviz%E4%B8%AD%E6%98%BE%E7%A4%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/jiangbaoaaa/my_blog_img/main/myself.jpg">
      <meta itemprop="name" content="Hita">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="U.N.O">
      <meta itemprop="description" content="Gains Don't Stop!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | U.N.O">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E4%BD%BF%E7%94%A8Marker%E5%B0%86%E7%81%AB%E7%84%B0%E4%BD%8D%E7%BD%AE%E5%9C%A8Rviz%E4%B8%AD%E6%98%BE%E7%A4%BA/" class="post-title-link" itemprop="url">使用Marker将火焰位置在Rviz中显示</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-23 19:41:37" itemprop="dateModified" datetime="2025-07-23T19:41:37+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">ROS学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用Marker将火焰位置在Rviz中显示"><a href="#使用Marker将火焰位置在Rviz中显示" class="headerlink" title="使用Marker将火焰位置在Rviz中显示"></a>使用Marker将火焰位置在Rviz中显示</h1><h2 id="思路介绍"><a href="#思路介绍" class="headerlink" title="思路介绍"></a>思路介绍</h2><p>要使用marker来显示火焰的位置，首先需要在3Dlocator代码中将火焰相对于相机坐标系的坐标发布出去，然后由marker来订阅。</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><ol>
<li>fire_3D_locator</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image, CameraInfo</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Point, PointStamped</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fire3DLocator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bridge = CvBridge()</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.intrinsics = <span class="literal">None</span></span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/aligned_depth_to_color/image_raw&quot;</span>, Image, <span class="variable language_">self</span>.depth_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/camera/color/camera_info&quot;</span>, CameraInfo, <span class="variable language_">self</span>.info_callback)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_center_px&quot;</span>, Point, <span class="variable language_">self</span>.fire_callback)</span><br><span class="line">        <span class="variable language_">self</span>.pub = rospy.Publisher(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, queue_size=<span class="number">10</span>)</span><br><span class="line">        cv2.namedWindow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.WINDOW_NORMAL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.intrinsics:</span><br><span class="line">            <span class="variable language_">self</span>.intrinsics = &#123;</span><br><span class="line">                <span class="string">&#x27;fx&#x27;</span>: msg.K[<span class="number">0</span>], <span class="string">&#x27;fy&#x27;</span>: msg.K[<span class="number">4</span>],</span><br><span class="line">                <span class="string">&#x27;cx&#x27;</span>: msg.K[<span class="number">2</span>], <span class="string">&#x27;cy&#x27;</span>: msg.K[<span class="number">5</span>]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">depth_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="variable language_">self</span>.depth_image = <span class="variable language_">self</span>.bridge.imgmsg_to_cv2(msg, <span class="string">&quot;passthrough&quot;</span>)</span><br><span class="line">        <span class="comment"># 深度图归一化显示</span></span><br><span class="line">        norm_depth = cv2.normalize(<span class="variable language_">self</span>.depth_image, <span class="literal">None</span>, <span class="number">0</span>, <span class="number">255</span>, cv2.NORM_MINMAX, dtype=cv2.CV_8U)</span><br><span class="line">        cv2.imshow(<span class="string">&quot;Depth Visualization&quot;</span>, cv2.applyColorMap(norm_depth, cv2.COLORMAP_JET))</span><br><span class="line">        cv2.waitKey(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fire_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.depth_image <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="variable language_">self</span>.intrinsics <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        u, v = <span class="built_in">int</span>(msg.x), <span class="built_in">int</span>(msg.y)</span><br><span class="line">        depth = <span class="variable language_">self</span>.depth_image[v, u] / <span class="number">1000.0</span>  <span class="comment"># mm转m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="comment"># 计算相机坐标系下的3D坐标</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0.1</span> &lt; depth &lt;<span class="number">10.0</span>:</span><br><span class="line">            point_3d = PointStamped()</span><br><span class="line">            point_3d.header.frame_id = <span class="string">&quot;camera_depth_optical_frame&quot;</span>  <span class="comment"># 使用相机光学坐标系:ml-citation&#123;ref=&quot;3&quot; data=&quot;citationList&quot;&#125;</span></span><br><span class="line">            point_3d.header.stamp = rospy.Time.now()</span><br><span class="line">        </span><br><span class="line">            <span class="comment"># 像素坐标转3D坐标（针孔相机模型）:ml-citation&#123;ref=&quot;1&quot; data=&quot;citationList&quot;&#125;</span></span><br><span class="line">            point_3d.point.x = (u - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cx&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fx&#x27;</span>]</span><br><span class="line">            point_3d.point.y = (v - <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;cy&#x27;</span>]) * depth / <span class="variable language_">self</span>.intrinsics[<span class="string">&#x27;fy&#x27;</span>]</span><br><span class="line">            point_3d.point.z = depth</span><br><span class="line">        </span><br><span class="line">            <span class="variable language_">self</span>.pub.publish(point_3d)  <span class="comment"># 发布3D坐标</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#终端显示火焰位置</span></span><br><span class="line">            rospy.loginfo(<span class="string">&quot;\n火焰位置(相机坐标系):\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;X: <span class="subst">&#123;point_3d.point.x:<span class="number">.3</span>f&#125;</span> m\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;Y: <span class="subst">&#123;point_3d.point.y:<span class="number">.3</span>f&#125;</span> m\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;Z: <span class="subst">&#123;point_3d.point.z:<span class="number">.3</span>f&#125;</span> m\n&quot;</span></span><br><span class="line">                        <span class="string">f&quot;像素坐标: (<span class="subst">&#123;u&#125;</span>, <span class="subst">&#123;v&#125;</span>)&quot;</span>)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;fire_3d_locator&#x27;</span>)</span><br><span class="line">    Fire3DLocator()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>fire_marker_publisher</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> visualization_msgs.msg <span class="keyword">import</span> Marker</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PointStamped</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FireMarkerPublisher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        rospy.init_node(<span class="string">&#x27;fire_marker_publisher&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.marker_pub = rospy.Publisher(<span class="string">&#x27;/fire_marker&#x27;</span>, Marker, queue_size=<span class="number">10</span>)</span><br><span class="line">        rospy.Subscriber(<span class="string">&quot;/fire_position_3d&quot;</span>, PointStamped, <span class="variable language_">self</span>.callback)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 动态更新参数</span></span><br><span class="line">        <span class="variable language_">self</span>.last_position = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker = Marker()</span><br><span class="line">        <span class="variable language_">self</span>.update_threshold = <span class="number">0.3</span>  <span class="comment"># 位置变化阈值(米)</span></span><br><span class="line">        <span class="variable language_">self</span>.stable_timeout = rospy.Duration(<span class="number">2.0</span>)  <span class="comment"># 稳定持续时间</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化默认Marker</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.ns = <span class="string">&quot;fire_detection&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.<span class="built_in">id</span> = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.<span class="built_in">type</span> = Marker.SPHERE</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.action = Marker.ADD</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.scale.x = <span class="variable language_">self</span>.current_marker.scale.y = <span class="variable language_">self</span>.current_marker.scale.z = <span class="number">0.1</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.color.r = <span class="number">1.0</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.color.a = <span class="number">0.8</span></span><br><span class="line">        <span class="variable language_">self</span>.current_marker.lifetime = rospy.Duration(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        current_pos = np.array([msg.point.x, msg.point.y, msg.point.z])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 首次检测或超过稳定时间</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.last_position <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> \</span><br><span class="line">           (rospy.Time.now() - <span class="variable language_">self</span>.current_marker.header.stamp) &gt; <span class="variable language_">self</span>.stable_timeout:</span><br><span class="line">            <span class="variable language_">self</span>._update_marker(msg, current_pos)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 计算位置变化量</span></span><br><span class="line">        displacement = np.linalg.norm(current_pos - <span class="variable language_">self</span>.last_position)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 超过阈值则更新</span></span><br><span class="line">        <span class="keyword">if</span> displacement &gt; <span class="variable language_">self</span>.update_threshold:</span><br><span class="line">            <span class="variable language_">self</span>._update_marker(msg, current_pos)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_update_marker</span>(<span class="params">self, msg, new_pos</span>):</span><br><span class="line">        <span class="variable language_">self</span>.last_position = new_pos</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.header = msg.header</span><br><span class="line">        <span class="variable language_">self</span>.current_marker.pose.position = msg.point</span><br><span class="line">        <span class="comment">#self.current_marker.header.stamp = rospy.Time.now()  # 重置时间戳</span></span><br><span class="line">        <span class="variable language_">self</span>.marker_pub.publish(<span class="variable language_">self</span>.current_marker)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    FireMarkerPublisher()</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为了保证marker数据显示的稳定性，添加了一个稳定时间以及位置变化阈值，这样可以稳定输出火焰位置。</p>
<h2 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h2><ol>
<li><pre><code class="language-bash"># 依次打开以下节点
roslaunch realsense2_camera rs_camera.launch align_depth:=true
rosrun robot_vision fire_detector.py 
rosrun robot_vision fire_3D_locator.py 
rosrun robot_vision fire_marker_publisher.py 
</code></pre>
<p>执行完以下程序之后，可以看到结果：</p>
</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/11212.png" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-14_15-10-29.png" style="zoom:50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/jiangbaoaaa/my_blog_img@main/Snipaste_2025-07-14_15-11-11.png"></p>
<p>这样既可以在rviz中显示火焰的位置，也可以在终端显示火焰相对于相机的具体位置。后续作用于小车上也很方便进行。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hita</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
